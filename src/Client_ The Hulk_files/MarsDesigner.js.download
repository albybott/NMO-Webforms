var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},_MicrosoftMars;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(){function t(){}return t.loadConfigurationData=function(n){var i=new window._MicrosoftMars.Client.Utility.Util,t=JSON.stringify(n.Result);localStorage[this.allConfigurationKey]=t;sessionStorage[this.allConfigurationKey]=t;sessionStorage[this.INVALIDATE_CONFIG_CACHE_KEY]="false";this.addConfigEtagToStore(n);i.initializeConfiguration()},t.addConfigEtagToStore=function(n){jQuery.isEmptyObject(n)||jQuery.isEmptyObject(n.ETags)||(sessionStorage[this.MARS_ETAGS]=JSON.stringify(n.ETags))},t.saveConfigurationUserRolesToLocalStore=function(t){var i=JSON.parse(localStorage[this.allConfigurationKey]),r,u;i&&(r=i.ProductOrgDetail.AuthoringId,u=n.Loader.$mars.grep(i.AuthoringDetails,function(n){return n.AuthoringGroupDetail.AuthoringId.toLowerCase()===r.toLowerCase()})[0],u.AuthoringGroupDetail.ConfigurationUserRoles=t,localStorage[this.allConfigurationKey]=JSON.stringify(i))},t.allConfigurationKey="allConfigurationKey",t.INVALIDATE_CONFIG_CACHE_KEY="INVALIDATE_CONFIG_CACHE_KEY",t.MARS_ETAGS="ETags",t}();t.ConfigurationUtil=i})(t=n.Utility||(n.Utility={}))})(t=n.Client||(n.Client={}))})(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){"use strict";var r=function(){function n(){}return n.Analyze="Analyze",n}(),i;t.AnalyticsTelemetryType=r;i=function(){function t(){var n=window._MicrosoftMars.Client.Telemetry;this.activity=new n.UserActivityEvent(n.ActivityName.analyze)}return t.prototype.startActivity=function(t){var i=[t];this.activity.SetActivityData(i);this.activity.SetUserActivityInfo(n.Loader.appContext.userId,"","","",n.Loader.appContext.getAuthoringId(),"","","")},t.prototype.finishActivity=function(n){var t=window._MicrosoftMars.Client.Telemetry;this.activity.FinishActivity(t.EndAction[n])},t}();t.AnalyticsTelemetry=i})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){"use strict";var i=function(){function t(){}return t.toggleUpDown=function(t,i){for(var r=-1,u=-1,f=0;f<i.length;f++)if(i[f].infocus){r=f;break}t==n.Utility.KeyCodeEnum.DownArrowKey?r==-1?(r=0,u=1):u=r==i.length-1?0:r+1:t==n.Utility.KeyCodeEnum.UpArrowKey&&(r==-1?(r=0,u=i.length-1):u=r==0?i.length-1:r-1);r!=-1&&u!=-1&&(i[r].infocus=!1,i[u].infocus=!0,i[u].focus())},t.setFocus=function(n,t){for(var i=0;i<n.length;i++)n[i].infocus=n[i].getAttribute("data-value")==t.getAttribute("data-value")?!0:!1},t}();t.MenuKeyboardHandler=i})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var f=function(){function r(){this.ControlVersionId=i.Util.Constants.EmptyGuid;this.ControlId=i.Util.Constants.EmptyGuid;this.AuthoringId=i.Util.Constants.EmptyGuid;this.Version=i.Util.Constants.defaultVersion;this.ControlName="";this.ControlType=null;this.CreateTelemetry=!1;this.MetadataJson={Index:0,Content:{},ClientId:"",ParentControlIds:[],Links:[],ChildControlIds:[],Template:"",UITrigger:"invoked",Width:0,Pages:1,IsSideBarHeaderDisabled:!1,IsSideBarTitleDisabled:!1,IsSideBarFooterDisabled:!1,EnableWildCardNavigation:!1,IsFooterSectionAvailable:!1,ShowBubbleElementPointer:!0,SupportedLanguagesForControl:[],PublishingGroupsInfo:[],EnableNudge:!0,PageNavigationInfo:"",ElementIdentifier:"",HybridType:"click",PlacementPosition:"",LearnMoreCaption:i.Locale.learnMoreCaption};this.Comments="";this.CreatedDate="";this.LastUpdatedDate=null;this.Enabled=!0;this.AuthorId=n.Client.Loader.appContext.UserId;this.AuthorName=n.Client.Loader.appContext.UserName;this.LastUpdatedByUserId=i.Util.Constants.EmptyGuid;this.CheckedOut=!1;this.CheckedOutByUserId=i.Util.Constants.EmptyGuid;this.CheckedOutByUserName="";this.LastCheckedOutDate=null;this.IsContextHomeSideBar=!1;this.IsErrorControl=!1;this.Events=[];this.Tags="";this.ObjectState=t.Utility.LearningPathObjectState.Added;this.CustomAttributes=[];this.BaseLcid=n.Client.Loader.defaultLanguageLcid;this.LanguageControlVersionContents=[];this.Title=""}return r}(),o,s,h,c,l,u,a,v,e,y,p,w,b,k,d;r.ControlBaseMetadata=f;o=function(){function r(){this.Id=i.Util.Constants.EmptyGuid;this.ControlVersionId=i.Util.Constants.EmptyGuid;this.Lcid=n.Client.Loader.defaultLanguageLcid;this.HtmlView="";this.Xliff="";this.Title="";this.ObjectState=t.Utility.LearningPathObjectState.Added;this.MarsObjectCompositeKey=""}return r}();r.LanguageControlVersionContentsModel=o;s=function(){function n(){this.Id=i.Util.Constants.EmptyGuid;this.Key="";this.Value="";this.Precedence=0;this.EntityContextValue=null}return n}();r.ContextValueModel=s;h=function(){function n(){this.Id=i.Util.Constants.EmptyGuid;this.ObjectState=t.Utility.LearningPathObjectState.Added}return n}();r.ContextGroupElementModel=h;c=function(){function n(){this.Id=i.Util.Constants.EmptyGuid;this.Title="";this.ObjectState=t.Utility.LearningPathObjectState.Added}return n}();r.ContextGroupModel=c;l=function(){function n(){this.Id=i.Util.Constants.EmptyGuid}return n}();r.ControlContextModel=l;u=function(n){function t(){n.apply(this,arguments);this.Contexts=[]}return __extends(t,n),t}(f);r.ControlWithContext=u;a=function(n){function t(){n.call(this);this.Sections=[];this.ControlType=i.Utility.ControlTypes.Sidebar;this.CreateTelemetry=!1}return __extends(t,n),t}(u);r.SidebarMetadata=a;v=function(n){function t(){n.call(this);this.Steps=[];this.ControlType=i.Utility.ControlTypes.GuidedTask;this.CreateTelemetry=!1}return __extends(t,n),t}(u);r.GuidedTaskMetadata=v;e=function(){function n(){this.Id=i.Utility.Util.newGuid();this.ControlId=i.Util.Constants.EmptyGuid;this.ControlVersionId=i.Util.Constants.EmptyGuid;this.UseLatest=!0}return n}();r.ControlReferenceModel=e;y=function(n){function t(){n.apply(this,arguments);this.Links=[]}return __extends(t,n),t}(f);r.SectionMetadata=y;p=function(){function n(){this.CommentsModel={UserName:"",Version:"",Text:"",Date:new Date};this.VideoTitleModel={Title:"",VideoSource:"",VideoTagSupport:0,VideoHeaderText:"",VideoFooterText:""};this.TextTitleModel={Title:"",Text:""};this.LegacyHelpModel={Title:"",LinkText:i.Locale.legacyHelpLink};this.ListOfLinksModel={Title:"",Links:[]};this.LinksModel={Id:i.Utility.Util.newGuid(),LinkType:i.Utility.LinkType.None,Title:"",OpenInNew:"",Url:"http://",EnableNavigation:!1,PageNavigationInfo:"",DialogHeight:"",DialogWidth:"",DialogCallback:"",CallbackFuntion:"",LinkHolder:"",LinkEnabled:!0,ControlReference:new e};this.AddButtonsModel={Title:"",Text:"",Links:[]};this.FooterSectionModel={Title:"",Text:"",Links:[]};this.EventModel={Id:"",Trigger:"",Action:"",ChainedTo:""};this.SupportedLanguagesStructure={ControlVersionLanguageName:"",ControlVersionLcid:0,ControlVersionId:"",Version:""};this.PublishingGroupsInfoStructure={LanguageName:"",Version:"",AppVersion:"",LastPublished:""}}return n}();r.MetaDataJsonElementStructure=p;w=function(){function n(){this.SectionIndex=0}return n}();r.DynamicSectionModel=w;b=function(){function n(){this.ControlName="";this.Title="";this.ControlType=-1}return n}();r.EnabledTemplateModel=b;k=function(){function n(){this.Key="";this.Value="";this.wildcarded=!1;this.enableWildcard=!1}return n}();r.WildCardRowModel=k;d=function(){function n(){this.AuthorId="";this.AuthorName=""}return n}();r.UpdateAuthorModel=d})(r=i.Content||(i.Content={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.landingPageViewName="landingpageview",n.skinnyToolbarViewName="skinnytoolbarview",n.defaultVersion="1.0.0",n.ActiveStep="ActiveStep",n.PassiveStep="PassiveStep",n.InfoBubble="InfoBubble",n.Step="Step",n.SpecialTemplate="Special Template",n.GuidedTask="StepThrough",n.close="close",n.xbutton="xbutton",n.trigger="click",n.DesktopFormFactor="1",n.TabletFormFactor="2",n.PhoneFormFactor="3",n.ExtraLargeFormFactor="4",n.LargeFormFactor="5",n.Medium="6",n.Small="7",n.MaximumPageSize="500",n.MobileClientType="Mobile",n.MobileClient="mobile",n.WebClientType="Web",n.ISHClientType="Ish",n.UCIClientType="UCI",n.EmptyGuid="00000000-0000-0000-0000-000000000000",n.allConfigurationKey="allConfigurationKey",n.isTemplatesLoaded="isTemplatesLoaded",n.CustomAttributeSetting="CustomAttributeSetting",n.FormFactorExpression="AppInfo.DeviceInfo.formfactor",n.Attributes="Attributes",n.StaticToken="static",n.DynamicToken="dynamic",n.MultivaluedDynamicToken="multivaluedDynamic",n.draft="Draft",n.review="Review",n.readytoPublish="ReadytoPublish",n.published="Published",n.archive="Archive",n.hold="Hold",n.readytoPublishonHold="ReadytoPublishonHold",n.contentCheck="ContentCheck",n.reviewDone="ReviewDone",n.Global="Global",n.App="App",n.locHandoff="LocHandoff",n.locHandbackComplete="LocHandbackComplete",n.PublishGroupId="PublishGroupSetting",n.apiKeysForDynamicToken=["AppInfo.OrgInfo","AppInfo.UserInfo","Client","Control","Navigation","Section","Tabs","FormSelector","App"],n.apiValuesForDynamicToken=[{"AppInfo.OrgInfo":"OrgName"},{"AppInfo.OrgInfo":"OrgLCID"},{"AppInfo.OrgInfo":"ClientUrl"},{"AppInfo.UserInfo":"UserLcid"},{"AppInfo.UserInfo":"UserName"},{"AppInfo.UserInfo":"UserId"},{Client:"ClientName"},{Client:"ClientState"},{Client:"ClientUrl"},{Control:"ControlType"},{Control:"ControlName"},{Control:"Parent"},{Control:"ControlLabel"},{Navigation:"Id"},{Navigation:"Label"},{Section:"Id"},{Section:"Label"},{Tabs:"Id"},{Tabs:"Label"},{FormSelector:"Id"},{FormSelector:"Label"},{App:"AppName"},{App:"AppVersion"}],n.apiKeysForMultivaluedToken=["AppInfo.client","AppInfo.DeviceInfo.formfactor"],n.apiValuesForMultivaluedToken=[{"AppInfo.client":"Default"},{"AppInfo.client":"Mobile"},{"AppInfo.client":"Web"},{"AppInfo.client":"Outlook"},{"AppInfo.DeviceInfo.formfactor":"Desktop"},{"AppInfo.DeviceInfo.formfactor":"Tablet"},{"AppInfo.DeviceInfo.formfactor":"Phone"}],n.controlType="ControlType",n.controlId="ControlId",n.enabled="Enabled",n.status="Status",n.buildAction="build",n.buildActionType="Build",n.viewReportsAction="ViewReports",n.viewControlReport="ControlReport",n.readOnly="readonly",n.aCopy="copy",n.LanguageSetting="LanguageSetting",n.SecuritySetting="SecuritySetting",n.UserRoleSetting="UserRoleSetting",n.ContextSetting="ContextSetting",n.LifeCycleStageSetting="LifeCycleStageSetting",n.publishAction="publish",n.publishActionType="Publish",n.publishSyncActionType="PublishControlSync",n.checkInAction="checkin",n.deleteControlAction="DeleteControlData",n.exportControlAction="ExportControlXml",n.bulkEditAction="bulkedit",n.ControlExistPopup="ControlExistPopup",n.NoNavigationInfoPopup="NoNavigationInfoPopup",n.inProgress="inprogress",n.answerpanel="answerpanel",n.stepthrough="stepthrough",n.NoControlSelctedPopup="NocontrolSelectedPopup",n.UnAuthorizedPopup="UnAuthorizedPopup",n.answerPanelSection="Section",n.emptyHtmlView="<contentblock><empty><\/empty><\/contentblock>",n.answerPanel="AnswerPanel",n.statusPublished="Published",n.uploadedFiles="UploadedFiles",n.placeImagePopup="PlaceImagePopup",n.UserExperienceSetting="UserExperienceSetting",n.controlXMLZipFile="DownloadedControls.zip",n.exportControlXML="ExportControl",n.Lcid=-1,n.exportLearningPath="ExportLearningPaths",n.NoLearningPathSelectedPopup="NoLearningPathSelctedPopup",n.xliffZipFile="DownloadedXliffFiles.zip",n.exportControl="ExportControlXliff",n.importControl="ImportControlXliff",n.reviewerRoleName="Reviewer",n.publisherRoleName="Publisher",n.authorRoleName="Author",n.adminRoleName="Admin",n.editorRoleName="Editor",n.localizerRoleName="Localizer",n.ErrorSideBar="ErrorSideBar",n.ErrorGuidedTask="ErrorGuidedTask",n.sideBar="sidebar",n.guidedTask="guidedtask",n.both="both",n.Section="section",n.PageInApp="pageinapp",n.WebPage="webpage",n.oneButton="OneButton",n.twoButton="TwoButton",n.elementSelectionWidthForMOCA="6%",n.stepRenderingWidthForMOCA="100%",n.statusWaitTime=5e3,n.GlobalScope="Global",n.exportConfigurationXml="ExportXml",n.configurationFile="Configuration.xml",n.safari="Safari",n.firefox="Firefox",n.chrome="Chrome",n.internetExplorer="IE",n.title="Title",n.selectedContent="selectedContent",n.insightsPortal="insightsPortal",n.passiveStepBubbleContainer="passiveStepBubbleContainer",n.activeStepBubbleContainer="activeStepBubbleContainer",n.clickHybridType="click",n.inputHybridType="input",n.customHybridType="custom",n.tokeNameRegEx="[/\\\\#' \"]",n.DeleteContentPopUp="DeleteContentPopUp",n.existingGuidedTask="renderer_addexistingguidedtasktemplate",n.defaultTemplate="renderer_answerpaneldefaulttemplate",n.titleTextTemplate="renderer_titletexttemplate",n.titleTextLinkTemplate="renderer_titletextlinktemplate",n.titleImageTemplate="renderer_titleimagetemplate",n.titleVideoTemplate="renderer_titlevideotemplate",n.titleVideoPreviewTemplate="renderer_titlevideotemplatepreview",n.listOflinkTemplate="renderer_listoflinkstemplate",n.onebuttonTemplate="renderer_onebuttontemplate",n.twobuttonTemplate="renderer_twobuttontemplate",n.twobuttonPreviewTemplate="renderer_twobuttontemplatepreview",n.footerSectionTemplate="renderer_footersectiontemplate",n.addExistingGuidedTaskTemplate="renderer_addexistingguidedtasktemplate",n.addExistingGuidedTaskTemplatePreview="renderer_addexistingguidedtasktemplatepreview",n.legacyHelpTemplate="renderer_legacyhelptemplate",n.checklistTemplate="renderer_addchecklistsectiontemplate",n.errorSidebarTemplate="renderer_errorsidebartemplate",n.answerPanel2x1Template="renderer_answerpanel2x1template",n.answerPanelEightSectionTemplate="renderer_answerpaneleightsectiontemplate",n.answerPanel1xCustomTemplate="renderer_answerpanel1xcustomtemplate",n.answerPanel2xCustomTemplate="renderer_answerpanel2xcustomtemplate",n.answerPanel2x2Template="renderer_answerpanel2x2template",n.answerPanelCustomTemplate="renderer_answerpanelcustomtemplate",n.answerPanelChecklistTemplate="renderer_answerpanelchecklisttemplate",n.sectionPreviewTemplate="renderer_sectionpreviewtemplate",n.sidebarDefaultPreviewTemplate="renderer_answerpaneldefaultpreviewtemplate",n.answerPanel2x2PreviewTemplate="renderer_answerpanel2x2previewtemplate",n.answerPanelCustomPreviewTemplate="renderer_answerpanelcustompreviewtemplate",n.errorSidebarPreviewTemplate="renderer_errorsidebarpreviewtemplate",n.answerPanelChecklistPreviewTemplate="renderer_answerpanelchecklistpreviewtemplate",n.addStepMessageTemplate="renderer_addstepmessage",n.stepTemplate="renderer_steptemplate",n.multiSelectDropdownTemplate="renderer_multiselectdropdowntemplate",n.newTokeSelectConditionalTextTemplate="renderer_newtokenselectconditionaltexttemplate",n.newTokenSelectEntityTemplate="renderer_newtokenselectentitytemplate",n.newTokenTemplate="renderer_newtokentemplate",n.activeBubblePreviewViewTemplate="renderer_activebubblepreviewview",n.passiveBubblePreviewViewTemplate="renderer_passivebubblepreviewview",n.infoBubblePreviewViewTemplate="renderer_infobubblepreviewview",n.languageControlTemplate="renderer_languagecontroltemplate",n.guidedTaskFlowViewTemplate="renderer_guidedtaskflowview",n.guidedTaskSetupViewTemplate="renderer_guidedtasksetupviewtemplate",n.activeBubbleDisplayViewTemplate="renderer_activebubbledisplayview",n.passiveBubbleDisplayViewTemplate="renderer_passivebubbledisplayview",n.waitingBubbleDisplayViewTemplate="renderer_waitingbubbledisplayview",n.hybridBubbleDisplayViewTemplate="renderer_hybridbubbledisplayview",n.infoBubbleDisplayViewTemplate="renderer_infobubbledisplayview",n.insertSectionTemplate="renderer_insertsection",n.detailedInsertSectionForReadOnly="renderer_detailedinsertsectionforreadonly",n.detailedInsertSectionForCopy="renderer_detailedinsertsectionforcopy",n.titleImageLocationTemplate="renderer_titleimagelocationtemplate",n.titleImageContentTemplate="renderer_titleimagecontenttemplate",n.imageEnlargePopupTemplate="renderer_imageenlargepopuptemplate",n.listOfLinksPopupTemplate="renderer_listoflinkspopuptemplate",n.sidebarNavigationSelectionPopup="renderer_sidebarnavigationselectionpopup",n.commentsViewTemplate="renderer_commentsviewtemplate",n.masterTemplate="renderer_mastertemplate",n.customAttributeControlTemplate="renderer_customattributecontroltemplate",n.simpleDialogTemplate="renderer_simpledialogtemplate",n.customAttributeTableTemplate="renderer_customattributetabletemplate",n.dialogTemplate="renderer_dialogtemplate",n.exportSelectLanguageDialogTemplate="renderer_exportselectlanguagedialogtemplate",n.footerButtonViewTemplate="renderer_footerbuttonviewtemplate",n.headerTemplate="renderer_headertemplate",n.importLanguageDialogTemplate="renderer_importlanguagedialogtemplate",n.landingPagePanelViewTemplate="renderer_landingpagepanelview",n.publishPopupTemplate="renderer_publishpopup",n.bulkEditPopupTemplate="renderer_bulkeditpopup",n.propertyTabTemplate="renderer_propertytab",n.searchtemplate="renderer_searchtemplate",n.stepheader="renderer_stepheadertemplate",n.controlToolTab="renderer_controltooltabtemplate",n.sectionfooterTemplate="renderer_sectionfootertemplate",n.propertyTabBuilderControlTemplate="renderer_propertytabbuildercontrolviewtemplate",n.sectionFooterbuilderControlTemplate="renderer_sectionfooterbuildercontrolviewtemplate",n.skinnyToolbarViewTemplate="renderer_skinnytoolbarview",n.sidebarSetupViewTemplate="renderer_sidebarsetupviewtemplate",n.controlActionToolTab="renderer_controlactiontooltab",n.sidebarAdvancedOptionsViewTemplate="renderer_sidebaradvancesetupviewtemplate",n.sidebarAdvancedOptionsViewPublishingInfoTemplate="renderer_sidebaradvancedpublishinggroups",n.editSectionTemplate="renderer_editsectiontemplate",n.sidebarAdvancedOptionsViewWildcardTableTemplate="renderer_sidebaradvancedviewwildcardtable",n.sidebarAdvancedOptionsViewAppModuleListTable="renderer_sidebaradvancedappmodulelisttable",n.sidebarAdvancedOptionsViewSupportedLanguagesTemplate="renderer_sidebaradvancedsupportedlanguagesgrid",n.flowEditorSidePanelTemplate="renderer_floweditorsidepaneltemplate",n.sidebarAdvancedDynamicPropertiesTable="renderer_sidebaradvanceddynamicpropertiestable",n.sidebarAdvancedDynamicPropertiesForm="renderer_dynamicpropertyform",n.sidebarExistingDynamicProperties="renderer_sidebarexistingdynamicproperties",n.stepContainer="renderer_stepcontainertemplate",n.addNewBubbleListTemplate="renderer_addnewbubblelisttemplate",n.configurationTemplate="renderer_configurationtemplate",n.configurationMenuTemplate="renderer_configurationmenutemplate",n.configurationContainerTemplate="renderer_configurationcontainertemplate",n.analyzeTemplate="renderer_analyzetemplate",n.analyzeContainerTemplate="renderer_analyzecontainertemplate",n.analyzeMenuTemplate="renderer_analyzemenutemplate",n.securityRolesTemplate="renderer_securityrolestemplate",n.publishingConfigurationTemplate="renderer_publishingconfigurationtemplate",n.addNewPublishingGroupTemplate="renderer_addnewpublishinggrouptemplate",n.microsoftSettingsTemplate="renderer_microsoftsettingstemplate",n.advancedOptionTemplate="renderer_advancedoptiontemplate",n.stepBubbleContainerTemplate="renderer_stepbubblecontainertemplate",n.titleTextGtTemplate="renderer_gttexttemplate",n.titleVideoGtTemplate="renderer_gtvideotemplate",n.titleTwoButtonGtTemplate="renderer_gttwobuttontemplate",n.titleTextTemplateGt="renderer_titletexttemplategt",n.bubbleViewTemplate="renderer_bubbleviewtemplate",n.stepContainerItemTemplate="renderer_stepcontaineritemtemplate",n.controlImport="Import",n.gtTitleVideoPreviewTemplate="renderer_gttitlevideotemplatepreview",n.gtTitleTextPreviewTemplate="renderer_gttitletexttemplatepreview",n.incorrectURLFormat="Incorrect URL Format",n.internalServerError="Internal server error",n.MouseDownEventName=window.PointerEvent?"pointerdown":"mousedown",n.crmPageTitleKey="CrmPageTitle",n}();n.Constants=t})(t=n.Util||(n.Util={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(){function u(){}return u.convertDateToUtc=function(n){return n.toUTCString()},u.convertUtcToLocal=function(t,i){var u,f;if(i===void 0&&(i=!1),t!=null){if(u=(new n.Client.Utility.Util).getBrowserInfo(),u.name!==r.Constants.safari){if(i){if(u.name===r.Constants.firefox||u.name===r.Constants.chrome)return this.formatLocalDate(t)}else return f=(new n.Client.Loader.SearchAnswerPanelApi).getMarket(),t.toLocaleString(f);return t.toLocaleString().replace(/[^ -~]/g,"")}return t.toGMTString().substr(0,t.toGMTString().indexOf("GMT"))}return t},u.getLocalDateTime=function(n){var t,i;return n&&(t=n.toString(),t.indexOf("Z")<0&&t.indexOf("UTC")<0&&t.indexOf("GMT")<0?(i=Date.parse(n+"Z"),n=r.Common.convertUtcToLocal(new Date(i))):n=r.Common.convertUtcToLocal(new Date(n)),n=n.replace("  UTC","")),n},u.convertMMddyyyToyyyymmdd=function(n){if(n){var t=n.split(",");return t[0].split("/")[2]+"-"+t[0].split("/")[0]+"-"+t[0].split("/")[1]+t[1]}return null},u.formatLocalDate=function(n,t){var u,f;t===void 0&&(t=!1);var e=(n.getMonth()+1<10?"0":"")+(n.getMonth()+1),r=n.getHours()>=12?"pm":"am",i=n.getHours()%12;return i==0&&r=="pm"&&(i=12),u=(n.getMinutes()<10?"0":"")+n.getMinutes(),f=n.getSeconds(),t?e+"/"+n.getDate()+"/"+n.getFullYear()+" "+i+":"+u+":"+f+" "+r+"  UTC":e+"/"+n.getDate()+"/"+n.getFullYear()+" "+i+":"+u+":"+f+" "+r},u.getContextTypeMetadata=function(n,t){var e=[],o=n.Contexts,u,i,r,f;if(o)for(u=0;u<o.length;u++)if(i=n.Contexts[u].ContextGroup.ContextGroupElements,i)for(r=0;r<i.length;r++)if(i[r].ContextTypeMetaDataId==t)for(f=0;f<i[r].ContextValues.length;f++)e.push(i[r].ContextValues[f].Value);return e},u.getVersionChangeType=function(n,i){var r=n.trim().split("."),u=i.trim().split(".");return r.length!=4||u.length!=4?t.Utility.VersionChangeType.VersionTypeError:r[0]!=u[0]?t.Utility.VersionChangeType.MajorVersionChange:r[1]!=u[1]?t.Utility.VersionChangeType.MinorVersionChange:r[2]!=u[2]?t.Utility.VersionChangeType.PatchVersionChange:r[3]!=u[3]?t.Utility.VersionChangeType.BuildVersionChange:t.Utility.VersionChangeType.VersionTypeError},u.setContextTypeMetadata=function(n,f,e,o){var l,a,s,h,c;if(o===void 0&&(o=null),f){if(l=!1,e=u.createNewContextGroupElement(e,n),e.length>0){if(s=[],n!==i.Utility.ContextTypeMetaData.PageNavigationInfo)if(n==i.Utility.ContextTypeMetaData.AppModule)for(h=0;h<f.length;h++)s.push(JSON.stringify(f[h]));else s=Object.prototype.toString.call(f)==="[object Array]"?f:f.split(",");else s.push(f);c=[];e.forEach(function(u){var e,f;if(u.ContextTypeMetaDataId===n){for(e=0;e<s.length;e++)f=null,u.ContextValues.forEach(function(n){if(s[e].EntityContextValue){if(n.Value.trim()==s[e].Value.trim()){f=s[e];return}}else if(n.Value.trim()==s[e].trim()||u.ContextTypeMetaDataId==i.Utility.ContextTypeMetaData.ProductVersion&&r.Common.getVersionChangeType(n.Value,s[e])==t.Utility.VersionChangeType.BuildVersionChange){f=n;return}}),f||(f=new i.Content.ContextValueModel,f.Id=i.Utility.Util.newGuid(),f.Value=s[e].trim(),o&&o.forEach(function(n){n.Id==f.Value&&(f.Key=n.Name)})),c.push(f);a=u;l=!0;u.ContextValues=[];u.ContextValues=c;return}})}return e}},u.addPlaceHolderForCKEditor=function(n){var t=n;return n.indexOf("<CKEditorContent>")>=0&&(t="<CKEditorContent>"+t),n.indexOf("<CKEditorContent>")>=0&&n.lastIndexOf("<\/CKEditorContent>")!==n.length-18&&(t=t+"<\/CKEditorContent>"),t},u.createChildControl=function(n){var t=new i.Content.SectionMetadata;return t.MetadataJson.ClientId=i.Utility.Util.newGuid(),t.ControlId=i.Utility.Util.newGuid(),t.ControlVersionId=i.Utility.Util.newGuid(),t.ObjectState=i.Utility.LearningPathObjectState.Added,r.Common.handleLanguageControlVersionContent(t,"",!1,"",n.BaseLcid,"<empty><\/empty>")},u.createGuidedTaskControl=function(t){var u=new i.Content.GuidedTaskMetadata;return u.AuthoringId=n.Client.Loader.appContext.getAuthoringId(),u.MetadataJson.ClientId=i.Utility.Util.newGuid(),u.ControlId=i.Utility.Util.newGuid(),u.ControlVersionId=i.Utility.Util.newGuid(),u.ObjectState=i.Utility.LearningPathObjectState.Added,r.Common.handleLanguageControlVersionContent(u,"",!1,"",t.BaseLcid,"<empty><\/empty>")},u.getTemplateDisplayName=function(n){var t="";switch(n.trim().toLowerCase()){case r.Constants.titleTextTemplate:t=i.Locale.contentTypeconfirmation_Text;break;case r.Constants.titleTextLinkTemplate:t=i.Locale.contentTypeconfirmation_Textlink;break;case r.Constants.titleImageTemplate:t=i.Locale.contentTypeconfirmation_Image;break;case r.Constants.titleVideoTemplate:t=i.Locale.contentTypeconfirmation_Video;break;case r.Constants.existingGuidedTask:t=i.Locale.contentTypeconfirmation_ExistingGuidedTasks;break;case r.Constants.listOflinkTemplate:t=i.Locale.titleCustomLinks;break;case r.Constants.onebuttonTemplate:t=i.Locale.oneButton;break;case r.Constants.twobuttonTemplate:t=i.Locale.twoButton;break;case r.Constants.checklistTemplate:t=i.Locale.checkList;break;case r.Constants.legacyHelpTemplate:t=i.Locale.legacyHelp;break;case r.Constants.footerSectionTemplate:t=i.Locale.footerSectionTemplate}return t},u.getContentPreviewTemplate=function(n){var t=r.Constants.titleTextTemplateGt;switch(n){case"text":t=r.Constants.titleTextTemplateGt;break;case"video":t=r.Constants.titleVideoPreviewTemplate;break;case"two-button":t=r.Constants.twobuttonPreviewTemplate}return t},u.createNewContextGroupElement=function(n,t){var u,f=!1;return n.forEach(function(n){if(n.ContextTypeMetaDataId===t){f=!0;return}}),f||(u=new i.Content.ContextGroupElementModel,u.ContextValues=[],u.Id=u.Id!==r.Constants.EmptyGuid?u.Id:i.Utility.Util.newGuid(),u.ContextTypeMetaDataId=t,n.push(u)),n},u.showErrorMessage=function(r,u,f,e){var o,h,l,c,s,a;if(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Common:showErrorMessage START"),r.length>0){for(o="<ul>",h=0;h<r.length;h++)o+="<li>"+r[h]+" <\/li>";o+="<\/ul>";l=i.App.lPathDesignerContainer;c=i.$mars("#lPathDesignerErrorMessageDialog");i.$mars("#lPathDesignerErrorMessageDialog").length<=0&&(c=i.$mars("<div id='lPathDesignerErrorMessageDialog'><\/div>"),l.append(c));e||(e=i.Locale.alertTitle);l.length>0&&(s=new i.Renderer.SimpleDialogView({},c,"ErrorMessageDialog",e,o,u,f),s.showCancel=!1,s.zIndexPlus=2,s.ariaDescribedById="ErrorMessageDialog",s.show());a=t.Loader.$mars(o).text();n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User got the following error message : "+a);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Common:showErrorMessage END")}},u.showAlertMessage=function(r,u,f,e,o,s,h,c,l,a){l===void 0&&(l=!0);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Common:showAlertMessage START");try{var p="<div>"+u+"<\/div>",v=new i.Renderer.SimpleDialogView({},f,"NavigationAlertMessage",r,p,h,c);v.okCaption=o;v.cancelCaption=s;v.showCancel=e;a&&(v.elementToFocusOnPopupEscape=a);l==!1&&(v.showClose=!1);v.ariaDescribedById="NavigationAlertMessage";v.show()}catch(y){t.Loader.marsExceptionHandler.execute(y.name,y.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Common:Exception occurred while showing alert dialog : "+r)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User got the following alert message : "+r);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Common:showAlertMessage END")},u.checkForChangedContextValuesInModel=function(n,t){var f,e,o,s,r,u;if(n.ObjectState!=i.Utility.LearningPathObjectState.Added){for(r=0;r<n.Contexts.length;r++)for(f=n.Contexts[r],u=0;u<f.ContextGroup.ContextGroupElements.length;u++)e=f.ContextGroup.ContextGroupElements[u],o=e.ContextValues,t.Contexts[r].ContextGroup.ContextGroupElements[u]&&(s=t.Contexts[r].ContextGroup.ContextGroupElements[u].ContextValues,JSON.stringify(o)!==JSON.stringify(s)&&(e.ObjectState=i.Utility.LearningPathObjectState.Modified,f.ContextGroup.ObjectState=i.Utility.LearningPathObjectState.Modified,n.ObjectState=i.Utility.LearningPathObjectState.Modified));JSON.stringify(n)!==JSON.stringify(t)&&(n.ObjectState=i.Utility.LearningPathObjectState.Modified)}},u.getPreviewTemplateName=function(n){switch(n){case r.Constants.answerPanel2x1Template:case r.Constants.defaultTemplate:case r.Constants.answerPanelEightSectionTemplate:n=r.Constants.sidebarDefaultPreviewTemplate;break;case r.Constants.answerPanel2x2Template:n=r.Constants.answerPanel2x2PreviewTemplate;break;case r.Constants.answerPanel2xCustomTemplate:case r.Constants.answerPanel1xCustomTemplate:n=r.Constants.answerPanelCustomPreviewTemplate;break;case r.Constants.errorSidebarTemplate:n=r.Constants.errorSidebarPreviewTemplate;break;case r.Constants.answerPanelChecklistTemplate:n=r.Constants.answerPanelChecklistPreviewTemplate}return n},u.updateHTMLViewContent=function(n,t,i,r,u){u===void 0&&(u="");for(var f=0;f<n.length;f++)n[f].Lcid==t&&(n[f].HtmlView=r.length!==0&&u.length!==0?i.replace(r,u):i);return n},u.getCompiledHtml=function(t,r){var u="",f,e;if(r&&t)try{f=t.ControlType!==i.Utility.ControlTypes.Sidebar;e=i.Renderer.TemplateEngine.applyTemplate(r,t,!0,f);u=n.Client.Utility.Util.decodeSpecialCharacters(e)}catch(o){console.error(o)}return u},u.onToggleClick=function(r){var e=i.$mars("#marsIFrame").css("background-image")==="none"?!0:!1,o=i.$mars("body").css("background-color")==="rgb(255, 255, 255)"?!1:!0,f=r.currentTarget,u;(r.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(r,!0))&&(f&&f.tagName.toLowerCase()==="div"&&(u=f.firstElementChild),i.$mars(r.currentTarget).closest(".lpath-section-header").siblings().slideToggle(),u.src.indexOf("collapsed")!==-1?(u.src=e?o?t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.expandedIconInHCB:t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.expandedIconInHCW:t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.expandedIcon,u.alt=t.Loader.marsLocale.expanded,u.title=t.Loader.marsLocale.sectionExpandedToolTip,f.setAttribute("aria-expanded","true")):(u.src=e?o?t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.collapsedIconInHCB:t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.collapsedIconInHCW:t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.collapsedIcon,u.alt=t.Loader.marsLocale.collapsed,u.title=t.Loader.marsLocale.sectionCollapsedToolTip,f.setAttribute("aria-expanded","false")))},u.handleLanguageControlVersionContent=function(n,u,f,e,o,s){var c,h;if(n.LanguageControlVersionContents.length==0)c=new i.Content.LanguageControlVersionContentsModel,c.Id=t.Utility.Util.newGuid(),c.ControlVersionId=i.Util.Constants.EmptyGuid,c.HtmlView=s?s:r.Common.getCompiledHtml(n,u),n.LanguageControlVersionContents.push(c);else for(h=0;h<n.LanguageControlVersionContents.length;h++){if(o&&n.LanguageControlVersionContents[h].Lcid===o){e&&(n.LanguageControlVersionContents[h].Title=e);s?n.LanguageControlVersionContents[h].HtmlView=s:u&&u!=""&&(n.LanguageControlVersionContents[h].HtmlView=r.Common.getCompiledHtml(n,u));break}f&&(n.LanguageControlVersionContents[h].Title=n.LanguageControlVersionContents[h].Title,n.LanguageControlVersionContents[h].HtmlView=s?s:r.Common.getCompiledHtml(n,u))}return n},u.getGridRowDataFromService=function(t,r,f,e,o,s,h,c,l){var a=new n.Client.Loader.SearchCriteria(t,r,f,e,o,s,h,c,l),v;return a.GroupBy==""&&delete a.GroupBy,v=u.getOdataUrl(a),i.App.serviceHandler.searchSync(v)},u.getDynamicPropertiesFromService=function(){var t="?$filter=AuthoringId eq "+n.Client.Loader.appContext.getAuthoringId();return i.App.serviceHandler.getAvailableDynamicProprties(t)},u.getOdataUrl=function(n){var i="?",r=!0;return t.Loader.$mars.each(n,function(n,t){if(t!=null)if(r)i+="$"+n+"="+t,r=!1;else switch(n){case"top":case"orderby":i+="&$"+n+"="+t;break;case"SortOrder":i+=" "+t;break;case"AuthoringId":i+="&$filter="+n+" eq "+t;break;case"PublishGroupId":jQuery.isEmptyObject(t)||(i+=" and PublishGroupId eq "+t);break;case"Lcid":i+=" and Lcid eq "+t;break;case"search":t=encodeURIComponent(t);i+=" and (contains(ControlName,'"+t+"') or contains(Title,'"+t+"') or contains(AuthorName,'"+t+"') or contains(Tags,'"+t+"'))";break;case"MarsOrgId":i+="&$filter="+n+" eq "+t;break;case"Filters":i+=u.gridFilterOdataUrl(t)}}),i},u.gridFilterOdataUrl=function(n){for(var r,u,i="",t=0;t<n.length;t++)if(n[t].Details.length<=1){r=encodeURIComponent(n[t].Details[0].Value);i+=" and ";switch(n[t].Details[0].Condition.toString()){case"0":i+="startswith(cast("+n[t].Name+",'Edm.String'),'"+r+"')";break;case"1":i+="endswith(cast("+n[t].Name+",'Edm.String'),'"+r+"')";break;case"4":i+="contains(cast("+n[t].Name+",'Edm.String'),'"+r+"')";break;case"5":i+="not contains(cast("+n[t].Name+",'Edm.String'),'"+r+"')";break;case"6":i+="cast("+n[t].Name+",'Edm.String') eq '"+r+"'";break;case"7":i+=n[t].Name=="ControlId"?n[t].Name+" ne "+r:"cast("+n[t].Name+",'Edm.String') ne '"+r+"'"}}else for(u=0;u<n[t].Details.length;u++)i+=u==0?" and (":" or ",i+="cast("+n[t].Name+",'Edm.String') eq '"+encodeURIComponent(n[t].Details[u].Value)+"'",u==n[t].Details.length-1&&(i+=")");return i},u.wildCardOptions=function(t){var c,e,y,l=[],o,s=[],p=n.Client.Loader.appContext.ClientType,h,f,u;if(r.Common.getContextTypeMetadata(t,i.Utility.ContextTypeMetaData.PageNavigationInfo).length===0)return s;o=JSON.parse(r.Common.getContextTypeMetadata(t,i.Utility.ContextTypeMetaData.PageNavigationInfo)[0]);var a=o[p],w=o.QSMap,v=o.wildcard;if(a)for(h=i.App.appContext.getPageNavigationObject(a,w,v),c=h.Attributes,e=h.KeyParams,l=n.Client.Loader.appContext.Util.getConfigurationData("WildcardConfig"),y=new i.Content.WildCardRowModel,f=0;f<e.length;f++)u=new i.Content.WildCardRowModel,u.Key=e[f],u.Value=c[e[f]],i.$mars.inArray(u.Key,l)>=0&&(u.enableWildcard=!0),i.$mars.inArray(u.Key,v)>=0&&(u.wildcarded=!0),s.push(u);return s},u.getAppModuleList=function(){for(var r,f,s,e,h=t.Designer.Renderer.ControlView.prototype.getCurrentControlValue(),u=new i.Content.ContextGroupElementModel,o=h.Contexts[0].ContextGroup.ContextGroupElements,n=0;n<o.length;n++)if(o[n].ContextTypeMetaDataId==i.Utility.ContextTypeMetaData.AppModule){u=o[n];break}for(r=t.Loader.appContext.getAppModuleListFromAPI(),n=0;n<r.length;n++)r[n].isEditable=!0;if(u&&u.ContextValues&&u.ContextValues.length>0)for(n=0;n<u.ContextValues.length;n++){for(f=JSON.parse(u.ContextValues[n].Value),f.isEditable=!1,s=!0,e=0;e<r.length;e++)(f.AppUniqueName==r[e].AppUniqueName||f.IsDefault&&r[e].IsDefault)&&(s=!1);s&&r.push(f)}return r},u.isDynamicSectionAllowed=function(n){return n==r.Constants.defaultTemplate||n==r.Constants.answerPanel2x2Template?!0:!1},u.getMinMaxDynamicSections=function(n){if(u.isDynamicSectionAllowed(n)){var t={Min:1,Max:1};switch(n){case r.Constants.answerPanel2x1Template:case r.Constants.defaultTemplate:case r.Constants.answerPanelEightSectionTemplate:t.Min=4;t.Max=12;break;case r.Constants.answerPanel2x2Template:t.Min=6;t.Max=12}return t}return null},u.handleSidebarTemplateHolderCSS=function(n,t){switch(n){case r.Constants.answerPanel2x2Template:t.removeClass("lpath-sidebar-defaultTemplateholder");t.hasClass("lpath-sidebar-2xTemplateholder")||t.addClass("lpath-sidebar-2xTemplateholder");break;default:t.removeClass("lpath-sidebar-2xTemplateholder");t.hasClass("lpath-sidebar-defaultTemplateholder")||t.addClass("lpath-sidebar-defaultTemplateholder")}},u.is2x2Template=function(n){var t=!1;switch(n){case r.Constants.answerPanel2x2Template:t=!0;break;default:t=!1}return t},u.isEvenNumber=function(n){return n%2==0?!0:!1},u.removeFieldFromJSON=function(n,t){var f,r,e,o;if(i.$mars.isArray(n))for(f=0;f<n.length;f++)e=n[f],u.removeFieldFromJSON(e,t);else if(n instanceof Object)for(r in n){if(n.hasOwnProperty(r)&&(e=n[r],o=r.toLowerCase(),o==t.toLowerCase())){delete n[r];continue}u.removeFieldFromJSON(e,t)}},u.getUserIdLoggedInDateTime=function(){var t,n;return r.LPathLocalStorage.checkKeyExist("userIdLastLoginTime")&&(t=r.LPathLocalStorage.retrieve("userIdLastLoginTime"),t.length>0)?(n=t.split("_"),n.length>=2&&(n[1]=Date.parse(new Date(Number(n[1])).toUTCString())),n):null},u.setPreviousAndNextControlIds=function(n,f){var y,h,e,nt,tt,it;f===void 0&&(f=!1);try{var p,w=!1,v=!1,b=!1,k=!1,c,l,o,a,d=!1,g=!1,s=t.Loader._mars.sortBy(n.Steps,function(n){return n.MetadataJson.Index});for(s.length>0&&n.MetadataJson.PageNavigationInfo!=s[0].MetadataJson.PageNavigationInfo&&(n.MetadataJson.PageNavigationInfo=s[0].MetadataJson.PageNavigationInfo,r.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.PageNavigationInfo,s[0].MetadataJson.PageNavigationInfo,n.Contexts[0].ContextGroup.ContextGroupElements),n.ObjectState=i.Utility.LearningPathObjectState.Modified),y=function(n){return n.MetadataJson.IsHybridBubble?n.MetadataJson.IsHybridBubble:n.ControlType==i.Utility.ControlTypes.HybridStep},h=0;h<s.length;h++)e=s[h],e&&(nt=e.Events.length,f&&(e.MetadataJson.Index=(h+1).toString()),l=(new i.Content.MetaDataJsonElementStructure).EventModel,o=(new i.Content.MetaDataJsonElementStructure).EventModel,c=e.ControlType,g=y(s[s.length-1]),c!=i.Utility.ControlTypes.GuidedTask&&(a=(new i.Content.MetaDataJsonElementStructure).EventModel,a.Action=r.Constants.close,a.Id=r.Constants.xbutton,a.Trigger=r.Constants.trigger,e.Events=[],e.Events.push(a)),h!==0&&(e.MetadataJson.PreviousControlId=s[h-1].MetadataJson.ClientId,w=s[h-1].ControlType==i.Utility.ControlTypes.GuidedTask,p=c==i.Utility.ControlTypes.PassiveStep&&s[h-1].ControlType==i.Utility.ControlTypes.PassiveStep,d=y(s[h-1]),b||w&&(b=!0,l.Id="",l.ChainedTo=s[h-1].ControlId,e.Events.push(l)),p&&!d?(l.Id=u.btnPrevious+e.MetadataJson.PreviousControlId,l.Trigger=r.Constants.trigger,l.Action=u.previousAction,e.Events.push(l)):c==i.Utility.ControlTypes.InfoBubble&&u.pushLearnMoreEventsForInfoBubble(e)),h!==s.length-1?(e.MetadataJson.NextControlId=s[h+1].MetadataJson.ClientId,v=s[h+1].ControlType==i.Utility.ControlTypes.GuidedTask,k||v&&(k=!0,o.Id="",o.ChainedTo=s[h+1].ControlId,e.Events.push(o)),c!=i.Utility.ControlTypes.PassiveStep||v?c==i.Utility.ControlTypes.InfoBubble?u.pushLearnMoreEventsForInfoBubble(e):c==i.Utility.ControlTypes.ActiveStep||c==i.Utility.ControlTypes.WaitingStep?(o.Trigger=r.Constants.trigger,o.Action=u.nextAction,e.Events.push(o)):c==i.Utility.ControlTypes.HybridStep&&(h>0&&(tt=s[h-1].ControlType==i.Utility.ControlTypes.PassiveStep,tt&&(l.Id=u.btnPrevious+e.MetadataJson.PreviousControlId,l.Trigger=r.Constants.trigger,l.Action=u.previousAction,e.Events.push(l))),o.Id=u.btnNext+e.MetadataJson.NextControlId,o.Trigger=r.Constants.trigger,o.Action=u.nextAction,e.Events.push(o)):(o.Id=u.btnNext+e.MetadataJson.NextControlId,o.Trigger=r.Constants.trigger,o.Action=u.nextAction,e.Events.push(o))):c==i.Utility.ControlTypes.WaitingStep?(o.Trigger=r.Constants.trigger,o.Action=u.nextAction,e.Events.push(o)):c==i.Utility.ControlTypes.HybridStep&&u.pushEventsForHybridBubble(e,r.Constants.close),h==0&&h==s.length-1&&(c==i.Utility.ControlTypes.InfoBubble?u.pushLearnMoreEventsForInfoBubble(e):c==i.Utility.ControlTypes.PassiveStep&&g||c==i.Utility.ControlTypes.HybridStep?u.pushEventsForHybridBubble(e,r.Constants.close):c==i.Utility.ControlTypes.WaitingStep&&(o.Trigger=r.Constants.trigger,o.Action=u.nextAction,e.Events.push(o))),it=e.Events.length,nt!=it&&e.ObjectState!=i.Utility.LearningPathObjectState.Added&&(e.ObjectState=i.Utility.LearningPathObjectState.Modified))}catch(rt){t.Loader.marsExceptionHandler.execute(rt.name,rt.message)}},u.pushLearnMoreEventsForInfoBubble=function(n){var t=(new i.Content.MetaDataJsonElementStructure).EventModel,r;n.MetadataJson.Links&&n.MetadataJson.Links.length>0&&(r=n.MetadataJson.Links[0].ControlReference.ControlId,t.Id="learnMore"+r,t.Trigger="click",t.Action=u.learnMore,r!=null&&r!==""&&(t.ChainedTo=r),n.Events.push(t))},u.pushEventsForHybridBubble=function(n,t){var f=(new i.Content.MetaDataJsonElementStructure).EventModel;f.Id=u.btnNext;f.Trigger=r.Constants.trigger;f.Action=t?t:u.nextAction;n.Events.push(f)},u.getModelValueWithoutControlIdAndIds=function(n){return r.Common.removeFieldFromJSON(n,"ControlId"),r.Common.removeFieldFromJSON(n,"ControlVersionId"),r.Common.removeFieldFromJSON(n,"Id"),n},u.isValidUrlExtension=function(n){for(var i=["js"],u=r.Common.getFileExtension(n),t=0;t<i.length;t++)if(u==i[t])return!1;return!0},u.getFileExtension=function(n){return n.substr(n.lastIndexOf(".")+1).toLowerCase()},u.addSkeletonContextObjectToControlModel=function(n){var t,r;return n.Contexts&&n.Contexts.length==0&&(n.Contexts=[],r=new i.Content.ControlContextModel,n.Contexts.push(r),t=new i.Content.ContextGroupModel,n.Contexts[0].ContextGroup=t,n.Contexts[0].ContextGroup.ContextGroupElements=[],n.Contexts[0].Id=i.Utility.Util.newGuid(),n.Contexts[0].ContextGroup.Id=i.Utility.Util.newGuid(),n.Contexts[0].ContextGroup.Title=n.ControlName),n},u.attachEventToElement=function(n,r){if(n&&r)n.off(r).on(r,function(n){n.keyCode==i.Utility.KeyCodeEnum.EscapeKey&&t.Loader.$mars("#lPathSkinnyToolbarHomeButton").focus()})},u.removeEventToElement=function(n,t){n&&t&&n.off(t)},u.btnPrevious="btnPrevious",u.btnNext="btnNext",u.previousAction="previous",u.nextAction="next",u.learnMore="learnmore",u}();r.Common=u})(r=i.Util||(i.Util={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){"use strict";var i=function(){function t(){this.designerControlApi=new n.Client.Loader.DesignerControlApi;this.configurationApi=new n.Client.Loader.ConfigurationAPI;this.analyticsApi=new n.Client.Loader.AnalyticsAPI}return t}();t.ControlApi=i})(i=t.Util||(t.Util={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.save=function(t,i){n.isLocalStorageAvailable()&&(localStorage[t]=JSON.stringify(i))},n.retrieve=function(t){if(n.isLocalStorageAvailable())return localStorage[t]?JSON.parse(localStorage[t]):{}},n.retrieveAll=function(){var i=[],t,r;if(n.isLocalStorageAvailable())for(t=0;t<=n.length-1;t++)r={key:localStorage.key(t),value:JSON.parse(localStorage[localStorage.key(t)])},i.push(r);return i},n.checkKeyExist=function(n){return localStorage[n]?!0:!1},n.remove=function(n){localStorage.removeItem(n)},n.removeAll=function(){localStorage.clear()},n.setLocalStorage=function(n,t){localStorage[n]=t},n.getLocalStorage=function(t){var i=localStorage[t];if(n.isLocalStorageAvailable())return i?localStorage[t]:undefined},n.isLocalStorageAvailable=function(){return typeof Storage=="undefined"?!1:!0},n}();n.LPathLocalStorage=t})(t=n.Util||(n.Util={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(){function r(){this.controlApi=null;r._instance?console.log("Singleton instance already exists for ServiceHandler. Access it via ServiceHandler.getInstance()"):(r._instance=this,this.controlApi=new i.Util.ControlApi)}return r.getInstance=function(){return r._instance==null&&(r._instance=new r),r._instance},r.prototype.upsertControl=function(n){var t=this.getUpsertPayload(n);return this.controlApi.designerControlApi.post(t,"UpsertControl")},r.prototype.updateAuthorName=function(n){return this.controlApi.designerControlApi.post(n,"UpdateAuthor")},r.prototype.getControlById=function(n,t){var i=this.getControlPayload(n,t);return this.controlApi.designerControlApi.post(i,"GetControlById")},r.prototype.getAllConfiguration=function(){return this.controlApi.configurationApi.getAllConfigurations()},r.prototype.getFinalizeOrgProvisioning=function(){return this.controlApi.configurationApi.getFinalizeOrgProvisioning(n.Client.Loader.ServiceProxy.getOrgProvisioningRequest())},r.prototype.getControlTemplate=function(){var n=this.getControlTemplatePayload();return this.controlApi.designerControlApi.getControlTemplates(n)},r.prototype.searchSync=function(n){return this.controlApi.designerControlApi.searchSync(n,"Search")},r.prototype.GetExportedControlMetadata=function(n){return this.controlApi.designerControlApi.post(n,"GetExportedControlMetadata")},r.prototype.downloadControlReport=function(){return this.controlApi.marsReportApi.get("format=csv")},r.prototype.exportControlAction=function(){return this.controlApi.designerControlApi.controlWebApiUrl+"/"+i.Util.Constants.exportControlAction},r.prototype.downloadControlsXliffs=function(n,t){var r=this.getExportLanguagePayload(n,t),u=i.Util.Constants.xliffZipFile,f=i.Util.Constants.exportControl;return this.controlApi.designerControlApi.exportXMLHttpRequest(f,u,r)},r.prototype.importLanguageControl=function(n,i){var u=t.Loader.appContext.getDraftPublishGroupId(),r={};return r.draftPublishGroupId=u,r.fileName=i,this.controlApi.designerControlApi.post(r,"ImportControlXliff",n)},r.prototype.importControl=function(n,i){var r,u,f,e,o;return r=t.Loader.appContext.getAuthoringId(),u=t.Loader.appContext.UserId,f=t.Loader.appContext.getDraftPublishGroupId(),e=t.Loader.appContext.getOrgId(),o="ImportControl?authoringId="+r+"&userId="+u+"&draftPublishGroupId="+f+"&productOrgId="+e,this.controlApi.designerControlApi.post(i,o,n)},r.prototype.callPostAction=function(n,t,i){var r=this.getControlPostActionPayload(t,i,n);return this.controlApi.designerControlApi.post(r,n)},r.prototype.getSupportedLanguagesForControl=function(n){return this.controlApi.designerControlApi.post(n,"GetControlLanguages")},r.prototype.getPublishGroupInfoData=function(n,t){var i=this.getPublishInfoPayload(n,t);return this.controlApi.designerControlApi.post(i,"PublishInfo")},r.prototype.getExportedControl=function(n,t,r){var u={ControlIds:n,PublishGroupId:t,Locale:r},f=i.Util.Constants.controlXMLZipFile,e=i.Util.Constants.exportControlXML;return this.controlApi.designerControlApi.exportXMLHttpRequest(e,f,u)},r.prototype.getExportedControlMetadataForSelectedLanguages=function(n,t){var r=this.getExportLanguagePayload(n,t),u=i.Util.Constants.xliffZipFile,f=i.Util.Constants.exportControl;return this.controlApi.designerControlApi.exportXMLHttpRequest(f,u,r)},r.prototype.getExportLanguagePayload=function(n,i){var r=[];return n.forEach(function(n){r.push({ControlId:n,LanguageIds:i})}),{controlLanguage:r,DraftPublishGroupId:t.Loader.appContext.getDraftPublishGroupId()}},r.prototype.getAvailableDynamicProprties=function(n){return this.controlApi.designerControlApi.searchSync(n,"GetDynamicContexts")},r.prototype.getTenantInstances=function(){return this.controlApi.configurationApi.getTenantInstances()},r.prototype.getAllReportNames=function(){return this.controlApi.analyticsApi.getAllReportNames()},r.prototype.getReportDetails=function(n){return this.controlApi.analyticsApi.getReportDetails(n)},r.prototype.getPublishInfoPayload=function(n,t){return{ControlId:n,PublishGroupId:t}},r.prototype.getUpsertPayload=function(n){return{DraftPublishGroupId:t.Loader.appContext.getDraftPublishGroupId(),Control:n}},r.prototype.getControlTemplatePayload=function(){return{Locale:t.Loader.defaultLcidforTemplates,PublishGroupId:"44444444-4444-4444-4444-444444444444"}},r.prototype.getControlPostActionPayload=function(n,i){var r=n;return{ControlIds:n,DraftPublishGroupId:t.Loader.appContext.getDraftPublishGroupId(),TargetPublishGroup:i}},r.prototype.getControlPayload=function(n,i){i||(i=t.Loader.appContext.getDraftPublishGroupId());return{ControlId:n,PublishGroupId:i,Locale:t.Loader.defaultLanguageLcid}},r._instance=null,r}();i.ServiceHandler=r})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(){function r(){r._instance?console.log("Singleton instance already exists for PostControlActionHandler. Access it via PostControlActionHandler.getInstance()"):r._instance=this}return r.getInstance=function(){return r._instance==null&&(r._instance=new r),r._instance},r.prototype.callPostControlAction=function(n,r,u){var f,s;if(t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Store:callPostControlAction START Params : value : "+n+"; actionType : "+r+"; publishEnvironment : "+u),n.length<1)return this.createPostControlActionFlyout(i.Locale.errorMsgSelectRow),null;var o=[],e=i.$mars.Deferred(),h=this;try{return f="",r==i.Locale.buildCaption?f=i.Util.Constants.buildActionType:r==i.Locale.publishCaption?f=i.Util.Constants.publishActionType:r==i.Locale.publishSyncCaption&&(f=i.Util.Constants.publishSyncActionType),t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Initiating call to add selected controls in publish queue."),s=i.ServiceHandler.getInstance().callPostAction(f,n,u),s.done(function(n){f==i.Util.Constants.publishActionType&&t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Store:callPostControlAction Successfully added selected controls in publish queue.");o=n;e.resolve(o)}),s.fail(function(n){h.createPostControlActionFlyout(i.Locale.publishFailed);t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON);o=null;e.reject();t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Store:callPostControlAction Failed to add selected control in publish queue.")}),t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Store:callPostControlAction END"),e}catch(c){return t.Loader.marsExceptionHandler.execute(c.name,c.message),h.createPostControlActionFlyout(r+" "+i.Locale.postActionError),t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Store:callPostControlAction Exception occurred while adding controls in publish queue."),t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Store:callPostControlAction END"),e}},r.prototype.createPostControlActionFlyout=function(r){var f=i.$mars("#lPathDesignerContainer"),o=window._MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex(),h=i.$mars('<div id="lpathPostControlActionFlyoutOverlay" class="lpath-dialog-overlay"/>'),s=i.$mars('<div  id="lPathPostControlActionFlyoutDialog" class="lpath-post-control-action-flyout-dialog"><\/div>'),e=f.find("#lpathPostControlActionFlyoutOverlay"),u=f.find("#lPathPostControlActionFlyoutDialog");r==null?(e.length<=0&&f.append(h),u.length>0&&(u.html(),u.hide()),e.css("z-index",o+99).show()):(e.length>0&&e.hide(),u.length<=0?(s.append('<div tabindex="0" class="lpath-postcontrol-action-message">'+r+" <\/div>"),f.append(s),u=f.find("#lPathPostControlActionFlyoutDialog")):u.html('<div tabindex="0" class="lpath-postcontrol-action-message">'+r+" <\/div>"),u.css("z-index",o+100).show(300));i.$mars("#lPathPostControlActionFlyoutDialog").append('<input tabindex="0" id="closeFlyout" class="lpath-float-right lpath-close-flyout" type="image" alt="'+i.Locale.close+'" src="'+t.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.closeIcon+'" />');i.$mars('input[id="closeFlyout"]').on("click",this.hidePostControlActionFlyout);i.$mars('input[id="closeFlyout"]').keydown(function(n){n.keyCode==27&&i.$mars('input[id="closeFlyout"]').click()});i.$mars('input[id="closeFlyout"]').focus()},r.prototype.hidePostControlActionFlyout=function(){var n=i.$mars("#lpathPostControlActionFlyoutOverlay"),t=i.$mars("#lPathPostControlActionFlyoutDialog");n.hide();t.fadeOut("slow",function(){i.$mars("#lPathDesignerContainer").focus()})},r.prototype.callPostControlActionForFurtherProcessing=function(n,r){var f=[],u=i.$mars.Deferred(),e;try{return e=i.ServiceHandler.getInstance().callPostAction(r,n),e.done(function(n){f=n;u.resolve(f)}),e.fail(function(n){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON);f=null;u.reject()}),u}catch(o){return t.Loader.marsExceptionHandler.execute(o.name,o.message),u}},r._instance=null,r}();i.PostControlActionHandler=r})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(){function r(){if(this.controlModel=null,this.cloneControlModel=null,r._instance)throw new Error("Singleton instance already exists for Store. Access it via Store.getInstance()");else r._instance=this}return r.getInstance=function(){return r._instance==null&&(r._instance=new r),r._instance},r.prototype.getEmptyControlModelByType=function(n){var r;return r=n==t.Utility.ControlTypes.Sidebar?new i.SidebarMetadata:n==t.Utility.ControlTypes.GuidedTask?new i.GuidedTaskMetadata:new i.ControlBaseMetadata,new i.ControlModel(r.ControlId,r)},r.prototype.save=function(n){var i=this,r=t.$mars.Deferred(),f=this.getControlModelByMetaData(n),u;return n=f.getValue(),n=this.handleEncodeDecodeAndUTCDate(n),n=this.handleObjectStateValue(n),n=this.updateBaseLcid(n),n=this.resetControlStatusToDraft(n),u=t.ServiceHandler.getInstance().upsertControl(n),u.done(function(n){var u=n.Result,t;u=i.handleJSONParseAndUTCDate(u);t=i.getControlModelByMetaData(u);i.setNewControlModel(t.id,t.getValue());r.resolve(t.getValue())}),u.fail(function(n,t,i){r.reject(n,t,i)}),r},r.prototype.getCurrentControlModelValue=function(){if(!this.controlModel)throw new Error("controlModel is empty. Please add controlmodel.");var n=this.controlModel.getValue();return n=this.updateBaseLcid(n),JSON.parse(JSON.stringify(n))},r.prototype.saveControlCreateTelemetry=function(n){var t=this.controlModel.getValue();t.CreateTelemetry=n.CreateTelemetry},r.prototype.storeControl=function(n){var t,i;i=n.MetadataJson.constructor;i.__typeName==="String"&&(n=this.handleJSONParseAndUTCDate(n));t=this.getControlModelByMetaData(n);this.setNewControlModel(t.id,t.getValue())},r.prototype.getControl=function(n,i,r){var u=t.$mars.Deferred(),f=this,o,e;if(n==t.Util.Constants.EmptyGuid)if(i)o=f.getEmptyControlModelByType(i),u.resolve(o.getValue());else throw new Error("Control type required to create new control.");else e=t.ServiceHandler.getInstance().getControlById(n,r),e.done(function(n){var t=n.Result,i=f.getControlModelByMetaData(t);t=f.handleJSONParseAndUTCDate(i.getValue());u.resolve(t)}),e.fail(function(){u.reject()});return u},r.prototype.updateCurrentModelValueOnPostAction=function(n){var i=this.getCurrentControlModelValue();n==t.Util.Constants.checkInAction?i.CheckedOut=!1:n==t.Util.Constants.deleteControlAction&&(this.controlModel=null);this.setNewControlModel(i.ControlId,i)},r.prototype.dispose=function(){this.cloneControlModel=null;this.controlModel=null},r.prototype.setNewControlModel=function(n,t){this.controlModel=new i.ControlModel(n,t);this.setcloneControlModel(n,t)},r.prototype.setcloneControlModel=function(n,t){this.cloneControlModel=new i.ControlModel(n,t)},r.prototype.getControlModelByMetaData=function(n){if(n.ControlId&&n.ControlType)n=n.ControlType==t.Utility.ControlTypes.Sidebar?n:n.ControlType==t.Utility.ControlTypes.GuidedTask?n:n;else throw new Error("Control metadata is not in correct format.");return new i.ControlModel(n.ControlId,n)},r.prototype.handleJSONParseAndUTCDate=function(n){var i=this;return n.MetadataJson&&(n.MetadataJson=JSON.parse(n.MetadataJson)),n.Comments&&n.Comments.length>0&&(n.Comments=JSON.parse(n.Comments)),n.Events&&(n.Events=JSON.parse(n.Events)),n.LastUpdatedDate=i.updateModelDateToUTC(n.LastUpdatedDate),n.CreatedDate=i.updateModelDateToUTC(n.CreatedDate),n.Sections!=null?t.$mars.each(n.Sections,function(){this!==undefined&&i.handleJSONParseAndUTCDate(this)}):n.Sections=[],n.Steps!=null?t.$mars.each(n.Steps,function(){this!==undefined&&i.handleJSONParseAndUTCDate(this)}):n.Steps=[],n},r.prototype.handleEncodeDecodeAndUTCDate=function(n){var i=this,r;return n.MetadataJson=JSON.stringify(n.MetadataJson),n.Comments&&(r=n.Comments,t.$mars.each(r,function(){this.Text=t.EncodeDecode.MarsHtmlEncode(t.EncodeDecode.MarsHtmlDecode(this.Text))}),n.Comments=r,n.Comments=JSON.stringify(n.Comments)),n.Events&&typeof n.Events!="string"&&(n.Events=JSON.stringify(n.Events)),n.ControlName=t.EncodeDecode.MarsHtmlEncode(t.EncodeDecode.MarsHtmlDecode(n.ControlName)),n.LastUpdatedDate=i.updateModelDateToUTC(n.LastUpdatedDate),n.CreatedDate=i.updateModelDateToUTC(n.CreatedDate),n.Tags!=null&&(n.Tags=t.EncodeDecode.MarsHtmlEncode(t.EncodeDecode.MarsHtmlDecode(n.Tags))),n.AuthorName!=null&&(n.AuthorName=t.EncodeDecode.MarsHtmlEncode(t.EncodeDecode.MarsHtmlDecode(n.AuthorName))),n.LanguageControlVersionContents!=null&&t.$mars.each(n.LanguageControlVersionContents,function(){this!==undefined&&(this.Title=t.EncodeDecode.MarsHtmlEncode(t.EncodeDecode.MarsHtmlDecode(this.Title)))}),n.Sections!=null&&t.$mars.each(n.Sections,function(){this!==undefined&&i.handleEncodeDecodeAndUTCDate(this)}),n.Steps!=null&&t.$mars.each(n.Steps,function(){this!==undefined&&i.handleEncodeDecodeAndUTCDate(this)}),n},r.prototype.updateModelDateToUTC=function(n){return n?n.toString().indexOf("Z")<0&&n.toString().indexOf("UTC")<0&&n.toString().indexOf("GMT")<0?t.Util.Common.convertDateToUtc(new Date(n.toString()+"Z")).toString():t.Util.Common.convertDateToUtc(new Date(n)).toString():t.Util.Common.convertDateToUtc(new Date).toString()},r.prototype.handleObjectStateValue=function(n){var r,l,e,o,s,a,w=n,h,f,u,i,v,y,c,p;if(h=this.getCurrentControlModelValue(),n.ObjectState==t.Utility.LearningPathObjectState.Added||n.ObjectState==t.Utility.LearningPathObjectState.Deleted)return w;for(f=0;f<n.Contexts.length;f++)if(r=n.Contexts[f],r.ContextGroup.ObjectState!=t.Utility.LearningPathObjectState.Added)for(i=0;i<r.ContextGroup.ContextGroupElements.length;i++)if(l=r.ContextGroup.ContextGroupElements[i],e=l.ContextValues,h.Contexts[f].ContextGroup.ContextGroupElements[i]){if(o=h.Contexts[f].ContextGroup.ContextGroupElements[i].ContextValues,JSON.stringify(e)!==JSON.stringify(o))for(l.ObjectState=t.Utility.LearningPathObjectState.Modified,r.ContextGroup.ObjectState=t.Utility.LearningPathObjectState.Modified,r.ObjectState=t.Utility.LearningPathObjectState.Modified,n.ObjectState=t.Utility.LearningPathObjectState.Modified,u=0;u<e.length;u++)o[u]&&o[u].EntityContextValue&&(e[u].EntityContextValue.ObjectState=JSON.stringify(e[u])!==JSON.stringify(o[u])?t.Utility.LearningPathObjectState.Modified:t.Utility.LearningPathObjectState.Unchanged)}else r.ContextGroup.ObjectState=t.Utility.LearningPathObjectState.Modified,r.ObjectState=t.Utility.LearningPathObjectState.Modified,n.ObjectState=t.Utility.LearningPathObjectState.Modified;for(s=n.LanguageControlVersionContents,a=h.LanguageControlVersionContents,i=0;i<s.length;i++)v=s[i],y=a[i],JSON.stringify(v)!==JSON.stringify(y)?(s[i].ObjectState=t.Utility.LearningPathObjectState.Modified,n.ObjectState=t.Utility.LearningPathObjectState.Modified):(s[i].ObjectState=t.Utility.LearningPathObjectState.Unchanged,n.ObjectState=t.Utility.LearningPathObjectState.Unchanged);if(n.ControlType==t.Utility.ControlTypes.GuidedTask&&n.Steps!=null&&n.Steps.length>0)for(c=0;c<n.Steps.length;c++)p=n.Steps[c],n.Steps[c]=this.handleObjectStateValue(p);return JSON.stringify(n)!==JSON.stringify(h)&&(n.ObjectState=t.Utility.LearningPathObjectState.Modified),n.ControlType==t.Utility.ControlTypes.Sidebar&&(n=this.updateObjectStateValuesInSectionModel(n)),n},r.prototype.updateObjectStateValuesInSectionModel=function(n){var a=n,o,u,s,i,e,f,h,r,c,l;if(o=this.getCurrentControlModelValue(),n.ObjectState===t.Utility.LearningPathObjectState.Added||n.ObjectState===t.Utility.LearningPathObjectState.Deleted)return a;for(u=0,s=0;u<n.Sections.length;u++,s++)if(i=n.Sections[u],i.ObjectState!==t.Utility.LearningPathObjectState.Added&&i.ObjectState!==t.Utility.LearningPathObjectState.Deleted){if(e=o.Sections[s],e)for(f=i.LanguageControlVersionContents,h=e.LanguageControlVersionContents,r=0;r<f.length;r++)c=f[r],h[r]&&(l=h[r],JSON.stringify(c)!==JSON.stringify(l)?(f[r].ObjectState=t.Utility.LearningPathObjectState.Modified,i.ObjectState=t.Utility.LearningPathObjectState.Modified):(f[r].ObjectState=t.Utility.LearningPathObjectState.Unchanged,i.ObjectState=t.Utility.LearningPathObjectState.Unchanged));if(i.ObjectState===t.Utility.LearningPathObjectState.Added){u++;n.ObjectState=t.Utility.LearningPathObjectState.Modified;continue}else i.ObjectState!==t.Utility.LearningPathObjectState.Deleted&&JSON.stringify(i)!==JSON.stringify(e)&&(i.ObjectState=t.Utility.LearningPathObjectState.Modified,n.ObjectState=t.Utility.LearningPathObjectState.Modified)}return JSON.stringify(n)!==JSON.stringify(o)&&(n.ObjectState=t.Utility.LearningPathObjectState.Modified),n},r.prototype.resetControlStatusToDraft=function(n){return n.Status=t.Utility.StatusType.Draft,n},r.prototype.updateBaseLcid=function(t){return t.BaseLcid==-1&&(t.BaseLcid=n.Loader.defaultLanguageLcid),t},r._instance=null,r}();i.Store=r})(i=t.Content||(t.Content={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){"use strict";i.$mars=t.Loader.$mars;i.Locale=t.Loader.marsLocale;i.EncodeDecode=t.Loader.marsEncodeDecode;i.Utility=n.Client.Utility;var r=function(){function r(){}return r.init=function(){var n=jQuery.Deferred(),i;if(this.loaded)n.resolve();else try{this.loaded=!0;i=r.loadTemplates();i.done(function(){n.resolve()});i.fail(function(){n.reject()});r.createLPathDesignerContainer();r.createActionOverlay()}catch(u){t.Loader.marsExceptionHandler.execute("loadDesginer",t.Loader.marsLocale.unableToLoadDesigner);this.loaded=!1}return n},Object.defineProperty(r,"currentLocale",{get:function(){return this.locale},set:function(n){this.locale=n},enumerable:!0,configurable:!0}),r.save=function(n){return this.store.save(n)},r.saveControlCreateTelemetry=function(n){this.store.saveControlCreateTelemetry(n)},r.openNewControl=function(n){var t=r.store.getEmptyControlModelByType(n);r.store.storeControl(t.getValue());r.openControlInView(n,!0)},r.openControl=function(u,f,e,o,s){var h,c;try{if(h=this,o||(o=h.lPathDesignerContainer),u){if(u==i.Util.Constants.EmptyGuid&&!f)throw new Error("controlType required to create new control.");this.isDraftControl=!0;u!=i.Util.Constants.EmptyGuid&&s&&t.Loader.appContext.getDraftPublishGroupId()!=s&&(this.isDraftControl=!1);c=r.store.getControl(u,f,s);c.done(function(n){var t=n;if(t&&t.ControlType)r.store.storeControl(t),t.ControlVersionId==i.Util.Constants.EmptyGuid?h.postValidationOpenControl(t):h.controlValidation(t,o);else throw new Error("Control data is not in correct format.");});c.fail(function(n){console.log("Control not found.");t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON)})}else throw new Error("Please provide either controlId or controlValue.");}catch(l){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception on open control from app.");t.Loader.marsExceptionHandler.execute(l.name,l.message)}},r.postValidationOpenControl=function(u){try{console.log("Opened control id:"+u.ControlId);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Opened control id:"+u.ControlId);r.openControlInView(u.ControlType,u.ControlId==i.Util.Constants.EmptyGuid)}catch(f){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception on postValidationOpenControl from app.");t.Loader.marsExceptionHandler.execute(f.name,f.message)}},r.controlValidation=function(r,u){var e,o,s,h,c,f;try{e=this;this.isDraftControl?r.Status==i.Utility.StatusType.Published?(r.ControlType==i.Utility.ControlTypes.GuidedTask?(o="<div>"+i.Locale.alreadyGTPublishMessage+"<\/div>",s=i.Locale.alreadyGTPublishAlert):(o="<div>"+i.Locale.alreadyPublishMessage+"<\/div>",s=i.Locale.alreadyPublishAlert),f=new i.Renderer.SimpleDialogView({},u,"AlreadyPublishMessage",s,o,function(){e.postValidationOpenControl(r)},function(){e.focusOnControlName(r,u)}),f.showCancel=!1,f.ariaDescribedById="AlreadyPublishMessage",f.show()):r.CheckedOut==!0?(h="",h=r.ControlType==1?i.Locale.answerPanel.toLowerCase():i.Locale.guidedTask.toLowerCase(),c=e.appContext.UserId.replace(/[{}]/g,"").toLowerCase(),r.CheckedOutByUserId==c?e.postValidationOpenControl(r):(o="<div>"+i.Locale.alreadyCheckedoutmessage1+" "+i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(r.CheckedOutByUserName))+" "+i.Locale.alreadyCheckedoutmessage2+h+" "+i.Locale.alreadyCheckedoutmessage3+" "+i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(r.CheckedOutByUserName))+" "+i.Locale.alreadyCheckedoutmessage4+h+" "+i.Locale.alreadyCheckedoutmessage5+"<\/div>",s=i.Locale.alreadyCheckedoutTitle+" "+h,f=new i.Renderer.SimpleDialogView({},u,"CheckedOutMessage",s,o,function(){e.focusOnControlName(r,u)},function(){e.focusOnControlName(r,u)}),f.ariaDescribedById="CheckedOutMessage",f.show())):r.CheckedOut==!1&&(r.ControlType==i.Utility.ControlTypes.GuidedTask?(o="<div>"+i.Locale.alreadyGTCheckedinMessage+"<\/div>",s=i.Locale.alreadyGTCheckedinTitle):(o="<div>"+i.Locale.alreadyCheckedinMessage+"<\/div>",s=i.Locale.alreadyCheckedinTitle),f=new i.Renderer.SimpleDialogView({},u,"CheckedinMessage",s,o,function(){e.postValidationOpenControl(r);n.Client.Loader.appContext.setAriaHiddenForElementsExceptMars(!1);i.$mars("#lpathRuntimeOverlay").attr("aria-hidden",!0);i.$mars(".mars-answerpanel-container").attr("visibility","hidden")}),f.addDefaultFocusOnOkOrClose=!0,f.ariaDescribedById="CheckedinMessage",f.show()):(o="<div>"+i.Locale.cannotChangeControlMessage+"<\/div>",f=new i.Renderer.SimpleDialogView({},u,"CannotChangeControlMessage",i.Locale.cannotChangeControlAlert,o,function(){e.postValidationOpenControl(r)},function(){e.focusOnControlName(r,u)}),f.showCancel=!1,f.ariaDescribedById="CannotChangeControlMessage",f.show())}catch(l){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception on controlValidation from app.");t.Loader.marsExceptionHandler.execute(l.name,l.message)}},r.focusOnControlName=function(n,t){var i=t.find("#"+n.ControlId);i.find("a").first().focus()},r.showLPathDesignerOverlay=function(){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CrmAppContext:showDesignerOverlay START");var i=t.Loader.$mars("#lPathDesignerOverlay");i&&!i.hasClass("lpath-overlay-show")&&i.addClass("lpath-overlay-show");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CrmAppContext:showDesignerOverlay END")},r.hideLPathDesignerOverlay=function(){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CrmAppContext:hideDesignerOverlay START");t.Loader.$mars("#lPathDesignerOverlay").hasClass("lpath-overlay-show")&&t.Loader.$mars("#lPathDesignerOverlay").removeClass("lpath-overlay-show");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CrmAppContext:hideDesignerOverlay END")},r.show=function(u){u===void 0&&(u=i.Util.Constants.landingPageViewName);try{r.SetPageTitleToMars(n.Client.Loader.marsLocale.contentLibraryTitle);this.lPathDesignerContainer.show();this.lPathDesignerContainer.css("position","absolute");t.Loader.appContext.Util.assignCkEditorInstance(window._MicrosoftMars.Client.Loader.InAppCKEDITOR);this.isDesignerLaunched=!0;n.Client.Loader.appContext.isMobileClient()&&n.Client.Loader.appContext.util.showCustomizationContainer();u==i.Util.Constants.skinnyToolbarViewName?this.showSkinnyTolbarPage():this.showLandingPage();window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg");n.Client.Loader.appContext.setAriaHiddenForElementsExceptMars(!0)}catch(f){this.isDesignerLaunched=!1;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception on initializing designer app.");t.Loader.marsExceptionHandler.execute(f.name,f.message)}},r.hide=function(){r.ResetPageTitleToProduct();this.lPathDesignerContainer&&this.lPathDesignerContainer.is(":visible")&&this.lPathDesignerContainer.hide();n.Client.Loader.appContext.setAriaHiddenForElementsExceptMars(!1);this.isDesignerLaunched=!1},r.close=function(){t.Loader.appContext.util.hideCustomizationContainer();try{var i=window.Microsoft.Mars.Client.ContextResolution.ContextResolutionManager.getInstance();i.notify(window.Microsoft.Mars.Client.ContextResolution.ClientResolutionState.Reset);n.SearchUtil&&(n.SearchUtil.searchResultsMap={})}catch(u){}r.hide();this.hideLPathDesignerOverlay();this.lPathDesignerContainer.children().remove();r.isRTL&&t.Loader.$mars(window.document.body).removeClass("lpath-rtl");this.isDesignerLaunched=!1;window.marsLoader=new n.Client.Loader.MarsLoader(!1);r.appContext.util.hideOverlay();t.Loader.appContext.Util.assignCkEditorInstance(window._MicrosoftMars.Client.Loader.InAppCKEDITOR)},r.createActionOverlay=function(){var n=r.lPathDesignerContainer,t=i.$mars('<div id="lPathActionOverlay" class="lpath-dialog-overlay"/>'),u=i.$mars('<div  id="lPathActionDialog" class="lpath-save-dialog" />'),f=r.lPathDesignerContainerZIndex;t.css("z-index",f+99);n.find("#lPathActionOverlay").length<=0&&n.append(t);n.find("#lPathActionDialog").length<=0&&n.append(u)},r.removeActionOverlay=function(){var n=r.lPathDesignerContainer,t=i.$mars("#lPathActionOverlay"),u=i.$mars("#lPathActionDialog");n.find("#lPathActionOverlay").length>0&&t.remove();n.find("#lPathActionDialog").length>0&&u.remove()},r.showActionOverlay=function(){this.createActionOverlay();var n=i.$mars("#lPathActionOverlay"),t=i.$mars("#lPathActionDialog");n.show();t.fadeIn(300)},r.hideActionOverlay=function(){var n=i.$mars("#lPathActionOverlay"),t=i.$mars("#lPathActionDialog");n.hide();t.fadeOut(300);this.removeActionOverlay()},r.trackActivity=function(n,r){var u=window._MicrosoftMars.Client.Telemetry,o,e,c,s,a;if(!n.FormFactor&&n.Contexts.length>0)for(n.FormFactor="",o=n.Contexts[0].ContextGroup.ContextGroupElements,e=0;e<o.length;e++)if(o[e].ContextTypeMetaDataId==i.Utility.ContextTypeMetaData.FormFactor)for(c=o[e].ContextValues,s=0;s<c.length;s++)n.FormFactor+=i.Utility.FormFactorEnum[c[s].Value]+"\n";var f,h,v=n.isErrorControl?n.isErrorControl:!1,w=n.isContextHomeSidebar?n.isContextHomeSidebar:!1,y=n.BaseLcid?n.BaseLcid:0,p=n.Events?n.Events[0].Trigger:"",b=n.MetadataJson?n.MetadataJson.Template:"",k=n.Sections?n.Sections:[],d=n.Steps?n.Steps:[],l=n.Tags?n.Tags:"";n.ControlType==i.Utility.ControlTypes.Sidebar?(f=new u.UserActivityEvent(u.ActivityName.answerpanelAuthoring),h=[i.Utility.FormFactorEnum[t.Loader.appContext._formFactor],n.FormFactor,y,p,v,w,b,k.length,l]):n.ControlType==i.Utility.ControlTypes.GuidedTask?(f=new u.UserActivityEvent(u.ActivityName.guidedtaskAuthoring),h=[i.Utility.FormFactorEnum[t.Loader.appContext._formFactor],n.FormFactor,y,p,v,d.length,l]):(n.ControlType==i.Utility.ControlTypes.ActiveStep||n.ControlType==i.Utility.ControlTypes.PassiveStep||n.ControlType==i.Utility.ControlTypes.InfoBubble||n.ControlType==i.Utility.ControlTypes.HybridStep||n.ControlType==i.Utility.ControlTypes.WaitingStep)&&(f=new u.UserActivityEvent(u.ActivityName.guidedtaskStepAuthoring),a=n.MetadataJson.Content.ContentType,h=[i.Utility.FormFactorEnum[t.Loader.appContext._formFactor],n.FormFactor,n.position,i.Utility.ControlTypes[n.ControlType],a?a:"text",l]);f.SetUserActivityInfo(t.Loader.appContext.userId,n.ControlId,n.pgId,n.pgName,t.Loader.appContext.getAuthoringId(),"",n.AuthorId,n.ControlName,n.gtid,n.gtname);f.SetActivityData(h);f.FinishActivity(u.EndAction[r]);r=="created"&&(n.CreateTelemetry=!0)},r.SetPageTitleToMars=function(t){document.title.indexOf(n.Client.Loader.marsLocale.learningPathPageTitle)==-1&&(localStorage[i.Util.Constants.crmPageTitleKey]=document.title);document.title=t+": "+n.Client.Loader.marsLocale.learningPathPageTitle},r.ResetPageTitleToProduct=function(){document.title.indexOf(n.Client.Loader.marsLocale.learningPathPageTitle)>-1?document.title=localStorage[i.Util.Constants.crmPageTitleKey]:localStorage[i.Util.Constants.crmPageTitleKey]=document.title},r.showLandingPage=function(){r.createLPathDesignerOverlay();r.createLandingPageContainer();var u={AppVersion:t.Loader.appContext.AppVersion,AuthorName:t.Loader.appContext.UserName},n=new i.Renderer.LandingPageView(u,this.landingPageContainer);this.skinnyToolbarContainer&&this.skinnyToolbarContainer.remove();n.show();n.checkForHighContrast()},r.showSkinnyTolbarPage=function(){r.createLPathDesignerOverlay();r.createSkinnyToolbarContainer();this.landingPageContainer&&this.landingPageContainer.remove()},r.openControlInView=function(n,t){var u,f;this.show(i.Util.Constants.skinnyToolbarViewName);n==i.Utility.ControlTypes.Sidebar?(this.skinnyToolbarContainer.show(),u=new i.Renderer.SidebarSkinnyToolbarView(this.skinnyToolbarContainer,{controlCreated:t}),u.show()):n==i.Utility.ControlTypes.GuidedTask?(f=new i.Renderer.GuidedTaskSkinnyToolbarView(this.skinnyToolbarContainer,{controlCreated:t}),f.show()):console.log("Please provide correct control type.");r.ResetPageTitleToProduct();window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg")},r.loadTemplates=function(){var n=jQuery.Deferred(),t;return i.Util.LPathLocalStorage.checkKeyExist(i.Util.Constants.isTemplatesLoaded)?(n.resolve(),r.setEnabledTemplateNames()):(t=i.ServiceHandler.getInstance().getControlTemplate(),t.done(function(t){for(var f,u=0;u<t.Result.length;u++)if(i.Util.LPathLocalStorage.checkKeyExist(t.Result[u].ControlName)||i.Util.LPathLocalStorage.save(t.Result[u].ControlName.toLowerCase(),t.Result[u]),t.Result[u].ContentTemplates)for(f=0;f<t.Result[u].ContentTemplates.length;f++)i.Util.LPathLocalStorage.checkKeyExist(t.Result[u].ContentTemplates[f].ControlName)||i.Util.LPathLocalStorage.save(t.Result[u].ContentTemplates[f].ControlName.toLowerCase(),t.Result[u].ContentTemplates[f]);i.Util.LPathLocalStorage.save(i.Util.Constants.isTemplatesLoaded,t.Result);r.setEnabledTemplateNames();n.resolve(t)}),t.fail(function(){n.reject()})),n},r.setEnabledTemplateNames=function(){var n=i.Util.LPathLocalStorage.retrieve(i.Util.Constants.isTemplatesLoaded),t,u;if(n&&n.length>0)for(r.enabledTemplates=[],t=0;t<n.length;t++)n[t].ControlName&&n[t].LanguageControlVersionContents[0]&&n[t].LanguageControlVersionContents[0].Title&&(u=new i.Content.EnabledTemplateModel,u.ControlName=n[t].ControlName,u.Title=n[t].LanguageControlVersionContents[0].Title,u.ControlType=n[t].ControlType,r.enabledTemplates.push(u))},r.createLPathDesignerContainer=function(){if(t.Loader.$mars('div[id="lPathDesignerContainer"]').length<=0){this.lPathDesignerContainer=t.Loader.$mars('<div id="lPathDesignerContainer" class="lpath-designer-container" style="display:none;" aria-labelledby="lPathDesignerOverlay">');this.lPathDesignerContainer.css("z-index",r.lPathDesignerContainerZIndex);t.Loader.$mars(window.document.body).append(this.lPathDesignerContainer);r.isRTL=this.appContext.isRTL();r.isRTL&&(this.lPathDesignerContainer.addClass("lpath-rtl"),this.appContext.isHebrewEnv()&&this.lPathDesignerContainer.addClass("lpath-hebrew"));i.$mars("#checkHighContrastDiv").css("background-image")==="none"&&(this.lPathDesignerContainer.hasClass("lpath-highcontrast")||this.lPathDesignerContainer.addClass("lpath-highcontrast"));this.lPathDesignerContainer.off(i.Util.Constants.MouseDownEventName).on(i.Util.Constants.MouseDownEventName,function(n){n.stopImmediatePropagation()})}else this.lPathDesignerContainer=t.Loader.$mars('div[id="lPathDesignerContainer"]');n.Client.Loader.appContext.isMobileClient()&&t.Loader.$mars(document.body).addClass("lpath-moca").parent().height("100%")},r.createLPathDesignerOverlay=function(){var t,i;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CrmAppContext:createDesignerOverlay START");document.getElementById("lPathDesignerOverlay")||(t=null,t=document.createElement("div"),t.id="lPathDesignerOverlay",t.title=n.Client.Loader.marsLocale.learningPathCaption,i=r.lPathDesignerContainerZIndex-1,t.className="lpath-designer-overlay-initial",t.style.cssText="z-index:"+i,document.getElementById("lPathDesignerContainer")&&!document.getElementById("lPathDesignerOverlay")&&document.getElementById("lPathDesignerContainer").appendChild(t),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"created DesignerOverlay"));n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CrmAppContext:createDesignerOverlay END")},r.createLandingPageContainer=function(){if(!document.getElementById("lPathlandingPageContainer")){var n=t.Loader.$mars('<div id="lPathlandingPageContainer"  tabindex="0" class="lpath-landingpage-container" style="height:100%; overflow-y:auto; top: 0;display:none;position:fixed;">');n.css("z-index",r.lPathDesignerContainerZIndex);document.getElementById("lPathDesignerContainer")&&t.Loader.$mars("#lPathDesignerContainer").append(n)}document.getElementById("lPathlandingPageContainer")&&(r.landingPageContainer=t.Loader.$mars("#lPathlandingPageContainer"))},r.createSkinnyToolbarContainer=function(){if(!document.getElementById("lPathskinnyToolbarContainer")){var n=t.Loader.$mars('<div id="lPathskinnyToolbarContainer" class="lpath-skinnytoolbar-container" style="position:absolute; top: 0;display:none;">');n.css("z-index",r.lPathDesignerContainerZIndex);document.getElementById("lPathDesignerContainer")&&t.Loader.$mars("#lPathDesignerContainer").append(n)}document.getElementById("lPathskinnyToolbarContainer")&&(r.skinnyToolbarContainer=t.Loader.$mars("#lPathskinnyToolbarContainer"))},r.store=i.Content.Store.getInstance(),r.appContext=window._MicrosoftMars.Client.Loader.appContext,r.loaded=!1,r.serviceHandler=i.ServiceHandler.getInstance(),r.lPathDesignerContainerZIndex=r.appContext.Util.getMaxZIndex()+2,r.isDesignerLaunched=!1,r.isDraftControl=!0,r.postControlActionHandler=i.PostControlActionHandler.getInstance(),r}();i.App=r})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(){function i(n,t,i,r){i===void 0&&(i={});r===void 0&&(r=!0);this.viewDataValue=n;this.rootElement=t;this.params=i;this.processBuildFlag=r;this.eventSources=[];r&&this.build()}return i.prototype.build=function(){this.viewName=this.getTemplate();this.rootElement.empty();this.rootElement.html(t.TemplateEngine.applyTemplate(this.viewName,this.viewDataValue));window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg")},i.prototype.close=function(){this.rootElement&&(this.unsubscribe(),this.rootElement.remove(),this.eventSources=null,this.rootElement=null,this.viewDataValue=null)},i.prototype.getTemplate=function(){return""},i.prototype.unsubscribe=function(){if(this.eventSources){for(var n=0;n<this.eventSources.length;n++)this.rootElement.find(this.eventSources[n]).off();this.eventSources=[]}},i.prototype.subscribe=function(n,t,i,r,u){var e,f;r===void 0&&(r=!0);e=this;this.eventSources.push(n);f=this.rootElement;u&&(f=u);f.find(n).off(t,i).on(t,function(n){return(i.call(e,n,this),r)?!1:!0})},i.prototype.show=function(){this.rootElement.show()},i.prototype.hide=function(){this.rootElement.hide()},i.prototype.getGenericDialogHolder=function(t){var i=n.$mars("#lpathGenericDialogHolder");return n.$mars("#lpathGenericDialogHolder").length<=0&&(i=n.$mars('<div id ="lpathGenericDialogHolder" class="lpath-generic-dialog-holder"><\/div>'),t?t.append(i):this.rootElement.append(i)),i},i.prototype.isHighContrastModeActive=function(){return n.$mars("#marsIFrame").css("background-image")==="none"?!0:!1},i.prototype.isBlackHighContrastMode=function(){return n.$mars("body").css("background-color")==="rgb(255, 255, 255)"?!1:!0},i}();t.View=i})(t=n.Renderer||(n.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t){t===void 0&&(t={});u.call(this,f.store.getCurrentControlModelValue(),n,t);this.rootElement=n;this.params=t}return __extends(f,u),f.prototype.getCurrentControlValue=function(){return f.store.getCurrentControlModelValue()},f.prototype.save=function(n){var t=i.$mars.Deferred(),r=i.App.save(n);return i.App.showActionOverlay(),r.done(function(n){i.App.hideActionOverlay();t.resolve(n)}),r.fail(function(n,r,u){i.App.hideActionOverlay();t.reject(n,r,u)}),t},f.prototype.publishCurrentControl=function(n,t){if(this.prePublishValidation()){var i=this.getCurrentControlValue(),f=this.getGenericDialogHolder(),e=[i],u=new r.PublishPopup(f,e,function(){n&&n()},function(){t&&t()},i.CheckedOut);u.publishControls(!0);u.setFocusOnPopupLoad()}},f.prototype.checkinCurrentControl=function(n,t){var u;if(n===void 0&&(n=!1),u=this.getCurrentControlValue(),u.CheckedOut===!0){var e=this.getGenericDialogHolder(),o=[u],s=new r.CheckinPopup(e,o,function(){f.store.updateCurrentModelValueOnPostAction(i.Util.Constants.checkInAction);t&&t()},function(){t&&t()});s.checkInControls(n)}},f.prototype.isControlCheckIn=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishPopup:Control checkin validation START");try{var i=this.getCurrentControlValue();if(i.CheckedOut===!1)return!0;this.checkinCurrentControl(!0)}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"PublishPopup:Exception occurred while validating control checkin.")}return t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishPopup:Control checkin validation END"),!1},f.prototype.prePublishValidation=function(){var u,f,e,o,n;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishPopup:Control prepublish validation START");try{if(u=this.getCurrentControlValue(),u.LanguageControlVersionContents[0].Title!==""&&u.LanguageControlVersionContents[0].Title!==null)return!0;o=this.getGenericDialogHolder();u.ControlType==i.Utility.ControlTypes.GuidedTask?(f="<div>"+i.Locale.emptyGTMessage+"<\/div>",e=i.Locale.emptyGTTitle):(f="<div>"+i.Locale.publishErrorPromptSidebarMessage+"<\/div>",e=i.Locale.publishErrorPromptSidebarTitle);n=new r.SimpleDialogView({},o,i.Util.Constants.ControlExistPopup,e,f,function(){this.rootElement.find('button[id="lPathSkinnyToolbarPublishButton"]').focus()});n.addDefaultFocusOnOkOrClose=!0;n.cancelElementFocus=this.rootElement.find('button[id="lPathSkinnyToolbarPublishButton"]');n.ariaDescribedById=i.Util.Constants.ControlExistPopup;n.show()}catch(s){t.Loader.marsExceptionHandler.execute(s.name,s.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"PublishPopup:Exception occurred while  prepublish validation of control.")}return t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishPopup:Control prepublish validation END"),!1},f.prototype.deleteCurrentControl=function(){var t=this.getCurrentControlValue();n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ControlView:deleteCurrentControl START");var u=this.getGenericDialogHolder(),e=[t.ControlId],o=new r.DeleteSidebarPopup(u,e,function(){f.store.updateCurrentModelValueOnPostAction(i.Util.Constants.deleteControlAction);i.App.CancelCaller.viewName?i.App.show():i.App.close()},function(){});o.deleteSidebar()},f.prototype.updateAuthorName=function(n){var t=i.$mars.Deferred(),r=i.ServiceHandler.getInstance().updateAuthorName(n);return r.done(function(n){var i=n.Result;t.resolve(i)}),r.fail(function(n,i,r){t.reject(n,i,r)}),t},f.store=i.Content.Store.getInstance(),f}(r.View);r.ControlView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n){u.call(this,n);this.rootElement=n;this.addedDynamicValueIds=[];this.ComparatorMapper={optionForBoolean:[i.Utility.Operators.True,i.Utility.Operators.False],optionForText:[i.Utility.Operators.Equal,i.Utility.Operators.NotEqual,i.Utility.Operators.Contains,i.Utility.Operators.DoesNotContain,i.Utility.Operators.StartsWith,i.Utility.Operators.EndsWith],optionForNumber:[i.Utility.Operators.Equal,i.Utility.Operators.NotEqual,i.Utility.Operators.GreaterThan,i.Utility.Operators.GreaterThanOrEqual,i.Utility.Operators.LessThan,i.Utility.Operators.LessThanOrEqual]};this.buildView()}return __extends(f,u),f.prototype.buildView=function(){var r=this.getCurrentControlValue(),t;this.dynamicContextModel=this.populateDynamicPropGrid(r);this.viewDataValue=this.dynamicContextModel;this.build();t=i.$mars(".lpath-dpc-table table");t&&t.children().length==0?t.after('<div id="lpathDynPropertyTablePlaceholder" class="lpathDynPropertyTablePlaceholder">'+n.Client.Loader.marsLocale.emptydynamicPropertyTablePlaceholder+"<\/div>"):i.$mars("#lpathDynPropertyTablePlaceholder").hide();this.dynamicConditionsAvailable()},f.prototype.getTemplate=function(){return i.Util.Constants.sidebarAdvancedDynamicPropertiesTable},f.prototype.populateDynamicPropGrid=function(n){var t=this;return t.getContextValues(n,i.Utility.ContextTypeMetaData.DynamicContext)},f.prototype.getContextValues=function(n,t){var e=[],o=n.Contexts,f,i,r,u;if(this.addedDynamicValueIds=[],o)for(f=0;f<o.length;f++)if(i=n.Contexts[f].ContextGroup.ContextGroupElements,i)for(r=0;r<i.length;r++)if(i[r].ContextTypeMetaDataId==t)for(u=0;u<i[r].ContextValues.length;u++)e.push(i[r].ContextValues[u]),this.addedDynamicValueIds.push(i[r].ContextValues[u].Value);return e},f.prototype.attachEventToList=function(){var n=this;this.dynamicPropertyListItem=this.rootElement.find('td[data-name="lPathDyanmicPropertyName"]');this.dynamicPropertyListItemDelete=this.rootElement.find('button[data-name="lPathDyanmicPropertyDelete"]');this.addMoreButton=this.rootElement.find("#lPathAddMore");this.addExistingBtn=this.rootElement.find("#lpathDynPropAddExisting");this.subscribe(this.dynamicPropertyListItem,"click",this.onListItemClick);this.subscribe(this.addMoreButton,"click",this.addMoreButtonClick);this.addMoreButton.on("keydown",function(t){n.addMoreButtonKeyDownHandling(t)});this.subscribe(this.dynamicPropertyListItemDelete,"click",this.onDeleteItemClick);this.subscribe(this.addExistingBtn,"click",this.addExistingPropertyToModel)},f.prototype.addMoreButtonClick=function(){var n=new i.Utility.DynamicContext;this.renderDynamicPropForm(n);this.subscribe(this.contextType,"change",this.libraryFieldValidation);this.subscribe(this.valueType,"change",this.populateComparator);this.populateComparator()},f.prototype.libraryFieldValidation=function(){var n=this.rootElement.find("#lPathDynLibrary"),t=this.contextType.val();t==2?n.hasClass("lpath-display-dynpropnone")&&n.removeClass("lpath-display-dynpropnone"):n.hasClass("lpath-display-dynpropnone")||n.addClass("lpath-display-dynpropnone")},f.prototype.populateComparator=function(){var r=i.$mars('<option value="3">'+n.Client.Loader.marsLocale.equalsCaption+'<\/option><option value= "6">'+n.Client.Loader.marsLocale.doesNotEquals+'<\/option><option value= "7">'+n.Client.Loader.marsLocale.containsCaption+'<\/option><option value= "8">'+n.Client.Loader.marsLocale.doesNotContainsCaption+'<\/option><option value= "9">'+n.Client.Loader.marsLocale.startsWithCaption+'<\/option><option value= "10">'+n.Client.Loader.marsLocale.endsWithCaption+'<\/option><option value= "4">'+n.Client.Loader.marsLocale.greaterThan+'<\/option><option value= "5">'+n.Client.Loader.marsLocale.greaterThanEqualTo+'<\/option><option value= "1">'+n.Client.Loader.marsLocale.lessThan+'<\/option><option value= "2">'+n.Client.Loader.marsLocale.lessThanEqualTo+'<\/option><option value= "11">'+n.Client.Loader.marsLocale.trueCaption+'<\/option><option value= "12">'+n.Client.Loader.marsLocale.falseCaption+"<\/option>"),u=this.valueType.val(),t,f;u==0?(t=this.ComparatorMapper.optionForText,this.populateComaparatorDropdown(r,t),this.rootElement.find('input[id="lPathValueForComparator"]').prop("disabled",!1)):u==2?(t=this.ComparatorMapper.optionForNumber,this.populateComaparatorDropdown(r,t),this.rootElement.find('input[id="lPathValueForComparator"]').prop("disabled",!1)):u==1&&(f=this.ComparatorMapper.optionForBoolean,this.rootElement.find('input[id="lPathValueForComparator"]').val(""),this.populateComaparatorDropdown(r,f),this.rootElement.find('input[id="lPathValueForComparator"]').prop("disabled",!0))},f.prototype.populateComaparatorDropdown=function(n,t){var f=this.rootElement.find("#lPathDynComparator"),r,u;for(f.html(""),r=0;r<n.length;r++)for(u=0;u<t.length;u++)n[r].getAttribute("value")===t[u].toString()&&f.append(i.$mars(n[r]))},f.prototype.onListItemClick=function(n){var r=n.currentTarget,f=this.rootElement.find(r),u,t,i;this.rootElement.find(".lpath-dpc-table-tr").removeClass("lpath-dpc-active-row");this.rootElement.find(r).parent().addClass("lpath-dpc-active-row");u=f.data("entitycontextvalueid");t=this.createModelForDynPropView(u,this.dynamicContextModel);this.renderDynamicPropForm(t);var e=this.rootElement.find("select").not("#lPathDynPropDropdown"),o=this.rootElement.find("#lPathDynamicPropOkButton"),s=this.rootElement.find("#lPathDynamicPropCancelButton");this.rootElement.find('select[id="lPathDynContextType"]').val(t.DynamicContextType);this.rootElement.find('select[id="lPathDynPropValueType"]').val(t.Value.ValueType);this.populateComparator();this.rootElement.find('select[id="lPathDynComparator"]').val(t.Value.Comparator);i=this.rootElement.find("#lPathDynLibrary");t.DynamicContextType==2?i.hasClass("lpath-display-dynpropnone")&&i.removeClass("lpath-display-dynpropnone"):i.hasClass("lpath-display-dynpropnone")||i.addClass("lpath-display-dynpropnone");e.attr("disabled","true");this.inputTextBox.attr("disabled","true");o.attr("disabled","true");s.attr("disabled","true")},f.prototype.renderDynamicPropForm=function(n){var u=i.Util.Constants.sidebarAdvancedDynamicPropertiesForm,t;this.dynamicFormPlaceholder=i.App.lPathDesignerContainer.find('div[id="lPathDynPropFormHolder"]');this.dynamicFormPlaceholder.html("");t=r.TemplateEngine.applyTemplate(u,n);this.dynamicFormPlaceholder.append(t);this.saveButtonDynPropForm=this.rootElement.find("#lPathDynamicPropOkButton");this.cancelButtonDynPropForm=this.rootElement.find("#lPathDynamicPropCancelButton");this.inputTextBox=this.rootElement.find('input[type="text"]');this.valueType=this.rootElement.find('select[id="lPathDynPropValueType"]');this.contextType=this.rootElement.find('select[id="lPathDynContextType"]');this.subscribe(this.saveButtonDynPropForm,"click",this.onSaveButtonClick);this.subscribe(this.cancelButtonDynPropForm,"click",this.addMoreButtonClick)},f.prototype.createModelForDynPropView=function(n,t){for(var s,u,f,e,o=[],r=0;r<t.length;r++)n===t[r].EntityContextValue.Id&&(f=new i.Utility.DynamicContextJsonValue,e=new i.Utility.DynamicContext,u=JSON.parse(t[r].EntityContextValue.Value),e.Name=t[r].EntityContextValue.Name,e.Description=t[r].EntityContextValue.Description,e.DynamicContextType=t[r].EntityContextValue.DynamicContextType,e.Library=t[r].EntityContextValue.Library,f.ApiMethod=u.ApiMethod,u.ApiParams&&(o=JSON.parse(u.ApiParams),s=o.toString(),f.ApiParams=s),f.Comparator=u.Comparator,f.ValueType=u.ValueType,f.ExpectedValue=u.ExpectedValue,e.Value=f);return e},f.prototype.setContextValues=function(t){var f=new i.Utility.DynamicContextJsonValue,u=new i.Utility.DynamicContext,o,e=this.getCurrentControlValue(),s=[],h=!0,r=this,c;return f.ApiMethod=r.dynamicFormPlaceholder.find('input[id="lPathAPIMethod"]').val(),s=this.dynamicFormPlaceholder.find('input[id="lPathAPIParams"]').val().split(","),f.ApiParams=JSON.stringify(s),f.Comparator=r.dynamicFormPlaceholder.find('select[id="lPathDynComparator"]').val(),f.ValueType=r.dynamicFormPlaceholder.find('select[id="lPathDynPropValueType"]').val(),f.ExpectedValue=r.dynamicFormPlaceholder.find('input[id="lPathValueForComparator"]').val(),u.Name=r.dynamicFormPlaceholder.find('input[id="lPathConditionName"]').val(),u.Description=r.dynamicFormPlaceholder.find('input[id="lPathDynPropDesc"]').val(),u.AuthoringId=n.Client.Loader.appContext.getAuthoringId(),u.DynamicContextType=r.dynamicFormPlaceholder.find('select[id="lPathDynContextType"]').val(),u.Library=r.dynamicFormPlaceholder.find('input[id="lPathDynPropLibrary"]').val(),t&&(h=this.formValidation(u,f)),h?(u.Value=JSON.stringify(f),o=u,c=e.Contexts[0].ContextGroup.ContextGroupElements,e.Contexts[0].ContextGroup.ContextGroupElements=r.bindContextValues(i.Utility.ContextTypeMetaData.DynamicContext,o,c),e):void 0},f.prototype.bindContextValues=function(n,t,r){var f=!1,e,u;return r=i.Util.Common.createNewContextGroupElement(r,n),r.length>0&&(u=[],u.push(t),r.forEach(function(t){var s=t.ContextValues,r,o;if(t.ContextTypeMetaDataId===n){for(r=0;r<u.length;r++)o=new i.Content.ContextValueModel,o.Id=i.Utility.Util.newGuid(),o.Value=u[r].Id.trim(),o.EntityContextValue=u[r],s.push(o);e=t;f=!0;t.ContextValues=[];t.ContextValues=s;return}})),r},f.prototype.onSaveButtonClick=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarAdvancedOptionsView:onSave START");try{var n=this.setContextValues(!0);n&&this.saveControlValues(n);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarAdvancedOptionsView:onSave END")}catch(i){t.Loader.marsExceptionHandler.execute(i.name,i.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView : Error onSave call click.")}},f.prototype.saveControlValues=function(n){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Saving the data to Store for the Adavnced Options View : START");try{var f=this,i=u.prototype.save.call(this,n);i.done(function(){f.buildView()});i.fail(function(n,i,r){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON);console.log("Error while saving Advanced Options data "+r.message)});t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Saving the data to Store for the Adavnced Options View : END")}catch(r){t.Loader.marsExceptionHandler.execute(r.name,r.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView :Error when saving the data to Store for the Adavnced Options View")}},f.prototype.onDeleteItemClick=function(n){var r=n.currentTarget,u=this.rootElement.find(r),f=this,t;t=u.data("entitycontextvalueid");i.Util.Common.showAlertMessage(i.Locale.removeConditionPopupTitle,i.Locale.removeConditionPopupMessage,this.rootElement,!0,i.Locale.remove,i.Locale.cancelCaption,function(){f.deleteCondition(t)})},f.prototype.deleteCondition=function(n){for(var e,r=this.getCurrentControlValue(),f=[],u=0;u<this.dynamicContextModel.length;u++)n!==this.dynamicContextModel[u].EntityContextValue.Id&&f.push(this.dynamicContextModel[u]);e=r.Contexts[0].ContextGroup.ContextGroupElements;r.Contexts[0].ContextGroup.ContextGroupElements=i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.DynamicContext,f,e);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarAdvancedOptionsView:onDelete START");try{r&&this.saveControlValues(r);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarAdvancedOptionsView:onDelete END")}catch(o){t.Loader.marsExceptionHandler.execute(o.name,o.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView : Error onDelete call click.")}},f.prototype.getsidebarExistingDynamicPropertiesTemplate=function(){return i.Util.Constants.sidebarExistingDynamicProperties},f.prototype.dynamicConditionsAvailable=function(){try{var n=this,u=i.Util.Common.getDynamicPropertiesFromService();u.done(function(t){for(var s,e,f=t.Result,o=[{Id:0,Name:i.Locale.addExistingDynPropSelectAValue,Model:"0"}],u=0;u<f.length;u++)i.$mars.inArray(f[u].Id,n.addedDynamicValueIds)===-1&&(s={Id:f[u].Id,Name:f[u].Name,Model:JSON.stringify(f[u])},o.push(s));e=n.rootElement.find('div[id="lpathExistingDynamicProp"]');e.html("");e.html(r.TemplateEngine.applyTemplate(n.getsidebarExistingDynamicPropertiesTemplate(),o));n.attachEventToList()});u.fail(function(i){t.Loader.marsExceptionHandler.execute(i.status,i.statusText,i.responseJSON);n.attachEventToList()})}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedDynamicPropertiesView :Error in dynamicConditionsAvailble to get data from api call")}},f.prototype.addExistingPropertyToModel=function(){var t=JSON.parse(this.rootElement.find("#lPathDynPropDropdown option:selected").val()),n,r;t!==0&&(n=this.getCurrentControlValue(),r=n.Contexts[0].ContextGroup.ContextGroupElements,n.Contexts[0].ContextGroup.ContextGroupElements=this.bindContextValues(i.Utility.ContextTypeMetaData.DynamicContext,t,r),n&&this.saveControlValues(n))},f.prototype.validateOnCancelClick=function(){var n=this.getCurrentControlValue(),t=this.setContextValues(!1);return(i.Util.Common.getModelValueWithoutControlIdAndIds(n),i.Util.Common.getModelValueWithoutControlIdAndIds(t),JSON.stringify(t)===JSON.stringify(n))?!1:!0},f.prototype.formValidation=function(n,t){var r=this;return this.conditionNameValidation(n.Name)?(i.Util.Common.showAlertMessage(i.Locale.conditionNamePopupTitle,i.Locale.conditionNamePopupMessage,this.rootElement.parents("#lpathSkinnytoolbarOtherControlContainer"),!1,i.Locale.okCaption,function(){r.rootElement.find("#lPathDynamicPropOkButton").focus()},function(){r.rootElement.find("#lPathDynamicPropOkButton").focus()}),!1):this.requiredFieldValidation(n,t)?(i.Util.Common.showAlertMessage(i.Locale.dynamicPropFormPopupTitle,i.Locale.dynamicPropFormPopupMessage,this.rootElement.parents("#lpathSkinnytoolbarOtherControlContainer"),!1,i.Locale.okCaption,function(){r.rootElement.find("#lPathDynamicPropOkButton").focus()},function(){r.rootElement.find("#lPathDynamicPropOkButton").focus()}),!1):!0},f.prototype.conditionNameValidation=function(n){if(!(n=="")){var r=!1,t=[],u=this;return this.rootElement.find("#lPathDynPropDropdown").children().each(function(){t.push(u.rootElement.find(this).text());t.length>0&&!(i.$mars.inArray(n,t)===-1)&&(r=!0)}),r||this.rootElement.find(".lpath-dpc-table table tr td:nth-child(1)").each(function(){t.push(u.rootElement.find(this).text());t.length>0&&!(i.$mars.inArray(n,t)===-1)&&(r=!0)}),r}},f.prototype.requiredFieldValidation=function(n,t){return n.Name.trim()==""||n.DynamicContextType==null||t.ApiMethod.trim()==""||t.ValueType==null||t.Comparator==null||!(t.ValueType==1)&&t.ExpectedValue.trim()==""},f.prototype.cancelCallback=function(){return this.dynamicFormPlaceholder&&!i.App.lPathDesignerContainer.find("#lPathConditionName").attr("disabled")?this.validateOnCancelClick():!1},f.prototype.addMoreButtonKeyDownHandling=function(n){n.keyCode==i.Utility.KeyCodeEnum.TabKey&&n.shiftKey&&(i.App.lPathDesignerContainer.find(".lpath-header-caption-active").focus(),n.stopPropagation(),n.preventDefault())},f}(r.ControlView);r.SidebarAdvancedDynamicPropertiesView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t,i){u.call(this);this.onAdvancedOptionsOkCallback=t;this.onAdvancedOptionsCancelCallback=i;this.backboneModel=n.model!=null&&n.model!=undefined?n.model:r.BackboneControlBaseMetadata;this.$el=n.el}return __extends(f,u),f.prototype.events=function(){return{}},f.prototype.render=function(){var u=this,t=this,f=r.TemplateEngine.applyTemplate(i.Util.Constants.advancedOptionTemplate,this.backboneModel.toJSON());this.$el.html(f);this.$el.find("#lPathControlAdvancedOptionsView").css("z-index",n.Client.Loader.appContext.Util.getMaxZIndex()+1);this.$el.find('button[id="lPathSetupAdvancedOptionsCancelButton"]').click(function(n){return u.onAdvancedOptionsCancelClick(n)});this.$el.find('button[id="lPathSetupAdvancedOptionsOkButton"]').click(function(n){return u.onAdvancedOptionsOkClick(n)});this.$el.find("#lpath-gt-enable_nudge").focus();this.$el.find('div[id="lPathControlAdvancedOptionsView"]').off("keyup").on("keyup",function(n){t.handleEscapeKeyDown(n,t)});this.$el.find('button[id="lPathSetupAdvancedOptionsCancelButton"]').keydown(function(n){return u.onCancelKeyDown(n)});this.$el.find("#lpath-gt-enable_nudge").keydown(function(n){return u.setTabbingOnTabPanel(n)});this.$el.find(".lpath-setup-advance-grid-wildcard-checkbox").on("keydown",function(n){return t.handleUpDownArrowNavigationOnGrid(n,t)});this.$el.find(".lpath-setup-advance-grid-wildcard-checkbox").off("change").on("change",function(n){t.onChangeOfCheckboxState(n)});return this.$el.find("#okButtonAriaDescId").text(i.Locale.GTOkAdvancedOptionDialog),this.$el.find("#cancelButtonAriaDescId").text(i.Locale.GTCancelAdvancedOptionDialog),this.$el.find("#ignoreValueGTAriaDescId").text(i.Locale.GTUncheckedIgnoreValueCheckbox),this},f.prototype.onAdvancedOptionsOkClick=function(){this.onAdvancedOptionsOkCallback()},f.prototype.onAdvancedOptionsCancelClick=function(){this.onAdvancedOptionsCancelCallback()},f.prototype.isCurrentModelValueUpdated=function(){return!1},f.prototype.handleEscapeKeyDown=function(n,t){if(n.keyCode==i.Utility.KeyCodeEnum.EscapeKey){t.onAdvancedOptionsCancelClick(n);n.stopPropagation()}},f.prototype.onCancelKeyDown=function(r){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"tabbing order after Cancel key down : START");try{if(r.keyCode==i.Utility.KeyCodeEnum.TabKey)if(r.shiftKey)r.shiftKey&&this.$el.find("#lPathSetupAdvancedOptionsOkButton")&&this.$el.find("#lPathSetupAdvancedOptionsOkButton").focus();else{var f=this.$el.find("#lpath-gt-enable_nudge");f.focus()}else if(n.Client.Loader.appContext.Util.isEnterPressed(r,!0))this.onAdvancedOptionsCancelClick(r);return t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"tabbing order after Cancel key down : END"),!1}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"AdvancedOptionsView : Error on tabbing order after Cancel key down")}},f.prototype.handleUpDownArrowNavigationOnGrid=function(n,t){var i=this.$el.find("#lPathSetupAdvancedOptionsOkButton"),r=this.$el.find("#lpath-gt-show_bubble_pointer");this.handleUpDownArrowNavigation(n,t,r,i,"lpath-setup-advance-grid-wildcard-checkbox")},f.prototype.handleUpDownArrowNavigation=function(n,t,r,u,f){var o=t.$el.find(n.currentTarget),e;n.keyCode==i.Utility.KeyCodeEnum.TabKey&&(n.shiftKey?n.shiftKey&&r.focus():u.focus(),n.stopPropagation(),n.preventDefault());n.keyCode==i.Utility.KeyCodeEnum.DownArrowKey&&(e=o.closest("tr").next(),e.find("."+f).focus(),n.preventDefault());n.keyCode==i.Utility.KeyCodeEnum.UpArrowKey&&(e=o.closest("tr").prev(),e.find("."+f).focus(),n.preventDefault());this.$el.find("."+f).attr("tabindex","-1");o.attr("tabindex","0")},f.prototype.setTabbingOnTabPanel=function(n){n.keyCode==i.Utility.KeyCodeEnum.TabKey&&(n.shiftKey||this.$el.find("#lpath-gt-show_bubble_pointer").is(":visible")&&this.$el.find("#lpath-gt-show_bubble_pointer").focus(),n.shiftKey&&this.$el.find(":tabbable")&&this.$el.find(":tabbable").last().focus(),n.stopPropagation(),n.preventDefault())},f.prototype.onChangeOfCheckboxState=function(n){var r=t.Loader.$mars(n.currentTarget);r.prop("checked")===!0?this.$el.find("#ignoreValueGTAriaDescId").text(i.Locale.GTcheckedIgnoreValueCheckbox):this.$el.find("#ignoreValueGTAriaDescId").text(i.Locale.GTUncheckedIgnoreValueCheckbox);r.removeAttr("aria-describedby").attr("aria-describedby","ignoreValueGTAriaDescId")},f}(BackboneMars.View);r.AdvancedOptionView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(i){"use strict";var r=function(){function i(){}return i.prototype.DisplayStepBubble=function(i,r,u,f,e,o){var s,c,h,l;f===void 0&&(f=window.Microsoft.Mars.Client.Runtime.Controls.BubbleUtilityConstants.bubblePositionAuto);e===void 0&&(e=!0);try{return(t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubbleRenderer:DisplayStepBubble START..(No END point is added returns value at multiple statments)"),t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Params : totalSteps : "+i+"; stepIndex : "+u+"; placementPosition : "+f),s=new window.Microsoft.Mars.Client.Runtime.Controls.StepBubbleModel(this.stepModelValue.ControlId),s.setTemplate(r),s.setControlType(window.Microsoft.Mars.Client.Runtime.Controls.ControlTypes.PassiveStep),s.setStepActive(window.Microsoft.Mars.Client.Runtime.Controls.ControlTypes.ActiveStep),s.setEvents(this.stepModelValue.Events),c=new window.Microsoft.Mars.Client.Runtime.Controls.StepBubbleView(this.stepModelValue.ControlId,i),c.setHtmlContent(s.getTemplate()),this.stepBubble=new window.Microsoft.Mars.Client.Runtime.Controls.StepBubble(s,i),this.stepBubble.setView(c),h=n.Client.Loader.appContext.getElement(this.stepModelValue.MetadataJson.ElementIdentifier),h)?(t.Loader.appContext.Util.setSelectionState(h),s.setJquerySelectorMap("element",h),this.stepBubble.bubbleModel.setStepIndex(u),this.stepBubble.inject(!1,!0,f,e),l=this,this.stepBubble.bubbleModel.jquerySelectorMap.xButtonId.click(function(){var i,r;l.RemoveStepBubble();o&&o();e||n.Client.Loader.appContext.Util.hideOverlay();i=t.Loader.$mars('div[name="mars_propertytab_container"]');i&&i.hide();r=t.Loader.$mars("#highlighter");r&&r.hide()}),e||this.stepBubble.bubbleModel.jquerySelectorMap.bubbleId.hasClass("lpath-flow-preview-bubble")||this.stepBubble.bubbleModel.jquerySelectorMap.bubbleId.addClass("lpath-flow-preview-bubble"),this.stepBubble.show(e),t.Loader.appContext.util.showXButton(),t.Loader.$mars("#learnMore").css("text-overflow","ellipsis"),t.Loader.$mars(".lpath-gt-bubble-passivecontainer").css("max-height","inherit"),!0):!1}catch(a){return t.Loader.marsExceptionHandler.execute(a.name,a.message),t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"StepBubbleRenderer:DisplayStepBubble Exception occurred displaying step bubble."),!1}},i.prototype.RemoveStepBubble=function(){try{this.stepBubble&&this.stepBubble!=null&&(this.stepBubble.cleanup(),this.stepBubble=null)}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message)}},i}();i.StepBubbleRenderer=r})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(){function r(n,t,i,r){t===void 0&&(t=!1);r===void 0&&(r=!1);this.mouseLeaveHandler=n;this.isAccesibleDnd=t;this.stepModel=i;this.isDomDndDisabled=r;this.currentTargets=[];this.roots=[];this.timerValue=15e3;this.parentArray=[];this.returnArray=[];this.lastActiveRoot=null;this.moveEvent="mousemove";this.trackingKey="IsInProgress";this.dragHandleId="dynamicDragHandler";this.dragHandleSelector="#"+this.dragHandleId;this.currentMoveState=null;this.currentIFrames=[];this.accessibleRegisteredControls=[];this.currentRegisteredControlIndex=0;this.disableEscKey=!1;this.attachedMousupForQuickform=!1;this.highlightedTargets=[];t&&(this.timerValue=3e4)}return r.prototype.enableElementSelection=function(){if(this.isAccesibleDnd)this.initializeAccessibleDnd();else{var n=this.getBody();this.attachEvents(n,[])}return this.promise=i.$mars.Deferred(),this.timeOutWatcher=window.setTimeout(this.handleTimeout,this.timerValue,this),this.promise},r.prototype.close=function(){window.clearTimeout(this.timeOutWatcher);this.clearCurrentTargets();this.onElementMouseLeave();this.currentMoveState!=null&&this.currentMoveState.focusableEls&&this.currentMoveState.focusableEls!=null&&this.currentMoveState.focusableEls.length>0&&(this.currentMoveState.focusableEls.forEach(function(n){return n.click()}),this.currentMoveState.focusableEls=[])},r.prototype.show=function(i){var r=n.Client.Loader.appContext.getElement(i);if(r&&r!=null)if(this.isRegisteredControl(r.element))this.highlightedTargets.push({element:r.element,prevBorder:this.checkIfBorderExists(r.element)?t.Loader.$mars(r.element).css("border"):""}),t.Loader.$mars(r.element).css("border","3px solid #17c500");else this.onElementMouseEnter(r.element)},r.prototype.handleTimeout=function(t){n.Client.Loader.appContext.handleCustomizationContainerInMoca(!0);t.clearCurrentTargets();t.promise.fail();t.currentMoveState&&t.onElementMouseLeave();t=null},r.prototype.attachEvents=function(t,i){var r=this,u,f;this.clearCurrentTargets();n.Client.Loader.appContext.handleCustomizationContainerInMoca(!1);this.attachMouseUpEventForRegisteredControl();this.isDomDndDisabled||this.attachMouseUpEvent(t,i);u=n.Client.Loader.appContext.isMobileClient();u&&(f=n.Client.Loader.appContext.isISHPage()?".icQuickCreateForm-popupContent":".quickCreateForm-popupContent",this.getBody().find(".dialogConductor").bind("DOMSubtreeModified",function(t){var i=n.Client.Loader.$mars(t.currentTarget).find(f);i&&i.length>0&&!r.attachedMousupForQuickform&&(console.log("Event attached for Quick form MOCA"),r.attachedMousupForQuickform=!0,r.pageLoadHandler())}),this.getBody().find(".navBarQuickCreate").bind("DOMSubtreeModified",function(t){var i=n.Client.Loader.$mars(t.currentTarget).find(".popupContent");i&&i.length>0&&i.data("is-popup")&&!r.attachedMousupForQuickform&&(console.log("Event attached for Quick form ISH"),r.attachedMousupForQuickform=!0,r.pageLoadHandler())}))},r.prototype.pageLoadHandler=function(){window.clearTimeout(this.timeOutWatcher);this.timeOutWatcher=window.setTimeout(this.handleTimeout,this.timerValue,this);var n=this.getBody();this.attachEvents(n,[])},r.prototype.getPathBasedOnPosition=function(n){var i,r,u;for(n=t.Loader.$mars(n),i=n.prop("tagName"),r="";i&&i!=="BODY";)u=n.parent().children(i).index(n),r=">"+i+"/"+u+r,n=n.parent(),i=n.prop("tagName");return r},r.prototype.getPathBasedOnId=function(i){var r,u,f,e;for(i=t.Loader.$mars(i),r=i.prop("tagName"),u="";r&&r!=="BODY";){if(f=i.attr("id"),f&&(n.Client.Loader.appContext.ClientType!="Mobile"||f.match(/\d+/)==null))return">"+r+"/#"+f+u;e=i.parent().children(r).index(i);u=">"+r+"/"+e+u;i=i.parent();r=i.prop("tagName")}return u},r.prototype.getPathBasedOnCss=function(n){var i,u,f,r;for(n=t.Loader.$mars(n),i=n.prop("tagName"),u="";i&&i!=="BODY";)f=n.parent().children(i).index(n),r=n.attr("class"),r&&r.trim()?(r=r.trim().split(/\s+/).join(" "),f=n.parent().find(i+"."+r.replace(/ /g,".")).index(n),u=">"+i+"."+r.replace(/ /g,".")+"/"+f+u):u=">"+i+"/"+f+u,n=n.parent(),i=n.prop("tagName");return u},r.prototype.clearCurrentTargets=function(){for(var r,u;this.currentTargets.length>0;)r=this.currentTargets.pop(),r.elements.off("mouseup",r.handler),r.elements=null,r.handler=null;while(this.roots.length>0){var u=this.roots.pop(),r=u.target,f=r.find(this.dragHandleSelector);f&&f.remove();r.data(this.trackingKey,!1);r.off(this.moveEvent,u.handler);r.off("keyup",u.keyHandler)}this.clearRegisteredControlHighlight();this.getBody().off("keyup");t.Loader.appContext.ClientType==i.Util.Constants.WebClientType?(u=n.Client.Loader.$mars("body"),n.Client.Loader.appContext.getCurrentContentFrame(u,null).off("load")):(this.getBody().find(".dialogConductor").unbind("DOMSubtreeModified"),this.getBody().find(".navBarQuickCreate").unbind("DOMSubtreeModified"))},r.prototype.clearRegisteredControlHighlight=function(){while(this.highlightedTargets.length>0){var n=this.highlightedTargets.pop();t.Loader.$mars(n.element).css("border",n.prevBorder);n.element=null;n.prevBorder=null}},r.prototype.controlAddRemoveEventHandler=function(){var s=t.Loader.appContext.getActiveRegisteredControl(),a=this,n=function(n){a.onControlMouseUp(n.target,n.data.properties);return n.stopPropagation(),!1},h,r,e,f,l,u,v,o,c;for(h in s)try{if(t.Loader.appContext.ClientType==i.Util.Constants.MobileClientType){if(r=a.getDOMElement(window.parent,s[h].getCtrlObj()),r){i.$mars(r).attr("MarsFlag",!0);c=s[h].getProperties();i.$mars(r).off("mouseup",n).on("mouseup",{properties:c},i.$mars.proxy(n,this));this.currentTargets.push({elements:i.$mars(r),handler:n});this.highlightedTargets.push({element:r,prevBorder:this.checkIfBorderExists(r)?t.Loader.$mars(r).css("border"):""});t.Loader.$mars(r).css("border","3px solid #17c500")}}else{s[h].getCtrlObj().attr("MarsFlag",!0);e=s[h].getCtrlObj()[0];c=s[h].getProperties();i.$mars(e).off("mouseup",n).on("mouseup",{properties:c},i.$mars.proxy(n,this));this.currentTargets.push({elements:i.$mars(e),handler:n});this.highlightedTargets.push({element:e,prevBorder:this.checkIfBorderExists(e)?t.Loader.$mars(e).css("border"):""});t.Loader.$mars(e).css("border","3px solid #358717")}}catch(y){}if(f=t.Loader.appContext.getAllChildRegisteredControl(),f)for(l in f)try{if(t.Loader.appContext.ClientType==i.Util.Constants.MobileClientType){if(u=a.getDOMElement(window.parent,f[l].getCtrlObj()),u){i.$mars(u).attr("MarsFlag",!0);v=f[l].getProperties();i.$mars(u).off("mouseup",n).on("mouseup",{properties:v},i.$mars.proxy(n,this));this.currentTargets.push({elements:i.$mars(u),handler:n});this.highlightedTargets.push({element:u,prevBorder:this.checkIfBorderExists(u)?t.Loader.$mars(u).css("border"):""});t.Loader.$mars(u).css("border","3px solid #358717")}}else{f[l].getCtrlObj().attr("MarsFlag",!0);o=f[l].getCtrlObj()[0];c=f[l].getProperties();i.$mars(o).off("mouseup",n).on("mouseup",{properties:c},i.$mars.proxy(n,this));this.currentTargets.push({elements:i.$mars(o),handler:n});this.highlightedTargets.push({element:o,prevBorder:this.checkIfBorderExists(o)?t.Loader.$mars(o).css("border"):""});t.Loader.$mars(o).css("border","3px solid #358717")}}catch(y){}},r.prototype.onMouseUp=function(n,r,u){var v,p,h,w,c,y;window.clearTimeout(this.timeOutWatcher);this.disableEscKey=!0;var l,f,e,o,k,s=u,a={resultPathDOM:"",resultPathClientAPI:""},d=JSON.stringify(t.Loader.appContext.getPageNavigationInfo());for(f=this.getPathBasedOnId(n),e=this.getPathBasedOnCss(n),o=this.getPathBasedOnPosition(n),l=[f,e,o],n=i.$mars(n),n.hasClass("lpath-sidebar-floweditor")&&this.promise.reject(d);n.length!=0;)if(n.attr("MarsFlag")=="true"){v=t.Loader.appContext.getActiveRegisteredControl();for(p in v)try{if(v[p].getCtrlObj()[0]==n[0]){s=v[p].getProperties();break}}catch(rt){}if(s!=null)break;if(h=t.Loader.appContext.getAllChildRegisteredControl(),h)for(w in h)try{if(h[w].getCtrlObj()[0]==n[0]){s=h[w].getProperties();break}}catch(rt){}break}else n=n.parent();if(l){if(c=[],r instanceof Array)c=r;else{this.parentArray.push(r);for(var nt=n,g=nt.parentsUntil(),tt=g[g.length-1].parentNode,it=this.getAllRequiredIFramesForSelectedControl(tt),b=this.returnArray.length;it&&b>0;)c.push(this.returnArray[b-1]),b--}while(c.length>0)y=c.pop(),f=this.getPathBasedOnId(y)+f,e=this.getPathBasedOnCss(y)+e,o=this.getPathBasedOnPosition(y)+o;l=[f,e,o]}k=s!=null?JSON.stringify(s):"";a.resultPathDOM=l;a.resultPathClientAPI=k;this.clearCurrentTargets();a?this.promise.resolve(JSON.stringify(a),d):this.promise.reject()},r.prototype.onControlMouseUp=function(n,i){window.clearTimeout(this.timeOutWatcher);this.disableEscKey=!0;var r={resultPathDOM:"",resultPathClientAPI:""},u=JSON.stringify(t.Loader.appContext.getPageNavigationInfo());i!=null&&(r.resultPathClientAPI=JSON.stringify(i));this.clearCurrentTargets();r?this.promise.resolve(JSON.stringify(r),u):this.promise.reject()},r.prototype.getAllRequiredIFramesForSelectedControl=function(n){for(var r,f;this.parentArray!==null;){var t=this.parentArray.pop(),u=t[0].contentWindow.frames,i=u.length;if(t[0].contentWindow.document==n)return this.returnArray.push(t),!0;if(i==0)return!1;while(i>0){if(r=[],r.push(u[i-1].frameElement),this.parentArray.push(r),f=this.getAllRequiredIFramesForSelectedControl(n),f)return this.returnArray.push(t),!0;i--}}return!1},r.prototype.attachMouseUpEvent=function(n,r){var u=this,h,e,s;t.Loader.appContext.ClientType==i.Util.Constants.MobileClientType&&(h=i.$mars(window.parent.document).find(".customizationContainer"),n=h.siblings());var c=n.find('div[id!="dynamicDragHandler"], a, div, h1, h2, h3, h4, h5, h6, img, input, label, li, p, select, span, textarea, td, th, button, dialog, details, summary, header, mark, meter, progress, section, time').not('#lPathDesignerContainer, [MarsFlag!="true"]').andSelf(),l=function(n){u.onMouseUp(n.target,r,null);return r=null,n.stopPropagation(),!1};c.off("mouseup").on("mouseup",i.$mars.proxy(l,this));this.currentTargets.push({elements:c,handler:l});var u=this,f=t.Loader.appContext.ClientType==i.Util.Constants.WebClientType?n:t.Loader.$mars(window.parent.document).find("body"),o=function(n){u.onMouseMove(n,f)};f.off("mousemove").on("mousemove",o);if(e=function(n){u.keyHandler(n,f)},t.Loader.appContext.ClientType!=i.Util.Constants.WebClientType){s=i.$mars(document);s.off("keyup").on("keyup",e);this.roots.push({target:s,handler:o,keyHandler:e})}else f.off("keyup").on("keyup",e);this.roots.push({target:f,handler:o,keyHandler:e});n.find("iframe").each(function(){var n,t,f;if(this.name!="authFrame"){n=i.$mars(this);t=u.getIFrameUniqueIdentifier(n);u.currentIFrames.indexOf(t)<0&&u.currentIFrames.push(t);try{f=n.contents().find("body");u.attachMouseUpEvent(f,r instanceof Array?r.concat(n):r)}catch(e){}}})},r.prototype.getIFrameUniqueIdentifier=function(n){for(var u,t,r=["id","name"],i=0;i<r.length;i++)if(u=r[i],t=n.attr(u),t&&t!="")return t;return""},r.prototype.checkIfBorderExists=function(n){var i=t.Loader.$mars(n);return i.css("border")==="2px solid rgb(0, 0, 255)"||i.css("border")==="3px solid #358717"?!1:i.outerWidth()-i.innerWidth()>0||i.outerHeight()-i.innerHeight()>0?!0:!1},r.prototype.onElementMouseEnter=function(i){var r=this;this.currentMoveState={target:i,hasBorder:this.checkIfBorderExists(i),prevBorder:t.Loader.$mars(i).css("border"),timeoutId:null,scrollx:0,focusableEls:[]};this.isAccesibleDnd?t.Loader.$mars(i).css("border","3px solid #358717"):this.isRegisteredControl(i)||t.Loader.$mars(i).css("border","2px solid #3b79b7");this.currentMoveState.timeoutId||this.isAccesibleDnd||this.disableEscKey||(this.currentMoveState.timeoutId=window.setTimeout(function(){var f,u;try{f=n.Client.Loader.appContext.isMobileClient();r.isRegisteredControl(i)?f?n.Client.Loader.appContext.isISHPage()?t.Loader.$mars(i).prop("tagName")!="BUTTON"?(r.attachedMousupForQuickform=!1,r.simulateElementClick(i)):(r.attachedMousupForQuickform=!1,r.simulateReactClick(i)):(r.attachedMousupForQuickform=!1,r.simulateReactClick(i)):(r.attachedMousupForQuickform=!1,r.simulateElementClick(i)):f?n.Client.Loader.appContext.isISHPage()?(u=n.Client.Loader.appContext.util.getNearestFocusableElement(i),u&&u!=null&&t.Loader.$mars(u).prop("tagName")!="BUTTON"?(r.attachedMousupForQuickform=!1,r.simulateElementClick(u)):(r.attachedMousupForQuickform=!1,r.simulateReactClick(i))):(r.attachedMousupForQuickform=!1,r.simulateReactClick(i)):(u=n.Client.Loader.appContext.util.getNearestFocusableElement(i),u&&u!=null&&(r.attachedMousupForQuickform=!1,r.simulateElementClick(u)))}catch(e){}r.currentMoveState.timeoutId=null},2e3))},r.prototype.onElementMouseLeave=function(){var n=this.currentMoveState;n&&(n.timeoutId&&(window.clearTimeout(n.timeoutId),n.timeoutId=null),(!this.isRegisteredControl(n.target)||this.isAccesibleDnd)&&(n.hasBorder?t.Loader.$mars(n.target).css("border",n.prevBorder):t.Loader.$mars(n.target).css("border","")))},r.prototype.onMouseMove=function(n,r){var f,o,e,u,s,h,c;if((this.currentMoveState==null||this.currentMoveState.target!=n.target)&&!i.$mars(n.target).hasClass("lpath-sidebar-floweditor")&&(f=n.target,this.onElementMouseLeave(),this.isDomDndDisabled&&(f=this.getRegisteredControl(f)),f))this.onElementMouseEnter(f);o=5;e=window._MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex();e=e+100;u=null;s="";this.mouseLeaveHandler==undefined||i.$mars(n.target).hasClass("lpath-sidebar-floweditor")||(this.mouseLeaveHandler(),this.mouseLeaveHandler=undefined);s=r.data(this.trackingKey);s?u=r.find(this.dragHandleSelector):(this.lastActiveRoot!=null&&(this.lastActiveRoot.data(this.trackingKey,!1),u=this.lastActiveRoot.find(this.dragHandleSelector),u&&u.remove()),this.lastActiveRoot=r,r.data(this.trackingKey,!0),u=i.$mars('<div id="'+this.dragHandleId+'" style="position: absolute;background-image: url('+t.Loader.serverUrl+'images/cursor_icon.png);background-repeat: no-repeat;height:48px;width:50px;"><\/div>'),u.css("z-index",e),r.append(u));h=0;c=0;h=r.height()<=n.pageY+60?n.pageY-70:n.pageY;c=r.width()<=n.pageX+60?n.pageX-70:n.pageX;i.$mars(n.target).scrollParent().prop("clientHeight")<i.$mars(n.target).scrollParent().prop("scrollHeight")&&(i.$mars(n.target).scrollParent().scrollTop()!=0&&this.currentMoveState.scrollx<u.offset().top?(i.$mars(n.target).scrollParent().animate({scrollTop:i.$mars(n.target).scrollParent().scrollTop()-50}),this.currentMoveState.scrollx=u.offset().top):i.$mars(n.target).scrollParent().prop("clientHeight")-50<=u.offset().top&&(i.$mars(n.target).scrollParent().animate({scrollTop:i.$mars(n.target).scrollParent().scrollTop()+50}),this.currentMoveState.scrollx=u.offset().top));u.css({left:c+o,top:h+o})},r.prototype.attachMouseUpEventForRegisteredControl=function(){this.controlAddRemoveEventHandler();this.isDomDndDisabled&&this.attachMouseMoveEvent(this.getBody())},r.prototype.attachMouseMoveEvent=function(n){var t=this,u=function(i){t.onMouseMove(i,n)},r;n.off("mousemove").on("mousemove",u);r=function(i){t.keyHandler(i,n);i.stopPropagation()};n.off("keyup").on("keyup",r);this.roots.push({target:n,handler:u,keyHandler:r});n.find("iframe").each(function(){var n,r,u;if(this.name!="authFrame"){n=i.$mars(this);r=t.getIFrameUniqueIdentifier(n);t.currentIFrames.indexOf(r)<0&&t.currentIFrames.push(r);try{u=n.contents().find("body");t.attachMouseMoveEvent(u)}catch(f){}}})},r.prototype.keyHandler=function(t){if(t.which==27)this.disableEscKey||(this.close(),n.Client.Loader.appContext.handleCustomizationContainerInMoca(!0),this.promise.fail());else if(t.which==37||t.which==38)this.isAccesibleDnd&&this.currentRegisteredControlIndex>0&&(this.unwireRegisteredControl(this.accessibleRegisteredControls[this.currentRegisteredControlIndex]),this.currentRegisteredControlIndex--,this.wireRegisteredControl(this.accessibleRegisteredControls[this.currentRegisteredControlIndex]));else if(t.which==39||t.which==40)this.mouseLeaveHandler!=undefined&&(this.mouseLeaveHandler(),this.mouseLeaveHandler=undefined),this.isAccesibleDnd&&this.currentRegisteredControlIndex<this.accessibleRegisteredControls.length-1&&(this.unwireRegisteredControl(this.accessibleRegisteredControls[this.currentRegisteredControlIndex]),this.currentRegisteredControlIndex++,this.wireRegisteredControl(this.accessibleRegisteredControls[this.currentRegisteredControlIndex]));else if(t.which==13){var i=this.accessibleRegisteredControls[this.currentRegisteredControlIndex];this.onControlMouseUp(this.getRegisteredElement(i),i.getProperties())}t.stopPropagation()},r.prototype.getRegisteredElement=function(t){var r=n.Client.Loader.appContext.isMobileClient(),i=t.getCtrlObj();return i&&i!=null?r?this.getDOMElement(window.parent,i):i[0]:null},r.prototype.initializeAccessibleDnd=function(){this.initializeAccessibleEvents();this.initializeRegisteredControls()},r.prototype.initializeAccessibleEvents=function(){var l=this,e=this.getBody(),a=n.Client.Loader.appContext.isMobileClient(),o=a?i.$mars(document):e,s=function(n){l.keyHandler(n,o)},h,u,f,r,c;o.on("keyup",s);this.roots.push({target:o,keyHandler:s});h=window._MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex()+100;u=i.$mars('<div id="'+this.dragHandleId+'" style="position: absolute;background-image: url('+t.Loader.serverUrl+'images/cursor_icon.png);background-repeat: no-repeat;height:48px;width:50px;"><\/div>');u.css("z-index",h);f=i.$mars(document.activeElement).offset();this.stepModel&&this.stepModel.MetadataJson.ElementIdentifier&&(r=n.Client.Loader.appContext.getElement(this.stepModel.MetadataJson.ElementIdentifier),r&&r!=null&&(c=n.Client.Loader.appContext.Util.getBrowserInfo(),c.name==="IE"&&i.$mars(r.element).focus(),f=i.$mars(r.element).offset()));u.css({left:f.left,top:f.top});e.append(u);this.roots.push({target:e,keyHandler:s})},r.prototype.initializeRegisteredControls=function(){var n=this;this.accessibleRegisteredControls=this.accessibleRegisteredControls.concat(t.Loader.appContext.getActiveRegisteredControl());this.accessibleRegisteredControls=this.accessibleRegisteredControls.concat(t.Loader.appContext.getAllChildRegisteredControl());this.accessibleRegisteredControls=this.accessibleRegisteredControls.filter(function(t){var i=n.getRegisteredElement(t);return i!=null&&i.clientWidth>0&&i.clientHeight>0});this.accessibleRegisteredControls=_(this.accessibleRegisteredControls).chain().sortBy(function(t){var r=n.getRegisteredElement(t),u;return r&&r!=null?(u=i.$mars(r).offset(),u.left):-1}).sortBy(function(t){var r=n.getRegisteredElement(t),u;return r&&r!=null?(u=i.$mars(r).offset(),u.top):-1}).value()},r.prototype.wireRegisteredControl=function(n){var u=this.getRegisteredElement(n),r,f;if(u&&u!=null){this.onElementMouseEnter(u);r=i.$mars(u);f=t.Loader.$mars(this.dragHandleSelector);f.css({left:r.offset().left,top:r.offset().top});r.scrollParent().scrollTop(r.offset().top)}},r.prototype.unwireRegisteredControl=function(){this.onElementMouseLeave()},r.prototype.isRegisteredControl=function(n){return i.$mars(n).attr("MarsFlag")=="true"},r.prototype.getRegisteredControl=function(n){var t=null,r,u;return i.$mars(n).attr("MarsFlag")=="true"?t=n:t==null?(r=i.$mars(n).parents("[MarsFlag=true]"),r.length>0&&(t=r[0])):(u=i.$mars(n).has("[MarsFlag=true]"),u.length>0&&(t=u[0])),t},r.prototype.getBody=function(){var t=n.Client.Loader.appContext.isMobileClient();return t?i.$mars(window.parent.document).find("body"):i.$mars("body")},r.prototype.getDOMElement=function(n,t){try{return n.ReactDOM.findDOMNode(t)}catch(i){return null}},r.prototype.simulateElementClick=function(t){var i=this;t.click();n.Client.Loader.appContext.checkForPageIdle(function(){return i.pageLoadHandler()});this.currentMoveState.focusableEls.push(t)},r.prototype.simulateReactClick=function(t){var r=this,i=window.parent.React;i!=null&&i!==undefined&&(i.addons.TestUtils.Simulate.shortPress(t),n.Client.Loader.appContext.checkForPageLoad(function(){return r.pageLoadHandler()}),this.currentMoveState.focusableEls.push(t))},r}();r.StepTargetSelector=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t,i){i===void 0&&(i={});u.call(this,n,i);this.rootElement=n;this.supportedLanguages=t;this.params=i;this.bindAdvanceSetupView()}return __extends(f,u),f.prototype.bindAdvanceSetupView=function(){u.prototype.build.call(this);this.bindPublishGroupDropDown();this.initializeControls();this.attachAdvancedOptionsEvents();this.setdefaultCompareModelValue()},f.prototype.setdefaultCompareModelValue=function(){this.defaultCompareModelAdvValue=JSON.parse(JSON.stringify(this.getSelectedValues()))},f.prototype.getTemplate=function(){return i.Util.Constants.sidebarAdvancedOptionsViewTemplate},f.prototype.getPublishInfoTemplate=function(){return i.Util.Constants.sidebarAdvancedOptionsViewPublishingInfoTemplate},f.prototype.getSupportedLanguagesTemplate=function(){return i.Util.Constants.sidebarAdvancedOptionsViewSupportedLanguagesTemplate},f.prototype.initializeControls=function(){var e=this,r,u,o,c,s,f,h;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Initializing the values of Adavnced Options View : START");try{if(r=e.getCurrentControlValue(),r){for(r.ControlType===i.Utility.ControlTypes.Sidebar&&(r.MetadataJson.IsSideBarHeaderDisabled!=undefined&&e.rootElement.find('input[id="lPathIsSideBarHeaderDisabled"]').prop("checked",r.MetadataJson.IsSideBarHeaderDisabled),r.MetadataJson.IsSideBarTitleDisabled!=undefined&&e.rootElement.find('input[id="lPathIsSideBarTitleDisabled"]').prop("checked",r.MetadataJson.IsSideBarTitleDisabled),r.MetadataJson.IsSideBarFooterDisabled!=undefined&&e.rootElement.find('input[id="lPathIsSideBarFooterDisabled"]').prop("checked",r.MetadataJson.IsSideBarFooterDisabled)),this.getSupportedLanguagesData(),o=e.getCurrentControlValue(),u=new i.Content.ContextGroupElementModel,o=o.Contexts[0].ContextGroup.ContextGroupElements,f=0;f<o.length;f++)if(o[f].ContextTypeMetaDataId==i.Utility.ContextTypeMetaData.AppModule){u=o[f];break}if(this.shouldDefaultToCurrentApp()||u&&u.ContextValues&&u.ContextValues.length>0)if(c=this.rootElement.find('input[id= "lPathEnableSelected"]'),c.prop("checked",!0),this.setEnabledCheckboxes(),s=e.rootElement.find('td[class="lpath-setup-app-module-include"] input[type="checkbox"]'),(!u.ContextValues||u.ContextValues.length==0)&&s.length>0)s.each(function(i,r){t.Loader.$mars(r).data("id").AppUniqueName==n.Client.Loader.appContext.getCurrentAppModule()&&t.Loader.$mars(r).prop("checked",!0)});else if(u.ContextValues)for(f=0;f<u.ContextValues.length;f++)t.Loader.$mars.each(s,function(n){var i=t.Loader.$mars(s[n]).data("id"),r=JSON.parse(u.ContextValues[f].Value);(r.AppUniqueName==i.AppUniqueName||r.IsDefault&&i.IsDefault)&&t.Loader.$mars(s[n]).prop("checked",!0)});this.rootElement.find('input[id="lPathAdvPublishInfoAppVersion"]').val(n.Client.Loader.appContext.getAppVersion());h=n.Client.Loader.appContext.Util.getConfigurationData("AuthoringGroup");h&&this.rootElement.find('input[id="lPathAdvPublishInfoAuthoringGroup"]').val(h.Name);this.getPublishInfoGroupsData();this.advanceViewDivSelector=this.rootElement.find("#lPathAdvancedOptionLabel");this.publishInfoDivSelector=this.rootElement.find("#lPathPublishInfoLabel");this.dynamicPropertyDivSelector=this.rootElement.find("#lPathDynamicPropLabel");this.appModuleListDivSelector=this.rootElement.find("#lPathAppModuleLabel");this.enableAdvancedView();this.rootElement.find("#lPathIsSideBarHeaderDisabled").focus();t.Loader.$mars("#lPathControlSetupView").attr("aria-hidden",!0);t.Loader.$mars("#lPathSkinnyToolbarBlock").attr("aria-hidden",!0)}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Initializing the values of Adavnced Options View : END")}catch(l){t.Loader.marsExceptionHandler.execute(l.name,l.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView :Error in Initializing the values of Adavnced Options View")}return r},f.prototype.bindPublishGroupDropDown=function(){var n=this.rootElement.find('select[id="lPathPublishGroups"] option[data-publishgrouptype="'+i.Utility.PublishGroupType.Draft+'"]');n&&this.rootElement.find('select[id="lPathPublishGroups"] option[data-publishgrouptype="'+i.Utility.PublishGroupType.Draft+'"]').remove();this.rootElement.find('select[id="lPathPublishGroups"] option:first').prop("selected",!0)},f.prototype.attachAdvancedOptionsEvents=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Attaching events to Adavnced Options View : START");try{var r=this;this.subscribe('button[id="lPathSetupAdvancedOptionsOkButton"]',"click",this.callAdvancedOptionsDataForSave);this.subscribe('button[id="lPathSetupAdvancedOptionsCancelButton"]',"click",this.onAdvancedOptionsCancelClick);this.subscribe('button[id="lPathSetupAdvancedOptionsCancelButton"]',"keydown",this.onCancelKeyDown);this.subscribe(this.advanceViewDivSelector,"click",this.enableAdvancedView);this.subscribe(this.publishInfoDivSelector,"click",this.enablePublishInfoView);this.subscribe(this.dynamicPropertyDivSelector,"click",this.enableDynamicPropView);this.subscribe(this.appModuleListDivSelector,"click",this.enableAppModuleListView);this.subscribe('input[id= "lPathEnableAll"]',"change",this.setEnabledCheckboxes);this.subscribe('input[id= "lPathEnableSelected"]',"change",this.setEnabledCheckboxes);this.subscribe('select[id="lPathPublishGroups"]',"change",this.bindPublishInfoGroupsData);this.subscribe("#lPathAdvancedOptionLabel","keydown",this.setTabbingOnTabPanel);this.subscribe("#lPathPublishInfoLabel","keydown",this.setTabbingOnTabPanel);this.subscribe("#lPathDynamicPropLabel","keydown",this.setTabbingOnTabPanel);this.subscribe("#lPathAppModuleLabel","keydown",this.setTabbingOnTabPanel);i.App.lPathDesignerContainer.find(".lpath-advanceoptions-apptab-grid-checkbox").on("keydown",function(n){return r.handleUpDownArrowNavigationOnAppsTab(n,r)});i.App.lPathDesignerContainer.find('div[id="lPathControlAdvancedOptionsView"]').off("keydown").on("keydown",function(n){r.handleEscapeKeyDown(n,r)});this.lPathControlAdvancedOptions=i.App.lPathDesignerContainer.find('div[id="lPathControlAdvancedOptionsView"]');i.App.lPathDesignerContainer.find(".lpath-advanceoptions-apptab-grid-checkbox").off("change").on("change",function(n){r.onChangeOfAppTabCheckbox(n)});this.lPathControlAdvancedOptions.find(".lpath-setup-advanceoptions-header div").on("keydown",function(r){var u=n.Client.Loader.$mars(r.target).next().next(),f=n.Client.Loader.$mars(r.target).prev().prev();(r.keyCode==i.Utility.KeyCodeEnum.RightArrowKey||r.keyCode===t.Utility.KeyCodeEnum.DownArrowKey)&&(u&&u.length!=0?u.focus():i.App.lPathDesignerContainer.find(r.target).parent().children(".lpath-setup-advanceoptions-header div").first().focus());(r.keyCode==i.Utility.KeyCodeEnum.LeftArrowKey||r.keyCode===t.Utility.KeyCodeEnum.UpArrowKey)&&(f&&f.length!=0?f.focus():i.App.lPathDesignerContainer.find(r.target).parent().children(".lpath-setup-advanceoptions-header div").last().focus())});this.lPathControlAdvancedOptions.find("#lPathIsSideBarHeaderDisabled").on("keydown",function(n){r.setFocusToCurrentActiveTab(n,r)});this.lPathControlAdvancedOptions.find("#lPathPublishGroups","keydown").on("keydown",function(n){r.setFocusToCurrentActiveTab(n,r)});this.lPathControlAdvancedOptions.find("input[name = AppModuleSelector]:checked","keydown").on("keydown",function(n){r.setFocusToCurrentActiveTab(n,r)});this.rootElement.find(".lpath-setup-advance-grid-wildcard-checkbox").off("change").on("change",function(n){r.onChangeOfCheckboxProperty(n)});t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Attaching events to Adavnced Options View : END")}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView :Error in Attaching events to Adavnced Options View")}},f.prototype.setEnabledCheckboxes=function(){var t=this.rootElement.find('input[id= "lPathEnableSelected"]'),n=this.rootElement.find('input[id^= "lPathAppModules"]');t.prop("checked")?(n.prop("disabled",!1),this.rootElement.find("#appsTabGrid").removeClass("lpath-advanceoptions-apptab-disabledgrid"),this.rootElement.find("#lPathAppModuleListGrid").removeClass("lpath-advanceoptions-apptab-disablegrid-cursor")):(n.prop("disabled",!0),this.rootElement.find("#appsTabGrid").addClass("lpath-advanceoptions-apptab-disabledgrid"),this.rootElement.find("#lPathAppModuleListGrid").addClass("lpath-advanceoptions-apptab-disablegrid-cursor"))},f.prototype.setFocusToCurrentActiveTab=function(n){n.keyCode==i.Utility.KeyCodeEnum.TabKey&&n.shiftKey&&(i.App.lPathDesignerContainer.find(".lpath-header-caption-active").focus(),n.stopPropagation(),n.preventDefault())},f.prototype.setTabIndexPublish=function(t){return t.keyCode==i.Utility.KeyCodeEnum.TabKey?(t.shiftKey||this.publishInfoDivSelector&&this.publishInfoDivSelector.hasClass("lpath-header-caption-active")&&this.rootElement.find("#lPathPublishGroups")&&this.rootElement.find("#lPathPublishGroups").focus(),t.shiftKey&&this.publishInfoDivSelector&&this.publishInfoDivSelector.hasClass("lpath-header-caption-active")&&this.rootElement.find(":tabbable")&&this.rootElement.find(":tabbable").last().focus()):n.Client.Loader.appContext.Util.isEnterPressed(t,!1)&&this.enablePublishInfoView(),!1},f.prototype.getSupportedLanguages=function(n){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SidebarSetupView : Call to getSupportedLanguages to get data from api call ");try{return i.App.serviceHandler.getSupportedLanguagesForControl(n)}catch(r){t.Loader.marsExceptionHandler.execute(r.name,r.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSetupView :Error in getSupportedLanguages to get data from api call")}},f.prototype.getSupportedLanguagesData=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SidebarAdvancedOptionsView : Call to service api to get supported languages data  : START");try{var n=this,u=n.getCurrentControlValue(),f=this.getSupportedLanguages(u.ControlVersionId);f.done(function(t){var e=t.Result,f;u.MetadataJson.SupportedLanguagesForControl=e;f=n.rootElement.find('div[id="lPathSupportedLanguagesTable"]');f.html("");f.html(r.TemplateEngine.applyTemplate(n.getSupportedLanguagesTemplate(),u));n.subscribe('button[id="lPathLanguageGridFotterExportbutton"]',"click",n.onExportLanguages);n.subscribe('button[id="lPathLanguageGridFotterImportbutton"]',"click",n.importLanguagesForControl);i.App.lPathDesignerContainer.find("#lpathSetupAdvancedOptionsSupportedLanguagesTable").find("input").on("keydown",function(t){return n.handleUpDownArrowNavigationOnLanguagesGrid(t,n)});i.App.lPathDesignerContainer.find("#lPathWildcardOptionsGrid").find("input").on("keydown",function(t){return n.handleUpDownArrowNavigationOnWildcardGrid(t,n)})});f.fail(function(n){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON)});t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SidebarAdvancedOptionsView : Call to service api to get supported languages data  : END")}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView :Error in call to service api to get supported languages data")}},f.prototype.getPublishInfoGroupsData=function(){var n,u,i;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SidebarAdvancedOptionsView : Call to service api to get published info data  : START");try{n=this;n.publishGroupIds=[];n.rootElement.find('select[id="lPathPublishGroups"] option').each(function(){n.publishGroupIds.push(this.value)});u=n.getCurrentControlValue();i=n.getPublishedGroupsData(u.ControlId,n.publishGroupIds);i.done(function(t){var e,f,i,o,u,h,s,c;if(n.PublishInfoData=t.Result.PublishInfoDetails,n.PublishInfoData){for(e=0,f=0;f<n.publishGroupIds.length;f++)if(n.PublishInfoData[n.publishGroupIds[f]]!=undefined){e=f;break}for(i=0;i<n.publishGroupIds.length;i++)if(n.PublishInfoData[n.publishGroupIds[i]]!=undefined)for(o=n.PublishInfoData[n.publishGroupIds[i]],u=0;u<o.length;u++)o[u].LastPublishedTime!=undefined&&(n.PublishInfoData[n.publishGroupIds[i]][u].LastPublishedTime=n.changeDatasettingforDatetime(o[u].LastPublishedTime));n.rootElement.find("#lPathIsSideBarHeaderDisabled").focus();h=n.PublishInfoData[n.publishGroupIds[e]];s=n.rootElement.find('select[id="lPathPublishGroups"] option[value="'+n.publishGroupIds[e]+'"]');s&&s.prop("selected",!0);c=n.rootElement.find('div[id="lPathPublishInfoGroupsTable"]');c.html(r.TemplateEngine.applyTemplate(n.getPublishInfoTemplate(),h))}});i.fail(function(n){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON)});t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SidebarAdvancedOptionsView : Call to service api to get published info data  : END")}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView :Error in call to service api to get published info data")}},f.prototype.getPublishedGroupsData=function(n,r){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SidebarAdvancedOptionsView : Call to getPublishGroupInfoData to get data from api call ");try{return i.App.serviceHandler.getPublishGroupInfoData(n,r)}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView :Error in getPublishGroupInfoData to get data from api call")}},f.prototype.bindPublishInfoGroupsData=function(){var t=this.rootElement.find('select[id="lPathPublishGroups"]').val(),n=this.rootElement.find('div[id="lPathPublishInfoGroupsTable"]'),i;n.html("");this.PublishInfoData[t]==undefined?n.append(r.TemplateEngine.applyTemplate(this.getPublishInfoTemplate(),{})):(i=this.PublishInfoData[t],n.append(r.TemplateEngine.applyTemplate(this.getPublishInfoTemplate(),i)))},f.prototype.handleEscapeKeyDown=function(n,t){if(n.keyCode==i.Utility.KeyCodeEnum.EscapeKey){t.onAdvancedOptionsCancelClick(n,this,!0);n.stopPropagation()}},f.prototype.changeDatasettingforDatetime=function(n){var t=n,r,u;return t&&(r=t.toString(),r.indexOf("Z")<0&&r.indexOf("UTC")<0&&r.indexOf("GMT")<0?(u=Date.parse(t+"Z"),t=i.Util.Common.convertUtcToLocal(new Date(u))):t=i.Util.Common.convertUtcToLocal(new Date(t)),t=t.replace("  UTC",""),t=t.substring(0,t.indexOf(","))),t},f.prototype.enableAdvancedView=function(){this.advancedOptionsTabsHandling(this.advanceViewDivSelector)},f.prototype.enablePublishInfoView=function(){this.advancedOptionsTabsHandling(this.publishInfoDivSelector)},f.prototype.enableDynamicPropView=function(){this.renderDynamicPropertyTab();this.advancedOptionsTabsHandling(this.dynamicPropertyDivSelector)},f.prototype.enableAppModuleListView=function(){this.advancedOptionsTabsHandling(this.appModuleListDivSelector)},f.prototype.advancedOptionsTabsHandling=function(t){var r=this.rootElement.find("#lPathAdvancedOptionDiv"),u=this.rootElement.find("#lPathPublishInfoDiv"),f=this.rootElement.find("#lpathDynamicPropDiv"),e=this.rootElement.find("#lPathAppModuleListDiv");this.rootElement.find("#lPathAdvancedSetupView").attr("aria-labelledby",t[0].getAttribute("id"));this.rootElement.find("#lPathAdvancedSetupView").off("click keydown").on("click keydown",function(t){t.keyCode!=n.Client.Utility.KeyCodeEnum.EscapeKey&&t.stopPropagation()});i.App.lPathDesignerContainer.find(".lpath-header-caption-active").removeClass("lpath-header-caption-active");t.hasClass("lpath-header-caption-active")||t.addClass("lpath-header-caption-active");switch(t){case this.advanceViewDivSelector:r.css("display","block");u.css("display","none");f.css("display","none");e.css("display","none");r.attr("aria-hidden","false");u.attr("aria-hidden","true");f.attr("aria-hidden","true");e.attr("aria-hidden","true");this.rootElement.find("#lPathAdvancedOptionLabel").attr("aria-selected","true");this.rootElement.find("#lPathPublishInfoLabel").attr("aria-selected","false");this.rootElement.find("#lPathDynamicPropLabel").attr("aria-selected","false");this.rootElement.find("#lPathAppModuleLabel").attr("aria-selected","false");this.rootElement.find("#lPathIsSideBarHeaderDisabled").focus();this.addAriaDescribedbyAttributes(this.advanceViewDivSelector);break;case this.publishInfoDivSelector:r.css("display","none");u.css("display","inline-block");f.css("display","none");e.css("display","none");r.attr("aria-hidden","true");u.attr("aria-hidden","false");f.attr("aria-hidden","true");e.attr("aria-hidden","true");this.rootElement.find("#lPathAdvancedOptionLabel").attr("aria-selected","false");this.rootElement.find("#lPathPublishInfoLabel").attr("aria-selected","true");this.rootElement.find("#lPathDynamicPropLabel").attr("aria-selected","false");this.rootElement.find("#lPathAppModuleLabel").attr("aria-selected","false");this.rootElement.find("#lPathPublishGroups").focus();this.addAriaDescribedbyAttributes(this.publishInfoDivSelector);break;case this.dynamicPropertyDivSelector:r.css("display","none");u.css("display","none");f.css("display","inline-block");e.css("display","none");r.attr("aria-hidden","true");u.attr("aria-hidden","true");f.attr("aria-hidden","false");e.attr("aria-hidden","true");this.rootElement.find("#lPathAdvancedOptionLabel").attr("aria-selected","false");this.rootElement.find("#lPathPublishInfoLabel").attr("aria-selected","false");this.rootElement.find("#lPathDynamicPropLabel").attr("aria-selected","true");this.rootElement.find("#lPathAppModuleLabel").attr("aria-selected","false");this.rootElement.find("#lPathAddMore").focus();this.addAriaDescribedbyAttributes(this.dynamicPropertyDivSelector);break;case this.appModuleListDivSelector:r.css("display","none");u.css("display","none");f.css("display","none");e.css("display","inline-block");r.attr("aria-hidden","true");u.attr("aria-hidden","true");f.attr("aria-hidden","true");e.attr("aria-hidden","false");this.rootElement.find("#lPathAdvancedOptionLabel").attr("aria-selected","false");this.rootElement.find("#lPathPublishInfoLabel").attr("aria-selected","false");this.rootElement.find("#lPathDynamicPropLabel").attr("aria-selected","false");this.rootElement.find("#lPathAppModuleLabel").attr("aria-selected","true");this.rootElement.find("input[name=AppModuleSelector]:checked").focus();this.addAriaDescribedbyAttributes(this.appModuleListDivSelector)}},f.prototype.addAriaDescribedbyAttributes=function(n){var f=this.rootElement.find("#saveAdvancedOptionButton"),e=this.rootElement.find("#cancelAdvancedOptionButton"),t,r,u;n.attr("id")==="lPathAdvancedOptionLabel"?(t=i.Locale.saveAdvancedOptionTab,r=i.Locale.cancelAdvancedOptionTab):n.attr("id")==="lPathPublishInfoLabel"?(t=i.Locale.savePublishingTab,r=i.Locale.cancelPublishingTab):n.attr("id")==="lPathAppModuleLabel"&&(t=i.Locale.saveAppsTab,r=i.Locale.cancelAppsTab);u=this.getCurrentControlValue();t=u.ControlType==i.Utility.ControlTypes.Sidebar?t+" "+i.Locale.goToSidebarSettingsString:t+" "+i.Locale.goToGuidedTaskSettingsString;r=u.ControlType==i.Utility.ControlTypes.Sidebar?r+" "+i.Locale.goToSidebarSettingsString:r+" "+i.Locale.goToGuidedTaskSettingsString;f.text("");e.text("");f.text(t);e.text(r)},f.prototype.onExportLanguages=function(n,r){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView : call to onExportLanguages to get exported data files : START");try{var o=this,u=[],s=this.getCurrentControlValue(),f=this.getSupportedLanguagesLcids();if(f.length<=0)return i.Util.Common.showAlertMessage(i.Locale.languageBlankPopupTitle,i.Locale.languageBlankMessage,o.rootElement,!1,i.Locale.okCaption,null,null,null,null,r),!1;u.push(s.ControlId);i.App.serviceHandler.getExportedControlMetadataForSelectedLanguages(u,f)}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView : call to onExportLanguages to get exported data files : END")}},f.prototype.getSupportedLanguagesLcids=function(){var i=this,n=[],r=this.rootElement.find('td[class="lpath-setup-advance-grid-language"] input[type="checkbox"]:checked');return t.Loader.$mars.each(r,function(r){n.push(t.Loader.$mars(i.rootElement.find('td[class="lpath-setup-advance-grid-language"] input[type="checkbox"]:checked')[r]).data("lcid"))}),n},f.prototype.getSelectedWildCardOptions=function(){var i=this,n=[],r=this.rootElement.find('td[class="lpath-setup-advance-grid-ignore-value"] input[type="checkbox"]:checked');return t.Loader.$mars.each(r,function(r){n.push(t.Loader.$mars(i.rootElement.find('td[class="lpath-setup-advance-grid-ignore-value"] input[type="checkbox"]:checked')[r]).data("key"))}),n},f.prototype.getSelectedAppModules=function(){var i=this,n=[],r=this.rootElement.find('td[class="lpath-setup-app-module-include"] input[type="checkbox"]:checked');return t.Loader.$mars.each(r,function(r){var u=t.Loader.$mars(i.rootElement.find('td[class="lpath-setup-app-module-include"] input[type="checkbox"]:checked')[r]).data("id");n.push(u)}),n},f.prototype.importLanguagesForControl=function(){var u=this,n,i;n=new r.ImportLanguageDialogView;n.focusElementOnPopupClose=this.rootElement.find('button[id="lPathLanguageGridFotterImportbutton"]');i=n.createTemplateDialog();i.done(function(){u.getSupportedLanguagesData()});i.fail(function(n){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON)})},f.prototype.getSelectedValues=function(){var n,r,u,e,f,o;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Get Advanced Options Values from UI ");try{n=this.getCurrentControlValue();r=n.Contexts[0].ContextGroup.ContextGroupElements;n.Tags=i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(this.rootElement.find('input[id="lPathTags"]').val()));n.ControlType===i.Utility.ControlTypes.Sidebar&&(n.MetadataJson.IsSideBarHeaderDisabled=this.rootElement.find('input[id="lPathIsSideBarHeaderDisabled"]').is(":checked"),n.MetadataJson.IsSideBarTitleDisabled=this.rootElement.find('input[id="lPathIsSideBarTitleDisabled"]').is(":checked"),n.MetadataJson.IsSideBarFooterDisabled=this.rootElement.find('input[id="lPathIsSideBarFooterDisabled"]').is(":checked"),u=i.App.appContext.getPageNavigationInfo(),e=this.getSelectedWildCardOptions(),u.wildcard=e,i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.PageNavigationInfo,JSON.stringify(u),r));f=this.getSelectedAppModules();o=this.rootElement.find('input[id= "lPathEnableSelected"]');o.prop("checked")||(f=[]);i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.AppModule,f,r)}catch(s){t.Loader.marsExceptionHandler.execute(s.name,s.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView :Error while Getting Advanced Options Values from UI")}return t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Successfully completed Get Advanced Options Values from UI "),n},f.prototype.saveControlValues=function(n){var f=this,i;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Saving the data to Store for the Adavnced Options View : START");try{i=u.prototype.save.call(this,n);i.done(function(n){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Disable Sidebar Header : "+n.MetadataJson.IsSideBarHeaderDisabled);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Disable Sidebar Title : "+n.MetadataJson.IsSideBarTitleDisabled);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Disable Sidebar Footer : "+n.MetadataJson.IsSideBarFooterDisabled);f.close()});i.fail(function(n,i,r){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON);console.log("Error while saving Advanced Options data "+r.message)});t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Saving the data to Store for the Adavnced Options View : END")}catch(r){t.Loader.marsExceptionHandler.execute(r.name,r.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView :Error when saving the data to Store for the Adavnced Options View")}},f.prototype.onCancelKeyDown=function(r){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"tabbing order after Cancel key down : START");try{if(r.keyCode==i.Utility.KeyCodeEnum.TabKey)if(r.shiftKey)r.shiftKey&&this.rootElement.find("#lPathSetupAdvancedOptionsOkButton")&&this.rootElement.find("#lPathSetupAdvancedOptionsOkButton").focus();else{var f=this.rootElement.find(".lpath-header-caption-active");f.focus()}else if(n.Client.Loader.appContext.Util.isEnterPressed(r,!0))this.onAdvancedOptionsCancelClick(r,this);else if(r.keyCode==i.Utility.KeyCodeEnum.EscapeKey)this.onAdvancedOptionsCancelClick(r,this,!0);return t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"tabbing order after Cancel key down : END"),!1}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView : Error on tabbing order after Cancel key down")}},f.prototype.renderDynamicPropertyTab=function(){var n=this,t=n.rootElement.find('div[id="lpathDynamicPropDiv"]');n.dynamicPropertyTabInstance=new r.SidebarAdvancedDynamicPropertiesView(t)},f.prototype.isCurrentModelValueUpdated=function(){var n=this.getCurrentControlValue();return(n=this.getSelectedValues(),i.Util.Common.getModelValueWithoutControlIdAndIds(n),i.Util.Common.getModelValueWithoutControlIdAndIds(this.defaultCompareModelAdvValue),JSON.stringify(this.defaultCompareModelAdvValue)===JSON.stringify(n))?!1:!0},f.prototype.close=function(){this.closeCallback&&this.closeCallback();u.prototype.close.call(this)},f.prototype.closeAdvancedOptionsDialog=function(n){this.rootElement.find("#lPathIsSideBarHeaderDisabled").focus();n.hide();this.dynamicPropertyTabInstance&&this.dynamicPropertyTabInstance.close();t.Loader.$mars("#lPathControlSetupView").attr("aria-hidden",!1);t.Loader.$mars("#lPathSkinnyToolbarBlock").attr("aria-hidden",!1);this.rootElement.parent().find('div[id="lPathAdvancedOptions"]').focus();t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Closing Advanced Options view")},f.prototype.onAdvancedOptionsCancelClick=function(n,i,r){r===void 0&&(r=!1);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarAdvancedOptionsView:onCancel START");try{this.dynamicPropertyTabInstance?this.dynamicPropertyTabInstance.cancelCallback()?this.showValidationPopup(r):this.closeAdvancedOptionsDialog(this):this.isCurrentModelValueUpdated()?this.showValidationPopup(r):this.closeAdvancedOptionsDialog(this);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarAdvancedOptionsView:onCancel END")}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView : Error on Cancel.")}},f.prototype.showValidationPopup=function(n){var r=this;i.Util.Common.showAlertMessage(i.Locale.unSavedChangesPopupTitle,i.Locale.unSavedChangesPopupMessage,t.Loader.$mars("#lPathSetupPopupContainer"),!0,i.Locale.deleteChangesCaption,i.Locale.stayOnPageCaption,function(){r.closeAdvancedOptionsDialog(r)},function(){n?r.advanceViewDivSelector&&r.advanceViewDivSelector.hasClass("lpath-header-caption-active")?r.rootElement.find("#lPathIsSideBarHeaderDisabled").is(":visible")?r.rootElement.find("#lPathIsSideBarHeaderDisabled").focus():r.rootElement.find("#lPathIsGuidedTaskErrorCheck").is(":visible")&&r.rootElement.find("#lPathIsGuidedTaskErrorCheck").focus():r.publishInfoDivSelector.hasClass("lpath-header-caption-active")?r.rootElement.find("#lPathPublishGroups").focus():r.appModuleListDivSelector.hasClass("lpath-header-caption-active")&&r.rootElement.find("input[name=AppModuleSelector]:checked").focus():r.rootElement.find('button[id="lPathSetupAdvancedOptionsCancelButton"]').focus()})},f.prototype.handleUpDownArrowNavigationOnAppsTab=function(n,t){var i=this.rootElement.find("#lPathSetupAdvancedOptionsOkButton"),r=this.rootElement.find("#lPathEnableSelected");this.handleUpDownArrowNavigation(n,t,r,i,"lpath-advanceoptions-apptab-grid-checkbox")},f.prototype.handleUpDownArrowNavigationOnLanguagesGrid=function(n,t){var i=this.rootElement.find("#lPathTags"),r=this.rootElement.find("#lPathLanguageGridFotterImportbutton");this.handleUpDownArrowNavigation(n,t,i,r,"lpath-setup-advance-grid-language-checkbox")},f.prototype.handleUpDownArrowNavigationOnWildcardGrid=function(n,t){var i=this.rootElement.find("#lPathLanguageGridFotterExportbutton"),r=this.rootElement.find("#lPathSetupAdvancedOptionsOkButton");this.handleUpDownArrowNavigation(n,t,i,r,"lpath-setup-advance-grid-wildcard-checkbox")},f.prototype.onChangeOfAppTabCheckbox=function(n){var r=t.Loader.$mars(n.currentTarget),u=r.parent().prev().prev().text(),f=i.Locale.excludeAppCheckbox+" "+u,e=i.Locale.includeAppCheckbox+" "+u;r.prop("checked")===!0?r.removeAttr("aria-label").attr("aria-label",f):r.removeAttr("aria-label").attr("aria-label",e)},f.prototype.onChangeOfCheckboxProperty=function(n){var i=t.Loader.$mars(n.currentTarget);i.prop("checked")===!0?i.removeAttr("aria-describedby").attr("aria-describedby","checkedIgnoreValue"):i.removeAttr("aria-describedby").attr("aria-describedby","uncheckedIgnoreValue")},f.prototype.handleUpDownArrowNavigation=function(n,t,r,u,f){var o=t.rootElement.find(n.currentTarget),e;n.keyCode==i.Utility.KeyCodeEnum.TabKey&&(n.shiftKey?n.shiftKey&&r.focus():u.focus(),n.stopPropagation(),n.preventDefault());n.keyCode==i.Utility.KeyCodeEnum.DownArrowKey&&(e=o.closest("tr").next(),e.find("."+f).focus(),n.preventDefault());n.keyCode==i.Utility.KeyCodeEnum.UpArrowKey&&(e=o.closest("tr").prev(),e.find("."+f).focus(),n.preventDefault());this.rootElement.find("."+f).attr("tabindex","-1");o.attr("tabindex","0")},f.prototype.callAdvancedOptionsDataForSave=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarAdvancedOptionsView:onSave START");try{var n=this.getSelectedValues();n&&this.saveControlValues(n);this.close();t.Loader.$mars("#lPathControlSetupView").attr("aria-hidden",!1);t.Loader.$mars("#lPathSkinnyToolbarBlock").attr("aria-hidden",!1);i.App.lPathDesignerContainer.find('div[id="lPathAdvancedOptions"]').focus();t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarAdvancedOptionsView:onSave END")}catch(r){t.Loader.marsExceptionHandler.execute(r.name,r.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarAdvancedOptionsView : Error onSave call click.")}},f.prototype.shouldDefaultToCurrentApp=function(){return n.Client.Loader.appContext.shouldDefaultContentToCurrentApp()&&n.Client.Loader.appContext.getCurrentAppModule()!=""},f.prototype.setTabbingOnTabPanel=function(t,r){if(t.keyCode==i.Utility.KeyCodeEnum.TabKey)t.shiftKey||(this.advanceViewDivSelector&&this.advanceViewDivSelector.hasClass("lpath-header-caption-active")?this.rootElement.find("#lPathIsSideBarHeaderDisabled").is(":visible")?this.rootElement.find("#lPathIsSideBarHeaderDisabled").focus():this.rootElement.find("#lPathIsGuidedTaskErrorCheck").is(":visible")&&this.rootElement.find("#lPathIsGuidedTaskErrorCheck").focus():this.publishInfoDivSelector&&this.publishInfoDivSelector.hasClass("lpath-header-caption-active")?this.rootElement.find("#lPathPublishGroups")&&this.rootElement.find("#lPathPublishGroups").focus():this.dynamicPropertyDivSelector&&this.dynamicPropertyDivSelector.hasClass("lpath-header-caption-active")?this.rootElement.find("#lPathAddMore")&&this.rootElement.find("#lPathAddMore").focus():this.appModuleListDivSelector&&this.appModuleListDivSelector.hasClass("lpath-header-caption-active")&&this.rootElement.find("input[name=AppModuleSelector]:checked").focus()),t.shiftKey&&this.rootElement.find(":tabbable")&&this.rootElement.find(":tabbable").last().focus();else if(n.Client.Loader.appContext.Util.isEnterPressed(t,!1))switch(r.getAttribute("id")){case"lPathAdvancedOptionLabel":this.enableAdvancedView();break;case"lPathPublishInfoLabel":this.enablePublishInfoView();break;case"lPathDynamicPropLabel":this.enableDynamicPropView();break;case"lPathAppModuleLabel":this.enableAppModuleListView()}else if(t.keyCode==i.Utility.KeyCodeEnum.EscapeKey)this.onAdvancedOptionsCancelClick(t,this,!0);return!1},f}(r.ControlView);r.SidebarAdvancedOptionsView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(t){function i(n,i,r){r===void 0&&(r={});t.call(this,n,r);this.rootElement=n;this.supportedLanguages=i;this.params=r}return __extends(i,t),i.prototype.bindAdvanceSetupView=function(){t.prototype.bindAdvanceSetupView.call(this);this.bindGuidedTaskAdvanceSetupView();this.bindValues()},i.prototype.bindGuidedTaskAdvanceSetupView=function(){var n=t.prototype.setFocusToCurrentActiveTab,i=this;this.rootElement.find("#lPathWildcardOptionsGrid").hide();this.rootElement.find(".lpath-setup-advance-left-container").hide();this.rootElement.find("#divGuidedTaskErrorCheck").show();this.rootElement.find("#lPathIsGuidedTaskErrorCheck").on("keydown",function(t){n(t,i)})},i.prototype.getSelectedValues=function(){var n=t.prototype.getSelectedValues.call(this);return n.IsErrorControl=this.rootElement.find("#lPathIsGuidedTaskErrorCheck").is(":checked"),n},i.prototype.advancedOptionsTabsHandling=function(n){t.prototype.advancedOptionsTabsHandling.call(this,n);this.rootElement.find("#lPathAdvancedOptionDiv").is(":visible")&&this.setDefaultFocusGTAdvancedOption()},i.prototype.setTabIndexPublish=function(i,r){if(i.keyCode==n.Utility.KeyCodeEnum.TabKey&&this.rootElement.find("#lPathAdvancedOptionDiv").is(":visible"))return i.shiftKey||this.setTabIndexPublishInfo(i),!1;t.prototype.setTabIndexPublish.call(this,i,r)},i.prototype.setDefaultFocusGTAdvancedOption=function(){this.rootElement.find("#lPathIsGuidedTaskErrorCheck").focus()},i.prototype.bindValues=function(){var n=this.getCurrentControlValue();this.rootElement.find("#lPathIsGuidedTaskErrorCheck").prop("checked",n.IsErrorControl)},i.prototype.setTabIndexPublishInfo=function(n){n.keyCode!=9||n.shiftKey||this.rootElement.find("#lPathIsGuidedTaskErrorCheck").is(":visible")&&this.setDefaultFocusGTAdvancedOption()},i}(t.SidebarAdvancedOptionsView);t.GuidedTaskAdvancedOptionsView=i})(t=n.Renderer||(n.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t){u.call(this,n,t);this.rootElement=n;this.params=t;this.controlSelector=null;this.BubbleUtilityConstant=window.Microsoft.Mars.Client.Runtime.Controls.BubbleUtilityConstants;this.defaultBubbleLength=15;this.hasChanges=!1;this.toggleSidebarHandler=t.toggleSidebarHandler;this.controlCreated=t.controlCreated}return __extends(f,u),f.prototype.build=function(){if(u.prototype.build.call(this),this.modelValue=this.getCurrentControlValue(),this.controlActionToolTabTemplateHolder=this.rootElement.find("div[id='lpathFlowControlActionToolTabTemplateHolder']"),this.controlActionToolTabTemplateHolder.length==0){var n=t.Loader.$mars('<div id="lpathFlowControlActionToolTabTemplateHolder"  class="lpath-control-action-tooltab-template-holder" tabindex="-1" />');n.css("z-index",i.App.lPathDesignerContainerZIndex+1);this.rootElement.append(n);this.controlActionToolTabTemplateHolder=this.rootElement.find("div[id='lpathFlowControlActionToolTabTemplateHolder']")}this.stepsContainerHolder=this.rootElement.find("div[id='lPathFlowStepContainer']");this.bubblesContainerHolder=this.rootElement.find("div[id='lPathBubbleContainer']");this.enableDomCheckBox=this.rootElement.find("input[id='lpath-gt-enable_dom']");this.renderControlActionToolTab();this.renderStepsContainer();this.renderBubbleContainer();this.initializeView()},f.prototype.getTemplate=function(){return i.Util.Constants.flowEditorSidePanelTemplate},f.prototype.initializeView=function(){var n=this,r,u;this.enableDomCheckBox&&t.Loader.appContext.getClientName()==i.Util.Constants.UCIClientType&&this.enableDomCheckBox.prop("checked",!0);r=this;u=this.rootElement.find("#lPathEditHeader");u.val(i.EncodeDecode.MarsHtmlDecode(this.modelValue.LanguageControlVersionContents[0].Title));this.attachEventsToEditMode();this.rootElement.find(".lpath-gt-flow-addnewbubleicon").keydown(function(t){return n.openingAddNewBubbleItemDropdownOnTabOrder(t)});this.rootElement.find("#lPathFlowStepContainer").keydown(function(t){return n.closingAddNewBubbleItemDropdownOnTabOrder(t)});this.rootElement.find("#lPathControlToolTabDeleteButton").keydown(function(t){return n.homeButtonTabFocus(t)});this.rootElement.find("#lPathControlToolTabSaveButton").keydown(function(t){return n.arrowKeyNavigationForSaveButton(t)});t.Loader.$mars("#lPathSkinnyToolbarHomeButton").off("keydown").on("keydown",function(n){r.handleTabbingForHomeButton(n)});this.rootElement.find("#lPathBubbleContainer").off("click").on("click",function(){r.rootElement.find(".lpath-gt-flow-addnewbubleicon").focus()});this.rootElement.find("#lpath-gt-enable_dom").off("click").on("click",function(n){n.stopPropagation()});this.rootElement.find(".lpath-tag-info-image").off("click").on("click",function(n){n.stopPropagation()});this.onWindowResize()},f.prototype.close=function(){u.prototype.close.call(this);this.controlActionToolTabInstance.close();this.controlActionToolTabTemplateHolder.remove();this.removeBubble();this.stepContainerView&&this.stepContainerView.close();n.Client.Loader.$mars(window).off("resize.lpath-gt-section-container")},f.prototype.removeBubble=function(n){this.controlSelector!=null&&(this.controlSelector.close(),this.controlSelector=null);this.stepBubbleContainer!=null&&(this.stepBubbleContainer.isCurrentModelValueUpdated()&&(this.hasChanges=!0),this.stepBubbleContainer.removeBubble(n),this.stepBubbleContainer.close(),this.stepBubbleContainer=null)},f.prototype.isCurrentModelValueUpdated=function(){return this.hasChanges||(this.hasChanges=this.stepContainerView.isCurrentModelValueUpdated(),this.stepBubbleContainer&&this.stepBubbleContainer.isCurrentModelValueUpdated()&&(this.hasChanges=!0)),this.hasChanges},f.prototype.renderControlActionToolTab=function(){var u=this;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"FlowEditorSidePanelView:renderControlActionToolTab START");try{this.controlActionToolTabInstance=new r.ControlActionToolTabView({},this.controlActionToolTabTemplateHolder,function(){},function(){u.guidedTaskSaveAction()},function(){u.guidedTaskDeleteAction()});this.controlActionToolTabInstance.positionToolTab(0);this.controlActionToolTabTemplateHolder.find("#lPathControlToolTab").css("z-index",i.App.lPathDesignerContainerZIndex+2);this.controlActionToolTabTemplateHolder.find("#lPathControlToolTabPinButton").remove();this.modelValue.ControlType==i.Utility.ControlTypes.GuidedTask&&this.rootElement.find("#lPathControlToolTabDeleteButton").attr("title",i.Locale.deleteGuidedTask)}catch(f){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Expception in rendering controlaction tooltab from FlowEditorSidePanelView:renderControlActionToolTab");t.Loader.marsExceptionHandler.execute(f.name,f.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"FlowEditorSidePanelView:renderControlActionToolTab END")},f.prototype.renderStepsContainer=function(){var i=this;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"FlowEditorSidePanelView:renderStepsContainer START");try{this.stepContainerView=new r.StepContainerView({collection:this.modelValue.Steps,el:this.stepsContainerHolder},function(n,t){return i.renderBubbleOnEdit(n,t)},function(n){return i.removeBubble(n)},function(n,t,r){return i.handleMouseDown(n,t,r)});this.stepContainerView.render()}catch(u){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Expception in rendering controlaction tooltab from FlowEditorSidePanelView:renderStepsContainer");t.Loader.marsExceptionHandler.execute(u.name,u.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"FlowEditorSidePanelView:renderStepsContainer END")},f.prototype.renderBubbleContainer=function(){var u=this,f;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"FlowEditorSidePanelView:renderStepsContainer START");try{f=[{Type:i.Utility.ControlTypes.PassiveStep,Name:i.Locale.passiveStepContent,Title:i.Locale.passiveStepHoverText},{Type:i.Utility.ControlTypes.ActiveStep,Name:i.Locale.activeStepContent,Title:i.Locale.activeStepHoverText},{Type:i.Utility.ControlTypes.HybridStep,Name:i.Locale.hybridStepContent,Title:i.Locale.hybridStepHoverText},{Type:i.Utility.ControlTypes.InfoBubble,Name:i.Locale.infoStepContent,Title:i.Locale.infoStepHoverText}];n.Client.Utility.FFFUtility.isFeatureEnabled(n.Client.Utility.FFFUtility.WaitingBubble)&&f.push({Type:i.Utility.ControlTypes.WaitingStep,Name:i.Locale.waitingStepContent,Title:i.Locale.waitingStepHoverText});this.addNewBubbleView=new r.AddBubbleView({collection:f,el:this.bubblesContainerHolder},function(n){return u.addNewStep(n)},function(n,t,i){return u.handleMouseDown(n,t,!1,i)},function(){return u.removeBubble()});this.addNewBubbleView.render()}catch(e){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Expception in rendering controlaction tooltab from FlowEditorSidePanelView:renderStepsContainer");t.Loader.marsExceptionHandler.execute(e.name,e.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"FlowEditorSidePanelView:renderStepsContainer END")},f.prototype.handleMouseDown=function(i,r,u,f){if(r!=undefined&&r!=null||!this.checkMaximumSteps(i,u)){t.Loader.appContext.Util.hideDesignerOverlay();var e=n.Client.Loader.appContext.isMobileClient();if(e){t.Loader.$mars("#lPathSkinnyToolbarBlock").hasClass("open")?this.toggleSidebarHandler():u&&n.Client.Loader.appContext.handleCustomizationContainerInMoca(!1);this.onMouseDown(i,r,f)}else this.onMouseDown(i,r,f)}},f.prototype.renderBubbleOnEdit=function(n,i){this.currentStepModelInstance=n;this.checkForPageNavigation(i);t.Loader.$mars("#lPathSkinnyToolbarBlock").hasClass("open")&&this.toggleSidebarHandler(!1,i)},f.prototype.removeLoadingAnimation=function(){i.$mars("#loadingGifDiv").remove()},f.prototype.displayLoadingAnimation=function(){var r=i.App.lPathDesignerContainerZIndex,n,u;r+=99;n="left";i.App.isRTL&&(n="right");u='<div id="loadingGifDiv" style="position: fixed; top: 50%; '+n+": 50%; z-index: "+r+';"><img id="loadingGif" src="'+t.Loader.serverUrl+'images/publishloading.gif" height="85" width="85"><\/div>';this.rootElement.append(u)},f.prototype.guidedTaskSaveAction=function(){var n=this,r;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"FlowEditorSidePanelView:onSave START");try{this.handleSteps();this.isInfoBubbleAtLast()&&(this.displayLoadingAnimation(),r=u.prototype.save.call(this,this.modelValue),r.done(function(r){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Details : Control type : "+n.modelValue.ControlType+"; Id : "+n.modelValue.ControlId);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Author Name : "+n.modelValue.AuthorName+"; Author Id : "+n.modelValue.AuthorId+"; isContextHomeSideBar : "+n.modelValue.IsContextHomeSideBar);n.modelValue=r;n.removeBubble();n.updateSharedModelValue();n.hasChanges=!1;n.stepContainerView.updateState(n.modelValue.Steps,i.Utility.LearningPathObjectState.Unchanged);n.stepContainerView.onSave();n.stepBubbleContainer&&n.stepBubbleContainer.onSave();n.removeLoadingAnimation();n.trackActivity(n.modelValue)}),r.fail(function(i,r,u){t.Loader.marsExceptionHandler.execute(i.status,i.statusText,i.responseJSON);console.log("Error while saving GT data "+u.message);n.updateSharedModelValue();n.removeLoadingAnimation()}))}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"FlowEditorSidePanelView:onSave Exception occurred while saving sidebar data.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"FlowEditorSidePanelView:onSave END")},f.prototype.guidedTaskDeleteAction=function(){this.removeBubble();this.deleteCurrentControl()},f.prototype.addNewStep=function(n){this.checkMaximumSteps(n)||(this.removeBubble(),this.currentStepModelInstance=this.getNewStepModel(n),this.stepContainerView.addNewStep(this.currentStepModelInstance))},f.prototype.getNewStepModel=function(n){var r=this.stepContainerView.getCurrentStepIndex()+1,t=i.Util.Common.createGuidedTaskControl(this.modelValue);return t.ControlName=this.modelValue.ControlName+"_"+i.Util.Constants.GuidedTask+r,t.ControlType=n,t.Tags=this.getControlTypeName(n),t.MetadataJson.Index=r,t.MetadataJson.ParentControlIds=[this.modelValue.ControlId],t.MetadataJson.Content={Title:"",Text:""},t.MetadataJson.PlacementPosition=this.BubbleUtilityConstant.bubblePositionAuto,t},f.prototype.handleSteps=function(){var n=this.stepContainerView.getSteps(),t,r,u;if(n.length>0){for(t=0;t<n.length;t++)r=n[t],r&&(this.modelValue.MetadataJson.ChildControlIds[t]=r.ControlId);n[0].MetadataJson.PageNavigationInfo&&n[0].MetadataJson.PageNavigationInfo!=""&&(u=JSON.parse(n[0].MetadataJson.PageNavigationInfo),this.modelValue.MetadataJson.EnableWildCardNavigation=u.hasOwnProperty("wildcard")?!0:!1)}this.modelValue.Steps=n;i.Util.Common.setPreviousAndNextControlIds(this.modelValue);this.setPageNavigationToControl();this.modelValue.LanguageControlVersionContents[0].ObjectState=i.Utility.LearningPathObjectState.Modified},f.prototype.setPageNavigationToControl=function(){var n=i.Util.Common.getContextTypeMetadata(this.modelValue,i.Utility.ContextTypeMetaData.PageNavigationInfo);this.modelValue.IsContextHomeSideBar||this.modelValue.IsErrorControl||n.length!==0||(i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.PageNavigationInfo,JSON.stringify(t.Loader.appContext.getPageNavigationInfo()),this.modelValue.Contexts[0].ContextGroup.ContextGroupElements),this.modelValue.ObjectState=i.Utility.LearningPathObjectState.Modified)},f.prototype.onBubbleSave=function(n){this.stepContainerView.updateModel(n)},f.prototype.getControlTypeName=function(n){var t="";switch(n){case i.Utility.ControlTypes.PassiveStep:t=i.Locale.passiveStepContent;break;case i.Utility.ControlTypes.ActiveStep:t=i.Locale.activeStepContent;break;case i.Utility.ControlTypes.InfoBubble:t=i.Locale.infoStepContent;break;case i.Utility.ControlTypes.HybridStep:t=i.Locale.hybridStepContent;break;case i.Utility.ControlTypes.ExistingGTStep:t=i.Locale.existingGTStep;break;case i.Utility.ControlTypes.WaitingStep:t=i.Locale.waitingStepContent;break;default:t=""}return t},f.prototype.onMouseDown=function(n,u,f){var e=this,o;f===void 0&&(f=!1);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"FlowEditorSidePanelView:enableElementSelection START");this.removeBubble();this.currentStepModelInstance=u?u:this.getNewStepModel(n);this.controlSelector=new r.StepTargetSelector(this.onMouseLeave.bind(this),f,u,this.enableDomCheckBox.prop("checked"));o=this.controlSelector.enableElementSelection();o.done(function(n,r){r&&(e.stepContainerView.hideDragTitle(e.currentStepModelInstance.ControlId),e.stepContainerView.handleToolbar(e.currentStepModelInstance.ControlId,!0));e.currentStepModelInstance.MetadataJson.ElementIdentifier=n;var u=e.currentStepModelInstance;u.Contexts.length==0&&(u=i.Util.Common.addSkeletonContextObjectToControlModel(u));i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.PageNavigationInfo,JSON.stringify(t.Loader.appContext.getPageNavigationInfo()),u.Contexts[0].ContextGroup.ContextGroupElements);e.currentStepModelInstance.MetadataJson.PageNavigationInfo=JSON.stringify(t.Loader.appContext.getPageNavigationInfo());e.renderBubble();t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"FlowEditorSidePanelView:enableElementSelection END")});o.fail(function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"FlowEditorSidePanelView:enableElementSelection error on drop")})},f.prototype.onMouseLeave=function(){this.stepBubbleContainer&&this.stepBubbleContainer.removeBubble();this.addNewBubbleView.togglePopup(!0);t.Loader.$mars("#lPathSkinnyToolbarBlock").hasClass("open")&&this.toggleSidebarHandler()},f.prototype.renderBubble=function(){this.stepContainerView.addNewStep(this.currentStepModelInstance);this.renderStepBubble(this.currentStepModelInstance)},f.prototype.checkForPageNavigation=function(t){var r=this,i;t===void 0&&(t=!0);try{i=JSON.parse(this.currentStepModelInstance.MetadataJson.PageNavigationInfo);n.Client.Loader.appContext.compareNavInfo(i)?this.renderStepBubble(this.currentStepModelInstance,t):(i.callback=function(){r.renderStepBubble(r.currentStepModelInstance,t)},n.Client.Loader.appContext.navigateToPage(i))}catch(u){console.error(u)}},f.prototype.renderStepBubble=function(n,t,u){var f=this;t===void 0&&(t=!0);u===void 0&&(u=this.BubbleUtilityConstant.bubblePositionAuto);this.controlSelector!=null?(this.controlSelector.close(),this.controlSelector.show(n.MetadataJson.ElementIdentifier)):(this.controlSelector=new r.StepTargetSelector(null,!1),this.controlSelector.show(n.MetadataJson.ElementIdentifier));t===!0&&i.App.showLPathDesignerOverlay();this.stepBubbleContainer!=null&&this.stepBubbleContainer.close();this.stepBubbleContainer=new r.StepBubbleContainerView({stepModel:n,isEditMode:t,totalSteps:this.getTotalSteps()},function(n){return f.onBubbleSave(n)},function(){return f.removeBubble()},function(n,t,i){return f.handleMouseDown(n,t,!0,i)},function(n){return f.onBubbleCopy(n)});this.stepBubbleContainer.render()},f.prototype.openingAddNewBubbleItemDropdownOnTabOrder=function(i){i.which==t.Utility.KeyCodeEnum.TabKey&&(i.shiftKey?(i.preventDefault(),this.rootElement.find(".lpath-gt-flow-dropdown-menu").is(":visible")&&this.addNewBubbleView.togglePopup(),this.rootElement.find("#lpath-gt-enable_dom").focus()):t.Loader.$mars(".lpath-gt-flow-bubble-item").length>0&&(t.Loader.$mars(".lpath-gt-flow-bubble-item").removeClass("active"),t.Loader.$mars(".lpath-gt-flow-bubble-item:first").addClass("active"),t.Loader.$mars(".lpath-gt-flow-bubble-item:first .lapth-gt-bubble-main-div").focus(),i.preventDefault()));n.Client.Loader.appContext.Util.isEnterPressed(i,!0)&&(i.preventDefault(),this.rootElement.find(".lpath-gt-flow-dropdown-menu").is(":visible")||this.addNewBubbleView.togglePopup(),this.rootElement.find(".lpath-gt-flow-dropdown-menu li:first").focus())},f.prototype.closingAddNewBubbleItemDropdownOnTabOrder=function(n){n.which!=t.Utility.KeyCodeEnum.TabKey||n.shiftKey||this.rootElement.find(".lpath-gt-flow-newbubble-dropdown").hide()},f.prototype.updateSharedModelValue=function(){this.modelValue=this.getCurrentControlValue()},f.prototype.checkMaximumSteps=function(n,r){var e=!1,u,o;if(!r&&(u=t.Loader._mars.reject(this.stepContainerView.getSteps(),function(n){return n.ObjectState==t.Utility.LearningPathObjectState.Deleted}),u.length)){if(o=t.Loader._mars.where(u,{ControlType:i.Utility.ControlTypes.InfoBubble}),o.length&&n==i.Utility.ControlTypes.InfoBubble){e=!0;try{i.Util.Common.showAlertMessage(i.Locale.warnnigTitle,i.Locale.infoBubbleAlreadyExistAlertContent,t.Loader.$mars("#lpathSkinnytoolbarOtherControlContainer"),!1,i.Locale.okButtonCaption,"",function(){i.App.lPathDesignerContainer.find(".lpath-gt-flow-addnewbubleicon").focus()},function(){i.App.lPathDesignerContainer.find(".lpath-gt-flow-addnewbubleicon").focus()})}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message)}}if(u.length>=this.defaultBubbleLength){e=!0;try{i.Util.Common.showAlertMessage(i.Locale.warnnigTitle,i.Locale.maximumStepAlertContent+this.defaultBubbleLength,t.Loader.$mars("#lpathSkinnytoolbarOtherControlContainer"),!1,i.Locale.okButtonCaption,"",function(){},function(){})}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message)}}}return e},f.prototype.isInfoBubbleAtLast=function(){var r=!0,n=t.Loader._mars.reject(this.modelValue.Steps,function(n){return n.ObjectState==t.Utility.LearningPathObjectState.Deleted}),u,f;if(n=t.Loader._mars.sortBy(n,function(n){return n.MetadataJson.Index}),u=t.Loader._mars.where(n,{ControlType:i.Utility.ControlTypes.InfoBubble}),n.length&&u.length&&(f=n[n.length-1].ControlType,f!=i.Utility.ControlTypes.InfoBubble)){r=!1;try{i.Util.Common.showAlertMessage(i.Locale.infoBubbleTitle,i.Locale.infoBubbleMessage,t.Loader.$mars("#lpathSkinnytoolbarOtherControlContainer"),!1,i.Locale.okButtonCaption,"",function(){},function(){})}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message)}}return r},f.prototype.onBubbleCopy=function(n){var t=this.getNewStepModel(n.ControlType);t=this.cloneBubble(n,t);t.ObjectState=i.Utility.LearningPathObjectState.Added;this.stepContainerView.addNewStep(t);t.ControlName=t.ControlName+"_"+t.MetadataJson.Index;this.renderBubbleOnEdit(t,!0)},f.prototype.cloneBubble=function(n,r){var f=r.MetadataJson.Index;for(var u in n)n.hasOwnProperty(u)&&u!="ControlId"&&u!="MetadataJson"&&u!="LanguageControlVersionContents"&&(r[u]=n[u]);r.MetadataJson=JSON.parse(JSON.stringify(n.MetadataJson));r.MetadataJson.ClientId=i.Utility.Util.newGuid();r.ControlId=i.Utility.Util.newGuid();r.ControlVersionId=i.Utility.Util.newGuid();r.MetadataJson.Index=f;for(u in n.LanguageControlVersionContents)u!="ControlVersionId"&&u!="Id"&&(r[u]=n[u]);return r.MarsObjectId[0]=r.ControlVersionId,r.Contexts=[],r=i.Util.Common.addSkeletonContextObjectToControlModel(r),i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.PageNavigationInfo,JSON.stringify(t.Loader.appContext.getPageNavigationInfo()),r.Contexts[0].ContextGroup.ContextGroupElements),r},f.prototype.attachEventsToEditMode=function(){var t=this.rootElement.find("#lPathEditHeader"),r=this.getCurrentControlValue(),n=this;t.off("change").on("change",function(){var u=t.val(),f=i.Util.Common.getPreviewTemplateName(r.MetadataJson.Template);n.modelValue=i.Util.Common.handleLanguageControlVersionContent(n.modelValue,f,!1,u,n.modelValue.BaseLcid);n.hasChanges=!0});t.keypress(function(n){n.keyCode==13&&n.preventDefault()})},f.prototype.getTotalSteps=function(){var n=t.Loader._mars.reject(this.stepContainerView.getSteps(),function(n){return n.ObjectState==t.Utility.LearningPathObjectState.Deleted});return n.length},f.prototype.homeButtonTabFocus=function(r){try{return r.keyCode==i.Utility.KeyCodeEnum.TabKey?r.shiftKey?r.shiftKey&&(t.Loader.$mars(".lpath-gt-flow-bubble-item").length>0?(t.Loader.$mars(".lpath-gt-flow-bubble-item").removeClass("active"),t.Loader.$mars(".lpath-gt-flow-bubble-item:last").addClass("active"),t.Loader.$mars(".lpath-gt-flow-bubble-item:last .lapth-gt-bubble-main-div").focus()):t.Loader.$mars(".lpath-gt-flow-addnewbubleicon").focus()):t.Loader.$mars("#lPathSkinnyToolbarHomeButton").focus():r.keyCode==i.Utility.KeyCodeEnum.UpArrowKey?(this.rootElement.find("#lPathControlToolTabSaveButton").focus(),this.rootElement.find("#lPathControlToolTabSaveButton").attr("tabindex",0),this.rootElement.find("#lPathControlToolTabDeleteButton").attr("tabindex",-1)):n.Client.Loader.appContext.Util.isEnterPressed(r,!0)&&this.guidedTaskDeleteAction(),r.preventDefault(),t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"tabbing order after lpath delete button : END"),!1}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"FlowEditorSidePanelView : Error on tabbing order after lpath delete button")}},f.prototype.handleTabbingForHomeButton=function(r){try{return r.keyCode==i.Utility.KeyCodeEnum.TabKey?r.shiftKey?r.shiftKey&&i.App.lPathDesignerContainer.find(".lpath-control-tooltab-button:tabbable").focus():(t.Loader.$mars("#lpath-mars-toggle-arrow-button").focus(),r.stopPropagation(),r.preventDefault()):n.Client.Loader.appContext.Util.isEnterPressed(r,!0)&&t.Loader.$mars('div[id="lPathSkinnyToolbarHomeIcon"]').click(),t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"tabbing order after skinny tool bar home button : END"),!1}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"FlowEditorSidePanelView : Error on tabbing order after skinny tool bar home button")}},f.prototype.arrowKeyNavigationForSaveButton=function(r){try{return r.keyCode==i.Utility.KeyCodeEnum.TabKey?r.shiftKey?r.shiftKey&&(t.Loader.$mars(".lpath-gt-flow-bubble-item").length>0?(t.Loader.$mars(".lpath-gt-flow-bubble-item").removeClass("active"),t.Loader.$mars(".lpath-gt-flow-bubble-item:last").addClass("active"),t.Loader.$mars(".lpath-gt-flow-bubble-item:last .lapth-gt-bubble-main-div").focus()):t.Loader.$mars(".lpath-gt-flow-addnewbubleicon").focus()):t.Loader.$mars("#lPathSkinnyToolbarHomeButton").focus():r.keyCode==i.Utility.KeyCodeEnum.DownArrowKey?(this.rootElement.find("#lPathControlToolTabDeleteButton").focus(),this.rootElement.find("#lPathControlToolTabDeleteButton").attr("tabindex",0),this.rootElement.find("#lPathControlToolTabSaveButton").attr("tabindex",-1)):n.Client.Loader.appContext.Util.isEnterPressed(r,!0)&&this.guidedTaskSaveAction(),r.preventDefault(),t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"arrow key order after lpath save button : END"),!1}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"FlowEditorSidePanelView : Error on arrow key order after lpath save button")}},f.prototype.onWindowResize=function(){var t=this;n.Client.Loader.$mars(t.getWindow()).off("resize.lpath_GT_Bubble_MainContainer").on("resize.lpath_GT_Bubble_MainContai",function(){t.stepBubbleContainer!=null&&t.stepBubbleContainer.isBubbleInView()&&(t.stepBubbleContainer.removeBubble(t.currentStepModelInstance),t.stepBubbleContainer.renderStepBubble())})},f.prototype.getWindow=function(){var t=n.Client.Loader.appContext.isMobileClient();return t?window.parent.window:window},f.prototype.trackActivity=function(n){for(var t,u=this.controlCreated&&!n.CreateTelemetry?window._MicrosoftMars.Client.Telemetry.EndAction.created:window._MicrosoftMars.Client.Telemetry.EndAction.edited,r=0;r<n.Steps.length;r++)t=n.Steps[r],t.gtid=n.ControlId,t.gtname=n.ControlName,t.position=r,i.App.trackActivity(t,u);i.App.trackActivity(n,u);i.App.saveControlCreateTelemetry(n)},f}(r.ControlView);r.FlowEditorSidePanelView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t,i,r){u.call(this);this.renderBubbleOnEditCallback=t;this.removeBubbleCallback=i;this.mouseDownCallback=r;this.isInMouseDown=!1;this.isInDrag=!1;this.stepsCollection=n.collection!=null&&n.collection!=undefined?n.collection:[];this.backboneCollection=this.getBackboneCollection();this.$el=n.el;this.$el.html('<ul class="lpath-gt-step-bubble-conversation-wrap lpath-gt-step-bubble-drag lpath-sidebar-floweditor" id="lPathGtStepBubbleContainer" tabindex="-1"><\/ul>');this.stepContainer=this.$el.find("#lPathGtStepBubbleContainer");this.enableSortableUI()}return __extends(f,u),f.prototype.remove=function(){return this.removeAllStep(),this},f.prototype.render=function(){return this.addAllStep(),this},f.prototype.addNewStep=function(n){var u=t.Loader._mars.any(this.stepsCollection,function(t){return t.ControlId==n.ControlId}),i,r;u?(r=this.getIndex(this.backboneCollection.models,n.ControlId,!0),r>=0&&(this.backboneCollection.at(r).attributes.MetadataJson.PageNavigationInfo=n.MetadataJson.PageNavigationInfo)):(this.stepsCollection.push(n),i=this.getBackboneMetadata(n),this.backboneCollection.add(i,{at:this.backboneCollection.length}),this.addSingleStep(i),this.$el.find("li").removeClass("active"),i.trigger("active"),this.hasChanged=!0)},f.prototype.getSteps=function(){return this.stepsCollection},f.prototype.updateState=function(n,t){this.stepsCollection=n;this.stepsCollection.forEach(function(n){n.ObjectState=t;n.LanguageControlVersionContents.forEach(function(n){return n.ObjectState=t})})},f.prototype.updateModel=function(n){var i=this.backboneCollection.find(function(t){return t.attributes.ControlId===n.ControlId}),r;i&&(r=t.Loader._mars.clone(i.get("MetadataJson")),r.Content=n.MetadataJson.Content,i.set("MetadataJson",r),i.trigger("render"))},f.prototype.onSave=function(){this.hasChanged=!1},f.prototype.isCurrentModelValueUpdated=function(){return this.advanceOptionView&&this.advanceOptionView.isCurrentModelValueUpdated()&&(this.hasChanged=!0),this.hasChanged},f.prototype.getCurrentStepIndex=function(){return this.backboneCollection.length},f.prototype.close=function(){this.removeAllStep()},f.prototype.handleToolbar=function(n,t){var r=this.getIndex(this.backboneCollection.models,n,!0),i;r>=0&&(i=this.backboneCollection.at(r),i&&i!=null&&i.trigger("handleToolbar",{isEnable:t}))},f.prototype.hideDragTitle=function(n){var i=this.getIndex(this.backboneCollection.models,n,!0),t;i>=0&&(t=this.backboneCollection.at(i),t&&t!=null&&t.trigger("hideDragTitle"))},f.prototype.addAllStep=function(){var n=this;this.removeAllStep();this.backboneCollection.each(function(t){n.addSingleStep(t)},this);this.wireUIEvents()},f.prototype.addSingleStep=function(n,t){if((!t||!t.silent)&&n.attributes.ObjectState!=3){n.attributes.MetadataJson.Comments=n.attributes.MetadataJson.PageNavigationInfo?"":i.Locale.gtFlowEditorDragTitleText;var u=new r.StepItemView({model:n});this.wireItemViewEvents(u);u.render();n.attributes.MetadataJson.PageNavigationInfo?u.handleToolbar(!0):u.handleToolbar(!1);this.stepContainer.append(u.$el)}},f.prototype.removeAllStep=function(){var n=this;n.unwireUIEvents();n.backboneCollection.each(function(t){n.removeSingleStep(t)},n);this.stepContainer.empty()},f.prototype.removeSingleStep=function(n,t){t&&t.silent||(this.stopListening(n),n.trigger("close"))},f.prototype.unwireUIEvents=function(){this.$el.off("keydown",".lpath-gt-flow-bubble-item.lpath-gt-flow-step-bubble-conversation");this.$el.off("click",".lapth-gt-bubble-main-div:not(.lpath-gt-flow-moveicon)");this.$el.off("mousedown",".lapth-gt-bubble-main-div:not(.lpath-gt-flow-moveicon)");this.$el.off("mouseleave",".lpath-gt-step-bubble-conversation-wrap:parent");this.$el.off("mouseup",".lpath-gt-step-bubble-conversation-wrap:parent");this.$el.off("focus",".lapth-gt-bubble-main-div");this.$el.off("focus",".lpath-gt-flow-moveicon");this.$el.off("keydown",".lpath-gt-flow-moveicon")},f.prototype.wireUIEvents=function(){var r=this;r.onKeyUpDownAccessibility();r.$el.on("focus",".lapth-gt-bubble-main-div",function(){r.$el.find(".lpath-gt-flow-bubble-item").find("#lpath-gt-flow-smalltoolbar-icons").hide();r.$el.find(".lpath-gt-step-bubble-conversation-wrap .lpath-gt-flow-bubble-item").removeClass("active");i.$mars(this).closest("li").addClass("active");t.Loader.$mars(".lpath-gt-flow-bubble-item:active .lapth-gt-bubble-main-div").focus();t.Loader.$mars(".lpath-gt-flow-bubble-item.active").find("#lpath-gt-flow-smalltoolbar-icons").show()});r.$el.on("focus",".lpath-gt-flow-moveicon",function(n){n.stopPropagation()});r.$el.on("keydown",".lpath-gt-flow-moveicon",function(t){n.Client.Loader.appContext.Util.isEnterPressed(t,!0)&&(t.stopPropagation(),t.preventDefault())});r.$el.on("click",".lapth-gt-bubble-main-div:not(.lpath-gt-flow-moveicon)",function(n){var t,u;r.removeBubbleCallback&&(t=i.$mars(this).closest("li").index(),t>=0&&t<r.stepsCollection.length&&(u=r.backboneCollection.at(t).attributes.ControlId,r.removeBubbleCallback(r.stepsCollection[r.getIndex(r.stepsCollection,u)])));r.isInMouseDown=!1;r.$el.find(".lpath-gt-step-bubble-conversation-wrap .lpath-gt-flow-bubble-item").removeClass("active");i.$mars(this).closest("li").addClass("active").focus();i.$mars(this).closest("li").find(".lapth-gt-bubble-main-div").focus();n.preventDefault();n.stopPropagation()});r.$el.on("mousedown",".lapth-gt-bubble-main-div:not(.lpath-gt-flow-moveicon)",function(n){r.isInMouseDown||(r.isInMouseDown=!0,r.mouseDownIndex=i.$mars(n.target).closest("li").index());n.preventDefault();n.stopPropagation()});r.$el.on("mouseleave",".lpath-gt-step-bubble-conversation-wrap:parent",function(n){if(r.mouseDownCallback&&r.isInMouseDown&&(r.isInMouseDown=!1,r.mouseDownIndex>=0&&r.mouseDownIndex<r.stepsCollection.length)){var i=r.backboneCollection.at(r.mouseDownIndex).attributes.ControlId,t=r.stepsCollection[r.getIndex(r.stepsCollection,i)];r.mouseDownCallback(t.ControlType,t,!0)}r.isInDrag||(n.preventDefault(),n.stopPropagation())});r.$el.on("mouseup",".lpath-gt-step-bubble-conversation-wrap .lpath-gt-flow-bubble-item",function(n){r.isInMouseDown&&(r.isInMouseDown=!1);r.isInDrag||(n.preventDefault(),n.stopPropagation())})},f.prototype.wireItemViewEvents=function(n){var r=this;n.$el.on("click","#lpath-flow-bubble-preview",function(n){r.onPreview(this,i.$mars(this).closest("li.lpath-gt-flow-bubble-item").index());r.isInMouseDown=!1;n.preventDefault();n.stopPropagation()});n.$el.on("click","#lpath-flow-bubble-edit",function(n){r.onEdit(this,i.$mars(this).closest("li.lpath-gt-flow-bubble-item").index());r.isInMouseDown=!1;n.preventDefault();n.stopPropagation()});n.$el.on("click","#lpath-flow-bubble-delete",function(n){r.onDelete(this,i.$mars(this).closest("li.lpath-gt-flow-bubble-item").index());t.Loader.$mars(".lpath-gt-flow-bubble-item").length>0?(t.Loader.$mars(".lpath-gt-flow-bubble-item:last").addClass("active"),t.Loader.$mars(".lpath-gt-flow-bubble-item:last .lapth-gt-bubble-main-div").focus()):t.Loader.$mars(".lpath-gt-flow-addnewbubleicon").focus();r.isInMouseDown=!1;n.preventDefault();n.stopPropagation()});n.$el.on("click","#lpath-flow-bubble-adv",function(n){r.onSetting(this,i.$mars(this).closest("li.lpath-gt-flow-bubble-item").index());r.isInMouseDown=!1;n.preventDefault();n.stopPropagation()})},f.prototype.enableSortableUI=function(){var r=this,n=this,t,i;n.stepContainer.sortable({tolerance:"pointer",revert:"true",handle:".lpath-gt-flow-stack-default.lpath-sidebar-floweditor",cancel:"",cursor:"move",axis:"y",containment:"parent",start:function(i,r){n.isInDrag=!0;t=r.item.index();n.isInMouseDown&&(n.isInMouseDown=!1)},stop:function(u,f){n.isInDrag=!1;i=f.item.index();n.isInMouseDown&&(n.isInMouseDown=!1);r.onDragStop(t,i)}}).disableSelection()},f.prototype.onDragStop=function(n,t){var r=this.backboneCollection.models[n],i;this.backboneCollection.remove(this.backboneCollection.at(n));this.backboneCollection.add(r,{at:t});this.resetIndex();this.render();i=this.backboneCollection.at(t);this.$el.find("li").removeClass("active");i.trigger("active");this.hasChanged=!0},f.prototype.getIndex=function(n,i,r){return r===void 0&&(r=!1),r?t.Loader._mars.findIndex(n,function(n){return n.attributes.ControlId==i}):t.Loader._mars.findIndex(n,{ControlId:i})},f.prototype.onPreview=function(n,t){var i=this.backboneCollection.at(t).attributes.ControlId;this.renderBubbleOnEditCallback(this.stepsCollection[this.getIndex(this.stepsCollection,i)],!1)},f.prototype.onEdit=function(n,t){var i=this.backboneCollection.at(t).attributes.ControlId;this.renderBubbleOnEditCallback(this.stepsCollection[this.getIndex(this.stepsCollection,i)],!0)},f.prototype.onDelete=function(n,r){var u,f,e;r<0||r>this.backboneCollection.length||(u=this.backboneCollection.at(r).attributes.ControlId,f=this.stepsCollection[this.getIndex(this.stepsCollection,u)],f.ObjectState==t.Utility.LearningPathObjectState.Added?this.stepsCollection=t.Loader._mars.reject(this.stepsCollection,function(n){return n.ControlId==u}):f.ObjectState=i.Utility.LearningPathObjectState.Deleted,e=this.backboneCollection.models[this.getIndex(this.backboneCollection.toJSON(),u)],this.backboneCollection.remove(e),this.resetIndex(),this.removeBubbleCallback(f),this.render(),this.hasChanged=!0)},f.prototype.onSetting=function(n,u){var f=this,s=this.backboneCollection.at(u).attributes.ControlId,e=this.stepsCollection[this.getIndex(this.stepsCollection,s)],o;t.Loader.$mars("#lPathAdvancedPopupContainer").length>0?t.Loader.$mars("#lPathAdvancedPopupContainer").html="":t.Loader.$mars("#lPathDesignerContainer").append('<div id="lPathAdvancedPopupContainer"><\/div>');this.wildCardKeyValueModelList=i.Util.Common.wildCardOptions(e);o=new r.AdvancedOptionView({model:this.getBackboneMetadata(e),el:t.Loader.$mars("#lPathAdvancedPopupContainer")},function(){return f.onAdvancedOptionsOkCallback(u)},function(){return f.onAdvancedOptionsCancelCallback()});t.Loader.$mars("#lPathskinnyToolbarContainer").attr("aria-hidden",!0);o.render()},f.prototype.onAdvancedOptionsOkCallback=function(n){var e=this.backboneCollection.at(n).attributes.ControlId,r=this.stepsCollection[this.getIndex(this.stepsCollection,e)],u,f;r.MetadataJson.EnableNudge=t.Loader.$mars("#lpath-gt-enable_nudge").is(":checked");r.MetadataJson.ShowBubbleElementPointer=t.Loader.$mars("#lpath-gt-show_bubble_pointer").is(":checked");u=i.App.appContext.getPageNavigationInfo();f=this.getSelectedWildCardOptions();f.length>0&&(u.wildcard=f);i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.PageNavigationInfo,JSON.stringify(u),r.Contexts[0].ContextGroup.ContextGroupElements);r.MetadataJson.PageNavigationInfo=JSON.stringify(u);t.Loader.$mars("#lPathControlAdvancedOptionsView").hide();t.Loader.$mars("#lPathskinnyToolbarContainer").attr("aria-hidden",!1);t.Loader.$mars(".lapth-gt-flow-setting").focus()},f.prototype.onAdvancedOptionsCancelCallback=function(){t.Loader.$mars("#lPathControlAdvancedOptionsView").hide();t.Loader.$mars("#lPathskinnyToolbarContainer").attr("aria-hidden",!1);t.Loader.$mars(".lapth-gt-flow-setting").focus()},f.prototype.getSelectedWildCardOptions=function(){var n=[],i=t.Loader.$mars("table.lpath-gt-step-bubble-advance-options-table").find('td[class="lpath-setup-advance-grid-ignore-value"] input[type="checkbox"]:checked');return t.Loader.$mars.each(i,function(i){n.push(t.Loader.$mars(t.Loader.$mars("table.lpath-gt-step-bubble-advance-options-table").find('td[class="lpath-setup-advance-grid-ignore-value"] input[type="checkbox"]:checked')[i]).data("key"))}),n},f.prototype.getBackboneCollection=function(){var f=this,n=this.stepsCollection,u,i;return n!=null&&n!=undefined?(u=t.Loader._mars.sortBy(n,function(n){return n.MetadataJson.Index}),i=[],u.forEach(function(n){i.push(f.getBackboneMetadata(n))}),new r.BackboneSteps(i)):new r.BackboneSteps},f.prototype.getBackboneMetadata=function(n){return new r.BackboneControlBaseMetadata({ControlName:n.ControlName,ControlType:n.ControlType,MetadataJson:{Index:n.MetadataJson.Index,ClientId:n.MetadataJson.ClientId,Content:n.MetadataJson.Content,EnableNudge:n.MetadataJson.EnableNudge,ShowBubbleElementPointer:n.MetadataJson.ShowBubbleElementPointer,EnableWildCardNavigation:n.MetadataJson.EnableWildCardNavigation,WildCardKeyValueModelList:this.wildCardKeyValueModelList,PageNavigationInfo:n.MetadataJson.PageNavigationInfo},LastUpdatedDate:n.LastUpdatedDate,Enabled:n.Enabled,Comments:n.Comments,ControlId:n.ControlId,Tags:n.Tags,ObjectState:n.ObjectState})},f.prototype.resetIndex=function(){var n=this;this.backboneCollection.each(function(t,r){t.attributes.MetadataJson.Index=r+1;var u=n.stepsCollection[n.getIndex(n.stepsCollection,t.attributes.ControlId)];u.MetadataJson.Index=t.attributes.MetadataJson.Index;u.ObjectState!=i.Utility.LearningPathObjectState.Added&&(u.ObjectState=i.Utility.LearningPathObjectState.Modified)})},f.prototype.onKeyUpDownAccessibility=function(){var n=this;n.$el.on("keydown",".lpath-gt-flow-bubble-item",function(i){var u=n.$el.find(this),f,r;if(i.keyCode==38){if(u.prev().length>0){f=u.index();r=u.prev().index();n.onDragStop(f,r);t.Loader.$mars(".lpath-gt-flow-bubble-item").removeClass("active").eq(r).addClass("active");t.Loader.$mars(".lpath-gt-flow-bubble-item").find(".lapth-gt-bubble-main-div").eq(r).focus()}}else if(i.keyCode==40&&u.next().length>0){f=u.index();r=u.next().index();n.onDragStop(f,r);t.Loader.$mars(".lpath-gt-flow-bubble-item").removeClass("active").eq(r).addClass("active");t.Loader.$mars(".lpath-gt-flow-bubble-item").find(".lapth-gt-bubble-main-div").eq(r).focus()}})},f}(BackboneMars.View);r.StepContainerView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n){var r=this;u.call(this);this.model=n.model;this.$el=t.Loader.$mars('<li data-controlid="'+this.model.toJSON().ControlId+'" class="lpath-gt-flow-bubble-item lpath-gt-flow-step-bubble-conversation lpath-sidebar-floweditor" tabindex="-1" title="'+i.Locale.bubbleItem+'"><\/li>');this.initialize();this.model.on("close",function(){return r.close()});this.model.on("active",function(){return r.setActive()});this.model.on("render",function(){return r.render()});this.model.on("handleToolbar",function(n){return r.handleToolbar(n.isEnable)});this.model.on("hideDragTitle",function(){return r.hideDragTitle()})}return __extends(f,u),f.prototype.close=function(){this.stopListening(this.model,"destroy",this.remove);this.$el.find("#lpath-gt-flow-smalltoolbar-icons > ul li").off("keydown");this.unwireEvents();this.model.off("close");this.model.off("active");this.model.off("render")},f.prototype.render=function(){var u=this,f=r.TemplateEngine.applyTemplate(i.Util.Constants.stepContainerItemTemplate,this.model.toJSON()),n;return this.$el.html(f),this.$el.find("#lpath-gt-flow-smalltoolbar-icons > ul li").keydown(function(n){return u.arrowKeyNavigationForToolBar(n)}),n=this.$el.find(".lapth-gt-flow-view,.lapth-gt-flow-edit,.lapth-gt-flow-setting"),t.Loader.$mars(n).parent().hasClass(".lpath-gt-bubble-toolbar-disable")||t.Loader.$mars(n).attr("tabindex",0),this},f.prototype.clear=function(){this.model.destroy()},f.prototype.initiliaze=function(){this.listenTo(this.model,"destroy",this.remove)},f.prototype.handleToolbar=function(n){var i=this.$el.find(".lapth-gt-flow-view,.lapth-gt-flow-edit,.lapth-gt-flow-setting");n?(t.Loader.$mars(i).parent().parent().removeClass("lpath-gt-bubble-toolbar-disable"),t.Loader.$mars(i).attr("tabindex",0)):(t.Loader.$mars(i).parent().parent().addClass("lpath-gt-bubble-toolbar-disable"),t.Loader.$mars(i).attr("tabindex",-1))},f.prototype.hideDragTitle=function(){var n=this.$el.find(".lpath-gt-flow-dragtext");this.model.attributes.MetadataJson.Comments="";n.html("")},f.prototype.setActive=function(){this.$el.addClass("active")},f.prototype.unwireEvents=function(){this.$el.off("click","#lpath-flow-bubble-preview");this.$el.off("click","#lpath-flow-bubble-edit");this.$el.off("click","#lpath-flow-bubble-delete");this.$el.off("click","#lpath-flow-bubble-adv")},f.prototype.arrowKeyNavigationForToolBar=function(r){var u=t.Loader.$mars(r.currentTarget),f;return r.keyCode==i.Utility.KeyCodeEnum.TabKey?r.shiftKey?r.shiftKey&&(t.Loader.$mars(".lpath-gt-flow-bubble-item.active .lpath-gt-flow-moveicon").focus(),t.Loader.$mars(".lpath-sidebar-floweditor.active #lpath-gt-flow-smalltoolbar-icons li span *").attr("tabindex",-1),i.$mars(t.Loader.$mars(r.currentTarget).find("span")[0].firstChild).attr("tabindex",0)):(f=i.$mars(".lpath-gt-flow-bubble-item.active").next(),f.length>0?(t.Loader.$mars(".lpath-sidebar-floweditor.active #lpath-gt-flow-smalltoolbar-icons li span *").attr("tabindex",-1),i.$mars(t.Loader.$mars(r.currentTarget).find("span")[0].firstChild).attr("tabindex",0),t.Loader.$mars(".lpath-gt-flow-bubble-item").removeClass("active"),f.addClass("active"),f.find(".lapth-gt-bubble-main-div").focus()):(t.Loader.$mars(".lpath-sidebar-floweditor.active #lpath-gt-flow-smalltoolbar-icons li span *").attr("tabindex",-1),i.$mars(t.Loader.$mars(r.currentTarget).find("span")[0].firstChild).attr("tabindex",0),i.App.lPathDesignerContainer.find(".lpath-control-tooltab-button:tabbable").focus(),t.Loader.$mars(".lpath-gt-flow-bubble-item.active").find("#lpath-gt-flow-smalltoolbar-icons").hide())):r.keyCode==i.Utility.KeyCodeEnum.DownArrowKey?u.nextAll("li:not(.lpath-gt-bubble-toolbar-disable)").length>0&&u.nextAll("li:not(.lpath-gt-bubble-toolbar-disable)")[0].firstChild.focus():r.keyCode==i.Utility.KeyCodeEnum.UpArrowKey?u.prevAll("li:not(.lpath-gt-bubble-toolbar-disable)").length>0&&u.prevAll("li:not(.lpath-gt-bubble-toolbar-disable)")[0].firstChild.focus():n.Client.Loader.appContext.Util.isEnterPressed(r,!0)&&u[0].firstChild.click(),r.preventDefault(),r.stopPropagation(),!0},f}(BackboneMars.View);r.StepItemView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(i){function r(){i.apply(this,arguments)}return __extends(r,i),r.prototype.SkinnyToolbarView=function(){this.controlCreated=arguments[1]},r.prototype.build=function(){try{i.prototype.build.call(this);this.initializeControls();this.openSetupView();this.enableDisablePreviewAndSetting();this.subscribeLPathContainerMouseUpEvent();this.handlingForHighContrast()}catch(t){n.Loader.marsExceptionHandler.execute(t.name,t.message)}},r.prototype.getTemplate=function(){return t.Util.Constants.skinnyToolbarViewTemplate},r.prototype.initializeControls=function(){n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:initializeControls START");try{this.skinnyToolbarBlock=this.rootElement.find('div[id="lPathskinnyToolbarContainer"]');this.skinnyToolbar=this.rootElement.find('div[id="lPathSkinnyToolbar"]');this.skinnyToolbar.addClass("lpath-skinnytoolbar-edit-mode");this.settingsViewSelector=this.rootElement.find('button[id="lPathSkinnyToolbarSettingsButton"]');this.previewSelector=this.rootElement.find('button[id="lPathSkinnyToolbarPreviewButton"]');this.checkinButton=this.rootElement.find('button[id="lPathSkinnyToolbarCheckinButton"]');this.publishButton=this.rootElement.find('button[id="lPathSkinnyToolbarPublishButton"]');this.editButton=this.rootElement.find('button[id="lPathSkinnyToolbarEditButton"]');this.flowEditorViewSelector=this.rootElement.find('button[id="lPathSkinnyToolbarFlowEditorButton"]');this.toggleIconSelector=this.rootElement.find('div[id="lPathToggelButton"]');this.skinnyToolbarOtherControlContainer=this.rootElement.find('div[id="lpathSkinnytoolbarOtherControlContainer"]');this.toggleArrowbutton=this.rootElement.find('button[id="lpath-mars-toggle-arrow-button"]');this.skinnyToolbarContainer=this.rootElement.find('div[id="lPathSkinnyToolbarBlock"]');this.skinnyToolbarHomeButton=this.rootElement.find('div[id="lPathSkinnyToolbarHomeIcon"]');this.lpathDesignerContainerChildren=t.App.lPathDesignerContainer.children();this.subscribeSkinnyToolBarControls();this.attachHoverEventsToToolbar();this.toggleIconSelector.hide()}catch(i){n.Loader.marsExceptionHandler.execute(i.name,i.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SkinnyToolbarView:initializeControls Exception occurred on initializing side tool bar.")}n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:initializeControls END")},r.prototype.unsubscribe=function(){i.prototype.unsubscribe.call(this);this.lpathDesignerContainerChildren.off("mouseup.PropertyTabFlyout")},r.prototype.subscribeLPathContainerMouseUpEvent=function(){this.lpathDesignerContainerChildren.off("mouseup.PropertyTabFlyout").on("mouseup.PropertyTabFlyout",this.lpathContainerMouseupEventHandling)},r.prototype.lpathContainerMouseupEventHandling=function(n){var r=t.$mars.inArray(n.target.id,["lPathPropertyTabEditButton","lPathPropertyTabEditImage"]),i=t.$mars("#lpathPropertyTabBuilderControlContainer");r==-1&&!i.is(n.target)&&i.has(n.target).length===0&&i.is(":visible")&&i.hide()},r.prototype.subscribeSkinnyToolBarControls=function(){n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:subscribeSkinnyToolBarControls START");try{var t=this;this.subscribe(this.skinnyToolbarHomeButton,"click",this.onHomeIconClick);this.subscribe(this.previewSelector,"click",this.onPreviewClick,!0);this.subscribe(this.editButton,"click",this.onEditClick,!0);this.subscribe(this.settingsViewSelector,"click",this.onSettingButtonClick,!0);this.subscribe(this.publishButton,"click",this.onPublishButtonClick,!0);this.subscribe(this.checkinButton,"click",this.onCheckinButtonClick,!0);this.subscribe(this.flowEditorViewSelector,"click",this.onflowEditorButonClick,!0);this.subscribe(this.toggleIconSelector,"click",this.onToggleIconClick);this.subscribe(this.skinnyToolbarContainer,"click",function(){t.setFocusOnHome(t)});n.Designer.App.lPathDesignerContainer.find("#lPathDesignerOverlay").off("click").on("click",function(n){n.target.getAttribute("id")==="lPathDesignerOverlay"&&t.setFocusOnHome(t)});this.setShortcutKeys()}catch(i){n.Loader.marsExceptionHandler.execute(i.name,i.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SkinnyToolbarView:subscribeSkinnyToolBarControls Exception occurred on subscribing side tool bar controls.")}n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:subscribeSkinnyToolBarControls END")},r.prototype.attachHoverEventsToToolbar=function(){n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Attaching events START");try{var i=this,r="active",u="inactive";this.flowEditorViewSelector.off("focus mouseover").on("focus mouseover",function(t){i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarActiveFlowEditor,r);t.type==="focus"&&(i.focusElementImg=n.Loader.marsImageMapping.ImagePath.toolbarActiveFlowEditor)});this.settingsViewSelector.off("focus mouseover").on("focus mouseover",function(t){i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarActiveSettings,r);t.type==="focus"&&(i.focusElementImg=n.Loader.marsImageMapping.ImagePath.toolbarActiveSettings)});this.previewSelector.off("focus mouseover").on("focus mouseover",function(t){i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarActivePreview,r);t.type==="focus"&&(i.focusElementImg=n.Loader.marsImageMapping.ImagePath.toolbarActivePreview)});this.publishButton.off("focus mouseover").on("focus mouseover",function(t){i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarActivePublish,r);t.type==="focus"&&(i.focusElementImg=n.Loader.marsImageMapping.ImagePath.toolbarActivePublish)});this.checkinButton.off("focus mouseover").on("focus mouseover",function(t){i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarActivecheckin,r);t.type==="focus"&&(i.focusElementImg=n.Loader.marsImageMapping.ImagePath.toolbarActivecheckin)});this.editButton.off("focus mouseover").on("focus mouseover",function(t){i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarActiveEdit,r);t.type==="focus"&&(i.focusElementImg=n.Loader.marsImageMapping.ImagePath.toolbarActiveEdit)});this.flowEditorViewSelector.off("focusout mouseout").on("focusout mouseout",function(){i.rootElement.find('div[id="lPathEditFlowContainer"]').length<=0&&i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarInactiveFlowEditor,u)});this.settingsViewSelector.off("focusout mouseout").on("focusout mouseout",function(){i.rootElement.find('div[id="lPathControlSetupView"]').length<=0&&i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarInactiveSetting,u)});this.previewSelector.off("focusout mouseout").on("focusout mouseout",function(){i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarInactivePreview,u)});this.publishButton.off("focusout mouseout").on("focusout mouseout",function(){i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarInactivePublish,u)});this.checkinButton.off("focusout mouseout").on("focusout mouseout",function(){i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarInactivecheckin,u)});this.editButton.off("focusout mouseout").on("focusout mouseout",function(){i.handleToolbarElementStates(this,n.Loader.marsImageMapping.ImagePath.toolbarInactiveEdit,u)});this.skinnyToolbarHomeButton.off("keydown").on("keydown",function(n){if(n.keyCode==t.Utility.KeyCodeEnum.TabKey)return n.shiftKey?(i.attachFocusOnTabbingHomeButton(),!1):!0})}catch(f){n.Loader.marsExceptionHandler.execute(f.name,f.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SkinnyToolbarView: Exception occurred while attaching events")}n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Attaching events END")},r.prototype.setFocusOnHome=function(n){n.skinnyToolbarHomeButton.find("#lPathSkinnyToolbarHomeButton")[0].focus()},r.prototype.attachFocusOnTabbingHomeButton=function(){n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Home Button sift tab key press START");try{var t=this;t.rootElement.find('div[id="lPathEditSidebarHolder"]').length>0?t.rootElement.find('img[id="lPathFooterContentFeedback"]').focus():t.rootElement.find('div[id="lPathPreviewSidebarHolder"]').length>0?t.rootElement.find('img[id="feedbackBtn"]').focus():t.rootElement.find('div[id="lPathAdvancedOptions"]').hasClass("lpath-setup-advance-option-disable")?t.rootElement.find('button[id="lPathControlSetupCancel"]').focus():t.rootElement.find('div[id="lPathAdvancedOptions"]').focus()}catch(i){n.Loader.marsExceptionHandler.execute(i.name,i.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SkinnyToolbarView: Exception occurred while sift tab key press on home button")}n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView::Home Button sift tab key press END")},r.prototype.handleToolbarElementStates=function(t,i,r){var u,f;n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Element status START");try{u=this.rootElement.find(".lpath-skinnytoolbar-operations *:focus");t=this.rootElement.find(t);t&&(f=t.find("img"),f.attr("src",n.Loader.serverUrl+"images/"+i),r==="active"?t.hasClass("lpath-skinnytoolbar-active-button")||t.addClass("lpath-skinnytoolbar-active-button"):u.attr("id")!==t.attr("id")&&t.hasClass("lpath-skinnytoolbar-active-button")?t.removeClass("lpath-skinnytoolbar-active-button"):(u.hasClass("lpath-skinnytoolbar-active-button")||u.addClass("lpath-skinnytoolbar-active-button"),u.find("img").attr("src",n.Loader.serverUrl+"images/"+this.focusElementImg)))}catch(e){n.Loader.marsExceptionHandler.execute(e.name,e.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SkinnyToolbarView: Exception occurred while toolbar control changing status")}n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Element status END")},r.prototype.onHomeIconClick=function(){n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:onHomeIconClick START");try{this.close()}catch(t){n.Loader.marsExceptionHandler.execute(t.name,t.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SkinnyToolbarView:onHomeIconClick Exception occurred in side toolbar, on click of MARS Icon.")}n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:onHomeIconClick END")},r.prototype.setupViewSaveCallback=function(){},r.prototype.onToggleIconClick=function(){},r.prototype.openSetupView=function(){},r.prototype.onSettingButtonClick=function(){},r.prototype.onPublishButtonClick=function(){},r.prototype.onCheckinButtonClick=function(){},r.prototype.onflowEditorButonClick=function(){},r.prototype.onPreviewClick=function(){n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Preview skinnytoolbar START");try{this.showButtonsOnPreviewClick();this.settingsViewSelector.removeClass("lpath-skinnytoolbar-active-button");this.settingsViewSelector.find("img").attr("src",n.Loader.serverUrl+"images/"+n.Loader.marsImageMapping.ImagePath.toolbarInactiveSetting)}catch(t){n.Loader.marsExceptionHandler.execute(t.name,t.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SkinnyToolbarView: Exception occurred while previewing in skinny toolbar.")}n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Preview skinnytoolbar END")},r.prototype.onEditClick=function(){n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Edit skinnytoolbar START");try{this.showButtonsOnEditClick();var r=this.getCurrentControlValue();r.ControlType===t.Utility.ControlTypes.Sidebar?this.rootElement.find("#lPathEditHeader").focus():(this.settingsViewSelector.removeClass("lpath-skinnytoolbar-active-button"),this.settingsViewSelector.find("img").attr("src",n.Loader.serverUrl+"images/"+n.Loader.marsImageMapping.ImagePath.toolbarInactiveSetting),this.flowEditorViewSelector.addClass("lpath-skinnytoolbar-active-button"),this.flowEditorViewSelector.find("img").attr("src",n.Loader.serverUrl+"images/"+n.Loader.marsImageMapping.ImagePath.toolbarActiveFlowEditor))}catch(i){n.Loader.marsExceptionHandler.execute(i.name,i.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SkinnyToolbarView: Exception occurred while previewing in skinny toolbar.")}n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Edit skinnytoolbar END")},r.prototype.showButtonsOnPreviewClick=function(){n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Preview skinnytoolbar buttons START");try{this.skinnyToolbar.hasClass("lpath-skinnytoolbar-preview-mode")||(this.skinnyToolbar.addClass("lpath-skinnytoolbar-preview-mode"),this.toggleArrowbutton.show());this.skinnyToolbar.hasClass("lpath-skinnytoolbar-edit-mode")&&this.skinnyToolbar.removeClass("lpath-skinnytoolbar-edit-mode")}catch(t){n.Loader.marsExceptionHandler.execute(t.name,t.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SkinnyToolbarView:Exception occurred while previewing in skinnytoolbar buttons.")}n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Preview skinnytoolbar buttons END")},r.prototype.showButtonsOnEditClick=function(){n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView: Show skinnytoolbar edit buttons START");try{this.skinnyToolbar.hasClass("lpath-skinnytoolbar-edit-mode")||this.skinnyToolbar.addClass("lpath-skinnytoolbar-edit-mode");this.skinnyToolbar.hasClass("lpath-skinnytoolbar-preview-mode")&&this.skinnyToolbar.removeClass("lpath-skinnytoolbar-preview-mode")}catch(t){n.Loader.marsExceptionHandler.execute(t.name,t.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SkinnyToolbarView:Exception occurred while showing sidebar edit buttons.")}n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:Show skinnytoolbar edit buttons END")},r.prototype.enableDisablePreviewAndSetting=function(){var i=this.getCurrentControlValue();i.ControlId===t.Util.Constants.EmptyGuid?(this.settingsViewSelector.attr("disabled",!0),this.previewSelector.attr("disabled",!0)):(this.settingsViewSelector.attr("disabled",!1),this.previewSelector.attr("disabled",!1),this.settingsViewSelector.removeAttr("disabled"),this.settingsViewSelector.removeClass("lpath-skinnytoolbar-active-button"),this.settingsViewSelector.find('img[id="lPathSkinnyToolbarSettingsImg"]').attr("src",n.Loader.serverUrl+"images/"+t.Utility.ImageMapping.ImagePath.toolbarInactiveSetting))},r.prototype.getSettingRootElement=function(){return this.settingContainer=null,t.$mars("#lPathSettingViewContainer").length<=0?(this.settingContainer=t.$mars("<div id='lPathSettingViewContainer' role='dialog'><\/div>"),this.skinnyToolbarOtherControlContainer.append(this.settingContainer)):this.settingContainer=t.$mars("#lPathSettingViewContainer"),this.settingContainer},r.prototype.setShortcutKeys=function(){var r=this,i=[];n.Loader.$mars(document).off("keydown").on("keydown",function(i){i.altKey&&i.ctrlKey&&i.keyCode==t.Utility.KeyCodeEnum.TKey&&n.Loader.$mars('div[id="lPathToggelButton"]').click()});n.Loader.$mars(this.skinnyToolbar).off("keyup").on("keyup",function(){i=jQuery.unique(i);i[0]==t.Utility.KeyCodeEnum.Altkey&&i[1]==t.Utility.KeyCodeEnum.MKey&&i[2]==t.Utility.KeyCodeEnum.WKey&&i.length==3&&r.onHomeIconClick();i=[]});t.Util.Common.attachEventToElement(n.Loader.$mars(this.skinnyToolbar),"keydown.skinnyDefaultFocus")},r.prototype.close=function(){try{i.prototype.close.call(this);t.App.show()}catch(r){n.Loader.marsExceptionHandler.execute(r.name,r.message)}},r.prototype.handlingForHighContrast=function(){this.isHighContrastWhiteModeEnabled()&&this.rootElement.find("#lpathHomeLogoImg").attr("src",""+n.Loader.serverUrl+"images/"+n.Loader.marsImageMapping.ImagePath.toolbarHome_HighContrastWhite)},r.prototype.isHighContrastModeEnabled=function(){return t.$mars("#checkHighContrastDiv").css("background-image")==="none"},r.prototype.isHighContrastWhiteModeEnabled=function(){return this.isHighContrastModeEnabled()&&t.$mars("body").css("background-color")==="rgb(255, 255, 255)"},r}(i.ControlView);i.SkinnyToolbarView=r})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t){u.call(this,n,t);this.rootElement=n;this.params=t;this.settingModeViewName="settingModeView";this.previewModeViewName="previewModeView";this.editModeViewName="editModeSettingsView";this.controlCreated=t.controlCreated}return __extends(f,u),f.prototype.build=function(){try{u.prototype.build.call(this);this.addRequiredHoldersToRenderSidebar();i.App.showLPathDesignerOverlay();this.initializeSidebarSkinnyToolbar();this.triggerNavigation()}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message)}},f.prototype.show=function(){u.prototype.show.call(this);this.setupViewInstance?this.setupViewInstance.setFocusOnLoad():this.editModeSidebarSkinnyToolbarInstance&&this.setupViewInstance.setFocusOnLoad()},f.prototype.onHomeIconClick=function(){var r,f,n;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Home Click START");try{this.controlCreated&&(n=this.getCurrentControlValue(),n.ControlId==i.Util.Constants.EmptyGuid||n.CreateTelemetry||i.App.trackActivity(n,window._MicrosoftMars.Client.Telemetry.EndAction.created));r=this;this.isControlModelValueUpdated()?(n=this.getCurrentControlValue(),f=n.ControlType===i.Utility.ControlTypes.Sidebar?i.Locale.unSavedChangesPopupMessage:i.Locale.unSavedGTChangesPopupMessage,i.Util.Common.showAlertMessage(i.Locale.unSavedChangesPopupTitle,f,this.rootElement,!0,i.Locale.deleteChangesCaption,i.Locale.stayOnPageCaption,function(){r.close()},function(){r.skinnyToolbarHomeButton.find("#lPathSkinnyToolbarHomeButton").focus()})):u.prototype.onHomeIconClick.call(this)}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSkinnyToolbarView:Exception occurred on clicking Home Icon")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Home click END")},f.prototype.onCancelCallback=function(){this.close()},f.prototype.onSettingButtonClick=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Setting Click START");try{var n=this;this.isControlModelValueUpdated()?i.Util.Common.showAlertMessage(i.Locale.unSavedChangesPopupTitle,i.Locale.unSavedChangesPopupMessage,this.rootElement,!0,i.Locale.deleteChangesCaption,i.Locale.stayOnPageCaption,function(){n.toggleSidebarView(n.settingModeViewName)},function(){n.settingsViewSelector.focus()}):this.toggleSidebarView(this.settingModeViewName)}catch(r){t.Loader.marsExceptionHandler.execute(r.name,r.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSkinnyToolbarView:Exception occurred on clicking Setting Icon")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Setting click END")},f.prototype.isControlModelValueUpdated=function(){var t=this,n=!1;return t.setupViewInstance?n=this.setupViewInstance.isCurrentModelValueUpdated():t.editModeSidebarSkinnyToolbarInstance&&(n=this.editModeSidebarSkinnyToolbarInstance.isCurrentModelValueUpdated()),n},f.prototype.onPreviewClick=function(){var r,u,f;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Preview sidebar START");try{r=this;this.isControlModelValueUpdated()?(f=this.getCurrentControlValue(),u=f.ControlType===i.Utility.ControlTypes.Sidebar?i.Locale.unSavedChangesPopupMessage:i.Locale.unSavedGTChangesPopupMessage,i.Util.Common.showAlertMessage(i.Locale.unSavedChangesPopupTitle,u,this.rootElement,!0,i.Locale.deleteChangesCaption,i.Locale.stayOnPageCaption,function(){r.toggleSidebarView(r.previewModeViewName);r.disableNonActionableElements(r);r.attachKeyboardEventsForPreviewMode(r)},function(){r.previewSelector.focus()})):(r.toggleSidebarView(r.previewModeViewName),r.disableNonActionableElements(r),r.attachKeyboardEventsForPreviewMode(r),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Sidebar previewed successsully"))}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSkinnyToolbarView:Exception occurred while previewing in sidebar.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Preview sidebar END")},f.prototype.disableNonActionableElements=function(n){n.rootElement.find('[data-disabledInPreview="true"]').attr("tabindex","-1")},f.prototype.attachKeyboardEventsForPreviewMode=function(n){var r=n.sidebarPreviewHtmlHolder.find(":visible :tabbable:last");t.Loader.$mars("#lPathSkinnyToolbarEditButton").off("keydown");r.length==0&&(r=t.Loader.$mars("#lPathSkinnyToolbarEditButton"));r.off("keydown").on("keydown",function(t){t.keyCode!=i.Utility.KeyCodeEnum.TabKey||t.shiftKey||(n.skinnyToolbarHomeButton.find("#lPathSkinnyToolbarHomeButton").focus(),t.preventDefault(),t.stopPropagation())});n.skinnyToolbarHomeButton.find("#lPathSkinnyToolbarHomeButton").off("keydown").on("keydown",function(n){n.keyCode==i.Utility.KeyCodeEnum.TabKey&&n.shiftKey&&(r[0].focus(),n.preventDefault(),n.stopPropagation())})},f.prototype.onEditClick=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Show edit sidebar START");try{this.toggleSidebarView(this.editModeViewName);u.prototype.onEditClick.call(this)}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSkinnyToolbarView:Exception occurred while showing edit sidebar.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Show edit sidebar END")},f.prototype.onPublishButtonClick=function(){var n=this;this.publishCurrentControl(function(){n.publishButton.focus();var t=new r.SimpleDialogView({},n.rootElement,"PublishPopUp",i.Locale.publishSuccessAlertTitle,i.Locale.publishSuccessAlertMessage);t.cancelElementFocus=n.publishButton.focus();t.show();t.ariaDescribedById="PublishPopUp"},function(){n.publishButton.focus();var t=new r.SimpleDialogView({},n.rootElement,"PublishPopUp",i.Locale.publishFailureAlertTitle,i.Locale.publishFailureAlertMessage);t.cancelElementFocus=n.publishButton.focus();t.ariaDescribedById="PublishPopUp";t.show()})},f.prototype.onCheckinButtonClick=function(){var n=this;this.checkinCurrentControl(!1,function(){n.checkinButton.focus()})},f.prototype.triggerNavigation=function(){var e=this.getCurrentControlValue(),r=i.Util.Common.getContextTypeMetadata(e,i.Utility.ContextTypeMetaData.PageNavigationInfo)[0],o=t.Loader.appContext.getPageNavigationInfo(),f,u;r&&JSON.parse(r)&&(f=n.Client.Loader.appContext.compareNavInfo(JSON.parse(r),o),f||(u=JSON.parse(r),u.callback=function(){i.App.ResetPageTitleToProduct()},t.Loader.appContext.navigateToPage(u)))},f.prototype.openSetupView=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Showing Setup View START");try{var u=this.getSettingRootElement(),r=this.getCurrentControlValue(),n=r.ControlId===i.Util.Constants.EmptyGuid?i.Locale.newCaption+" ":r.ControlName+" ";n=r.ControlType==i.Utility.ControlTypes.Sidebar?n+i.Locale.sidebarSettings:n+i.Locale.guidedTaskSettings;u.attr("aria-label",n);this.setupViewInstance=this.onSetupViewInitialize(u);this.setupViewInstance.show();this.settingsViewSelector.hasClass("lpath-skinnytoolbar-active-button")||this.settingsViewSelector.removeClass("lpath-skinnytoolbar-active-button");this.settingsViewSelector.find('div[id="lPathSkinnyToolbarSettingsImg"]').attr("src",t.Loader.serverUrl+"images/"+i.Utility.ImageMapping.ImagePath.toolbarInactiveSetting)}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSkinnyToolbarView:Exception occurred while showing setupview.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Hiding Setup View END")},f.prototype.onSetupViewInitialize=function(n){var t=this;return new r.SidebarSetupView(n,function(){t.setupViewSaveCallback(t)})},f.prototype.setupViewSaveCallback=function(n){this.setupViewInstance=null;n.enableDisablePreviewAndSetting();this.toggleSidebarView(this.editModeViewName)},f.prototype.renderEditModeSidebar=function(n){var u,f;n.sidebarTemplateHolder.hide();n.cleanSidebarTemplateHolder();n.sidebarEditHtmlHolder=this.rootElement.find("#lPathEditSidebarHolder");n.sidebarEditHtmlHolder.length==0&&(u=i.$mars('<div id="lPathEditSidebarHolder" class="lpath-sidebar-edit-holder"><\/div>'),n.sidebarTemplateHolder.append(u),n.sidebarEditHtmlHolder=this.sidebarTemplateHolder.find("#lPathEditSidebarHolder"));this.editModeSidebarSkinnyToolbarInstance=new r.SidebarEditorView(n.sidebarEditHtmlHolder,{controlCreated:this.controlCreated});n.sidebarTemplateHolder.show();this.sidebarTemplateHolder.css("visibility","visible");this.editModeSidebarSkinnyToolbarInstance.show();this.editModeSidebarSkinnyToolbarInstance.setFocusOnLoad();window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg");this.attachKeyboardEventsForEditMode();t.Loader.$mars("#lpathSidebarTemplateHolder").attr("role","dialog");f=this.getCurrentControlValue().ControlName+" "+i.Locale.sidebarEditor;t.Loader.$mars("#lpathSidebarTemplateHolder").attr("aria-label",f)},f.prototype.attachKeyboardEventsForEditMode=function(){var n=this.rootElement.find("#lPathSidebarSectionContainer").find(":tabbable:last"),t=this.rootElement.find("#lPathSkinnyToolbarHomeButton");n.off("keydown").on("keydown",function(n){n.keyCode!=i.Utility.KeyCodeEnum.TabKey||n.shiftKey||(t.focus(),n.preventDefault(),n.stopPropagation())});t.off("keydown").on("keydown",function(t){t.keyCode==i.Utility.KeyCodeEnum.TabKey&&t.shiftKey&&(n[0].focus(),t.preventDefault(),t.stopPropagation())})},f.prototype.getSidebarPreviewTemplate=function(u){u===void 0&&(u=!1);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Getting preview sidebar template START");try{var f=this.getCurrentControlValue(),o=i.Util.Common.getPreviewTemplateName(f.MetadataJson.Template),s=r.TemplateEngine.applyTemplate(o,f,!0,u);return n.Client.Utility.Util.decodeSpecialCharacters(s)}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSkinnyToolbarView:Exception occurred while getting sidebar preview template.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Getting preview sidebar template END")},f.prototype.renderPreviewModeSidebar=function(){var e,r,f,o,s;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView: Sidebar renderPreviewModeSidebar START");try{for(this.sidebarPreviewHtmlHolder=this.rootElement.find("#lPathPreviewSidebarHolder"),this.sidebarPreviewHtmlHolder.length==0&&(e=i.$mars('<div id="lPathPreviewSidebarHolder" class="lpath-sidebar-preview-holder" role="region" aria-label="'+i.Locale.sidebarPreview+'"><\/div>'),this.sidebarTemplateHolder.append(e),this.sidebarPreviewHtmlHolder=this.rootElement.find("#lPathPreviewSidebarHolder")),r=this.getCurrentControlValue(),f=0;f<r.LanguageControlVersionContents.length;f++)r.LanguageControlVersionContents[f].Lcid===r.BaseLcid&&(r.LanguageControlVersionContents=i.Util.Common.updateHTMLViewContent(r.LanguageControlVersionContents,r.BaseLcid,r.LanguageControlVersionContents[f].HtmlView,"/// <![CDATA[/g",""),r.LanguageControlVersionContents=i.Util.Common.updateHTMLViewContent(r.LanguageControlVersionContents,r.BaseLcid,r.LanguageControlVersionContents[f].HtmlView,"/// ]\]>/g",""));u.prototype.onPreviewClick.call(this);o=this.getSidebarPreviewTemplate(!0);this.sidebarPreviewHtmlHolder.children().remove();this.sidebarPreviewHtmlHolder.append(o);n.Client.Utility.FFFUtility.isFeatureEnabled(n.Client.Utility.FFFUtility.LiveChatFeatureName)||window._MicrosoftMars.AnswerPanel.removeLiveChat(this.sidebarPreviewHtmlHolder);this.sidebarTemplateHolder.show();this.handleSidebarViews(r);this.sidebarTemplateHolder.addClass("lpath-preview-sidebar");this.sidebarTemplateHolder.append(this.sidebarPreviewHtmlHolder);t.Loader.appContext.ClientType==i.Util.Constants.MobileClientType&&this.sidebarTemplateHolder.css("height","100%");window._MicrosoftMars.AnswerPanel.replaceCallMeLiveChatIcons(this.sidebarTemplateHolder,"sidebarFooterChatEdit","sidebarFooterCallMeEdit");window._MicrosoftMars.AnswerPanel.attachEventsToSidebar();window._MicrosoftMars.AnswerPanel.setAnswerPanelHeader("lPathPreviewSidebarHolder",r.MetadataJson.IsSideBarHeaderDisabled,r.MetadataJson.IsSideBarTitleDisabled,r.MetadataJson.IsSideBarFooterDisabled,r.MetadataJson.IsFooterSectionAvailable,!0);window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg");this.sidebarTemplateHolder.find("#marsSearchImage").find("svg").attr("focusable","false");this.attachToggleButtonEvent();t.Loader.$mars("#lpathSidebarTemplateHolderskinny").attr("role","dialog");s=this.getCurrentControlValue().ControlName+" "+i.Locale.sidebarPreview;t.Loader.$mars("#lpathSidebarTemplateHolder").attr("aria-label",s)}catch(h){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception in rendering preview mode from Sidebar");t.Loader.marsExceptionHandler.execute(h.name,h.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView: Sidebar PreviewMode END");this.handlingForHighContrast()},f.prototype.setDefaultFocusInPreviewModeSidebar=function(){var n=this.sidebarPreviewHtmlHolder.find(":visible :tabbable").not("[data-disabledInPreview]").first();n.length!=0?n.focus():this.rootElement.find("#lPathSkinnyToolbarHomeButton").focus()},f.prototype.handlingForHighContrast=function(){var i,r,u;this.isHighContrastModeEnabled()&&(this.isHighContrastWhiteModeEnabled()&&this.rootElement.find("#lpathHomeLogoImg").attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarHome_HighContrastWhite),this.sidebarTemplateHolder&&(i=this.isHighContrastWhiteModeEnabled()?n.Client.Loader.marsImageMapping.ImagePath.sidebarContextHomeIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.sidebarContextHomeIconInHCB,this.sidebarTemplateHolder.find("#home-icon").attr("src",n.Client.Loader.serverUrl+"images/"+i),r=this.isHighContrastWhiteModeEnabled()?n.Client.Loader.marsImageMapping.ImagePath.sidebarSmileyIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.sidebarSmileyIconInHCB,this.sidebarTemplateHolder.find("#feedbackBtn").attr("src",n.Client.Loader.serverUrl+"images/"+r),u=this.isHighContrastWhiteModeEnabled()?n.Client.Loader.marsImageMapping.ImagePath.closeIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.closeIconInHighContrast,this.sidebarTemplateHolder.find("#closeButton").attr("src",n.Client.Loader.serverUrl+"images/"+u)))},f.prototype.attachToggleButtonEvent=function(){this.sidebarTemplateHolder.find(".lpath-toggleImage").parent().off("click").on("click",i.Util.Common.onToggleClick);this.sidebarTemplateHolder.find(".lpath-toggleImage").parent().off("keypress").on("keypress",i.Util.Common.onToggleClick)},f.prototype.toggleSidebarView=function(n){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Toggle Sidebar View START");try{this.setSidebarHolderCss();switch(n){case this.settingModeViewName:this.toggleSetupViewAndEditModeSidebar();break;case this.editModeViewName:this.cleanSidebarTemplateHolder();this.setupViewInstance&&(this.setupViewInstance.close(),this.setupViewInstance=null);this.triggerNavigation();this.renderEditModeSidebar(this);break;case this.previewModeViewName:this.editModeSidebarSkinnyToolbarInstance&&(this.editModeSidebarSkinnyToolbarInstance.close(),this.editModeSidebarSkinnyToolbarInstance=null);this.setupViewInstance&&(this.setupViewInstance.close(),this.setupViewInstance=null);this.triggerNavigation();this.cleanSidebarTemplateHolder();this.renderPreviewModeSidebar();this.sidebarTemplateHolder.css("visibility","visible");this.setDefaultFocusInPreviewModeSidebar()}}catch(i){t.Loader.marsExceptionHandler.execute(i.name,i.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSkinnyToolbarView:Exception occurred while toggling sidebar view.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:Toggle Sidebar View END")},f.prototype.handleSidebarViews=function(t){var i="calc( 0px ",r;t.MetadataJson.IsSideBarHeaderDisabled&&n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find(".lpath-search-subcontainer").length>0&&(i=i+" + "+n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find(".lpath-search-subcontainer").css("height"),n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find(".lpath-search-subcontainer").css("display","none"));t.MetadataJson.IsSideBarTitleDisabled&&n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find(".lpath-header-sidebar-container").length>0&&(i=i+" + "+n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find(".lpath-header-sidebar-container").css("height"),n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find(".lpath-header-sidebar-container").css("display","none"));t.MetadataJson.IsSideBarFooterDisabled&&(i=i+" + "+n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find("#lPathFooterSectionHolder").css("height"),n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find("#lPathFooterSectionHolder").css("display","none"));i!="calc( 0px "&&n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find("#lPathSidebarSectionContainer").length>0&&(r=n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find("#lPathSidebarSectionContainer").css("height"),r&&(i=i+" + "+r),n.Client.Loader.$mars("#lPathPreviewSidebarHolder").find("#lPathSidebarSectionContainer").attr("style","height:"+i+");"))},f.prototype.setSidebarHolderCss=function(){var n=this.getCurrentControlValue(),t=n.MetadataJson.Template;i.Util.Common.handleSidebarTemplateHolderCSS(t,this.sidebarTemplateHolder)},f.prototype.initializeSidebarSkinnyToolbar=function(){i.$mars("#lPathskinnyToolbarContainer").addClass("lpath-sidebar-skinnytoolbar")},f.prototype.addRequiredHoldersToRenderSidebar=function(){try{if(this.sidebarTemplateHolder=this.rootElement.find("#lpathSidebarTemplateHolder"),this.sidebarTemplateHolder.length==0){var n=t.Loader.$mars('<div id="lpathSidebarTemplateHolder"  class="lpath-sidebar-templateholder" />');n.css("z-index",i.App.lPathDesignerContainerZIndex+1);this.rootElement.append(n);this.sidebarTemplateHolder=this.rootElement.find("#lpathSidebarTemplateHolder")}}catch(r){t.Loader.marsExceptionHandler.execute(r.name,r.message)}},f.prototype.toggleSetupViewAndEditModeSidebar=function(){var n=this.getCurrentControlValue();this.setupViewInstance?(this.setupViewInstance.close(),this.setupViewInstance=null,n.ControlType==i.Utility.ControlTypes.Sidebar&&(this.renderEditModeSidebar(this),this.sidebarTemplateHolder.css("visibility","visible"))):(this.openSetupView(),this.cleanSidebarTemplateHolder(),n.ControlType==i.Utility.ControlTypes.Sidebar&&this.editModeSidebarSkinnyToolbarInstance&&(this.editModeSidebarSkinnyToolbarInstance.close(),this.editModeSidebarSkinnyToolbarInstance=null),this.sidebarTemplateHolder.css("visibility","hidden"))},f.prototype.cleanSidebarTemplateHolder=function(){this.sidebarTemplateHolder.children().remove()},f}(r.SkinnyToolbarView);r.SidebarSkinnyToolbarView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t,i){u.call(this,n);this.saveCallback=t;this.cancelCallback=i}return __extends(f,u),f.prototype.build=function(){try{u.prototype.build.call(this);this.initializeControls();this.initializeMultiSelect();this.bindValues();this.attachEvents();this.setShortcutKeys();this.enableDisableAdvancedOptions()}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message)}},f.prototype.setFocusOnLoad=function(){this.rootElement.find("#lPathControlName").focus()},f.prototype.initializeControls=function(){this.selectedFormFactors=[];this.availableFormFactors=[];this.initializeFormFactors();this.FormFactorEnum=i.Utility.FormFactorEnum;this.prepareFormFactors();this.setFocusOnLoad();this.updateSetupViewHeight();this.resetSetupViewHeight();this.multiselectAttchChangeEvent()},f.prototype.initializeFormFactors=function(){var r=this.getCurrentControlValue();this.availableFormFactors=n.Client.Loader.appContext.getAvailableFormFactors();this.selectedFormFactors=r.Contexts.length>0&&r.Contexts[0].ContextGroup.ContextGroupElements?i.Util.Common.getContextTypeMetadata(r,i.Utility.ContextTypeMetaData.FormFactor).map(Number):t.Loader.$mars.extend(!0,[],this.availableFormFactors);this.selectedFormFactorCnt=this.selectedFormFactors.length},f.prototype.prepareFormFactors=function(){var n={},r,f,t,u;for(n[i.Utility.FormFactorEnum.Desktop]="Desktop",n[i.Utility.FormFactorEnum.Tablet]="Tablet",n[i.Utility.FormFactorEnum.Phone]="Mobile",n[i.Utility.FormFactorEnum.ExtraLarge]="ExtraLarge",n[i.Utility.FormFactorEnum.Large]="Large",n[i.Utility.FormFactorEnum.Medium]="Medium",r=0;r<this.availableFormFactors.length;r++)for(t in n)if(this.availableFormFactors[r]==t){f="#lPathControlFormFactor"+n[t];this.rootElement.find(f).show();break}for(t in n)u='input[id="lPathControlFormFactor'+n[t]+'Checked"]',this.selectedFormFactors.indexOf(parseInt(t))<0?this.selectDeselectCheckbox(this.rootElement.find(u),!1):this.selectDeselectCheckbox(this.rootElement.find(u),!0)},f.prototype.selectDeselectCheckbox=function(n,t){n.prop("checked",t)},f.prototype.RemoveAnyOptionItem=function(n){for(var t=0;t<n.length;t++)n[t].Name=="*"&&n.splice(t,1);return n},f.prototype.initializeMultiSelect=function(){var h=this.getCurrentControlValue(),t=this,c=[],f,o,e,s,u;this.multiSelectLifeCycleStage=new r.MultiSelectDropDownView({},this.rootElement.find('div[id="lPathLifeCycleStage"]'),this.rootElement);this.multiSelectUserRoles=new r.MultiSelectDropDownView({},this.rootElement.find('div[id="lPathUserRole"]'),this.rootElement);f=n.Client.Loader.appContext.Util.getConfigurationData(n.Client.Loader.appContext.Util.LifeCycleStageSetting);f=t.RemoveAnyOptionItem(f);t.multiSelectLifeCycleStage.populateDropdown(f);o=i.Util.Common.getContextTypeMetadata(h,i.Utility.ContextTypeMetaData.LifecycleStage);o.length==0&&f.length>0?(c.push(f[0].Id),t.multiSelectLifeCycleStage.populateValues(c),t.lifeCycleStageField=f[0]):(t.multiSelectLifeCycleStage.populateValues(o),t.lifeCycleStageField=o);e=n.Client.Loader.appContext.Util.getConfigurationData(n.Client.Loader.appContext.Util.UserRoleSetting);e=t.RemoveAnyOptionItem(e);s=this.userRoleSettingMapperForMultiSelect(e);s.sort(this.compareUserRole);t.multiSelectUserRoles.populateDropdown(s);u=i.Util.Common.getContextTypeMetadata(h,i.Utility.ContextTypeMetaData.UserRole);u.length==0&&e.length>0||u.length==1&&u[0].toUpperCase()===i.Utility.Util.getAnyRoleUserId()?(t.isAnyRoleSelected=!0,u.length||u.push(i.Utility.Util.getAnyRoleUserId()),this.rootElement.find('input[id="anySecurityRole"]').prop("checked",!0),this.rolesButtonSelection(!0),t.userRoleField=u):(t.isAnyRoleSelected=!1,t.multiSelectUserRoles.populateValues(u),this.rootElement.find('input[id="customSecurityRoles"]').prop("checked",!0),t.userRoleField=u);this.rootElement.find("[name='lPathMultiSelectElement']").filter("a").removeAttr("href").attr("tabIndex","0").on("click",function(){return!1})},f.prototype.bindValues=function(){try{var r=this.getCurrentControlValue(),u=n.Client.Loader.appContext.getCurrentClient();this.rootElement.find('input[id="lPathControlClient"]').val(u.clientDisplayValue);this.rootElement.find('input[id="lPathControlClient"]').attr("data-name",u.clientKey);this.rootElement.find('input[id="lPathEnableSidebarCheck"]').prop("checked",!r.Enabled);this.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]').prop("checked",r.IsContextHomeSideBar);this.rootElement.find('input[id="lPathErrorControlCheck"]').prop("checked",r.IsErrorControl);this.rootElement.find('select[id="lPathControlActivates"]').val(r.MetadataJson.UITrigger);this.setStatus(r);this.onToggleContextHome(r.IsContextHomeSideBar);r.MetadataJson.Template?this.rootElement.find('select[id="lPathControlTemplate"]').val(r.MetadataJson.Template):this.rootElement.find('select[id="lPathControlTemplate"]  option[value="'+i.Util.Constants.defaultTemplate+'"]').length>0&&this.rootElement.find('select[id="lPathControlTemplate"]').val(i.Util.Constants.defaultTemplate);this.controlNameField=this.rootElement.find('input[id="lPathControlName"]').val()}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message)}},f.prototype.attachEvents=function(){var n=this;this.subscribe('input[data-name="lPathFormFactor"]',"change",function(n,t){this.handleFormFactorClick(this.rootElement.find(t))}.bind(this),!0);this.subscribe('input[data-name="lPathInfoImg"]',"mouseout",function(){t.Loader.$mars("#helpTextTable").css("display","none")}.bind(this),!0);this.subscribe('button[id="lPathControlSetupSave"]',"click",n.onSave);this.subscribe('input[id="lPathEnableHomeSidebarCheck"]',"change",this.contextHomeDialog);this.subscribe('input[id="lPathErrorControlCheck"]',"change",this.errorSidebarDialog);this.subscribe('input[name="securityrole"]',"change",this.securityRolesOptionChange)},f.prototype.handleFormFactorClick=function(n){var r;try{var f=!1,i=this.FormFactorEnum,u={lPathControlFormFactorDesktopChecked:i.Desktop,lPathControlFormFactorTabletChecked:i.Tablet,lPathControlFormFactorMobileChecked:i.Phone,lPathControlFormFactorExtraLargeChecked:i.ExtraLarge,lPathControlFormFactorLargeChecked:i.Large,lPathControlFormFactorMediumChecked:i.Medium},o=n[0].id;for(r in u)if(o==r){f=this.selectedFormFactors.indexOf(u[r])>=0;f?this.selectedFormFactorsPop(u[r]):this.selectedFormFactors.push(u[r]);break}this.updateFormFactor(n,f)}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message)}},f.prototype.selectedFormFactorsPop=function(n){if(this.selectedFormFactorCnt>1){var t=this.selectedFormFactors.indexOf(n);this.selectedFormFactors.splice(t,1)}},f.prototype.updateFormFactor=function(n,u){var o,e,f;return u?this.selectedFormFactors.length>0&&this.selectedFormFactorCnt>1?(this.selectedFormFactorCnt--,this.selectDeselectCheckbox(n,!1)):(u=!u,this.selectDeselectCheckbox(n,!0),o=this.getCurrentControlValue(),e="<div>"+i.Locale.numberOfGTFormFactorValidationMessage+"<\/div>",o.ControlType==i.Utility.ControlTypes.Sidebar&&(e="<div>"+i.Locale.numberOfSidebarFormFactorValidationMessage+"<\/div>"),f=new r.SimpleDialogView({},t.Loader.$mars("#lPathSetupPopupContainer"),i.Locale.numberOfFormFactorValidationTitle,i.Locale.numberOfFormFactorValidationTitle,e),f.addDoNotShowCheck=!1,f.showCancel=!1,f.cancelElementFocus=this.rootElement.find(n),f.okElementFocus=this.rootElement.find(n),f.show()):(this.selectDeselectCheckbox(n,!0),this.selectedFormFactors.length<=3&&this.selectedFormFactorCnt++),!u},f.prototype.setShortcutKeys=function(){var r=this,n=[];t.Loader.$mars("#lPathSkinnyToolbarBlock").off("keydown");t.Loader.$mars("#lPathSkinnyToolbarBlock").off("keyup");t.Loader.$mars("#lPathSkinnyToolbarBlock").keydown(function(t){n.push(t.keyCode)}).keyup(function(){if(n=jQuery.unique(n),n[0]==i.Utility.KeyCodeEnum.Altkey&&n[1]==i.Utility.KeyCodeEnum.MKey&&n.length==3)switch(n[2]){case i.Utility.KeyCodeEnum.OKey:r.getCurrentControlValue().ControlId!==t.Designer.Util.Constants.EmptyGuid&&t.Loader.$mars("#lPathAdvancedOptions").find('label[id="lPathSidebarAdvanceOptions"]').trigger("click");break;case i.Utility.KeyCodeEnum.WKey:t.Loader.$mars("#lPathSkinnyToolbarHomeIcon").click()}n.indexOf(i.Utility.KeyCodeEnum.CtrlKey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.Altkey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.SKey)!==-1&&r.onSave();n=[]});t.Loader.$mars("#lPathControlSetupView").off("keydown");t.Loader.$mars("#lPathControlSetupView").off("keyup");t.Loader.$mars("#lPathControlSetupView").keydown(function(t){n.push(t.keyCode);t.keyCode==i.Utility.KeyCodeEnum.EscapeKey&&t.target.focus()}).keyup(function(){if(n=jQuery.unique(n),n[0]==i.Utility.KeyCodeEnum.Altkey&&n[1]==i.Utility.KeyCodeEnum.MKey&&n.length==3)switch(n[2]){case i.Utility.KeyCodeEnum.OKey:r.getCurrentControlValue().ControlId!==t.Designer.Util.Constants.EmptyGuid&&t.Loader.$mars("#lPathAdvancedOptions").find('label[id="lPathSidebarAdvanceOptions"]').trigger("click");break;case i.Utility.KeyCodeEnum.WKey:t.Loader.$mars("#lPathSkinnyToolbarHomeIcon").click()}n.indexOf(i.Utility.KeyCodeEnum.CtrlKey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.Altkey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.SKey)!==-1&&r.onSave();n=[]})},f.prototype.enableDisableAdvancedOptions=function(){var n=this.getCurrentControlValue();this.advancedOptionsLink=this.rootElement.find('div[id="lPathAdvancedOptions"]');this.advanceViewSelector=this.rootElement.find('label[id="lPathSidebarAdvanceOptions"]');n.ControlId===i.Util.Constants.EmptyGuid?(this.advancedOptionsLink.removeClass("lpath-setup-advance-option-active"),this.advancedOptionsLink.addClass("lpath-setup-advance-option-disable")):(this.advancedOptionsLink.removeClass("lpath-setup-advance-option-disabled"),this.advancedOptionsLink.addClass("lpath-setup-advance-option-active"))},f.prototype.validate=function(r){var f=!0,h=this,e=[],c=this.rootElement.find('input[id="lPathControlName"]').val(),u="",s,o;if(c.trim()=="")e.push(i.Locale.errorMsgRequiredControlName),u=i.Locale.errorMsgTitleRequiredName,f=!1,t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.WARNING,"Validation failed.. Control name empty while creating/updating control from settings panel.");else for(s="/:*?<>|{}",o=0;o<s.length;o++)if(c.indexOf(s[o])>-1){e.push(i.Locale.errorMsgControlNameWithSpecChars);f=!1;break}return n.Client.Utility.FFFUtility.isFeatureEnabled("LifeCycleStage")&&(this.multiSelectLifeCycleStage.getSelectedValues()==""||this.lifeCycleStageField=="")&&(e.push(r?i.Locale.errorMsgOfGTRequiredLifeCycleStage:i.Locale.errorMsgOfSidebarRequiredLifeCycleStage),u=i.Locale.errorMsgRequiredLifeCycleStageTitle,f=!1),this.isAnyRoleSelected||this.multiSelectUserRoles.getSelectedValues()!=""&&this.userRoleField!=""||(e.push(r?i.Locale.errorMsgRequiredGTUserRole:i.Locale.errorMsgRequiredSideBarUserRole),u=i.Locale.errorMsgRequiredUserRoleTitle,f=!1),u=e.length==1&&u.trim()!=""?u:"",f||i.Util.Common.showErrorMessage(e,function(){h.rootElement.find('button[id="lPathControlSetupSave"]').focus()},function(){h.rootElement.find('button[id="lPathControlSetupSave"]').focus()},u),f},f.prototype.onCancel=function(){i.App.CancelCaller.viewName?i.App.show():i.App.close();this.cancelCallback&&this.cancelCallback()},f.prototype.getSelectedValues=function(r){var u,f;return r.ControlVersionId=r.ControlVersionId!==i.Util.Constants.EmptyGuid?r.ControlVersionId:i.Utility.Util.newGuid(),r.ControlId=r.ControlId!==i.Util.Constants.EmptyGuid?r.ControlId:i.Utility.Util.newGuid(),r.AuthoringId=n.Client.Loader.appContext.getAuthoringId(),r.ControlName=i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(this.rootElement.find('input[id="lPathControlName"]').val())),r.Enabled=!this.rootElement.find('input[id="lPathEnableSidebarCheck"]').is(":checked"),r.IsContextHomeSideBar=this.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]').is(":checked"),r.IsErrorControl=this.rootElement.find('input[id="lPathErrorControlCheck"]').is(":checked"),r.MetadataJson.UITrigger=t.Loader.$mars('select[id="lPathControlActivates"]').val(),u=(new i.Content.MetaDataJsonElementStructure).EventModel,u.Trigger=r.MetadataJson.UITrigger,f=[],f.push(u),r.Events=JSON.stringify(f),r=this.bindContextModelToControlModel(r),r.CreateTelemetry=r.CreateTelemetry,r},f.prototype.saveControlValues=function(r){var f=this,e=this,o=u.prototype.save.call(this,r);o.done(function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Details : Control type : "+r.ControlType+"; Id : "+r.ControlId);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Author Name : "+r.AuthorName+"; Author Id : "+r.AuthorId+"; isContextHomeSideBar : "+r.IsContextHomeSideBar);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Author Name : "+r.AuthorName+"; Author Id : "+r.AuthorId+"; isErrorControl : "+r.IsErrorControl);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"UI Trigger : "+r.MetadataJson.UITrigger+"; Template Selected : "+r.MetadataJson.Template+"; Locale : "+i.Util.Common.getContextTypeMetadata(r,i.Utility.ContextTypeMetaData.Locale));t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User Roles : "+i.Util.Common.getContextTypeMetadata(r,i.Utility.ContextTypeMetaData.UserRole));t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Life Cycle Stages : "+i.Util.Common.getContextTypeMetadata(r,i.Utility.ContextTypeMetaData.LifecycleStage));f.close();t.Loader.$mars("#lpathSidebarTemplateHolder").css("visibility","visible");n.Client.Utility.FFFUtility.isFeatureEnabled(n.Client.Utility.FFFUtility.GDPRUpdate)&&f.isAuthorNameChanged(r.AuthorId,r.AuthorName)&&f.saveUpdatedAuthorName(r);f.saveCallback&&f.saveCallback()});o.fail(function(n){n.responseJSON.ErrorCode==2627?i.Util.Common.showErrorMessage([i.Locale.errorMsgUniqueName],function(){e.rootElement.find('button[id="lPathControlSetupSave"]').focus()},function(){e.rootElement.find('button[id="lPathControlSetupSave"]').focus()},i.Locale.errorMsgTitleUniqueName):t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON)})},f.prototype.resetSetupViewHeight=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:Reset setupview height on screen resolution change START");try{var r=this;n.Client.Loader.$mars(window).off("resize.lpathsetupview").on("resize.lpathsetupview",function(){r.updateSetupViewHeight()})}catch(i){t.Loader.marsExceptionHandler.execute(i.name,i.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSetupView:Exception occurred while resetting setupview height on screen resolution change.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:Reset setupview height on screen resolution change END")},f.prototype.updateSetupViewHeight=function(){var r,i,u;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:Reset setupview height START");try{r=n.Client.Loader.$mars("body").outerHeight();this.rootElement&&(i=this.rootElement.find('div[id="lPathControlSetupView"]'),i.css("height","auto"),u=i.outerHeight(),r<u&&i.css("height","100%"))}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSetupView:Exception occurred while resetting setup view height.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:Reset setupview height END")},f.prototype.securityRolesOptionChange=function(n){var t=this.rootElement.find(n.target);t.prop("value")==="any"?this.rolesButtonSelection(!0):this.rolesButtonSelection(!1)},f.prototype.multiselectAttchChangeEvent=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:Reset setupview height on multiselect dropdown content change START");try{var i=this.rootElement.find(".lpath-multiSelectControl");this.subscribe(i,"DOMSubtreeModified",this.updateSetupViewHeight)}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSetupView:Exception occurred while resetting setup view height on multiselect dropdown content change.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:Reset setupview height on multiselect dropdown content change END")},f.prototype.setStatus=function(n){var t=n;switch(t.Status){case 4:this.rootElement.find('input[id="lPathControlStatus"]').val(i.Locale.published);this.rootElement.find('input[id="lPathControlStatus"]').attr("title",i.Locale.published);break;case 1:default:this.rootElement.find('input[id="lPathControlStatus"]').val(i.Locale.draft);this.rootElement.find('input[id="lPathControlStatus"]').attr("title",i.Locale.draft)}},f.prototype.bindContextModelToControlModel=function(r){var f,c,l,o;r=this.addSkeletonContextObjectToControlModel(r);var u=r.Contexts[0].ContextGroup.ContextGroupElements,s=n.Client.Utility.FFFUtility,e=n.Client.Loader.appContext.Util.getConfigurationData(n.Client.Loader.appContext.Util.LifeCycleStageSetting),h=[];for(f=0;f<e.length;f++)h.push(e[f].Id);return c=s.isFeatureEnabled(s.LifeCycleStageFeatureName)>0?this.multiSelectLifeCycleStage.getSelectedIds():h.join(","),u=i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.LifecycleStage,c,u,e),this.isAnyRoleSelected?u=i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.UserRole,i.Utility.Util.getAnyRoleUserId(),u):this.multiSelectUserRoles.getSelectedIds()&&(u=i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.UserRole,this.multiSelectUserRoles.getSelectedIds(),u)),u=i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.Product,n.Client.Loader.appContext.getAppName(),u),u=i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.Locale,JSON.stringify(n.Client.Loader.defaultLanguageLcid),u),l=this.selectedFormFactors,o=JSON.stringify(l.sort()),u=i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.FormFactor,o.substring(1,o.length-1),u),u=i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.ClientType,this.rootElement.find('input[id="lPathControlClient"]').attr("data-name"),u),u=i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.ProductVersion,t.Loader.appContext.getAppVersion(),u),r.Contexts[0].ContextGroup.ContextGroupElements=u,r},f.prototype.addSkeletonContextObjectToControlModel=function(n){var t,r;return n.Contexts&&n.Contexts.length==0&&(n.Contexts=[],r=new i.Content.ControlContextModel,n.Contexts.push(r),t=new i.Content.ContextGroupModel,n.Contexts[0].ContextGroup=t,n.Contexts[0].ContextGroup.ContextGroupElements=[],n.Contexts[0].Id=i.Utility.Util.newGuid(),n.Contexts[0].ContextGroup.Id=i.Utility.Util.newGuid(),n.Contexts[0].ContextGroup.Title=n.ControlName),n},f.prototype.onSave=function(){},f.prototype.contextHomeDialog=function(){},f.prototype.errorSidebarDialog=function(){},f.prototype.onToggleContextHome=function(){},f.prototype.onToggleErrorSidebar=function(){},f.prototype.errorControlDialog=function(){},f.prototype.userRoleSettingMapperForMultiSelect=function(n){for(var i=[],t=0;t<n.length;t++)n[t].IsActive&&i.push({Id:n[t].Value,Name:n[t].Name});return i},f.prototype.compareUserRole=function(n,t){return n.Name.localeCompare(t.Name)},f.prototype.rolesButtonSelection=function(n){var t=this.rootElement.find(".lpath-designer-setup-row.lpath-setup-control-role-container");this.isAnyRoleSelected=n;n?t.css("display","none"):t.css("display","inline-block");this.rootElement.find("#anySecurityRole").attr("aria-checked",n.toString());this.rootElement.find("#customSecurityRoles").attr("aria-checked",(!n).toString())},f.prototype.isAuthorNameChanged=function(i,r){try{var f=n.Client.Loader.appContext.UserName,e=n.Client.Loader.appContext.UserId;if(i.replace(/[{}]/g,"").toLowerCase()==e.replace(/[{}]/g,"").toLowerCase()&&r!=f)return!0}catch(u){console.log("Error : SetupView:isAuthorNameChanged : Failed to detect whether UserName is updated or not.");t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SetupView:isAuthorNameChanged : Failed to detect whether UserName is updated or not.")}return!1},f.prototype.updateModelWithCurrentAuthorName=function(t){var f=n.Client.Loader.appContext.UserName,e,r,u;if(t.AuthorName=f,e=t!=undefined&&t.ControlType==i.Utility.ControlTypes.GuidedTask,r=e?t.Steps:t.Sections,r.length>0)for(u=0;u<r.length;u++)r[u].AuthorName=f},f.prototype.saveUpdatedAuthorName=function(r){var f=this,e=new i.Content.UpdateAuthorModel,s=n.Client.Loader.appContext.UserName,o;e.AuthorId=r.AuthorId;e.AuthorName=s;o=u.prototype.updateAuthorName.call(this,e);o.done(function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Details : Control with name : "+r.ControlName+" and  Id : "+r.ControlId+" is updated with new AuthorName as : "+s);f.updateModelWithCurrentAuthorName(r)});o.fail(function(){console.log("Error : SetupView:saveUpdatedAuthorName : Failed to save update UserName value for controls.");i.Util.Common.showErrorMessage([i.Locale.updateAuthorNameFailed],function(){f.rootElement.find('button[id="lPathControlSetupSave"]').focus()},function(){f.rootElement.find('button[id="lPathControlSetupSave"]').focus()});t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SetupView:saveUpdatedAuthorName : Failed to save update UserName value for controls.")})},f}(r.ControlView);r.SetupView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(){u.apply(this,arguments)}return __extends(f,u),f.prototype.build=function(){u.prototype.build.call(this);this.subscribeSidebarControls();this.attachEventForAccessiblity();this.setdefaultCompareModelValue();this.HandleScrollOnZoomIn()},f.prototype.setdefaultCompareModelValue=function(){var n=this.getCurrentControlValue();this.defaultCompareModelValue=JSON.parse(JSON.stringify(this.getSelectedValues(n)))},f.prototype.subscribeSidebarControls=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SkinnyToolbarView:subscribeSkinnyToolBarControls START");try{var n=this;this.subscribe(this.advanceViewSelector,"click",n.invokeSidebarAdvancedOptionsPopup);this.subscribe('button[id="lPathControlSetupCancel"]',"click",n.onSetupCancel)}catch(i){t.Loader.marsExceptionHandler.execute(i.name,i.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSetupView:SidebarSetupViewControls Exception occurred on subscribing side tool bar controls.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:SidebarSetupViewControls END")},f.prototype.getTemplate=function(){return i.Util.Constants.sidebarSetupViewTemplate},f.prototype.attachEventForAccessiblity=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView: Attach accessiblity event START");try{var r=this;this.rootElement.find('button[id="lPathControlSetupCancel"]').off("keydown").on("keydown",function(n){if(n.keyCode==i.Utility.KeyCodeEnum.TabKey)return n.shiftKey?!0:(r.rootElement.find('div[id="lPathAdvancedOptions"]').hasClass("lpath-setup-advance-option-disable")?r.rootElement.parents('div[id="lPathSkinnyToolbar"]').find('button[id="lPathSkinnyToolbarHomeButton"]').focus():r.rootElement.find('div[id="lPathAdvancedOptions"]').focus(),!1)});this.rootElement.find('div[id="lPathAdvancedOptions"]').off("keydown").on("keydown",function(t,u){if(t.keyCode==i.Utility.KeyCodeEnum.TabKey)return t.shiftKey?!0:(r.rootElement.parents('div[id="lPathSkinnyToolbar"]').find('button[id="lPathSkinnyToolbarHomeButton"]').focus(),!1);n.Client.Loader.appContext.Util.isEnterPressed(t,!1)&&r.invokeSidebarAdvancedOptionsPopup(t,u)});this.rootElement.parents('div[id="lPathSkinnyToolbar"]').find('button[id="lPathSkinnyToolbarHomeButton"]').off("keydown").on("keydown",function(n){n.keyCode==i.Utility.KeyCodeEnum.TabKey&&n.shiftKey&&(r.rootElement.find('div[id="lPathAdvancedOptions"]').hasClass("lpath-setup-advance-option-disable")?r.rootElement.find('button[id="lPathControlSetupCancel"]').focus():r.rootElement.find('div[id="lPathAdvancedOptions"]').focus(),n.preventDefault(),n.stopPropagation())})}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSetupView: Exception occurred while attaching accessiblity event .")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:Attach accessiblity event END")},f.prototype.onSave=function(){var r,f,u;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:onSave START");try{r=this.getCurrentControlValue();r.CheckedOutByUserName=n.Client.Loader.appContext.UserName;f=r!=undefined&&r.ControlType==i.Utility.ControlTypes.GuidedTask;this.validate(f)&&(u=r.MetadataJson.Template,r=this.getSelectedValues(r),u!=""&&r.MetadataJson.Template!=u?this.validateTemplateSelection(r,u):this.saveControlValues(r))}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSetupView:onSave Exception occurred while creating/updating GT from settings panel.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:onSave END")},f.prototype.validateTemplateSelection=function(n,u){var f=this,o,e;o=this.isHighContrastModeEnabled()&&!this.isHighContrastWhiteModeEnabled()?'<div class= "lpath-float-left"><img id="warningIcon" alt="'+i.Locale.warnnigTitle+'" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon_HCB+'" />'+i.Locale.templateChangePopupContent+"<\/div>":'<div class= "lpath-float-left"><img id="warningIcon" alt="'+i.Locale.warnnigTitle+'" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon+'" />'+i.Locale.templateChangePopupContent+"<\/div>";e=new r.SimpleDialogView({},this.rootElement,"changeTemplatePopup",i.Locale.templateChangePopupTitle,o,function(){f.onChangeTemplateConfirmation(f,n)},function(){f.onCancelTemplateConfirmation(f,u)});e.showCancel=!0;e.okCaption=i.Locale.changeTemplateCaption;e.ariaDescribedById="changeTemplatePopup";e.show();t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User clicked to change template.");this.subscribe("#mars-simple-btnClose_changeTemplatePopup","click",function(){f.onCancelTemplateConfirmation(f,u)})},f.prototype.contextHomeDialog=function(){var u=this,f,n;if(u.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]').is(":checked"))f=this.isHighContrastModeEnabled()&&!this.isHighContrastWhiteModeEnabled()?'<div><img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon_HCB+'" />'+i.Locale.contextHomeMessage+"<\/div>":'<div><img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon+'" />'+i.Locale.contextHomeMessage+"<\/div>",n=new r.SimpleDialogView({},t.Loader.$mars("#lPathDesignerContainer"),"MakingContextHomeWarning",i.Locale.contextHomeWarningTitle,f,function(){u.getContextHomeData()},function(){n.okElementFocus=this.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]');n.cancelElementFocus=this.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]');u.onToggleContextHome(!1)}),n.showCancel=!0,n.ariaDescribedById="MakingContextHomeWarning",n.show();else u.onToggleContextHome(!1)},f.prototype.getContextHomeData=function(){var f=this,u=this,o=this.rootElement.find('input[id="lPathControlClient"]').attr("data-name"),s=new n.Client.Utility.ContextEngine,e=s.getControlByContext(i.Utility.ControlTypes.Sidebar,t.Loader.contextAppVersionType,t.Loader.appContext.Locale,o,!0,null);i.App.showActionOverlay();e.done(function(n){var o,s,e;if(i.App.hideActionOverlay(),o=u.getSidebarsFromCBCData(n.Result),o.length>0)s=u.getMessageForMultipleControl(o,i.Locale.multipleContextHomeMessage),e=new r.SimpleDialogView({},t.Loader.$mars("#lPathDesignerContainer"),"MultipleContextExistsWarning",i.Locale.multipleContextHomeWarningTitle,s,function(){u.onToggleContextHome(!0)},function(){u.onToggleContextHome(!1)}),e.okElementFocus=f.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]'),e.cancelElementFocus=f.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]'),e.showCancel=!0,e.ariaDescribedById="MultipleContextExistsWarning",e.show();else{u.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]').focus();u.onToggleContextHome(!0)}});e.fail(function(){i.App.hideActionOverlay();u.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]').focus();u.onToggleContextHome(!1);console.log("Unable to get context home data.");t.Loader.marsExceptionHandler.execute("contexthomeexception",t.Loader.marsLocale.unableToGetContextHome)})},f.prototype.onToggleContextHome=function(n){var r=this.getCurrentControlValue(),t=this.rootElement.find('svg[id="lPathContextHomeIcon"]');t.length===0&&(t=this.rootElement.find('img[id="lPathContextHomeIcon"]'));n||this.rootElement.find('input[id="lPathErrorControlCheck"]').is(":checked")?(n&&!this.rootElement.find('input[id="lPathErrorControlCheck"]').is(":checked")?(t.show(),t.closest("#lPathSetupControlTitle").attr("aria-label",i.Locale.homeSidebarText)):(t.hide(),t.closest("#lPathSetupControlTitle").attr("aria-label",i.Locale.sideBar)),this.rootElement.find('select[id="lPathControlActivates"]').val("click"),this.rootElement.find('select[id="lPathControlActivates"]').attr("disabled","true")):(t.hide(),t.closest("#lPathSetupControlTitle").attr("aria-label",i.Locale.sideBar),this.rootElement.find('select[id="lPathControlActivates"]').removeAttr("disabled"),this.rootElement.find('select[id="lPathControlActivates"]').val(r.MetadataJson.UITrigger),this.selectDeselectCheckbox(this.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]'),!1))},f.prototype.errorSidebarDialog=function(){var n=this,e,f,o,u;if(n.rootElement.find('input[id="lPathErrorControlCheck"]').is(":checked"))o=n.isHighContrastModeEnabled()&&!n.isHighContrastWhiteModeEnabled(),n.defaultCompareModelValue.ControlType==i.Utility.ControlTypes.GuidedTask?(f=o?'<div><img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon_HCB+'" />'+i.Locale.errorGuidedTaskMessage+"<\/div>":'<div><img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon+'" />'+i.Locale.errorGuidedTaskMessage+"<\/div>",e=i.Locale.errorGuidedTaskTitle):(f=o?'<div><img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon_HCB+'" />'+i.Locale.errorSidebarMessage+"<\/div>":'<div><img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon+'" />'+i.Locale.errorSidebarMessage+"<\/div>",e=i.Locale.errorSidebarTitle),u=new r.SimpleDialogView({},t.Loader.$mars("#lPathDesignerContainer"),"MakingErrorControlWarning",e,f,function(){n.getErrorSidebarData()},function(){n.onToggleErrorSidebar(!1)}),u.showCancel=!1,u.okElementFocus=this.rootElement.find('input[id="lPathErrorControlCheck"]'),u.cancelElementFocus=this.rootElement.find('input[id="lPathErrorControlCheck"]'),u.ariaDescribedById="MakingErrorControlWarning",u.show();else n.onToggleErrorSidebar(!1)},f.prototype.getErrorSidebarData=function(){var u=this,e=this.rootElement.find('input[id="lPathControlClient"]').attr("data-name"),o=new n.Client.Utility.ContextEngine,f=o.getControlByContext(i.Utility.ControlTypes.Sidebar,t.Loader.contextAppVersionType,t.Loader.appContext.Locale,e,null,!0);i.App.showActionOverlay();f.done(function(n){var e,o,f;if(i.App.hideActionOverlay(),e=u.getSidebarsFromCBCData(n.Result),e.length>0)o=u.getMessageForMultipleControl(e,i.Locale.multipleErrorSidebarMessage),f=new r.SimpleDialogView({},t.Loader.$mars("#lPathDesignerContainer"),"MultipleContextExistsWarning",i.Locale.multipleErrorSidebarWarningTitle,o,function(){u.onToggleErrorSidebar(!0)},function(){u.onToggleErrorSidebar(!1)}),f.showCancel=!0,f.ariaDescribedById="MultipleContextExistsWarning",f.show();else u.onToggleErrorSidebar(!0)});f.fail(function(){i.App.hideActionOverlay();u.onToggleContextHome(!1);console.log("Unable to get error sidebar data.");t.Loader.marsExceptionHandler.execute("errorsodebarexception",t.Loader.marsLocale.unableToGetContextHome)})},f.prototype.onToggleErrorSidebar=function(n){var r=this.getCurrentControlValue(),t=this.rootElement.find('svg[id="lPathContextHomeIcon"]');t.length===0&&(t=this.rootElement.find('img[id="lPathContextHomeIcon"]'));n||this.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]').is(":checked")?(!n&&this.rootElement.find('input[id="lPathEnableHomeSidebarCheck"]').is(":checked")?(t.show(),t.closest("#lPathSetupControlTitle").attr("aria-label",i.Locale.homeSidebarText)):(t.hide(),t.closest("#lPathSetupControlTitle").attr("aria-label",i.Locale.sideBar)),this.rootElement.find('select[id="lPathControlActivates"]').val("invoked"),this.rootElement.find('select[id="lPathControlActivates"]').attr("disabled","true")):(this.rootElement.find('select[id="lPathControlActivates"]').removeAttr("disabled"),this.rootElement.find('select[id="lPathControlActivates"]').val(r.MetadataJson.UITrigger),this.selectDeselectCheckbox(this.rootElement.find('input[id="lPathErrorControlCheck"]'),!1),t.hide())},f.prototype.getSidebarsFromCBCData=function(n){for(var u,i,f,r=[],t=0;t<n.length;t++)for(u=n[t].AnswerPanels.length,i=0;i<u;i++)f=n[t].AnswerPanels[i],r.push(f);return r},f.prototype.getSelectedValues=function(n){n=u.prototype.getSelectedValues.call(this,n);n.MetadataJson.Template=this.rootElement.find('select[id="lPathControlTemplate"]').val();var t=i.Util.Common.getPreviewTemplateName(n.MetadataJson.Template);return t&&(n=i.Util.Common.handleLanguageControlVersionContent(n,t,!1)),n},f.prototype.onChangeTemplateConfirmation=function(n,r){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:onChangeTemplateConfirmation START");try{r.Sections=[];r.MetadataJson.ChildControlIds=[];var u=i.Util.Common.getPreviewTemplateName(r.MetadataJson.Template);u&&(r=i.Util.Common.handleLanguageControlVersionContent(r,u,!0));this.saveControlValues(r);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Template changed successfully")}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSetupView:onChangeTemplateConfirmation Exception occurred on subscribing side tool bar controls.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSetupView:onChangeTemplateConfirmation END")},f.prototype.onCancelTemplateConfirmation=function(n,t){n.rootElement.find('select[id="lPathControlTemplate"]').val(t);n.rootElement.find('select[id="lPathControlTemplate"]').focus()},f.prototype.isCurrentModelValueUpdated=function(){var n=this.getCurrentControlValue(),t=!1;return(n.ControlId==i.Util.Constants.EmptyGuid&&(t=!0),n=this.getSelectedValues(n),t&&(i.Util.Common.getModelValueWithoutControlIdAndIds(n),i.Util.Common.getModelValueWithoutControlIdAndIds(this.defaultCompareModelValue)),JSON.stringify(this.defaultCompareModelValue)===JSON.stringify(n))?!1:!0},f.prototype.onSetupCancel=function(){var n=this;this.isCurrentModelValueUpdated()?i.Util.Common.showAlertMessage(i.Locale.unSavedChangesPopupTitle,i.Locale.unSavedChangesPopupMessage,t.Loader.$mars("#lPathSetupPopupContainer"),!0,i.Locale.deleteChangesCaption,i.Locale.stayOnPageCaption,function(){n.onCancel()},function(){n.rootElement.find("#lPathControlSetupCancel").focus()}):n.onCancel()},f.prototype.advanceSetupViewCloseCallback=function(n){n.setdefaultCompareModelValue()},f.prototype.invokeSidebarAdvancedOptionsPopup=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SidebarSetupView : Call to invokeSidebarAdvancedOptionsPopup to opn the Advanced options view  : START");try{if(this.advancedOptionsLink.hasClass("lpath-setup-advance-option-disable"))return!1;t.Loader.$mars("#lPathSetupPopupContainer").length>0?t.Loader.$mars("#lPathSetupPopupContainer").html="":this.rootElement.append('<div id="lPathSetupPopupContainer"><\/div>');var n=new r.SidebarAdvancedOptionsView(t.Loader.$mars("#lPathSetupPopupContainer"),""),i=this;n.closeCallback=function(){i.advanceSetupViewCloseCallback(i)};n.show();t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SidebarSetupView : Call to invokeSidebarAdvancedOptionsPopup to opn the Advanced options view  : END")}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSetupView :Error in getSupportedLanguages to get data from api call")}},f.prototype.getMessageForMultipleControl=function(n,i){var r,u,f;for(r=this.isHighContrastModeEnabled()&&!this.isHighContrastWhiteModeEnabled()?'<div class= "mars-float-left"><img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon_HCB+'" /><\/div>':'<div class= "mars-float-left"><img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon+'" /><\/div>',r+="<div>"+i+"<br>",u=0;u<n.length;u++)if(f=n,u<2)r+=f[u].ControlName+"<br>";else{r+="...";break}return r+"<\/div>"},f.prototype.isHighContrastModeEnabled=function(){return i.$mars("#checkHighContrastDiv").css("background-image")==="none"},f.prototype.isHighContrastWhiteModeEnabled=function(){return this.isHighContrastModeEnabled()&&i.$mars("body").css("background-color")==="rgb(255, 255, 255)"},f.prototype.HandleScrollOnZoomIn=function(){var n=this;i.$mars("#lPathSettingViewContainer").on("focus",".lpath-designer-setup-row a",function(){return n.getZoomlevel()>100&&n.handleScrollBar(this),!1});i.$mars("#lPathSettingViewContainer").on("focus",".lpath-designer-setup-row #questionmark_securityrole",function(){return n.getZoomlevel()>100&&n.handleScrollBar(this),!1});i.$mars("#lPathSettingViewContainer").on("focus",".lpath-designer-setup-row #questionmark_lifecycle_stage",function(){return n.getZoomlevel()>100&&n.handleScrollBar(this),!1});i.$mars("#lPathSettingViewContainer").on("focus",".lpath-designer-setup-row input#customSecurityRoles",function(){return n.getZoomlevel()>100&&n.handleScrollBar(this),!1});i.$mars("#lPathSettingViewContainer").on("focus",".lpath-designer-setup-row select#lPathControlTemplate",function(){return n.getZoomlevel()>100&&n.handleScrollBar(this),!1});i.$mars("#lPathSettingViewContainer").on("focus",".lpath-designer-setup-row .lpath-setup-footer-button button",function(){return n.getZoomlevel()>100&&n.handleScrollBar(this),!1})},f.prototype.getZoomlevel=function(){var n=100;return screen.deviceXDPI?n=Math.round(screen.deviceXDPI/screen.logicalXDPI*100):window.devicePixelRatio&&(n=Math.round(window.devicePixelRatio*100)),n},f.prototype.handleScrollBar=function(n){var u=i.$mars(window).height(),r=i.$mars("#lPathControlSetupView").scrollTop(),t=i.$mars(n).offset().top,f=i.$mars(n).height();t>=u?t>r?i.$mars("#lPathControlSetupView").animate({scrollTop:t},"slow"):i.$mars("#lPathControlSetupView").animate({scrollTop:r+(r-t)+f},"slow"):i.$mars("#lPathControlSetupView").animate({scrollTop:r+t},"slow")},f}(r.SetupView);r.SidebarSetupView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(r){function u(){r.apply(this,arguments)}return __extends(u,r),u.prototype.build=function(){var i,n;r.prototype.build.call(this);i=this.getCurrentControlValue();this.rootElement.find('input[id="lPathControlName"]').val(t.EncodeDecode.MarsHtmlDecode(i.ControlName));this.rootElement.find("#lPathMakeHomeSidebarContainer").hide();this.rootElement.find("#lPathSidebarTemplate").hide();n=this.rootElement.find("#lPathSetupControlTitle");n.attr("aria-label",t.Locale.guidedTask);n.text(t.Locale.guidedTask);this.rootElement.find("#lPathControlSetupView").addClass("lpath-gt-gudedtask-setting-panel");this.rootElement.find("#lPathControlSetupView").attr("aria-label",t.Locale.guidedTaskSettings);this.rootElement.find("#lPathControlTemplate").attr("tabindex","-1")},u.prototype.onSave=function(){r.prototype.onSave.call(this)},u.prototype.getSelectedValues=function(n){if(n=r.prototype.getSelectedValues.call(this,n),n.ObjectState!=t.Utility.LearningPathObjectState.Unchanged){n.MetadataJson.Template="";var i=n.LanguageControlVersionContents&&n.LanguageControlVersionContents.length>0?n.LanguageControlVersionContents[0].Title:"";n=t.Util.Common.handleLanguageControlVersionContent(n,"",!0,i,n.BaseLcid,t.Util.Constants.emptyHtmlView)}return n},u.prototype.invokeSidebarAdvancedOptionsPopup=function(){n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SidebarSetupView : Call to invokeSidebarAdvancedOptionsPopup to opn the Advanced options view  : START");try{if(this.advancedOptionsLink.hasClass("lpath-setup-advance-option-disable"))return!1;n.Loader.$mars("#lPathSetupPopupContainer").length>0?n.Loader.$mars("#lPathSetupPopupContainer").html="":this.rootElement.append('<div id="lPathSetupPopupContainer"><\/div>');var t=new i.GuidedTaskAdvancedOptionsView(n.Loader.$mars("#lPathSetupPopupContainer"),""),r=this;t.closeCallback=function(){r.advanceSetupViewCloseCallback(r)};t.show();t.setDefaultFocusGTAdvancedOption();n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SidebarSetupView : Call to invokeSidebarAdvancedOptionsPopup to opn the Advanced options view  : END")}catch(u){n.Loader.marsExceptionHandler.execute(u.name,u.message);n.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSetupView :Error in getSupportedLanguages to get data from api call")}},u.prototype.attachEventForAccessiblity=function(){r.prototype.attachEventForAccessiblity.call(this);var n=this;this.rootElement.find("#lPathUserRole a").on("keydown",function(i){if(i.shiftKey||i.keyCode!=t.Utility.KeyCodeEnum.TabKey){if(i.shiftKey&&i.keyCode==t.Utility.KeyCodeEnum.TabKey)return n.rootElement.find(".lpath-setup-control-role-options #customSecurityRoles").focus(),!1}else return n.rootElement.find(".lpath-setup-footer-button #lPathControlSetupSave").focus(),!1;return!0})},u}(i.SidebarSetupView);i.GuidedTaskSetupView=r})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=window.Microsoft.Mars.Client.Runtime.Controls,f=function(f){function e(n,t){f.call(this,n,t);this.rootElement=n;this.params=t;this.controlCreated=t.controlCreated}return __extends(e,f),e.prototype.initializeControls=function(){f.prototype.initializeControls.call(this);this.skinnyToolbar.addClass("lpath-skinnytoolbar-guidedtask")},e.prototype.enableDisablePreviewAndSetting=function(){f.prototype.enableDisablePreviewAndSetting.call(this);var n=this.getCurrentControlValue();n.ControlId===i.Util.Constants.EmptyGuid?this.flowEditorViewSelector.attr("disabled",!0):this.flowEditorViewSelector.removeAttr("disabled")},e.prototype.onSetupViewInitialize=function(n){var t=this;return new r.GuidedTaskSetupView(n,function(){t.setupViewSaveCallback()})},e.prototype.setupViewSaveCallback=function(){this.setupViewInstance=null;this.enableDisablePreviewAndSetting();this.openFlowEditor()},e.prototype.onflowEditorButonClick=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"GuidedTaskSkinnyToolbarView:Setting Click START");try{var n=this;this.isControlModelValueUpdated()?i.Util.Common.showAlertMessage(i.Locale.unSavedChangesPopupTitle,i.Locale.unSavedChangesPopupMessage,this.rootElement,!0,i.Locale.deleteChangesCaption,i.Locale.stayOnPageCaption,function(){n.toggleSidebarView("flowEditorModeView")},function(){i.App.lPathDesignerContainer.find("#lPathSkinnyToolbarFlowEditorButton").focus()}):(this.toggleSidebarView("flowEditorModeView"),n.toggleArrowbutton.show())}catch(r){t.Loader.marsExceptionHandler.execute(r.name,r.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"GuidedTaskSkinnyToolbarView:Exception occurred on clicking Setting Icon")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"GuidedTaskSkinnyToolbarView:Setting click END")},e.prototype.toggleSidebarView=function(n){this.isInPreview&&this.closePreview();n=="flowEditorModeView"?this.flowEditorSidePanelView?(this.flowEditorSidePanelView.close(),this.flowEditorSidePanelView=null):this.openFlowEditor():n=="previewModeView"?(t.Loader.appContext.Util.hideDesignerOverlay(),this.closeEditors(),this.renderPreview()):n=="editModeSettingsView"?this.openFlowEditor():(this.closeEditors(2),f.prototype.toggleSidebarView.call(this,n))},e.prototype.onSettingButtonClick=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"GuidedTaskSkinnyToolbarView:Setting Click START");try{var n=this;this.isControlModelValueUpdated()?i.Util.Common.showAlertMessage(i.Locale.unSavedChangesPopupTitle,i.Locale.unSavedChangesPopupMessage,this.rootElement,!0,i.Locale.deleteChangesCaption,i.Locale.stayOnPageCaption,function(){n.settingsViewSelector.hasClass("lpath-skinnytoolbar-active-button")?(n.flowEditorViewSelector.removeClass("lpath-skinnytoolbar-active-button"),n.flowEditorViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarInactiveFlowEditor)):(n.flowEditorViewSelector.removeClass("lpath-skinnytoolbar-active-button"),n.flowEditorViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarInactiveFlowEditor),n.settingsViewSelector.addClass("lpath-skinnytoolbar-active-button"),n.settingsViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarActiveSettings));n.onSettingToggleClick();n.toggleSidebarView(n.settingModeViewName);n.rootElement.find("#lPathControlName").focus()},function(){i.App.lPathDesignerContainer.find("#lPathSkinnyToolbarSettingsButton").focus()}):(this.onSettingToggleClick(),n.toggleSidebarView(this.settingModeViewName),n.toggleArrowbutton.hide(),n.settingsViewSelector.hasClass("lpath-skinnytoolbar-active-button")?(n.flowEditorViewSelector.removeClass("lpath-skinnytoolbar-active-button"),n.flowEditorViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarInactiveFlowEditor)):(n.flowEditorViewSelector.removeClass("lpath-skinnytoolbar-active-button"),n.flowEditorViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarInactiveFlowEditor),n.settingsViewSelector.addClass("lpath-skinnytoolbar-active-button"),n.settingsViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarActiveSettings)))}catch(r){t.Loader.marsExceptionHandler.execute(r.name,r.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"GuidedTaskSkinnyToolbarView:Exception occurred on clicking Setting Icon")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"GuidedTaskSkinnyToolbarView:Setting click END")},e.prototype.onSettingToggleClick=function(){this.flowEditorSidePanelView&&this.flowEditorSidePanelView!=null&&this.flowEditorSidePanelView.removeBubble()},e.prototype.onPreviewClick=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"GuidedTaskSkinnyToolbarView:Preview sidebar START");try{var r=this;this.isControlModelValueUpdated()?i.Util.Common.showAlertMessage(i.Locale.unSavedChangesPopupTitle,i.Locale.unSavedGTChangesPopupMessage,this.rootElement,!0,i.Locale.deleteChangesCaption,i.Locale.stayOnPageCaption,function(){r.toggleSidebarView(r.previewModeViewName)},function(){r.setupViewInstance?r.settingsViewSelector.hasClass("lpath-skinnytoolbar-active-button")?(r.flowEditorViewSelector.removeClass("lpath-skinnytoolbar-active-button"),r.flowEditorViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarInactiveFlowEditor)):(r.flowEditorViewSelector.removeClass("lpath-skinnytoolbar-active-button"),r.flowEditorViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarInactiveFlowEditor),r.settingsViewSelector.addClass("lpath-skinnytoolbar-active-button"),r.settingsViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarActiveSettings)):r.flowEditorViewSelector.hasClass("lpath-skinnytoolbar-active-button")?(r.settingsViewSelector.removeClass("lpath-skinnytoolbar-active-button"),r.settingsViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarInactiveSetting)):(r.settingsViewSelector.removeClass("lpath-skinnytoolbar-active-button"),r.settingsViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarInactiveSetting),r.flowEditorViewSelector.addClass("lpath-skinnytoolbar-active-button"),r.flowEditorViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarActiveFlowEditor));i.App.lPathDesignerContainer.find("#lPathSkinnyToolbarPreviewButton").focus()}):(r.toggleSidebarView(this.previewModeViewName),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Guidedtask previewed successfully"))}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"GuidedTaskSkinnyToolbarView:Exception occurred while previewing in guidedtask.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"GuidedTaskSkinnyToolbarView:Preview guidedtask END")},e.prototype.onToggleIconClick=function(r,u){var f,e;r===void 0&&(r=!0);u===void 0&&(u=!1);this.skinnyToolbarContainer.toggleClass("open");this.skinnyToolbarContainer.hasClass("open")?(i.App.showLPathDesignerOverlay(),n.Client.Loader.appContext.handleCustomizationContainerInMoca(!0),f=t.Loader.$mars("<img/>",{id:"lpath-mars-toggle-arrow-image","class":"lpath-svg",src:t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toggleIconLeft}),this.toggleArrowbutton.empty().append(f),window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg"),this.toggleArrowbutton.attr("title",i.Locale.hideToolbar),n.Client.Loader.appContext.isMobileClient()?this.skinnyToolbarOtherControlContainer.show():this.skinnyToolbarOtherControlContainer.fadeIn(),t.Loader.$mars("#lPathskinnyToolbarContainer").css("z-index",n.Client.Loader.appContext.Util.getMaxZIndex()+1),this.flowEditorSidePanelView&&this.flowEditorSidePanelView!=null&&this.flowEditorSidePanelView.removeBubble(),this.flowEditorViewRootElement&&this.flowEditorViewRootElement!=null&&this.flowEditorViewRootElement.find("#lPathEditHeader").focus()):(u?i.App.showLPathDesignerOverlay():i.App.hideLPathDesignerOverlay(),r&&n.Client.Loader.appContext.handleCustomizationContainerInMoca(!1),e=t.Loader.$mars("<img/>",{id:"lpath-mars-toggle-arrow-image","class":"lpath-svg",src:t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toggleIconRight}),this.toggleArrowbutton.empty().append(e),window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg"),this.toggleArrowbutton.attr("title",i.Locale.showToolbar),n.Client.Loader.appContext.isMobileClient()?this.skinnyToolbarOtherControlContainer.hide():this.skinnyToolbarOtherControlContainer.fadeOut())},e.prototype.isControlModelValueUpdated=function(){var n=!1;return this.setupViewInstance?n=this.setupViewInstance.isCurrentModelValueUpdated():this.flowEditorSidePanelView&&(n=this.flowEditorSidePanelView.isCurrentModelValueUpdated()),n},e.prototype.onHomeIconClick=function(){f.prototype.onHomeIconClick.call(this);this.isInPreview&&this.closePreview()},e.prototype.close=function(){this.flowEditorSidePanelView&&this.flowEditorSidePanelView!=null&&this.flowEditorSidePanelView.removeBubble();f.prototype.close.call(this)},e.prototype.validateBubbleExistAndPinned=function(){var u=this.getCurrentControlValue(),s=t.Loader._mars.reject(u.Steps,function(n){return n.MetadataJson.PageNavigationInfo}),f,e,o,n;return!u.Steps.length||s.length?(u.Steps.length?(f=i.Locale.unPinnedBubblesTitle,e="<div>"+i.Locale.unPinnedBubblesMessage+"<\/div>"):(f=i.Locale.emptyBubbleGTTitle,e="<div>"+i.Locale.emptyBubbleGTMessage+"<\/div>"),o=this.getGenericDialogHolder(),n=new r.SimpleDialogView({},o,i.Util.Constants.ControlExistPopup,f,e,function(){this.rootElement.find('button[id="lPathSkinnyToolbarPreviewButton"]').focus()}),n.addDefaultFocusOnOkOrClose=!0,n.cancelElementFocus=this.rootElement.find('button[id="lPathSkinnyToolbarPreviewButton"]'),n.ariaDescribedById=i.Util.Constants.ControlExistPopup,n.show(),!1):!0},e.prototype.openFlowEditor=function(){var e=this.getSettingRootElement(),o,u,s,f;e&&e.hide();this.toggleIconSelector.show();this.flowEditorViewRootElement=t.Loader.$mars("#lpathFlowTemplateHolder");this.flowEditorViewRootElement.length==0&&(u=this.getCurrentControlValue(),u.ControlId!=i.Util.Constants.EmptyGuid&&(o=u.ControlName),s=o+" "+i.Locale.headerGuidedTaskText+" "+i.Locale.flowView,f=t.Loader.$mars('<div id="lpathFlowTemplateHolder" class="lpath-flow-header" role="dialog" aria-label="'+s+'"><\/div>'),f.css("z-index",n.Client.Loader.appContext.Util.getMaxZIndex()+1),this.flowEditorViewRootElement=f,this.skinnyToolbarOtherControlContainer.append(this.flowEditorViewRootElement));this.flowEditorViewSelector.hasClass("lpath-skinnytoolbar-active-button")?(this.settingsViewSelector.removeClass("lpath-skinnytoolbar-active-button"),this.settingsViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarInactiveSetting)):(this.settingsViewSelector.removeClass("lpath-skinnytoolbar-active-button"),this.settingsViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarInactiveSetting),this.flowEditorViewSelector.addClass("lpath-skinnytoolbar-active-button"),this.flowEditorViewSelector.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarActiveFlowEditor));this.flowEditorSidePanelView=new r.FlowEditorSidePanelView(this.flowEditorViewRootElement,{toggleSidebarHandler:this.onToggleIconClick.bind(this),controlCreated:this.controlCreated});this.flowEditorSidePanelView.show();t.Loader.$mars("#lPathEditHeader").focus();this.closeEditors(1)},e.prototype.closeEditors=function(n){n===void 0&&(n=0);this.setupViewInstance&&this.setupViewInstance!=null&&(n==0||n==1)&&(this.setupViewInstance.close(),this.setupViewInstance=null);this.flowEditorSidePanelView&&this.flowEditorSidePanelView!=null&&(n==0||n==2)&&(this.flowEditorSidePanelView.close(),this.flowEditorSidePanelView=null);this.closePreview()},e.prototype.renderPreview=function(){var i=this.getCurrentControlValue(),r,f;if(this.validateBubbleExistAndPinned()){this.showButtonsOnPreviewClick();this.toggleIconSelector.is(":visible")||this.toggleIconSelector.show();t.Loader.$mars("#lPathSkinnyToolbarEditButton").focus();u.ScenarioUtil.parseScenarioJSON(i);r=i.ControlId;f=u.ScenarioManager.getInstance();f.launchScenario(r,!1,!1,!0);t.Loader.appContext.util.showOverlay();this.onToggleIconClick(!1);this.isInPreview=!0;n.Client.Loader.appContext.util.setGTPreviewState(!0)}},e.prototype.closePreview=function(){if(this.isInPreview){var i=this.getCurrentControlValue(),r=i.ControlId,f=u.ScenarioManager.getInstance();f.removeScenario(r);t.Loader.appContext.util.hideOverlay();this.isInPreview=!1;n.Client.Loader.appContext.util.setGTPreviewState(!1)}},e}(r.SidebarSkinnyToolbarView);r.GuidedTaskSkinnyToolbarView=f})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var f=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{type:6,Name:"Bubble with next button"}},t.prototype.initialize=function(){},t}(BackboneMars.Model),u;r.BackboneBubble=f;u=function(u){function f(n,t,i,r){u.call(this);this.addNewBubbleCallback=t;this.mouseDownCallback=i;this.removeBubbleCallback=r;this.isOpen=!1;this.isMousedown=!1;this.collection=n.collection;this.$el=n.el}return __extends(f,u),f.prototype.initialize=function(){},f.prototype.close=function(){this.$el.off("focusout",".lpath-gt-flow-dropdown-menu li:last");this.$el.find(".lpath-gt-flow-addnewbubleicon").off("click");this.$el.find(".lpath-gt-flow-newbubble-dropdown > li").off("click");this.$el.find(".lpath-gt-flow-newbubble-dropdown > li").off("keydown");this.$el.find(".lpath-gt-flow-newbubble-dropdown > li").off("mousedown");this.$el.find(".lpath-gt-flow-newbubble-dropdown > li").off("mouseleave")},f.prototype.render=function(){var n=this,t=r.TemplateEngine.applyTemplate(i.Util.Constants.addNewBubbleListTemplate,this.collection,!1,!0,!0);this.$el.append(t);this.$el.find(".lpath-gt-flow-addnewbubleicon").on("click",function(t){return n.addNewStepBubbleToggle(t)});this.$el.find(".lpath-gt-flow-newbubble-dropdown > li").on("click",function(t){return n.addNewBubble(t)});this.$el.find(".lpath-gt-flow-newbubble-dropdown > li").on("keydown",function(t){return n.addNewBubbleThroughKeysAndHandleKeyNavigation(t)});this.$el.find(".lpath-gt-flow-newbubble-dropdown > li").on("mousedown",function(t){n.isMousedown=!0;t.preventDefault();t.stopPropagation()});this.$el.find(".lpath-gt-flow-newbubble-dropdown > li").on("mouseleave",function(t){if(n.isMousedown)n.onMouseLeave(t);t.preventDefault();t.stopPropagation()});return this},f.prototype.addNewStepBubbleToggle=function(n){this.removeBubbleCallback&&this.removeBubbleCallback();this.togglePopup();n.preventDefault();n.stopPropagation()},f.prototype.addNewBubble=function(n){this.isMousedown=!1;this.addNewBubbleCallback(parseInt(n.target.id));this.addNewStepBubbleToggle(n);n.preventDefault();n.stopPropagation()},f.prototype.documentClick=function(n){var t=i.$mars("#lPathBubbleContainer");t.is(n.target)||t.has(n.target).length!==0||this.togglePopup();n.preventDefault();n.stopPropagation()},f.prototype.togglePopup=function(n){(!n||this.isOpen)&&(this.isOpen?this.unwireDocumentClick():(t.Loader.$mars("#lPathFlowStepContainer ul li.lpath-gt-flow-bubble-item").removeClass("active"),this.wireDocumentClick()),this.$el.find(".lpath-gt-flow-newbubble-dropdown").slideToggle(),this.isOpen?t.Loader.$mars(".lpath-gt-flow-bubble-item").length>0&&t.Loader.$mars(".lpath-gt-flow-bubble-item:last .lapth-gt-bubble-main-div").focus():t.Loader.$mars(".lpath-sidebar-floweditor").closest("li")[0].focus(),this.isOpen=!this.isOpen)},f.prototype.onMouseLeave=function(n){this.isMousedown=!1;this.mouseDownCallback(parseInt(n.target.id));n.preventDefault();n.stopPropagation()},f.prototype.getBody=function(){return t.Loader.appContext.ClientType==i.Util.Constants.WebClientType?i.$mars("body"):i.$mars(document).find("body")},f.prototype.wireDocumentClick=function(){var n=this;this.getBody().on("click",function(t){return n.documentClick(t)})},f.prototype.unwireDocumentClick=function(){this.getBody().off("click")},f.prototype.addNewBubbleThroughKeysAndHandleKeyNavigation=function(r){try{var u=t.Loader.$mars(r.currentTarget);return r.which==t.Utility.KeyCodeEnum.TabKey?(this.$el.find(".lpath-gt-flow-newbubble-dropdown").slideToggle(),r.shiftKey?r.shiftKey&&t.Loader.$mars(".lpath-gt-flow-addnewbubleicon").focus():t.Loader.$mars(".lpath-gt-flow-bubble-item").length>0?(t.Loader.$mars(".lpath-gt-flow-bubble-item").removeClass("active"),t.Loader.$mars(".lpath-gt-flow-bubble-item:first").addClass("active"),t.Loader.$mars(".lpath-gt-flow-bubble-item:first .lapth-gt-bubble-main-div").focus()):t.Loader.$mars("#lPathControlToolTabSaveButton").focus()):r.keyCode==i.Utility.KeyCodeEnum.DownArrowKey?u.closest("li.lpath-sidebar-floweditor").next().focus():r.keyCode==i.Utility.KeyCodeEnum.UpArrowKey?u.closest("li.lpath-sidebar-floweditor").prev().focus():n.Client.Loader.appContext.Util.isEnterPressed(r,!0)?this.addNewBubble(r):r.which==i.Utility.KeyCodeEnum.SpaceKey?this.mouseDownCallback(parseInt(r.target.id),null,!0):r.which==i.Utility.KeyCodeEnum.EscapeKey&&(this.unwireDocumentClick(),this.$el.find(".lpath-gt-flow-newbubble-dropdown").slideToggle(),t.Loader.$mars(".lpath-gt-flow-addnewbubleicon").focus()),r.preventDefault(),r.stopPropagation(),!0}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Add bubble view : Error on key press on new bubble dropdown")}},f}(BackboneMars.View);r.AddBubbleView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var u=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{isInEditMode:!0,Content:{},Template:"",StepIndex:1,Links:[],LearnMoreCaption:""}},t.prototype.initialize=function(){},t}(BackboneMars.Model),i,r;t.StepBubbleMetadata=u;i=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.prototype.defaults=function(){return{ControlName:"",ControlType:null,MetadataJson:{Index:0,ClientId:n.Utility.Util.newGuid(),Title:"",LearnMoreCaption:""},LastUpdatedDate:null,Enabled:!0,Comments:"",ControlId:n.Utility.Util.newGuid(),ObjectState:n.Utility.LearningPathObjectState.Added,Tags:""}},i.prototype.initialize=function(){},i}(BackboneMars.Model);t.BackboneControlBaseMetadata=i;r=function(n){function t(){n.apply(this,arguments);this.model=i}return __extends(t,n),t}(BackboneMars.Collection);t.BackboneSteps=r})(t=n.Renderer||(n.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n){u.call(this);this.bubbleModel=n.model;this.$el=n.el}return __extends(f,u),f.prototype.initialize=function(){},f.prototype.close=function(){var t=this.contentContainerElement.find('input[name="lpath_section_title"]'),n;t.off("change");n=this.contentContainerElement.find('input[id="mars-txtVideoUrl"]');n.off("change")},f.prototype.render=function(n){if(n===void 0&&(n=!1),this.bubbleModel.attributes.Content.ContentType&&this.renderContent(this.bubbleModel.attributes.Content.ContentType),n){var t=this.$el.find(".lpath-gt-bubble-stepbubble-nexticon"),i=this.$el.find("lpath-gt-bubble-stepbubble-previcon");Microsoft.Mars.Client.Runtime.Controls.StepBubble.replaceNextPrevIcon(t,i)}return this},f.prototype.handleEvents=function(){},f.prototype.getBubbleModel=function(){return this.bubbleModel},f.prototype.renderContent=function(n){switch(n){case f.textType:this.applyTextTemplate();break;case f.videoType:this.applyVideoTemplate();break;case f.twoButtonType:this.applyTwoButtonTemplate();break;default:this.applyTextTemplate()}},f.prototype.updateContainerElement=function(){},f.prototype.applyTextTemplate=function(){var s=this,h=t.Loader.$mars(this),e,u,o,n;this.bubbleModel.attributes.Content={Title:this.bubbleModel.attributes.Content.Title,Text:this.bubbleModel.attributes.Content.Text&&this.bubbleModel.attributes.Content.Text!=null?this.bubbleModel.attributes.Content.Text:"",ContentType:f.textType};e=r.TemplateEngine.applyTemplate(i.Util.Constants.titleTextGtTemplate,this.bubbleModel.attributes.Content,!1,!0,!0);u=this.getBuilderControlHolder();u.html(e);u.children().first().addClass("lpath-gt");this.bubbleModel.attributes.isInEditMode&&(o=t.Loader.$mars('div[name="mars_builderControlContainer"]'),n=this.contentContainerElement.find('textarea[id="lpath-txtText"]'),n.attr("id",this.contentContainerElement.attr("id")+"_"+n.attr("id")),i.Content.lPathCkEditor.setCkEditorForSectionContent(n,o,h,function(n){s.onUpdateTextContentValue(f.textFieldType,n)},function(){},this.ckEditorInstanceReady))},f.prototype.ckEditorInstanceReady=function(){t.Loader.$mars("#lpath_GT_Bubble_PassiveContainer").find(".cke_bottom").addClass("lpath-gt-bubble-cke-bottom");t.Loader.$mars("#lpath_GT_Bubble_PassiveContainer").find(".cke_contents").addClass("lpath-gt-bubble-cke-contents");t.Loader.$mars("#lpath_GT_Bubble_PassiveContainer").find(".cke_chrome").addClass("lpath-gt-bubble-cke-chrome");t.Loader.$mars("#lpath_GT_Bubble_PassiveContainer").find("iframe").contents().find("body").css("font-size","15px").css("font-family",'"segoe UI"').css("line-height","25px").css("margin","15px");t.Loader.appContext.ClientType==i.Util.Constants.MobileClientType&&t.Loader.$mars("#lpath_GT_Bubble_PassiveContainer").find("iframe").css("width","auto").css("height","auto");t.Loader.$mars(".cke_contents").find(".cke_wysiwyg_frame")[0].contentWindow.document.body.focus()},f.prototype.applyVideoTemplate=function(){var u=this,l=t.Loader.$mars(this),c,e,o,s,h;this.bubbleModel.attributes.Content={Title:this.bubbleModel.attributes.Content.Title,VideoHeaderText:this.bubbleModel.attributes.Content.VideoHeaderText&&this.bubbleModel.attributes.Content.VideoHeaderText!=null?this.bubbleModel.attributes.Content.VideoHeaderText:"",VideoFooterText:this.bubbleModel.attributes.Content.VideoFooterText&&this.bubbleModel.attributes.Content.VideoFooterText!=null?this.bubbleModel.attributes.Content.VideoFooterText:"",VideoSource:this.bubbleModel.attributes.Content.VideoSource&&this.bubbleModel.attributes.Content.VideoSource!=null?this.bubbleModel.attributes.Content.VideoSource:"",VideoTagSupport:this.bubbleModel.attributes.Content.VideoTagSupport,ContentType:f.videoType};var l=t.Loader.$mars(this),a=r.TemplateEngine.applyTemplate(i.Util.Constants.titleVideoGtTemplate,this.bubbleModel.attributes.Content,!1,!0,!1),v=this.getBuilderControlHolder();if(v.html(a),this.bubbleModel.attributes.isInEditMode){c=t.Loader.$mars('div[name="mars_builderControlContainer"]');e=u.contentContainerElement.find('input[name="lpath_section_title"]');e.attr("id",this.contentContainerElement.attr("id")+"_"+e.attr("id"));e.on("change",function(){});o=u.contentContainerElement.find('textarea[id="lpath-VideoHeaderText"]');o.attr("id",this.contentContainerElement.attr("id")+"_"+o.attr("id"));i.Content.lPathCkEditor.setCkEditorForSectionContent(o,c,l,function(n){u.onUpdateTextContentValue(f.videoHeaderFieldType,n)},function(){},this.ckEditorInstanceReady);s=u.contentContainerElement.find('textarea[id="lpath-VideoFooterText"]');s.attr("id",this.contentContainerElement.attr("id")+"_"+s.attr("id"));i.Content.lPathCkEditor.setCkEditorForSectionContent(s,c,l,function(n){u.onUpdateTextContentValue(f.videoFooterFieldType,n)},function(){});h=u.contentContainerElement.find('input[id="mars-txtVideoUrl"]');h.attr("id",u.contentContainerElement.attr("id")+"_"+h.attr("id"));i.$mars("body").on("change","#"+h.attr("id"),function(){var t=i.$mars(this).val();t.indexOf("youtube.com")>0||t.indexOf("youtu.be")>0?(u.bubbleModel.attributes.Content.VideoSource=n.Client.Loader.appContext.Util.getFormatedYouTubeVideoUrl(t),u.bubbleModel.attributes.Content.VideoTagSupport=1):t.toLowerCase().indexOf("go.microsoft.com/fwlink")>0?(u.bubbleModel.attributes.Content.VideoSource=t,u.bubbleModel.attributes.Content.VideoTagSupport=2):(u.bubbleModel.attributes.Content.VideoSource=t,u.bubbleModel.attributes.Content.VideoTagSupport=0)})}},f.prototype.applyTwoButtonTemplate=function(){var s=this,h=t.Loader.$mars(this),u,e,o,n;this.bubbleModel.attributes.Content={Title:this.bubbleModel.attributes.Content.Title,Text:this.bubbleModel.attributes.Content.Text&&this.bubbleModel.attributes.Content.Text!=null?this.bubbleModel.attributes.Content.Text:"",Links:[{Title:"Button1"},{Title:"Button2"}],ContentType:f.twoButtonType};u=r.TemplateEngine.applyTemplate(i.Util.Constants.titleTwoButtonGtTemplate,this.bubbleModel.attributes.Content,!1,!0,!1);e=this.getBuilderControlHolder();e.html(u);this.bubbleModel.attributes.isInEditMode&&(o=t.Loader.$mars('div[name="mars_builderControlContainer"]'),n=this.contentContainerElement.find('textarea[id="lPathText"]'),n.attr("id",this.contentContainerElement.attr("id")+"_"+n.attr("id")),i.Content.lPathCkEditor.setCkEditorForSectionContent(n,o,h,function(n){s.onUpdateTextContentValue(f.textFieldType,n)},function(){},this.ckEditorInstanceReady))},f.prototype.onUpdateTextContentValue=function(n,t){var r=i.Util.Common.addPlaceHolderForCKEditor(t.getData());this.bubbleModel.attributes.Content[n]=r},f.prototype.getBuilderControlHolder=function(){this.contentContainerElement.html("");var n=t.Loader.$mars('<div name="builderControlHolder" class="builderControlHolderTemplate" id="'+this.contentContainerElement.attr("id")+'_builderControlHolder" />');return n.data("sectionindex",this.bubbleModel.attributes.StepIndex),this.contentContainerElement.append(n),n},f.textFieldType="Text",f.videoHeaderFieldType="VideoHeaderText",f.videoFooterFieldType="VideoFooterText",f.textType="text",f.videoType="video",f.twoButtonType="two-button",f}(BackboneMars.View);r.BaseStepBubble=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(i){function r(){i.apply(this,arguments)}return __extends(r,i),r.prototype.render=function(){var r=t.TemplateEngine.applyTemplate(n.Util.Constants.passiveBubbleDisplayViewTemplate,this.bubbleModel);return this.$el.html(r),this.contentContainerElement=this.$el.find("#lpath_GT_Bubble_PassiveContent"),this.handleEvents(),i.prototype.render.call(this,!0)},r.prototype.handleEvents=function(){},r.prototype.getBubbleModel=function(){return this.bubbleModel},r.prototype.updateContainerElement=function(n){this.contentContainerElement=n.find("#lpath_GT_Bubble_PassiveContent")},r}(t.BaseStepBubble);t.PassiveStepBubble=i})(t=n.Renderer||(n.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t,r,f,e){u.call(this,{},f);this.parentControlId=n;this.content=r;this.rootElement=f;this.innerControlUpdateCallback=e;this.initializeControls();this.sectionIndex=t;this.ControlTypes=i.Utility.ControlTypes}return __extends(f,u),f.prototype.getTemplate=function(){return i.Util.Constants.listOflinkTemplate},f.prototype.initializeControls=function(){try{this.viewDataValue=this.content;u.prototype.build.call(this);this.genericPopupHolder=this.getGenericDialogHolder(i.App.lPathDesignerContainer);this.containerId=this.rootElement.attr("id");u.prototype.isHighContrastModeActive.call(this)&&this.handleLOLHc();this.attachEvents();this.createMiniGridPopup()}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message)}},f.prototype.attachEvents=function(){var n=this,u=this.rootElement.find('input[id="lPathSectionTextTemplateTitle"]'),f,r,t,e;u.attr("id",this.containerId+"_"+u.attr("id"));u.on("change",function(){n.content.Title=i.$mars(this).val();n.innerControlUpdateCallback(n.content,!1,n.sectionIndex);n.reload(!1,!0)});f=this.rootElement.find('button[name="lPathAddListOfLinksPlus"]');f.attr("id",this.containerId+"_"+f.attr("id"));this.subscribe(f,"click",this.onPlusClick);r=this.rootElement.find('button[id="lPathAddListOfLinksDelete"]');r&&(r.attr("id",this.containerId+"_"+r.attr("id")),this.subscribe(r,"click",this.deleteSelectedLink));t=this.rootElement.find('button[id="lPathAddListOfLinksEdit"]');t&&(t.attr("id",this.containerId+"_"+t.attr("id")),this.subscribe(t,"click",function(t,i){n.editButtonSelectedLink(t,i)}));e=this.rootElement.find('input[id="lPathListOfLinkTitle"]');e&&(e.attr("id",this.containerId+"_"+t.attr("id")),this.subscribe(e,"change",function(t,i){n.updateTitle(t,i)}));u.focus()},f.prototype.handleLOLHc=function(){var n=this.rootElement.find('button[id="lPathAddListOfLinksDelete"]'),i=this.rootElement.find('button[id="lPathAddListOfLinksEdit"]');u.prototype.isBlackHighContrastMode.call(this)?(n.length>0&&n.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.deleteSectionContentHCB),i.length>0&&i.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.editTitleHCB)):(n.length>0&&n.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.deleteSectionContentHCW),i.length>0&&i.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.editTitleHCW))},f.prototype.onPlusClick=function(){this.content&&this.content.Links&&(this.selectedLinkIndex=this.content.Links.length);this.openListOfLinkPopUp(this,null)},f.prototype.deleteSelectedLink=function(n,t){var i=this.rootElement.find(t);i&&(this.selectedLinkIndex=i.data("linkindex"),this.content.Links.splice(this.selectedLinkIndex,1),this.reload(!1))},f.prototype.editButtonSelectedLink=function(n,t){var r=this,u=this.rootElement.find(t),f;if(u){this.selectedLinkIndex=u.data("linkindex");this.selectedLinkName=u.data("linkname");switch(this.selectedLinkName){case i.Utility.LinkType.Sidebar:this.selectExistingControlByType(i.Utility.LinkType.Sidebar,function(n){r.selectsidebarnavigationmode(n,r,!0)},!0);break;case i.Utility.LinkType.GuidedTask:this.selectExistingControlByType(i.Utility.LinkType.GuidedTask,function(n){r.selectsidebarnavigationmode(n,r,!0)},!0);break;case i.Utility.LinkType.PageInApp:case i.Utility.LinkType.WebPage:case i.Utility.LinkType.DialogBox:f=this.content.Links[this.selectedLinkIndex];this.openListOfLinkPopUp(this,f,this.selectedLinkName,undefined,!0);this.updateLinkType(this,this.selectedLinkName)}}},f.prototype.updateTitle=function(n,t){var i=this.rootElement.find(t);this.selectedLinkIndex=i.data("linkindex");this.content.Links[this.selectedLinkIndex].Title=i.val();this.reload(!1,!0)},f.prototype.createMiniGridPopup=function(){this.dialogContainer=t.Loader.$mars('<div id="'+this.genericPopupHolder.attr("Id")+'_lPath-buildercontrol-dialog" class= "lpath_dialog lpath-lol-dialog-main-container"><\/div>');this.genericPopupHolder.append(this.dialogContainer)},f.prototype.openListOfLinkPopUp=function(u,f,e,o,s){var l=r.TemplateEngine.applyTemplate(i.Util.Constants.listOfLinksPopupTemplate,f),h,c;this.listOfLinkDialog=new r.SimpleDialogView({},this.genericPopupHolder,"ListOfLinkPopupTemplate",i.Locale.defineLink,l,function(){u.onNextClick(u,o);s?u.rootElement.find("button[data-linkname = "+u.selectedLinkName+"]").first().focus():t.Loader.$mars("#lPathMiniGridSearchText")!=null&&t.Loader.$mars("#lPathMiniGridSearchText").length>0&&t.Loader.$mars("#lPathMiniGridSearchText").focus()},function(){s?u.rootElement.find("button[data-linkname = "+u.selectedLinkName+"]").first().focus():i.App.lPathDesignerContainer.find('button[id="'+u.containerId+'_lPathAddListOfLinksPlus"]').focus()});this.listOfLinkDialog.okCaption=i.Locale.nextValue;this.listOfLinkDialog.addDoNotShowCheck=!1;this.listOfLinkDialog.okValidationCallback=u.validateListofLink;this.listOfLinkDialog.showCancel=!0;this.listOfLinkDialog.show();n.Client.Loader.appContext.getAppName()!=="Crm"&&t.Loader.$mars("#lPathOpenInlineDiv").hide();h=t.Loader.$mars(t.Loader.$mars.find('select[id="lPathListOfLinkTypes"]'));c=t.Loader.$mars(t.Loader.$mars.find("#lPathLinkToWebPage input[type='radio']"));c.on("change",function(){if(this.value=="window")t.Loader.$mars("#lPathOpenInNewWindow").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide();else if(this.value=="inline"){t.Loader.$mars("#lPathOpenInline").prop("checked",!0);t.Loader.$mars("#lPathDialogHeightWidth").css("display","block");t.Loader.$mars('input[id="lPathDialogHeight"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars('input[id="lPathDialogWidth"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars("#lPathCallback").show()}else t.Loader.$mars("#lPathOpenInNewTab").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide()});e?h.val(e):e=Number(h[0].options[0].value.toLowerCase());this.updateLinkType(this,e);h.on("change",function(){u.updateLinkType(u,Number(this.value))})},f.prototype.updateLinkType=function(r,u){var f,o,s,e;r.selectedLinkName=u;f=t.Loader.$mars('div[id="lPathLinkToWebPage"]');o=t.Loader.$mars("#lPathLinkToPageInApp");f.hide();o.hide();t.Loader.$mars("#lpath-linkTo-MDD-dialog").hide();t.Loader.$mars("#lpath-linkToWebPage-InlineAndTab").show();switch(r.selectedLinkName){case i.Utility.LinkType.PageInApp:o.show();s=t.Loader.$mars("#lPathLinkToPageInAppCrmPageInfo");s.hide();break;case i.Utility.LinkType.WebPage:if(f.show(),t.Loader.$mars("#lpathTargetSelector").show(),this.content.Links[this.selectedLinkIndex]&&this.content.Links[this.selectedLinkIndex].OpenInNew.toLowerCase()=="window")t.Loader.$mars("#lPathOpenInNewWindow").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide();else if(this.content.Links[this.selectedLinkIndex]&&this.content.Links[this.selectedLinkIndex].OpenInNew.toLowerCase()=="inline"&&t.Loader.appContext.ClientType!=i.Util.Constants.UCIClientType){t.Loader.$mars("#lPathOpenInline").prop("checked",!0);t.Loader.$mars("#lPathDialogHeightWidth").css("display","block");t.Loader.$mars('input[id="lPathDialogHeight"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars('input[id="lPathDialogWidth"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars("#lPathCallback").show()}else t.Loader.$mars("#lPathOpenInNewTab").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide();break;case i.Utility.LinkType.DialogBox:f.show();t.Loader.$mars("#lpathTargetSelector").hide();t.Loader.$mars("#lpath-linkToWebPage-InlineAndTab").hide();t.Loader.$mars("#lpath-linkTo-MDD-dialog").show();t.Loader.$mars("#lPathOpenInline").prop("checked",!0);t.Loader.$mars("#lPathDialogHeightWidth").css("display","block");e=r.content.Links[r.selectedLinkIndex];e&&e.Url&&t.Loader.$mars('input[id="lPathLinkToUniqueName"]').val(e.Url);t.Loader.$mars('input[id="lPathDialogHeight"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars('input[id="lPathDialogWidth"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars("#lPathCallback").show()}},f.prototype.onNextClick=function(n,r){var u=t.Loader.$mars(t.Loader.$mars.find('select[id="lPathListOfLinkTypes"]'));n.selectedLinkName=Number(u[0].value.toLowerCase());switch(n.selectedLinkName){case i.Utility.LinkType.GuidedTask:n.selectExistingControlByType(i.Utility.LinkType.GuidedTask,n.selectsidebarnavigationmode,!1);break;case i.Utility.LinkType.Sidebar:n.selectExistingControlByType(i.Utility.LinkType.Sidebar,n.selectsidebarnavigationmode,!1);break;case i.Utility.LinkType.PageInApp:n.updatePageInAppLinkInModel(n,r);break;case i.Utility.LinkType.WebPage:n.updateWebPageLinkInModel(n);break;case i.Utility.LinkType.DialogBox:n.updateMDDDialogLinkInModel(n)}},f.prototype.selectExistingControlByType=function(n,u,f){var e=this,n,o="",s="",h="lpath_GT_Bubble_MainContainer_Content",c;switch(n){case i.Utility.LinkType.Sidebar:e.createMiniGridHolder("_lPath-LinkOfSideBarPopUP-placeholder");n=e.ControlTypes.Sidebar;o=i.Locale.addExistingSidebarPopupHeader;s=i.Locale.selectTheSideBar;break;case i.Utility.LinkType.GuidedTask:e.createMiniGridHolder("_lPath-LinkOfSideBarPopUP-placeholder");n=e.ControlTypes.GuidedTask;o=i.Locale.flowViewMiniGridHeader;s=i.Locale.selectTheGuidedTask}this.listOfLinkDialog&&this.listOfLinkDialog.hide();c=new r.MiniGrid(s,o,n,e.miniGridHolder,!0,1,5,e.parentControlId,function(n){t.Loader.$mars("#"+e.placeHolderId).remove();u(n,e);e.dialogContainer.fadeOut(300);e.reload(!1);t.Loader.$mars("#lpath-gt-bubble-learn-more-edit").length>0&&t.Loader.$mars("#lpath-gt-bubble-learn-more-edit").focus()},function(){t.Loader.$mars("#"+e.placeHolderId).remove();e.dialogContainer.fadeOut(300);e.rootElement&&e.rootElement.attr("id")===h?t.Loader.$mars("#lpath-gt-bubble-learn-more-edit").focus():f&&e.rootElement.find('button[id="'+e.containerId+'_lPathAddListOfLinksEdit"]')?e.rootElement.find('button[id="'+e.containerId+'_lPathAddListOfLinksEdit"]').focus():e.rootElement.find('button[id="'+e.containerId+'_lPathAddListOfLinksPlus"]').focus()});e.dialogContainer.append(e.miniGridHolder);e.dialogContainer.fadeIn("slow",function(){t.Loader.$mars("#lPathMiniGridSearchText").focus()})},f.prototype.updateMDDDialogLinkInModel=function(n){var r=(new i.Content.MetaDataJsonElementStructure).LinksModel,u=t.Loader.$mars('input[id="lPathLinkToUniqueName"]').val();r.Url=u;r.OpenInNew="inline";r.Title=t.Loader.$mars('input[id="lPathLinkText"]').val();r.LinkType=i.Utility.LinkType.DialogBox;r.DialogHeight=t.Loader.$mars('input[id="lPathDialogHeight"]').val();r.DialogWidth=t.Loader.$mars('input[id="lPathDialogWidth"]').val();r.CallbackFuntion=t.Loader.$mars('input[id="lPathCallbackFunction"]').val();r.ControlReference=null;n.content.Links.push(r);n.reload(!1)},f.prototype.updateWebPageLinkInModel=function(r){var u,f;u=r.selectedLinkIndex<r.content.Links.length?r.content.Links[r.selectedLinkIndex]:(new i.Content.MetaDataJsonElementStructure).LinksModel;f=t.Loader.$mars('input[id="lPathLinkToUrl"]');u.LinkType=i.Utility.LinkType.WebPage;u.OpenInNew=t.Loader.$mars(t.Loader.$mars.find('input[name="openInNew"]:checked')).val();var e="http://",o="https://",s=f.val().substr(0,e.length).toLowerCase(),h=f.val().substr(0,o.length).toLowerCase();u.Url=s!==e&&h!==o&&u.OpenInNew!=="inline"?e+f.val():f.val();n.Client.Utility.ParameterizedURLManager.GetInstance().Validate(u.Url).isValid&&(u.Url=n.Client.Utility.ParameterizedURLManager.GetInstance().FormatUrl(u.Url));u.Url.substr(u.Url.lastIndexOf(".")+1).toLowerCase()!="js"?(u.Title=t.Loader.$mars('input[id="lPathLinkText"]').val(),u.OpenInNew=t.Loader.$mars(t.Loader.$mars.find('input[name="openInNew"]:checked')).val(),u.DialogHeight=t.Loader.$mars('input[id="lPathDialogHeight"]').val(),u.DialogWidth=t.Loader.$mars('input[id="lPathDialogWidth"]').val(),u.CallbackFunction=t.Loader.$mars('input[id="lPathCallbackFunction"]').val(),u.ControlReference=null,r.selectedLinkIndex<r.content.Links.length?r.content.Links[r.selectedLinkIndex]=u:r.content.Links.push(u),r.reload(!1)):i.Util.Common.showAlertMessage(i.Locale.alertTitle,i.Locale.invalidUrlLol,r.rootElement,!1)},f.prototype.updatePageInAppLinkInModel=function(n,r){var u,f;n.selectedLinkIndex<n.content.Links.length?u=n.content.Links[n.selectedLinkIndex]:(u=(new i.Content.MetaDataJsonElementStructure).LinksModel,u.LinkType=i.Utility.LinkType.PageInApp);r&&(u.PageNavigationInfo=JSON.stringify(r));f=t.Loader.$mars("#lPathLinkToPageInAppNavigationPath").val();f&&(u.Title=f);u.ControlReference=null;n.selectedLinkIndex<n.content.Links.length?n.content.Links[n.selectedLinkIndex]=u:u.Title.trim()!==""&&r&&n.content.Links.push(u);t.Loader.$mars("#lPathLinkToPageInAppNavigationPath").is(":visible")?f?n.reload(!1):n.reload(!0):n.reload(!0)},f.prototype.updatePageInAppLink=function(n,i){n.openListOfLinkPopUp(n,n.content.Links[n.selectedLinkIndex],n.selectedLinkName,i);n.updateLinkType(n,n.selectedLinkName);t.Loader.$mars("#lPathLinkToPageInAppCrmPageInfo").show()},f.prototype.selectsidebarnavigationmode=function(n,t,u){t.listOfLinkDialog&&t.listOfLinkDialog.hide();var e=r.TemplateEngine.applyTemplate(i.Util.Constants.sidebarNavigationSelectionPopup,null),f=new r.SimpleDialogView({},t.genericPopupHolder,"sidebarnavigation",i.Locale.sideBarNavigationCaption,e,function(){t.getData(n,t,u);t.reload();u&&t.rootElement.find('button[id="'+t.containerId+'_lPathAddListOfLinksEdit"]')?t.rootElement.find('button[id="'+t.containerId+'_lPathAddListOfLinksEdit"]').focus():t.rootElement.find('button[id="'+t.containerId+'_lPathAddListOfLinksPlus"]').focus()},function(){u&&t.rootElement.find('button[id="'+t.containerId+'_lPathAddListOfLinksEdit"]')?t.rootElement.find('button[id="'+t.containerId+'_lPathAddListOfLinksEdit"]').focus():t.rootElement.find('button[id="'+t.containerId+'_lPathAddListOfLinksPlus"]').focus()});f.okCaption=i.Locale.nextValue;f.addDoNotShowCheck=!1;f.showCancel=!0;f.show()},f.prototype.getData=function(n,r,u){for(var e,f=0;f<n.length;f++)e=(new i.Content.MetaDataJsonElementStructure).LinksModel,e.ControlReference.ControlId=n[f].controlId,e.ControlReference.ControlVersionId=n[f].controlVersionId,e.LinkType=r.selectedLinkName,e.Title=n[f].title==undefined||n[f].title.trim()==""?n[f].controlName:n[f].title,r.selectedLinkName==i.Utility.LinkType.Sidebar&&(e.EnableNavigation=t.Loader.$mars(t.Loader.$mars.find('input[name="navigationOption"]')).is(":checked")),r.content.Links.length!=0&&r.checkExistingControl(r.content.Links,n[f],r.selectedLinkName,r.selectedLinkIndex,u)||(r.selectedLinkIndex!==undefined?(r.content.Links[r.selectedLinkIndex]=e,r.selectedLinkIndex++):r.content.Links.push(e))},f.prototype.reload=function(n,r){if(r===void 0&&(r=!1),r||(this.unsubscribe(),this.initializeControls()),n){var u=this;this.innerControlUpdateCallback(this.content,!0,this.sectionIndex,function(n,t){u.updatePageInAppLink(u,n);u.originalControlPageNavigationObject=JSON.parse(t)})}else this.selectedLinkName==i.Utility.LinkType.PageInApp&&this.originalControlPageNavigationObject&&this.selectedLinkIndex!==undefined&&this.content.Links[this.selectedLinkIndex].PageNavigationInfo[t.Loader.appContext.ClientType]!==this.originalControlPageNavigationObject[t.Loader.appContext.ClientType]&&i.App.appContext.getPageNavigationInfo()[t.Loader.appContext.ClientType]!==this.originalControlPageNavigationObject[t.Loader.appContext.ClientType]&&i.App.appContext.navigateToPage(this.originalControlPageNavigationObject),this.innerControlUpdateCallback(this.content,!1,this.sectionIndex)},f.prototype.createMiniGridHolder=function(n){var r=this;r.placeHolderId=r.containerId+n;r.miniGridHolder=t.Loader.$mars('<div class="lpath-lol-minigrid-placeholder" id="'+r.placeHolderId+'" style="width:100%;"/>');r.miniGridHolder.css("z-index",i.App.lPathDesignerContainerZIndex+5);r.dialogContainer.html("");r.dialogContainer.append(r.miniGridHolder)},f.prototype.checkExistingControl=function(n,r,u,f,e){for(var s=this,h,c=[],o=0;o<n.length;o++)if(n[o].ControlReference&&n[o].ControlReference.ControlId==r.controlId&&o!=f)return u===i.Utility.LinkType.Sidebar?c.push(i.Locale.sidebarAlreadyExists):c.push(i.Locale.gtAlreadyExists),h=e&&s.rootElement.find('button[id="'+s.containerId+'_lPathAddListOfLinksEdit"]')?s.containerId+"_lPathAddListOfLinksEdit":s.containerId+"_lPathAddListOfLinksPlus",i.Util.Common.showErrorMessage(c,function(){t.Loader.$mars("#"+h).focus()},function(){t.Loader.$mars("#"+h).focus()}),!0;return!1},f.prototype.validateListofLink=function(){var n=!0,u=[],r,e=this.rootElement.find("#lPathListOfLinkTypes").val(),o,s,f;if(e==i.Utility.LinkType.WebPage){var h=this.rootElement.find('input[id="lPathLinkToUrl"]').val(),c=this.rootElement.find('input[id="lPathOpenInNewTab"]:checked').val(),l=this.rootElement.find('input[id="lPathOpenInNewWindow"]:checked').val(),a=this.rootElement.find('input[id="lPathOpenInline"]:checked').val();h.trim()==""&&(u.push(i.Locale.enterURL),n=!1,r="lPathLinkToUrl");c||l||a||(u.push(i.Locale.requiredRadioButtons),n=!1,r="lPathOpenInNewTab")}return o=this.rootElement.find("#lPathLinkToPageInAppCrmPageInfo").is(":visible"),e==i.Utility.LinkType.PageInApp&&o&&(s=this.rootElement.find('input[id="lPathLinkToPageInAppNavigationPath"]').val(),s.trim()==""&&(u.push(i.Locale.requiredlinkedPage),n=!1,r="lPathLinkToPageInAppNavigationPath")),e==i.Utility.LinkType.DialogBox&&(f=this.rootElement.find('input[id="lPathLinkToUniqueName"]').val(),f=f.trim(),f&&/\s/.test(f)&&(u.push(i.Locale.enterUniqueName),n=!1,r="lPathLinkToUniqueName")),n||i.Util.Common.showErrorMessage(u,function(){t.Loader.$mars("#"+r).focus()},function(){t.Loader.$mars("#"+r).focus()}),n},f}(r.View);r.AddListOfLinksView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(r){function u(){r.apply(this,arguments)}return __extends(u,r),u.prototype.build=function(){},u.prototype.initializeControls=function(){try{this.viewDataValue=this.content;this.genericPopupHolder=this.getGenericDialogHolder(t.App.lPathDesignerContainer);this.containerId=this.rootElement.attr("id");r.prototype.attachEvents.call(this);r.prototype.createMiniGridPopup.call(this)}catch(i){n.Loader.marsExceptionHandler.execute(i.name,i.message)}},u.prototype.onNextClick=function(n){n.selectExistingControlByType(t.Utility.LinkType.Sidebar,n.selectsidebarnavigationmode)},u.prototype.openListOfLinkPopUp=function(n,r,u,f){var e=i.TemplateEngine.applyTemplate(t.Util.Constants.listOfLinksPopupTemplate,r);this.listOfLinkDialog=new i.SimpleDialogView({},this.genericPopupHolder,"ListOfLinkPopupTemplate",t.Locale.defineLink,e,function(){n.onNextClick(n,f)},function(){});this.listOfLinkDialog.okValidationCallback=n.validateListofLink},u.prototype.editButtonSelectedLink=function(){var n=this;this.selectExistingControlByType(t.Utility.LinkType.Sidebar,function(t){n.selectsidebarnavigationmode(t,n)})},u.prototype.selectsidebarnavigationmode=function(n,t){t.getData(n,t);t.reload()},u}(i.AddListOfLinksView),u;i.AddListOfLinkForInfo=r;u=function(n){function u(t){n.call(this,t);this.model=t.model;this.$el=t.el}return __extends(u,n),u.prototype.render=function(){var r=i.TemplateEngine.applyTemplate(t.Util.Constants.infoBubbleDisplayViewTemplate,this.bubbleModel.toJSON());return this.$el.html(r),this.contentContainerElement=this.$el.find("#lpath_GT_Bubble_InfoContent"),n.prototype.render.call(this)},u.prototype.close=function(){this.$el.off("change","#lpath-gt-bubble-learn-more-text")},u.prototype.handleLearnMoreEvents=function(n){var t=this;n.find("#lpath-gt-bubble-learn-more-edit").click(function(){return t.learnMore()});n.on("change","#lpath-gt-bubble-learn-more-text",function(){t.bubbleModel.attributes.LearnMoreCaption=n.find("#lpath-gt-bubble-learn-more-text").val()})},u.prototype.getBubbleModel=function(){return this.bubbleModel},u.prototype.updateContainerElement=function(n){this.contentContainerElement=n.find("#lpath_GT_Bubble_InfoContent");n.find("#lpath-gt-bubble-learn-more-text").val(this.model.attributes.LearnMoreCaption);this.handleLearnMoreEvents(n)},u.prototype.learnMore=function(){var n=this.model.toJSON(),t=new r(n.ControlId,n.StepIndex,n,this.$el,this.updateInfoCallback.bind(this));n.Links.length==0?(t.openListOfLinkPopUp(t,null),t.listOfLinkDialog.onOkClick()):t.editButtonSelectedLink(event,null)},u.prototype.updateInfoCallback=function(){this.render()},u}(i.BaseStepBubble);i.InfoStepBubble=u})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(i){function r(){i.apply(this,arguments)}return __extends(r,i),r.prototype.render=function(){var r=t.TemplateEngine.applyTemplate(n.Util.Constants.waitingBubbleDisplayViewTemplate,this.bubbleModel);return this.$el.html(r),this.contentContainerElement=this.$el.find("#lpath_GT_Bubble_WaitingContent"),this.handleEvents(),i.prototype.render.call(this,!0)},r.prototype.handleEvents=function(){},r.prototype.getBubbleModel=function(){return this.bubbleModel},r.prototype.updateContainerElement=function(n){this.contentContainerElement=n.find("#lpath_GT_Bubble_WaitingContent")},r}(t.BaseStepBubble);t.WaitingStepBubble=i})(t=n.Renderer||(n.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(i){function r(){i.apply(this,arguments)}return __extends(r,i),r.prototype.render=function(){var r=t.TemplateEngine.applyTemplate(n.Util.Constants.hybridBubbleDisplayViewTemplate,this.bubbleModel);return this.$el.html(r),this.contentContainerElement=this.$el.find("#lpath_GT_Bubble_HybridContent"),this.handleEvents(),i.prototype.render.call(this,!0)},r.prototype.handleEvents=function(){},r.prototype.getBubbleModel=function(){return this.bubbleModel},r.prototype.updateContainerElement=function(n){this.contentContainerElement=n.find("#lpath_GT_Bubble_HybridContent")},r}(t.BaseStepBubble);t.HybridStepBubble=i})(t=n.Renderer||(n.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(i){function r(){i.apply(this,arguments)}return __extends(r,i),r.prototype.render=function(){var r=t.TemplateEngine.applyTemplate(n.Util.Constants.activeBubbleDisplayViewTemplate,this.bubbleModel);return this.$el.html(r),this.contentContainerElement=this.$el.find("#lpath_GT_Bubble_ActiveContent"),this.handleEvents(),i.prototype.render.call(this)},r.prototype.handleEvents=function(){},r.prototype.getBubbleModel=function(){return this.bubbleModel},r.prototype.updateContainerElement=function(n){this.contentContainerElement=n.find("#lpath_GT_Bubble_ActiveContent")},r}(t.BaseStepBubble);t.ActiveStepBubble=i})(t=n.Renderer||(n.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(r){function u(n,t,i,u,f){r.call(this);this.saveCallback=t;this.bubbleCloseCallback=i;this.moveCallback=u;this.onCopyCallback=f;this.hasChanges=!1;this.isTabKey=!1;this.bubbleInView=!1;this.stepModel=n.stepModel;this.isInEditMode=n.isEditMode;this.isInEditMode||(this.totalSteps=n.totalSteps)}return __extends(u,r),u.prototype.close=function(){this.bubbleInView=!1;this.stepBubbleRenderer&&(this.stepBubbleRenderer.RemoveStepBubble(),this.stepBubbleRenderer=null);this.unwireEvents()},u.prototype.render=function(){return this.renderStepBubble(),this},u.prototype.onSave=function(){this.hasChanges=!1},u.prototype.isCurrentModelValueUpdated=function(){return this.hasChanges},u.prototype.removeBubble=function(n){n&&n.ControlId==this.stepModel.ControlId||this.close()},u.prototype.isBubbleInView=function(){return this.bubbleInView},u.prototype.renderStepBubble=function(){this.bubbleInView=!0;this.stepBubbleRenderer?this.stepBubbleRenderer.RemoveStepBubble():this.stepBubbleRenderer=new i.StepBubbleRenderer;this.stepBubbleRenderer.stepModelValue=this.stepModel;var r=this.isInEditMode?i.TemplateEngine.applyTemplate(t.Util.Constants.stepBubbleContainerTemplate,this.stepModel):this.applyPreviewTemplate(this.stepModel.MetadataJson.Content.ContentType),u=n.Loader.$mars(n.Loader.$mars.parseHTML(r));this.renderChild(u.find("#lpath_GT_Bubble_MainContainer_Content"));r=u.prop("outerHTML");this.stepBubbleRenderer.DisplayStepBubble(this.totalSteps,r,this.stepModel.MetadataJson.Index,this.stepModel.MetadataJson.PlacementPosition,this.isInEditMode,this.bubbleCloseCallback)&&(this.$el=n.Loader.$mars("#"+this.stepModel.ControlId),this.isInEditMode?(this.titleHolder=this.$el.find("#lpath_section_textTemplate_title"),this.titleHolder.focus(),this.handleToolbarPosition(),this.child.updateContainerElement(this.$el.find("#lpath_GT_Bubble_MainContainer_Content")),this.wireEvents(),window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline('img[class^="lpath-flow-default"]')):this.stepModel.MetadataJson.ShowBubbleElementPointer?n.Loader.$mars("#"+this.stepModel.ControlId+window.Microsoft.Mars.Client.Runtime.Controls.BubbleUtilityConstants.transparentArrowName).show():n.Loader.$mars("#"+this.stepModel.ControlId+window.Microsoft.Mars.Client.Runtime.Controls.BubbleUtilityConstants.transparentArrowName).hide())},u.prototype.renderChild=function(n){switch(this.stepModel.ControlType){case t.Utility.ControlTypes.ActiveStep:this.child=new i.ActiveStepBubble({model:this.getChildModel(),el:n});break;case t.Utility.ControlTypes.InfoBubble:this.child=new i.InfoStepBubble({model:this.getChildModel(),el:n});break;case t.Utility.ControlTypes.HybridStep:this.child=new i.HybridStepBubble({model:this.getChildModel(),el:n});break;case t.Utility.ControlTypes.WaitingStep:this.child=new i.WaitingStepBubble({model:this.getChildModel(),el:n});break;default:this.child=new i.PassiveStepBubble({model:this.getChildModel(),el:n})}this.child.render()},u.prototype.applyPreviewTemplate=function(n){var r=null;switch(n){case i.BaseStepBubble.videoType:r=i.TemplateEngine.applyTemplate(t.Util.Constants.gtTitleVideoPreviewTemplate,this.stepModel);break;case i.BaseStepBubble.twoButtonType:r=i.TemplateEngine.applyTemplate(t.Util.Constants.twobuttonPreviewTemplate,this.stepModel);break;default:r=i.TemplateEngine.applyTemplate(t.Util.Constants.gtTitleTextPreviewTemplate,this.stepModel)}return r},u.prototype.getChildModel=function(){var n=new i.StepBubbleMetadata({isInEditMode:this.isInEditMode,Content:this.stepModel.MetadataJson.Content,StepIndex:this.stepModel.MetadataJson.Index,ControlId:this.stepModel.ControlId,Links:this.stepModel.MetadataJson.Links});return this.stepModel.ControlType==t.Utility.ControlTypes.InfoBubble&&(n.attributes.LearnMoreCaption=this.stepModel.MetadataJson.LearnMoreCaption),n},u.prototype.wireEvents=function(){var r=this,i=this;i.$el.on("click","#lpath_gt_bubble_save",function(n){i.onSaveClick();n.preventDefault();n.stopPropagation()});i.$el.on("click","#lpath_gt_bubble_edit",function(n){i.onEditClick();n.preventDefault();n.stopPropagation()});i.$el.on("click","#lpath_gt_bubble_chat",function(n){i.onSaveClick();i.onChangePlacementPositionClick();n.preventDefault();n.stopPropagation()});i.$el.on("click",".lpath-gt-bubble-contenttype-dropdown > li",function(n){i.onContentTypeChangeConfirmation(n)});i.$el.on("click",".lpath-gt-bubble-placement-dropdown > li",function(n){i.onPlacementPositionChange(n)});i.$el.on("click","#lpath_gt_bubble_close",function(n){i.onCloseButtonClick();n.preventDefault();n.stopPropagation()});i.$el.on("mousedown","#lpath_gt_bubble_drag",function(n){i.onMove();n.preventDefault();n.stopPropagation()});i.$el.on("click","#lpath_gt_bubble_copy",function(n){i.onCopy();n.preventDefault();n.stopPropagation()});i.$el.on("focusin mouseover","#lpath_gt_bubble_drag, #lpath_gt_bubble_edit, #lpath_gt_bubble_chat, #lpath_gt_bubble_copy, #lpath_gt_bubble_save",function(){n.Loader.$mars(this).addClass("lpath-gt-edit-themeColor")});i.$el.on("focusout mouseout","#lpath_gt_bubble_drag, #lpath_gt_bubble_edit, #lpath_gt_bubble_chat, #lpath_gt_bubble_copy, #lpath_gt_bubble_save",function(){n.Loader.$mars(this).removeClass("lpath-gt-edit-themeColor")});this.getBody().on("keydown",function(n){n.keyCode==t.Utility.KeyCodeEnum.EscapeKey&&(r.$el.find("#lpath-gt-bubble-contenttype").hasClass("lpath-gt-flow-bubble-flyout-open")&&(r.hideFlyout("lpath-gt-bubble-contenttype"),r.isTabKey=!0,r.$el.find(".lpath-flow-defaultchat").focus()),r.$el.find("#lpath-gt-bubble-placement").hasClass("lpath-gt-flow-bubble-flyout-open")&&(r.hideFlyout("lpath-gt-bubble-placement"),r.$el.find(".lpath-flow-defaultcopy").focus()),n.preventDefault(),n.stopPropagation())});this.onTabFocusBubble();this.hideFlyoutOnOutsideClick()},u.prototype.unwireEvents=function(){var t=this;t.$el.off("click","#lpath_gt_bubble_save");t.$el.off("click","#lpath_gt_bubble_edit");t.$el.off("click","#lpath_gt_bubble_chat");t.$el.off("click",".lpath-gt-bubble-contenttype-dropdown > li");t.$el.off("click",".lpath-gt-bubble-placement-dropdown > li");t.$el.off("click","#lpath_gt_bubble_close");t.$el.off("mousedown","#lpath_gt_bubble_drag");t.$el.off("click","#lpath_gt_bubble_copy");this.$el.find("#lpath_gt_bubble_close").off("keydown");this.$el.off("keydown",".lpath-gt-bubble-edit,.lpath-gt-bubble-chat");this.$el.off("keydown","#lpath_gt_bubble_save,#lpath_gt_bubble_copy");this.$el.off("keydown","#lpath_gt_bubble_drag");this.$el.off("keydown","#lpath_section_textTemplate_title");this.$el.off("click","#lpath_section_textTemplate_title");n.Loader.$mars("#lPathDesignerOverlay").off("keyup");n.Loader.$mars("#lPathDesignerOverlay").off("click")},u.prototype.onSaveClick=function(){if(this.isInEditMode){var n=this.child.getBubbleModel();n.attributes.Content.Title=this.titleHolder.val();this.stepModel.MetadataJson.Content=n.attributes.Content;this.stepModel.ControlType==t.Utility.ControlTypes.InfoBubble&&(this.stepModel.MetadataJson.LearnMoreCaption=n.attributes.LearnMoreCaption,this.stepModel.MetadataJson.Links=this.stepModel.MetadataJson.Links.splice(-1));this.stepModel.MetadataJson.Template=t.Util.Common.getContentPreviewTemplate(n.attributes.Content.ContentType);this.stepModel=t.Util.Common.handleLanguageControlVersionContent(this.stepModel,t.Util.Constants.bubbleViewTemplate,!0,n.attributes.Content.Title);this.stepModel.ObjectState!=t.Utility.LearningPathObjectState.Added&&(this.stepModel.ObjectState=t.Utility.LearningPathObjectState.Modified);this.saveCallback(this.stepModel);this.hasChanges=!0}},u.prototype.onEditClick=function(){this.hideFlyout("lpath-gt-bubble-placement");this.$el.find("#lpath-gt-bubble-contenttype").hasClass("lpath-gt-flow-bubble-flyout-open")?this.hideFlyout("lpath-gt-bubble-contenttype"):this.showFlyout("lpath-gt-bubble-contenttype")},u.prototype.onContentTypeChangeConfirmation=function(i){var r=this;if(this.hideFlyout("lpath-gt-bubble-contenttype"),this.$el.find(".lpath-gt-bubble-passivecontainer").html().trim()=="")this.onContentTypeChange(i);else t.Util.Common.showAlertMessage(t.Locale.bubbleContentTypeChangePopupTitle,t.Locale.bubbleContentTypeChangePopupMessage,this.$el,!0,t.Locale.bubbleChangeTypeCaption,t.Locale.cancelCaption,function(){r.onContentTypeChange(i)},function(){n.Loader.$mars("#lpath_gt_bubble_edit button").focus()});i.stopPropagation()},u.prototype.onContentTypeChange=function(t){var i=n.Loader.$mars(t.target).data("type");if(i)switch(i){case"video":this.child.renderContent("video");break;case"button":this.child.renderContent("two-button");break;default:this.child.renderContent("text")}n.Loader.$mars(".lpath-gt-bubble-chat").focus()},u.prototype.onChangePlacementPositionClick=function(){this.hideFlyout("lpath-gt-bubble-contenttype");this.$el.find("#lpath-gt-bubble-placement").hasClass("lpath-gt-flow-bubble-flyout-open")?this.hideFlyout("lpath-gt-bubble-placement"):this.showFlyout("lpath-gt-bubble-placement")},u.prototype.onPlacementPositionChange=function(t){this.unwireEvents();this.stepModel.MetadataJson.PlacementPosition=n.Loader.$mars(t.target).data("type");this.renderStepBubble();this.hideFlyout("lpath-gt-bubble-placement");t.stopPropagation()},u.prototype.onCloseButtonClick=function(){this.bubbleCloseCallback()},u.prototype.onMove=function(){this.removeBubble();this.moveCallback(this.stepModel.ControlType,this.stepModel,!1)},u.prototype.onCopy=function(){var i=this;this.checkChildHasChanges()?t.Util.Common.showAlertMessage(t.Locale.unSavedBubbleChangesPopupTitle,t.Locale.unSavedBubbleChangesPopupMessage,this.$el,!1,t.Locale.okCaption,!1,function(){n.Loader.$mars("#lpath_gt_bubble_copy button").focus()},function(){n.Loader.$mars("#lpath_gt_bubble_copy button").focus()}):t.Util.Common.showAlertMessage(t.Locale.bubbleCopyPopupTitle,t.Locale.bubbleCopyPopupMessage,this.$el,!0,t.Locale.copyCaption,t.Locale.cancelCaption,function(){i.removeBubble();i.onCopyCallback(i.stepModel);n.Loader.$mars('div[id="lpath_gt_bubble_copy"]').focus()},function(){n.Loader.$mars("#lpath_gt_bubble_copy button").focus()})},u.prototype.checkChildHasChanges=function(){return this.child!=null&&JSON.stringify(this.stepModel.MetadataJson.Content)===JSON.stringify(this.child.getBubbleModel().attributes.Content)?!1:!0},u.prototype.hideFlyout=function(n){this.$el.find("#"+n).removeClass("lpath-gt-flow-bubble-flyout-open");this.$el.find("#"+n).addClass("lpath-gt-flow-bubble-flyout-close")},u.prototype.showFlyout=function(t){var i=t.substr(16);this.$el.find("#"+t).removeClass("lpath-gt-flow-bubble-flyout-close");this.$el.find("#"+t).addClass("lpath-gt-flow-bubble-flyout-open");t==="lpath-gt-bubble-contenttype"?this.gtBubbleOptionsPlacement("contenttype"):t==="lpath-gt-bubble-placement"&&this.gtBubbleOptionsPlacement("placement");n.Loader.$mars("."+t+"-dropdown li:tabbable:first").focus()},u.prototype.onTabFocusBubble=function(){var i=this,r=n.Loader.$mars("#lpath_gt_bubble_drag button");this.$el.on("keydown","#lpath_gt_bubble_edit,#lpath_gt_bubble_chat",function(u){var o=n.Loader.$mars(u.target),c=n.Loader.$mars(u.currentTarget),s,h,f,e;o.is("button")?c.attr("id")=="lpath_gt_bubble_chat"?(f=i.$el.find(".lpath-gt-bubble-contenttype-dropdown li"),f.is(":visible")||(h=i.$el.find("#lpath_gt_bubble_edit button"),s=i.$el.find("#lpath_gt_bubble_copy button"),e="lpath-gt-bubble-placement")):c.attr("id")=="lpath_gt_bubble_edit"&&(f=i.$el.find(".lpath-gt-bubble-contenttype-dropdown li"),f.is(":visible")||(h=i.$el.find("#lpath_gt_bubble_drag button"),s=i.$el.find("#lpath_gt_bubble_chat button"),e="lpath-gt-bubble-contenttype")):o.is("li")&&(s=o.next("li:tabbable"),h=o.prev("li:tabbable"),f=o.closest("ul").find("li"),e=c.attr("id")==="lpath_gt_bubble_edit"?"lpath-gt-bubble-contenttype":"lpath-gt-bubble-placement");switch(u.keyCode){case t.Utility.KeyCodeEnum.UpArrowKey:h.focus();break;case t.Utility.KeyCodeEnum.DownArrowKey:s.focus();break;case t.Utility.KeyCodeEnum.EnterKey:case t.Utility.KeyCodeEnum.SpaceKey:f.is(":visible")?n.Loader.$mars(u.target).click():i.showFlyout(e);break;case t.Utility.KeyCodeEnum.TabKey:u.shiftKey?u.shiftKey&&n.Loader.$mars("#lpath_section_textTemplate_title").focus():(i.hideFlyout(e),n.Loader.$mars("#lpath_gt_bubble_close").focus());r=n.Loader.$mars(u.currentTarget).find("button");break;case t.Utility.KeyCodeEnum.EscapeKey:f.is(":visible")&&(i.hideFlyout(e),n.Loader.$mars(u.currentTarget).find("button").focus())}u.stopPropagation();u.preventDefault()});this.$el.on("keydown","#lpath_gt_bubble_save,#lpath_gt_bubble_copy",function(u){var f=n.Loader.$mars(u.currentTarget);u.keyCode==t.Utility.KeyCodeEnum.EnterKey?n.Loader.$mars(u.target).click():u.keyCode==t.Utility.KeyCodeEnum.UpArrowKey?f.attr("id")=="lpath_gt_bubble_copy"?i.$el.find("#lpath_gt_bubble_chat button").focus():i.$el.find("#lpath_gt_bubble_copy button").focus():u.keyCode==t.Utility.KeyCodeEnum.DownArrowKey?i.$el.find("#lpath_gt_bubble_save button").focus():u.keyCode==t.Utility.KeyCodeEnum.TabKey&&(u.shiftKey?u.shiftKey&&n.Loader.$mars("#lpath_section_textTemplate_title").focus():n.Loader.$mars("#lpath_gt_bubble_close").focus(),r=n.Loader.$mars(u.currentTarget).find("button"));u.stopPropagation();u.preventDefault()});this.$el.find("#lpath_gt_bubble_close").keydown(function(u){u.keyCode==t.Utility.KeyCodeEnum.EnterKey&&i.$el.find("#lpath_gt_bubble_close").click();u.keyCode==t.Utility.KeyCodeEnum.TabKey&&(u.shiftKey?r.focus():n.Loader.$mars("#lpath-mars-toggle-arrow-button").focus(),u.preventDefault(),u.stopPropagation())});n.Loader.$mars("#lpath-mars-toggle-arrow-button").on("keydown",function(i){i.keyCode==t.Utility.KeyCodeEnum.TabKey&&(i.shiftKey?n.Loader.$mars("#lpath_gt_bubble_close").focus():n.Loader.$mars("#lpath_section_textTemplate_title").focus(),i.preventDefault())});this.$el.on("keydown","#lpath_gt_bubble_drag",function(u){u.which==t.Utility.KeyCodeEnum.SpaceKey||u.which==t.Utility.KeyCodeEnum.EnterKey?(i.removeBubble(),n.Loader.$mars(u.target).focus(),i.moveCallback(i.stepModel.ControlType,i.stepModel,!0)):u.keyCode===t.Utility.KeyCodeEnum.DownArrowKey?i.$el.find("#lpath_gt_bubble_edit button").focus():u.keyCode===t.Utility.KeyCodeEnum.TabKey&&(u.shiftKey?u.shiftKey&&n.Loader.$mars("#lpath_section_textTemplate_title").focus():n.Loader.$mars("#lpath_gt_bubble_close").focus(),r=n.Loader.$mars(u.target));u.preventDefault();u.stopPropagation()});this.$el.find("#lpath_GT_Bubble_PassiveContainer").on("click",function(t){var i=n.Loader.$mars("#lpath-gt-bubble-contenttype,#lpath-gt-bubble-placement");!i.is(t.target)&&i.has(t.target).length===0&&(this.$el.find("#lpath-gt-bubble-contenttype").hasClass("lpath-gt-flow-bubble-flyout-open")||this.$el.find("#lpath-gt-bubble-placement").hasClass("lpath-gt-flow-bubble-flyout-open"))&&(this.hideFlyout("lpath-gt-bubble-contenttype"),this.hideFlyout("lpath-gt-bubble-placement"))});this.$el.find("#lpath_section_textTemplate_title").on("keydown",function(i){i.keyCode===t.Utility.KeyCodeEnum.TabKey&&(i.shiftKey?(n.Loader.$mars("#lpath-mars-toggle-arrow-button").focus(),i.preventDefault(),i.stopPropagation()):i.shiftKey||(r.focus(),i.preventDefault(),i.stopPropagation()))})},u.prototype.hideFlyoutOnOutsideClick=function(){var t=this;n.Loader.$mars("#lPathDesignerOverlay").off("click").on("click",function(i){var r=n.Loader.$mars("#lpath-gt-bubble-contenttype,#lpath-gt-bubble-placement");!r.is(i.target)&&r.has(i.target).length===0&&(t.$el.find("#lpath-gt-bubble-contenttype").hasClass("lpath-gt-flow-bubble-flyout-open")||t.$el.find("#lpath-gt-bubble-placement").hasClass("lpath-gt-flow-bubble-flyout-open"))&&(t.hideFlyout("lpath-gt-bubble-contenttype"),t.hideFlyout("lpath-gt-bubble-placement"))})},u.prototype.gtBubbleOptionsPlacement=function(n){var t=this.$el.position().top,i=this.$el.position().left;t<300&&i<150?this.$el.find("#lpath-gt-bubble-"+n).addClass("lpath-gt-bubble-"+n+"-right-bottom").removeClass("lpath-gt-bubble-"+n+"-left-bottom lpath-gt-bubble-"+n+"-right-top lpath-gt-bubble-"+n+"-left-top"):this.$el.position().top<300&&this.$el.position().left>150?this.$el.find("#lpath-gt-bubble-"+n).addClass("lpath-gt-bubble-"+n+"-left-bottom").removeClass("lpath-gt-bubble-"+n+"-right-bottom lpath-gt-bubble-"+n+"-right-top lpath-gt-bubble-"+n+"-left-top"):this.$el.position().top>300&&this.$el.position().left<150?this.$el.find("#lpath-gt-bubble-"+n).addClass("lpath-gt-bubble-"+n+"-right-top").removeClass("lpath-gt-bubble-"+n+"-left-bottom lpath-gt-bubble-"+n+"-right-bottom lpath-gt-bubble-"+n+"-left-top"):this.$el.find("#lpath-gt-bubble-"+n).addClass("lpath-gt-bubble-"+n+"-left-top").removeClass("lpath-gt-bubble-"+n+"-left-bottom lpath-gt-bubble-"+n+"-right-top lpath-gt-bubble-"+n+"-right-bottom")},u.prototype.getBody=function(){return n.Loader.appContext.ClientType==t.Util.Constants.WebClientType?t.$mars("body"):t.$mars(document).find("body")},u.prototype.handleToolbarPosition=function(){var n=this.$el.find("#lpath_GT_Bubble_ContentContainer"),t=this.$el.find("#lpath_GT_Bubble_MainContainer_toolBar");this.$el.attr("data-arrow-position")==="right"?(n.hasClass("lpath-gt-bubble-main-container-right")||n.addClass("lpath-gt-bubble-main-container-right"),t.hasClass("lpath_GT_Bubble_MainContainer_toolBar_right")||t.addClass("lpath_GT_Bubble_MainContainer_toolBar_right")):(n.hasClass("lpath-gt-bubble-main-container-right")&&n.removeClass("lpath-gt-bubble-main-container-right"),t.hasClass("lpath_GT_Bubble_MainContainer_toolBar_right")||t.removeClass("lpath_GT_Bubble_MainContainer_toolBar_right"))},u}(BackboneMars.View);i.StepBubbleContainerView=r})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var f=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{}},t.prototype.initialize=function(){},t}(BackboneMars.Model),u;r.BackboneControlAnalyzeModel=f;u=function(u){function f(n){u.call(this);this.collection=n.collection;this.$el=n.el}return __extends(f,u),f.prototype.initialize=function(){},f.prototype.close=function(){},f.prototype.render=function(){var u=this,f=new r.AnalyticsTelemetry,o;f.startActivity(r.AnalyticsTelemetryType.Analyze);o=r.TemplateEngine.applyTemplate(i.Util.Constants.analyzeTemplate,null,!1,!0,!1);this.$el.html(o);var h=n.Client.Designer.ServiceHandler.getInstance(),e=[],s=h.getAllReportNames();return s.done(function(n){if(n!=null&&n.Result!=null){n.Result.sort(function(n,t){return n>t?1:-1});t.Loader.$mars.each(n.Result,function(n,t){e.push({value:t,title:i.Locale[t]})});var r={listItems:e,selectedItem:e[0]};u.loadAnalyzeMenu(r);u.loadAnalyzeContainer(r);u.menuView.currentView=u.containerView.currentView;f.finishActivity("loaded")}}),s.fail(function(){u.renderError(i.Util.Constants.internalServerError,i.Locale.InternalServerError,i.Locale.InternalServerErrorMessage);f.finishActivity("failed")}),this},f.prototype.loadAnalyzeMenu=function(n){this.menuView=new r.AnalyzeMenuView({collection:n,el:this.$el});this.menuView.render()},f.prototype.loadAnalyzeContainer=function(n){this.containerView=new r.AnalyzeContainerView({collection:n,el:this.$el});this.containerView.render()},f.prototype.renderError=function(n,i,u){var e=t.Loader.$mars("#mars-analyze-simpleDialogHolder"),f=new r.SimpleDialogView({},e,n,i,u);f.addDefaultFocusOnOkOrClose=!0;f.ariaDescribedById=n;f.show()},f}(BackboneMars.View);r.AnalyzeView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{}},t.prototype.initialize=function(){},t}(BackboneMars.Model),i;t.BackboneControlAnalyzeContainerModel=r;i=function(i){function r(n){i.call(this);this.collection=n.collection;this.selectedItem=n.collection.selectedItem;this.$el=n.el}return __extends(r,i),r.prototype.initialize=function(){},r.prototype.close=function(){},r.prototype.render=function(){var u=this,r=new t.AnalyticsTelemetry,f=t.TemplateEngine.applyTemplate(n.Util.Constants.analyzeContainerTemplate,this.collection,!1,!0,!1),i;this.$el.find("#lpath-analyze").append(f);r.startActivity(this.selectedItem.title);i=n.App.lPathDesignerContainer.find("#backToCRMLink");i.removeClass();i.addClass("lpath-ap-close lpath-analyzeview");this.currentView=new t.AnalyzeReportView({current:{reportName:this.selectedItem.value},el:this.$el,analyticsTelemetry:r});this.currentView.render();this.$el.on("click","#lpath-analyze-backtomars",function(n){u.backToMars(n)});return this.$el.find("#lpath-analyze-backtomars").keypress(function(n){n.keyCode==13&&this.click()}),this.$el.find(".lpath-analyze-emptyDiv").keyup(function(t){t.keyCode===n.Utility.KeyCodeEnum.TabKey&&(n.App.lPathDesignerContainer.find("#backToCRMLink").focus(),t.stopPropagation(),t.preventDefault())}),this.$el.find(".lpath-analyze-menuitemslist > li.active").keydown(function(t){t.keyCode==n.Utility.KeyCodeEnum.TabKey&&t.shiftKey&&n.App.lPathDesignerContainer.find("#backToCRMLink").focus()}),this},r.prototype.backToMars=function(){n.App.show()},r}(BackboneMars.View);t.AnalyzeContainerView=i})(t=n.Renderer||(n.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var f=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{}},t.prototype.initialize=function(){},t}(BackboneMars.Model),u;r.BackboneControlAnalyzeMenuModel=f;u=function(u){function f(n){u.call(this);this.currentView=null;this.collection=n.collection;this.selectedItem=n.collection.selectedItem;this.$el=n.el;this.menuelement=null}return __extends(f,u),f.prototype.close=function(){},f.prototype.render=function(){var u=this,o=r.TemplateEngine.applyTemplate(i.Util.Constants.analyzeMenuTemplate,this.collection,!1,!0,!1),f,e;this.$el.find("#lpath-analyze").html(o);this.menuelement=this.$el.find(".lpath-analyze-menuitemslist > li");this.menuelement.click(function(n){return u.renderContent(n)});this.menuelement.on("keydown",function(i){n.Client.Loader.appContext.Util.isEnterPressed(i,!0)?u.renderContent(i):(i.keyCode==t.Utility.KeyCodeEnum.UpArrowKey||i.keyCode==t.Utility.KeyCodeEnum.DownArrowKey)&&r.MenuKeyboardHandler.toggleUpDown(i.keyCode,u.menuelement)});return f=this.selectedItem,e=this.menuelement.filter(function(){return this.getAttribute("data-value").toLowerCase()==f.value.toLowerCase()}),this.selectItem(e),this},f.prototype.renderContent=function(n){var f=new r.AnalyticsTelemetry,e=this.menuelement.filter(function(){return this.getAttribute("class")=="active"}),u;this.deSelectItem(e);this.selectItem(n.currentTarget);r.MenuKeyboardHandler.setFocus(this.menuelement,n.currentTarget);this.$el.find(".lpath-analyze-selecteditem").text(n.currentTarget.innerText).attr("title",n.currentTarget.innerText);u=t.Loader.$mars(n.currentTarget).attr("data-value");f.startActivity(i.Locale[u]);this.currentView=new r.AnalyzeReportView({current:{reportName:u},el:this.$el,analyticsTelemetry:f});this.currentView&&this.currentView.render();n.preventDefault()},f.prototype.selectItem=function(n){t.Loader.$mars(n).addClass("active");t.Loader.$mars(n).attr("tabindex","0");t.Loader.$mars(n).focus();t.Loader.$mars(n).attr("aria-selected","true");i.App.SetPageTitleToMars(t.Loader.$mars(n).text())},f.prototype.deSelectItem=function(n){t.Loader.$mars(n).removeClass("active");t.Loader.$mars(n).attr("tabindex","-1");t.Loader.$mars(n).attr("aria-selected","false")},f}(BackboneMars.View);r.AnalyzeMenuView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),Object.defineProperty(t.prototype,"ReportName",{get:function(){return this.reportName},set:function(n){this.reportName=n},enumerable:!0,configurable:!0}),t.prototype.BackboneControlAnalyzeReportModel=function(n){this.ReportName=n},t.prototype.defaults=function(){return{}},t.prototype.initialize=function(){},t}(BackboneMars.Model),f;r.BackboneControlAnalyzeReportModel=u;f=function(f){function e(n){f.call(this);this.currentItem=new u(n.current.reportname,n.analyticsTelemetry);this.currentItem.ReportName=n.current.reportName;this.$el=n.el;this.analyticsTelemetry=n.analyticsTelemetry}return __extends(e,f),e.prototype.initialize=function(){},e.prototype.close=function(){},e.prototype.render=function(){var u="",f="",e="",r=null,s=n.Client.Designer.ServiceHandler.getInstance(),h={DatasetName:this.currentItem.ReportName},o=s.getReportDetails(h),t=this;return o.done(function(n){var s,o,h;if(n==undefined||n==null||!t.validateReportDetails(n.Result)){t.renderError(i.Util.Constants.internalServerError,i.Locale.ResponseFailure,i.Locale.ResponseFailureMessage);t.analyticsTelemetry.finishActivity("failed");return}r=n.Result;u=r.PowerBIAccessToken;f=r.PowerBIUrl;e=r.PowerBIReportId;s={type:"report",accessToken:u,id:e,embedUrl:f,settings:{filterPaneEnabled:!0,navContentPaneEnabled:!0}};o=t.$el.find("#lpath-analyze-container-content")[0];o.powerBiEmbed=undefined;h=window.powerbi;h.embed(o,s);t.fitAndFocusIframe(i.Locale[t.currentItem.ReportName]);t.analyticsTelemetry.finishActivity("loaded")}),o.fail(function(){t.renderError(i.Util.Constants.internalServerError,i.Locale.InternalServerError,i.Locale.InternalServerErrorMessage);t.analyticsTelemetry.finishActivity("failed")}),this},e.prototype.validateReportDetails=function(n){return n==null||n==undefined?!1:!n.PowerBIAccessToken||!n.PowerBIUrl||!n.PowerBIReportId?!1:!0},e.prototype.renderError=function(n,i,u){var e=t.Loader.$mars("#mars-analyze-simpleDialogHolder"),f=new r.SimpleDialogView({},e,n,i,u);f.addDefaultFocusOnOkOrClose=!0;f.ariaDescribedById=n;f.show()},e.prototype.fitAndFocusIframe=function(n){var t=this.$el.find("#lpath-analyze-container-content"),i=t.find("iframe"),r,u;t.css("display","flex");i.css("height","inherit");i.css("display","flex");i.attr("title",n);i.focus();r=t.height();u=parseInt(t.css("min-height"),10);r<u&&(r=u);t.css("height",r.toString()+"px")},e}(BackboneMars.View);r.AnalyzeReportView=f})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t){u.call(this,n,t);this.rootElement=n;this.params=t;this.allowToggle=!0;this.pinningMode=!1;this.isViewPostBack=!1;this.sectionTitleHeight=60;this.sectionHeight=40;this.controlCreated=t.controlCreated}return __extends(f,u),f.prototype.build=function(){u.prototype.build.call(this);this.modelValue=this.getCurrentControlValue();this.minMaxDynamicSections=i.Util.Common.getMinMaxDynamicSections(this.modelValue.MetadataJson.Template);this.renderEditModeSidebar();this.setPageNavigationToControl();this.isViewPostBack=!1;this.setdefaultCompareModelValue(this.modelValue)},f.prototype.SaveAllControl=function(n){var t=[];i.$mars.each([],function(i,r){t.push(n.executeControlOpenAndSave(r,n))});i.$mars.when.apply(i.$mars,t).done(function(n){console.log("Control Save Updated - ~~~~~Id"+n)})},f.prototype.executeControlOpenAndSave=function(n,t){var r=i.$mars.Deferred(),u=i.App.store.getControl(n);return u.done(function(u){i.App.store.storeControl(u);t.modelValue=u;t.build();t.modelValue=t.getCurrentControlValue();t.minMaxDynamicSections=i.Util.Common.getMinMaxDynamicSections(t.modelValue.MetadataJson.Template);t.renderEditModeSidebar();t.setPageNavigationToControl();t.isViewPostBack=!1;t.setdefaultCompareModelValue(t.modelValue);var f=t.save(t.modelValue);f.done(function(){t.updateSharedModelValue();console.log("Control Saved: "+n);r.resolve(n)})}),r},f.prototype.setdefaultCompareModelValue=function(n){this.defaultCompareModelValue=JSON.parse(JSON.stringify(n))},f.prototype.isCurrentModelValueUpdated=function(){return JSON.stringify(this.defaultCompareModelValue)===JSON.stringify(this.modelValue)?!1:!0},f.prototype.setFocusOnLoad=function(){this.rootElement.find("#lPathEditHeader").focus()},f.prototype.renderEditModeSidebar=function(){this.renderEditModeSidebarTemplate();u.prototype.isHighContrastModeActive.call(this)&&this.handleEditSidebarHc();this.rootElement.show();this.attachEventsToEditModeSidebar()},f.prototype.renderEditModeSidebarTemplate=function(){var r,f,u;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:renderSidebarTemplate START");try{r=this;this.rootElement.children().remove();this.controlActionToolTabTemplateHolder=this.rootElement.find("div[id='lpathControlActionToolTabTemplateHolder']");this.rootElement.find("div[id='lpathControlActionToolTabTemplateHolder']").length==0&&(f=t.Loader.$mars('<div id="lpathControlActionToolTabTemplateHolder"  class="lpath-control-action-tooltab-template-holder" />'),f.css("z-index",i.App.lPathDesignerContainerZIndex+1),this.rootElement.append(f),this.controlActionToolTabTemplateHolder=this.rootElement.find("div[id='lpathControlActionToolTabTemplateHolder']"));this.propertyTabTemplateHolder=this.rootElement.find("div[id='lpathPropertyTabTemplateHolder']");this.rootElement.find("div[id='lpathPropertyTabTemplateHolder']").length==0&&(u=t.Loader.$mars('<div id="lpathPropertyTabTemplateHolder" class="lpath-property-tab-template-holder" />'),u.css("z-index",i.App.lPathDesignerContainerZIndex+1),this.rootElement.append(u),this.propertyTabTemplateHolder=u);this.bindcompiledTemplate();this.renderControlActionToolTab();this.renderPropertyTab();this.rootElement.find("#lPathControlToolTab").on("keydown",function(n){return r.controlToolTabKeyboardHandling(n,r)});this.rootElement.find("#lPathEditHeaderSidebarContainer").on("keydown",function(n){var t=r.rootElement.find("#lPathControlToolTab").find("button:visible:first");n.keyCode===i.Utility.KeyCodeEnum.TabKey&&n.shiftKey&&(t.focus(),n.preventDefault())});this.renderSectionFooterBuilderControl();this.subscribeSectionEvents()}catch(e){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Expception in rendering sidebartemplate from SidebarSkinnyToolbarView:renderSidebarTemplate");t.Loader.marsExceptionHandler.execute(e.name,e.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:renderSidebarTemplate END")},f.prototype.bindcompiledTemplate=function(){var u,n,t,o;this.templateName=this.modelValue.MetadataJson.Template;var f=this.modelValue,e=i.Util.Common.isDynamicSectionAllowed(this.templateName),s=this.modelValue.Sections.length,h=0;this.templateName&&(e&&(n=this.minMaxDynamicSections,t=s,h=n.Max,n&&n.Min>this.modelValue.Sections.length&&(t=n.Min),this.currentDynamicSectionCount=t,f=this.getModelValueWithDynamicSections(t)),u=r.TemplateEngine.applyTemplate(this.templateName,f,!0),this.rootElement.append(u),this.rootElement.find("#lPathEditSidebarContainer").css("z-index",i.App.lPathDesignerContainerZIndex+2),e&&(o=this.rootElement.find('button[id="lPathAddSection"]'),this.subscribe(o,"click",this.onAddSectionButtonClick),this.hideShowAddSectionContainer()))},f.prototype.onAddSectionButtonClick=function(){var i=this,n,t;this.currentDynamicSectionCount<this.minMaxDynamicSections.Max&&(n=this.currentDynamicSectionCount,this.addDynamicSectionTemplate(n),this.subscribeSectionEvents(),this.handleSectionFooterBuilderControl(n),this.currentDynamicSectionCount++,this.hideShowAddSectionContainer(),t=this.getSectionContainerElement(n),this.rootElement.find('div[id="lpathSectionFooterBuilderControlContainer_'+n+'"]').find(":tabbable:first").focus(),this.scrollToNewlyAddedSection(t),i.attachKeyboardEvents())},f.prototype.addDynamicSectionTemplate=function(n){var u=this.getDynamiceSectionModelValue(n),f=r.TemplateEngine.applyTemplate(i.Util.Constants.editSectionTemplate,u,!1),t=this.rootElement.find("#lpathEditSectionContainer");i.Util.Common.is2x2Template(this.templateName)&&(t=i.Util.Common.isEvenNumber(n)?this.rootElement.find("#lpathEditSectionContainer_left"):this.rootElement.find("#lpathEditSectionContainer_right"));t.append(f)},f.prototype.scrollToNewlyAddedSection=function(){this.rootElement.find("#lPathSidebarSectionContainer").animate({scrollTop:1e4},1e3)},f.prototype.hideShowAddSectionContainer=function(){this.currentDynamicSectionCount>=this.minMaxDynamicSections.Max?this.rootElement.find("#lpathAddSectionContainer").hide():this.rootElement.find("#lpathAddSectionContainer").show()},f.prototype.attachKeyboardEvents=function(){var n=this.rootElement.find("#lPathSidebarSectionContainer").find(":tabbable:last"),t=this.rootElement.parents('div[id="lPathskinnyToolbarContainer"]').find('button[id="lPathSkinnyToolbarHomeButton"]');if(n[0]!=this.propertyTabEditSectionButton[0])n.off("keydown").on("keydown",function(n){n.keyCode!=i.Utility.KeyCodeEnum.TabKey||n.shiftKey||(t.focus(),n.preventDefault(),n.stopPropagation())});t.off("keydown").on("keydown",function(t){t.keyCode==i.Utility.KeyCodeEnum.TabKey&&t.shiftKey&&(n[0].focus(),t.preventDefault(),t.stopPropagation())})},f.prototype.getModelValueWithDynamicSections=function(n){for(var i=JSON.parse(JSON.stringify(this.modelValue)),r=[],t=0;t<n;t++)r.push(this.getDynamiceSectionModelValue(t));return i.DynamicSections=r,i},f.prototype.getDynamiceSectionModelValue=function(n){var t;return t=new i.Content.DynamicSectionModel,t.SectionIndex=n,t},f.prototype.subscribeSectionEvents=function(){var n=this,i=this.rootElement.find('div[data-name="lpath_sidebar_section"]'),r;i.off("click").on("click",function(t){n.onSectionContainerClick(t,n)});i.off("keydown").on("keydown",function(i){if(i.keyCode==t.Loader.$mars.ui.keyCode.ENTER)n.onSectionContainerClick(i,n)});r=this.rootElement.find('div[id="lPathSidebarSectionContainer"]');r.off("scroll").on("scroll",function(t){n.onSectionScroll(t,n)})},f.prototype.onSectionScroll=function(n,t){var i=t.rootElement.find(".lpath-sidebar-section-selected");i.length>0&&(i.hasClass("lpath-edit-section")?t.setPropertyTabPosition(null,i.offset().top+this.sectionTitleHeight):t.setPropertyTabPosition(null,i.offset().top+this.sectionHeight))},f.prototype.onMoreButtonClick=function(n){this.handleSectionContainerClick(n);this.openPropertyTabBuilderControlView(!1,!0,n);var t=this.getSidebarTemplateHolderPositionX();this.setPropertyTabPosition(t,null,!1,!1);this.propertyTab.hide()},f.prototype.getSidebarTemplateHolderPositionX=function(){var t=0,n=i.App.lPathDesignerContainer.find("#lpathSidebarTemplateHolder");return n&&n.length>0&&(t=n.width()),t},f.prototype.handleSectionContainerClick=function(n){var u,i,r;try{this.pinningMode||(this.propertyTabTemplateHolder.detach().appendTo(n.parent()),this.propertyTabTemplateHolder=n.parent().find("div[id='lpathPropertyTabTemplateHolder']"),this.currentSection=n,u=this.rootElement.find('div[data-name="lpath_sidebar_section"]'),u.removeClass("lpath-sidebar-section-selected"),n.addClass("lpath-sidebar-section-selected"),this.selectedSectionIndex=n.data("sectionindex"),this.selectedSectionModel=this.getSelectedSection(this.selectedSectionIndex),this.propertyTab.show(),i=0,r=0,i=this.getSidebarTemplateHolderPositionX(),i&&(r=n.offset().top,r+=this.currentSection.hasClass("lpath-edit-section")?this.sectionTitleHeight:this.sectionHeight,this.setPropertyTabPosition(i,r),this.propertyTabTemplateHolder.show(),this.isSectionClicked=!0),this.handlePropertyTabBuilderControl(this.selectedSectionIndex,!0),this.propertyTabBuilderControlContainer.css({display:"none"}),this.attachKeyboardEvents())}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message)}},f.prototype.setPropertyTabPosition=function(n,t,r,u){r===void 0&&(r=!0);u===void 0&&(u=!0);var f=0,e=0;r&&(f=41,e=4);i.App.appContext.isRTL()?(n&&(this.propertyTabTemplateHolder.css({left:n+f,right:"auto"}),this.propertyTab.css({left:n,right:"auto"})),t&&(this.propertyTabTemplateHolder.css({top:t+e,right:"auto"}),this.propertyTab.css({top:t,right:"auto"}))):(n&&(this.propertyTabTemplateHolder.css({right:n+f,left:"auto"}),this.propertyTab.css({right:n,left:"auto"})),t&&(this.propertyTabTemplateHolder.css({top:t+e,left:"auto"}),this.propertyTab.css({top:t,left:"auto"})));u&&this.resetPropertyTabBuilderControlPosition(r,f)},f.prototype.resetPropertyTabBuilderControlPosition=function(n,t){var f,i,e,r,u,o;n===void 0&&(n=!0);t===void 0&&(t=null);f=this.rootElement.find('div[id="lPathControlToolTab"]').outerHeight();i=0;n&&(i=41);t&&(i=t);e=this.propertyTab.offset().top+this.propertyTab.outerHeight();f<this.propertyTab.offset().top&&e<window.innerHeight?(this.propertyTab.parent().css("visibility","visible"),this.propertyTabBuilderControlContainer.css({top:0}),r=this.propertyTab.offset().top+this.propertyTabBuilderControlContainer.height(),u=window.innerHeight,r>u&&(o=u-r-2,this.propertyTabBuilderControlContainer.css({top:o}))):this.propertyTab.parent().css("visibility","hidden")},f.prototype.onSectionContainerClick=function(n,t){var i=n.currentTarget,r=t.rootElement.find(i);t.handleSectionContainerClick(r)},f.prototype.handlePropertyTabBuilderControl=function(n,i){var u,e,r,f;try{u=null;e=null;this.modelValue.Sections[n]&&(u=this.modelValue.Sections[n].MetadataJson.Template,e=this.modelValue.Sections[n].MetadataJson.Content);r=this;f=this.getSectionContainerElement(n);this.propertyTabBuilderControlView.setBuilderControl(u,e,r.pinningMode,f,n,function(n,t,i,u,e){r.injectToggleButton(f);r.listOfLinkCallback=e;r.setSectionTemplate(n,t,i,u)},function(n,t,i,u,e){r.injectToggleButton(f);r.listOfLinkCallback=e;r.setSectionTemplate(n,t,i,u)},i,r.modelValue.MetadataJson.IsFooterSectionAvailable);this.propertyTabBuilderControlView.hideSelectedTemplate(u)}catch(o){t.Loader.marsExceptionHandler.execute(o.name,o.message)}},f.prototype.emptyPropertyTabifAlreadyExists=function(){this.propertyTabTemplateHolder.is(":empty")||this.propertyTabTemplateHolder.empty()},f.prototype.createPropertyTabBuilderControlView=function(){var f=this.modelValue.MetadataJson.Template,t=i.Util.LPathLocalStorage.retrieve(f),e=[],o=[],u=[],n;if(t.ContentTemplates)for(n=0;n<t.ContentTemplates.length;n++)o.push(t.ContentTemplates[n].LanguageControlVersionContents[0].Title),e.push(t.ContentTemplates[n].ControlName),u.push(i.Util.BuilderControlTemplateTypeEnum[t.ContentTemplates[n].LanguageControlVersionContents[0].Title.replace(/\s/g,"")]);this.propertyTabBuilderControlView=new r.PropertyTabBuilderControlView(this.modelValue.ControlId,this.modelValue.ControlType,this.propertyTabBuilderControlContainer,u)},f.prototype.openPropertyTabBuilderControlView=function(n,i,r){n===void 0&&(n=!0);i===void 0&&(i=!1);r===void 0&&(r=null);var f,e,o=this;if(n?t.Loader.$mars(".builderControlToolbarPrioritySection").css("display","block"):t.Loader.$mars(".builderControlToolbarPrioritySection").css("display","none"),i&&this.resetPropertyTabBuilderControlPosition(),!this.pinningMode){t.Loader.$mars(this.propertyTabEditSectionButton.find("img")[0]).attr("src")===t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.toolbarActiveEdit?this.propertyTabEditSectionButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.runtimeSidebarEditHome):u.prototype.isHighContrastModeActive.call(this)?u.prototype.isBlackHighContrastMode.call(this)?this.propertyTabEditSectionButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.editSectionControlHCB):this.propertyTabEditSectionButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.editSectionControlHCW):this.propertyTabEditSectionButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.sectionToolbarActiveEdit);this.propertyTabBuilderControlContainer.slideToggle("slow");f=this.propertyTabBuilderControlContainer.find("li:visible").first();e=this.propertyTabBuilderControlContainer.find("li:visible").last();f.focus();this.propertyTabBuilderControlContainer.off("keydown").on("keydown",function(n){return o.propertyTabBuilderControlContainerKeyboardHandling(n,e,o,r)})}},f.prototype.onSectionDeleteButtonClick=function(){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarEditorView:deleteSelectedTemplate START");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User clicked on deleteing a section");try{if(this.selectedSectionIndex>=0&&this.modelValue.Sections[this.selectedSectionIndex]&&Object.getOwnPropertyNames(this.modelValue.Sections[this.selectedSectionIndex].MetadataJson.Content).length!=0){var u=this,o="<div>"+i.Locale.deleteSectionConfirmation+(u.selectedSectionIndex+1)+i.Locale.undoDeleteSection+"<\/div>",f=new r.SimpleDialogView({},u.getGenericDialogHolder(),"DeleteSectionconfirmationPopup",i.Locale.deleteSectionTitle,o,function(){u.deleteSelectedSection();u.propertyTabTemplateHolder.hide();u.attachKeyboardEvents()});f.showCancel=!0;f.cancelElementFocus=this.propertyTabDeleteSectionButton;f.ariaDescribedById="DeleteSectionconfirmationPopup";f.show()}}catch(e){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception in deleting template at SidebarEditorView:deleteSelectedTemplate");t.Loader.marsExceptionHandler.execute(e.name,e.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarEditorView:deleteSelectedTemplate END")},f.prototype.isSectionExistInCurrentControl=function(n){var t=this.getCurrentControlValue();return t.Sections&&t.Sections[n]?!0:!1},f.prototype.deleteSelectedSection=function(){var r,u,f;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarEditorView:deleteTemplate START");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User confirmed to be delete the section");r=this.getSectionContainerElement(this.selectedSectionIndex);r.html("");r.append("<label>"+i.Locale.answerPanelSectionNumber+(this.selectedSectionIndex+1)+"<\/label>");u=this.getSectionFooterBuilderControlContainerElement(this.selectedSectionIndex);u.show();r.removeClass("lpath-edit-section");this.modelValue.Sections[this.selectedSectionIndex].MetadataJson.Template===i.Util.Constants.footerSectionTemplate&&(this.modelValue.MetadataJson.IsFooterSectionAvailable=!1);this.modelValue.Sections[this.selectedSectionIndex].MetadataJson.Template="";this.modelValue.Sections[this.selectedSectionIndex].MetadataJson.Content={};this.isSectionExistInCurrentControl(this.selectedSectionIndex)?this.modelValue.Sections[this.selectedSectionIndex].ObjectState=t.Utility.LearningPathObjectState.Deleted:this.modelValue.Sections[this.selectedSectionIndex]=null;this.handleSectionFooterBuilderControl(this.selectedSectionIndex);this.rootElement.find('div[id="lpathSectionFooterBuilderControlContainer_'+this.selectedSectionIndex+'"]').find(":tabbable:first").focus();f=this.getSidebarPreviewHTML();this.modelValue.LanguageControlVersionContents=i.Util.Common.updateHTMLViewContent(this.modelValue.LanguageControlVersionContents,this.modelValue.BaseLcid,f,"");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Section deleted successfully");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarEditorView:deleteTemplate END")},f.prototype.setFocusOutForBuilderControlListItem=function(n,i){var r,u;i===void 0&&(i=null);r=this;r.propertyTabEditSectionButton.is(":visible")?r.propertyTabEditSectionButton.focus():(u=t.Loader.$mars(i).parent().find(".lpath-sidebar-section-footer").find("li:last button"),u.focus());r.propertyTabBuilderControlContainer.hide()},f.prototype.renderPropertyTab=function(){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SideToolbarView:renderPropertyTab START");try{var u=this;this.emptyPropertyTabifAlreadyExists();this.propertyTabTemplateHolder.append(r.TemplateEngine.applyTemplate(i.Util.Constants.propertyTabTemplate,{}));this.propertyTabBuilderControlContainer=this.propertyTabTemplateHolder.find('div[name="lpathPropertyTabBuilderControlContainer"]');this.propertyTabEditSectionButton=this.propertyTabTemplateHolder.find('button[id="lPathPropertyTabEditButton"]');this.propertyTabDeleteSectionButton=this.propertyTabTemplateHolder.find('button[id="lPathPropertyTabSectionDeleteButton"]');this.propertyTab=this.propertyTabTemplateHolder.find('div[id="lPathPropertyTab"]');this.subscribe(this.propertyTabEditSectionButton,"click",function(){u.openPropertyTabBuilderControlView(!0,!0)});this.subscribe(this.propertyTabDeleteSectionButton,"click",this.onSectionDeleteButtonClick);this.createPropertyTabBuilderControlView();this.propertyTabBuilderControlContainer.hide();this.propertyTab.off("keydown").on("keydown",function(n){u.keyboardHandlingOnPropertyTab(n,u)});this.propertyTabEditSectionButton.off("keydown").on("keydown",function(t){t.keyCode==i.Utility.KeyCodeEnum.DownArrowKey&&(n.Client.Loader.$mars(this).next().focus(),t.preventDefault())});this.propertyTabDeleteSectionButton.off("keydown").on("keydown",function(t){if(t.keyCode==i.Utility.KeyCodeEnum.UpArrowKey)n.Client.Loader.$mars(this).prev().focus(),t.preventDefault();else if(t.keyCode==i.Utility.KeyCodeEnum.TabKey&&t.shiftKey){var r=u.rootElement.find(t.target);r.closest(".lpath-edit-section-container").find("div[data-name='lpath_sidebar_section']").find(":tabbable").last().focus();t.stopPropagation();t.preventDefault()}});this.modelValue.IsContextHomeSideBar||this.modelValue.IsErrorControl||this.setShortcutKeyForPinUnpin()}catch(f){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Expception in rendering sidebartemplate from SidebarSkinnyToolbarView:renderSidebarTemplate");t.Loader.marsExceptionHandler.execute(f.name,f.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:renderSidebarTemplate END")},f.prototype.handleEditSidebarHc=function(){this.handleControlActionToolHc();this.handlePropertyTabHc();u.prototype.isBlackHighContrastMode.call(this)?(this.rootElement.find("#closeButton").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.closeSidebarIconHCB),this.rootElement.find("#lPathAddSection").find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.addControlsHCB),this.rootElement.find("#lPathFooterContentHome").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.sidebarContextHomeIconInHCB),this.rootElement.find("#lPathFooterContentFeedback").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.sidebarSmileyIconInHCB)):(this.rootElement.find("#closeButton").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.closeSidebarIconHCW),this.rootElement.find("#lPathAddSection").find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.addControlsHCW),this.rootElement.find("#lPathFooterContentHome").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.sidebarContextHomeIconInHCW),this.rootElement.find("#lPathFooterContentFeedback").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.sidebarSmileyIconInHCW))},f.prototype.handlePropertyTabHc=function(){u.prototype.isBlackHighContrastMode.call(this)?(this.propertyTabDeleteSectionButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.controlActionToolTabDeletecIconHCB),this.propertyTabEditSectionButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.editSectionControlHCB)):(this.propertyTabDeleteSectionButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.controlActionToolTabDeletecIconHCW),this.propertyTabEditSectionButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.editSectionControlHCW))},f.prototype.setShortcutKeyForPinUnpin=function(){var n=this;t.Loader.$mars(document).on("keydown",function(t){t.altKey&&t.ctrlKey&&t.keyCode==i.Utility.KeyCodeEnum.PKey&&n.sidebarPinUnpinAction()})},f.prototype.handleControlActionToolHc=function(){u.prototype.isBlackHighContrastMode.call(this)?(this.controlActionToolTabInstance.deleteButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.controlActionToolTabDeletecIconHCB),this.controlActionToolTabInstance.saveButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.controlActionToolTabSavecIconHCB)):(this.controlActionToolTabInstance.deleteButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.controlActionToolTabDeletecIconHCW),this.controlActionToolTabInstance.saveButton.find("img").attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.controlActionToolTabSavecIconHCW))},f.prototype.keyboardHandlingOnPropertyTab=function(n,t){var r=t.rootElement.find(n.target);n.keyCode==i.Utility.KeyCodeEnum.TabKey&&(n.shiftKey||(r.closest(".lpath-edit-section-container").next().length!=0?(r.closest(".lpath-edit-section-container").next().find(":tabbable").first().focus(),n.stopPropagation(),n.preventDefault()):r.closest(".lpath-edit-section-container").next().length==0&&(this.rootElement.find("button[id='lPathAddSection']").parent().css("display")!="none"?(this.rootElement.find("button[id='lPathAddSection']").focus(),n.stopPropagation(),n.preventDefault()):this.rootElement.find("button[id='lPathAddSection']").parent().css("display")=="none"&&(this.rootElement.parents('div[id="lPathskinnyToolbarContainer"]').find('button[id="lPathSkinnyToolbarHomeButton"]').focus(),n.stopPropagation(),n.preventDefault()))))},f.prototype.attachEventsToEditModeSidebar=function(){var r=this.rootElement.find("#lPathEditHeader"),u=this.getCurrentControlValue(),t=this;r.off("change").on("change",function(){var n=r.val(),f=i.Util.Common.getPreviewTemplateName(u.MetadataJson.Template);t.modelValue=i.Util.Common.handleLanguageControlVersionContent(t.modelValue,f,!1,n,t.modelValue.BaseLcid)});r.keypress(function(t){n.Client.Loader.appContext.Util.isEnterPressed(t,!1)&&t.preventDefault()});this.rootElement.find('img[id="lPathFooterContentFeedback"]').off("keydown").on("keydown",function(n){if(n.keyCode==i.Utility.KeyCodeEnum.TabKey)return n.shiftKey?!0:(t.rootElement.parents('div[id="lPathskinnyToolbarContainer"]').find('button[id="lPathSkinnyToolbarHomeButton"]').focus(),!1)})},f.prototype.renderControlActionToolTab=function(){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:renderControlActionToolTab START");try{var u=this,e=i.App.lPathDesignerContainer.find("#lpathSidebarTemplateHolder").width();this.controlActionToolTabInstance=new r.ControlActionToolTabView({},this.controlActionToolTabTemplateHolder,function(){u.sidebarPinUnpinAction()},function(){u.sidebarSaveAction(u)},function(){u.sidebarDeleteAction()},function(){u.SaveAllControl(u)});this.controlActionToolTabInstance.positionToolTab(e);(this.modelValue.IsContextHomeSideBar||this.modelValue.IsErrorControl)&&this.hidePinningIcon()}catch(f){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Expception in rendering controlaction tooltab from SidebarSkinnyToolbarView:renderControlActionToolTab");t.Loader.marsExceptionHandler.execute(f.name,f.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:renderControlActionToolTab END")},f.prototype.hidePinningIcon=function(){this.controlActionToolTabTemplateHolder.find("#lPathControlToolTabPinButton").remove()},f.prototype.setPageNavigationToControl=function(){var n=i.Util.Common.getContextTypeMetadata(this.modelValue,i.Utility.ContextTypeMetaData.PageNavigationInfo);this.modelValue.IsContextHomeSideBar||this.modelValue.IsErrorControl||n.length!==0||i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.PageNavigationInfo,JSON.stringify(t.Loader.appContext.getPageNavigationInfo()),this.modelValue.Contexts[0].ContextGroup.ContextGroupElements)},f.prototype.sidebarPinUnpinAction=function(){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:placeModeOnoff START");try{var h,f,e,c=t.Loader.appContext.isRTL(),o=n.Client.Loader.appContext.isMobileClient(),v=n.Client.Utility.AppContextFactory.isUCIClient(),y=this.modelValue.IsContextHomeSideBar,l=this.modelValue.Contexts[0].ContextGroup.ContextGroupElements,r=i.App.lPathDesignerContainer.find("#lpathSidebarTemplateHolder"),u=i.App.lPathDesignerContainer.find("#lPathSkinnyToolbarBlock"),s=n.Client.Loader.$mars(window.parent.document).find(".customizationContainer");this.pinningMode=!this.pinningMode;this.pinningMode?(h=r.width(),e=50-h,f=u.width(),c?(u.animate({right:-f+"px"},1e3),r.animate({left:e+"px"},1e3,function(){o&&s.css({left:"0",right:"auto",width:"107px"})})):(u.animate({left:-f+"px"},1e3),r.animate({right:e+"px"},1e3,function(){o&&s.css({right:"0",left:"auto",width:"107px"})})),i.App.hideLPathDesignerOverlay(),this.rootElement.find("#lPathControlToolTabCrossLineImage").hide(),this.rootElement.find("#lPathControlToolTabPinImage").show(),this.rootElement.find("#lPathControlToolTabPinButton").attr("aria-label",i.Locale.pinCaption),this.rootElement.find("#lPathControlToolTabPinButtonSpan").text(i.Locale.pinButtonPMS),this.propertyTabTemplateHolder.hide(),v?i.$mars("body").find('button[data-lp-id="dynamics365-home-button"]').focus():i.$mars("body").find("span#TabnavTabLogoTextId a").focus()):(o&&s.css({left:"0",right:"auto",width:"100%"}),c?(u.animate({right:"0px"},1e3),r.animate({left:"0px"},1e3)):(u.animate({left:"0px"},1e3),r.animate({right:"0px"},1e3)),i.App.showLPathDesignerOverlay(),this.listOfLinkPageInApp(l),this.rootElement.find("#lPathControlToolTabCrossLineImage").show(),this.rootElement.find("#lPathControlToolTabPinImage").hide(),this.rootElement.find("#lPathControlToolTabPinButton").attr("aria-label",i.Locale.unpinCaption),this.rootElement.find("#lPathControlToolTabPinButtonSpan").text(i.Locale.unPinButtonPMS),y||this.listOfLinkCallback||i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.PageNavigationInfo,JSON.stringify(t.Loader.appContext.getPageNavigationInfo()),l));n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Pinning mode enabled")}catch(a){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception on pinning from SidebarSkinnyToolbarView:onPlacementModeOnoff");t.Loader.marsExceptionHandler.execute(a.name,a.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:placeModeOnoff END")},f.prototype.listOfLinkPageInApp=function(n){this.selectedSectionModel&&(this.selectedSectionModel.MetadataJson.Template==i.Util.Constants.listOflinkTemplate||this.selectedSectionModel.MetadataJson.Template==i.Util.Constants.onebuttonTemplate||this.selectedSectionModel.MetadataJson.Template==i.Util.Constants.twobuttonTemplate)&&(this.listOfLinkCallback?this.listOfLinkCallback(t.Loader.appContext.getPageNavigationInfo(),i.Util.Common.getContextTypeMetadata(this.modelValue,i.Utility.ContextTypeMetaData.PageNavigationInfo)):i.Util.Common.setContextTypeMetadata(i.Utility.ContextTypeMetaData.PageNavigationInfo,JSON.stringify(t.Loader.appContext.getPageNavigationInfo()),n))},f.prototype.handleEmptySection=function(){var n,t;if(this.modelValue.Sections.length>0)for(n=0;n<this.modelValue.Sections.length;n++)this.modelValue.Sections[n]||(t=this.getSelectedSection(n),this.modelValue.Sections[n]=t,this.modelValue.MetadataJson.ChildControlIds[n]=t.MetadataJson.ClientId)},f.prototype.sidebarSaveAction=function(n){var r=this,e,f;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbar:onSave START");try{if(this.handleEmptySection(),e=this.validateModel(n.modelValue),!e)return;f=u.prototype.save.call(this,n.modelValue);f.done(function(u){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Details : Control type : "+r.modelValue.ControlType+"; Id : "+r.modelValue.ControlId);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Author Name : "+r.modelValue.AuthorName+"; Author Id : "+r.modelValue.AuthorId+"; isContextHomeSideBar : "+r.modelValue.IsContextHomeSideBar);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Author Name : "+r.modelValue.AuthorName+"; Author Id : "+r.modelValue.AuthorId+"; isErrorControl : "+r.modelValue.IsErrorControl);n.updateSharedModelValue();var f=r.controlCreated&&!u.CreateTelemetry?window._MicrosoftMars.Client.Telemetry.EndAction.created:window._MicrosoftMars.Client.Telemetry.EndAction.edited;i.App.trackActivity(u,f);i.App.saveControlCreateTelemetry(u)});f.fail(function(n,i,r){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON);console.log("Error while saving sidebar data "+r.message)})}catch(o){t.Loader.marsExceptionHandler.execute(o.name,o.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"SidebarSkinnyToolbar:onSave Exception occurred while saving sidebar data.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbar:onSave END")},f.prototype.validateModel=function(t,i){var r,u,f,e,s,o;if(i===void 0&&(i=!0),r=!0,t.Sections)for(u=0;u<t.Sections.length&&r;u++)if(f=t.Sections[u],f.Links)for(e=0;e<f.Links.length&&r;e++)s=f.Links[e],o=n.Client.Utility.ParameterizedURLManager.GetInstance().Validate(s.Url),o.isValid||(r=!1);return i&&!r&&this.showErrors(o.errorMessages),r},f.prototype.showErrors=function(u){for(var e,s=i.App.lPathDesignerContainer,o=u[0],f=1;f<u.length;f++)o+="<br />"+u[f];e=new r.SimpleDialogView({},s,n.Client.Designer.Util.Constants.incorrectURLFormat,t.Loader.marsLocale.IncorrectURLFormat,o);e.addDefaultFocusOnOkOrClose=!0;e.show()},f.prototype.sidebarDeleteAction=function(){this.deleteCurrentControl()},f.prototype.injectToggleButton=function(r){var e,f;if(this.allowToggle&&(e=r.attr("id")+"_lpath_section_toggle",f=r.find("img[id="+e+"]"),f.length===0)){f=t.Loader.$mars('<div class="lpath-section-header-collapse" role="button" aria-expanded="true" tabindex="0"><img type="image" id='+e+' class="lpath-toggleImage lpath-section-header-collapse-image" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.expandedIcon+'" title="'+t.Loader.marsLocale.sectionExpandedToolTip+'" alt="'+t.Loader.marsLocale.expanded+'">');r.find('div[name="lpath_section_header"]').prepend(f);f=r.find("img[id="+e+"]");f.parent().attr("aria-label",f.closest('div[id="'+r.attr("id")+'"]').attr("title"));u.prototype.isHighContrastModeActive.call(this)&&(u.prototype.isBlackHighContrastMode.call(this)?f.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.expandedIconInHCB):f.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.expandedIconInHCW));this.subscribe(f.parent(),"click",i.Util.Common.onToggleClick);f.parent().off("keydown").on("keydown",function(t){if(n.Client.Loader.appContext.Util.isEnterPressed(t,!0)){i.Util.Common.onToggleClick(t);return!1}return!0})}},f.prototype.renderSectionFooterBuilderControl=function(){var n=this.rootElement.find('div[name="sectionFooterBuilderControl"]'),i=this;n.each(function(){var n=t.Loader.$mars(this).data("sectionindex");i.handleSectionFooterBuilderControl(n)})},f.prototype.handleSectionFooterBuilderControl=function(n){var t=this,c=this.getSectionFooterBuilderControlContainerElement(n),a=new r.SectionFooterBuilderControlView(t.modelValue.ControlId,t.modelValue.ControlType,c,n,function(n){t.onMoreButtonClick(n)}),s=t.getSectionContainerElement(n),o=null,f=null,l=!0,u=t.modelValue.Sections[n],h,e;if(u&&(o=u.MetadataJson.Template,f=u.MetadataJson.Content,l=!1),this.islinkTypeTemplate(o))u.Links||(u.Links=[]),f.Links=u.Links;else if(o==i.Util.Constants.footerSectionTemplate)for(h=f.Links,f.Links=u.Links,e=0;e<u.Links.length;e++)f.Links[e].LinkEnabled=h[e].LinkEnabled!=undefined?h[e].LinkEnabled:!0,f.Links[e].LinkHolder=h[e].LinkHolder;a.setBuilderControl(o,f,t.pinningMode,s,n,function(n,i,r,u,f){t.injectToggleButton(s);t.listOfLinkCallback=f;t.setSectionTemplate(n,i,r,u)},function(n,i,r,u,f){t.injectToggleButton(s);t.listOfLinkCallback=f;t.setSectionTemplate(n,i,r,u)},l,t.modelValue.MetadataJson.IsFooterSectionAvailable);u&&Object.getOwnPropertyNames(f).length!=0&&o!=""?(t.allowToggle=!0,t.injectToggleButton(s),c.hide()):c.show()},f.prototype.islinkTypeTemplate=function(n){return n==i.Util.Constants.listOflinkTemplate||n==i.Util.Constants.onebuttonTemplate||n==i.Util.Constants.twobuttonTemplate||n==i.Util.Constants.addExistingGuidedTaskTemplate},f.prototype.getSectionPreviewTemplate=function(n,t){t===void 0&&(t=!1);var u=JSON.parse(JSON.stringify(n));return u.allowToggle=this.allowToggle,i.Utility.Util.decodeSpecialCharacters(r.TemplateEngine.applyTemplate(i.Util.Constants.sectionPreviewTemplate,u,!0,t))},f.prototype.getSelectedSection=function(n){var t=new i.Content.SectionMetadata;return this.modelValue.Sections[n]?t=this.modelValue.Sections[n]:(t=i.Util.Common.createChildControl(this.modelValue),t.ControlType=i.Util.Constants.answerPanelSection,t.ControlName=this.modelValue.ControlName+"-"+i.Util.Constants.Section+n),t.ControlType=i.Utility.ControlTypes.Section,t},f.prototype.getSectionContainerElement=function(n){return this.rootElement.find('div[id="lPathTemplateContentContainer_'+n+'"]')},f.prototype.getSectionFooterBuilderControlContainerElement=function(n){return this.rootElement.find('div[id="lpathSectionFooterBuilderControlContainer_'+n+'"]')},f.prototype.setSectionTemplate=function(r,u,f,e){var o,s,h;try{e&&this.sidebarPinUnpinAction();this.selectedSectionModel=this.getSelectedSection(f);this.islinkTypeTemplate(r)&&(this.selectedSectionModel.Links=t.Loader.$mars.extend(!0,[],u.Links));r==i.Util.Constants.footerSectionTemplate?(this.selectedSectionModel.Links=t.Loader.$mars.extend(!0,[],u.Links),this.modelValue.MetadataJson.IsFooterSectionAvailable=!0):this.modelValue.MetadataJson.IsFooterSectionAvailable=this.IsFooterSectionPresent()?!0:!1;this.selectedSectionModel.MetadataJson.Content=t.Loader.$mars.extend(!0,{},u);this.selectedSectionModel.MetadataJson.Template=r;this.selectedSectionModel.ControlName=this.modelValue.ControlName+"-"+i.Util.Constants.Section+f;o=this.getSectionPreviewTemplate(this.selectedSectionModel);this.selectedSectionModel=i.Util.Common.handleLanguageControlVersionContent(this.selectedSectionModel,this.selectedSectionModel.MetadataJson.Template,!0,u.Title,this.modelValue.BaseLcid,o);this.selectedSectionModel.AuthoringId=n.Client.Loader.appContext.getAuthoringId();this.selectedSectionModel.MetadataJson.ClientId==""&&(this.selectedSectionModel.MetadataJson.ClientId=t.Utility.Util.newGuid());this.modelValue.MetadataJson.ChildControlIds[f]=this.selectedSectionModel.MetadataJson.ClientId;this.modelValue.Sections[f]=this.selectedSectionModel;s=n.Client.Utility.Util.decodeSpecialCharacters(this.getSidebarPreviewHTML());this.modelValue.LanguageControlVersionContents=i.Util.Common.updateHTMLViewContent(this.modelValue.LanguageControlVersionContents,this.modelValue.BaseLcid,s,"");this.isViewPostBack!=undefined&&this.isViewPostBack==!1&&(h=this.getSectionContainerElement(f),this.handleSectionContainerClick(h))}catch(c){t.Loader.marsExceptionHandler.execute(c.name,c.message)}},f.prototype.IsFooterSectionPresent=function(){for(var r=!1,t=this.modelValue.Sections,n=0;n<t.length;n++)if(t[n]&&t[n].MetadataJson.Template==i.Util.Constants.footerSectionTemplate){r=!0;break}return r},f.prototype.getSidebarPreviewHTML=function(){var r,u;try{r="<div><\/div>";this.modelValue.MetadataJson.Template;u=i.Util.Common.getPreviewTemplateName(this.modelValue.MetadataJson.Template);r=i.Util.Common.getCompiledHtml(this.modelValue,u)}catch(f){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Expception in genrating Preview HTML SidebarSkinnyToolbarView:getSidebarPreviewHTML");t.Loader.marsExceptionHandler.execute(f.name,f.message)}return r},f.prototype.updateSharedModelValue=function(){this.modelValue=this.getCurrentControlValue();this.setdefaultCompareModelValue(this.modelValue)},f.prototype.propertyTabBuilderControlContainerKeyboardHandling=function(n,t,r,u){var f,o,h;if(u===void 0&&(u=null),f=r.rootElement.find(n.target),n.keyCode==i.Utility.KeyCodeEnum.TabKey&&(n.shiftKey?n.shiftKey&&this.setFocusOutForBuilderControlListItem(t):this.setFocusOutForBuilderControlListItem(t,u),n.stopPropagation(),n.preventDefault()),n.keyCode==i.Utility.KeyCodeEnum.DownArrowKey){for(var l=f.attr("data-index"),c=f.closest(".lpath-builderControlToolbar").find("ul[name*=builderControlToolBarList]").find("li").length,e=parseInt(l)+1;c&&e<=c;)if(o=f.closest(".lpath-builderControlToolbar").find("ul[name*=builderControlToolBarList]").find("li[data-index="+e+"]"),o&&o.is(":tabbable")){o.focus();break}else e=e+1;n.stopPropagation();n.preventDefault()}if(n.keyCode==i.Utility.KeyCodeEnum.UpArrowKey){for(var l=f.attr("data-index"),c=f.closest(".lpath-builderControlToolbar").find("ul[name*=builderControlToolBarList]").find("li").length,s=parseInt(l)-1;c&&s>-1;)if(h=f.closest(".lpath-builderControlToolbar").find("ul[name*=builderControlToolBarList]").find("li[data-index="+s+"]"),h&&h.is(":tabbable")){h.focus();break}else s=s-1;n.stopPropagation();n.preventDefault()}},f.prototype.controlToolTabKeyboardHandling=function(t,i){var r=n.Client.Loader.$mars("#lPathEditHeader"),u=n.Client.Loader.$mars("#lPathSkinnyToolbarPreviewButton");this.handleArrowKeysNavigation(t,i,u,r)},f.prototype.handleArrowKeysNavigation=function(r,u,f,e){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:handleArrowKeysNavigation START");try{var o=u.rootElement.find(r.target);r.keyCode!==i.Utility.KeyCodeEnum.TabKey||r.shiftKey?r.keyCode===i.Utility.KeyCodeEnum.TabKey&&r.shiftKey&&(f.focus(),r.preventDefault()):(e.focus(),r.preventDefault());r.keyCode==i.Utility.KeyCodeEnum.DownArrowKey&&(o.next()&&o.next().focus(),r.preventDefault());r.keyCode==i.Utility.KeyCodeEnum.UpArrowKey&&(o.prev()&&o.prev().focus(),r.preventDefault())}catch(s){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception in handling arrow-keys in edit mode of sidebar from SidebarSkinnyToolbarView:handleArrowKeysNavigation");t.Loader.marsExceptionHandler.execute(s.name,s.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SidebarSkinnyToolbarView:handleArrowKeysNavigation END")},f}(r.ControlView);r.SidebarEditorView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(){function t(n,t){this.id=n;this.value=t;this.isDataSaved=!0}return t.prototype.getValue=function(){return this.value},t.prototype.save=function(t){var i=n.$mars.Deferred(),u=this,r=n.App.save(t);return r.done(function(n){u.value=n;this.isDataSaved=!0;i.resolve(n)}),r.fail(function(){i.reject()}),i},t}();t.ControlModel=i})(t=n.Content||(n.Content={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(){"use strict"})(t=n.Content||(n.Content={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){"use strict";var i=function(){function t(){}return t.setCkEditorForSectionContent=function(t,i,r,u,f,e){setTimeout(function(){n.Loader.$mars("#"+t.attr("id")).ckeditor({autoParagraph:!1});var o=window.CKEDITOR.instances[t.attr("id")];if(o!=null){o.on("change",function(){u(this)});o.on("contentDom",function(){var t=o.editable();t.attachListener(t,"focus",function(){var u=this.editor.name,t;return i.hide(),r.focus(),t=n.Loader.$mars("#"+u).parent().closest("[id^='lPathTemplateContentContainer']"),t.trigger("click"),!1});f&&f()});if(e)o.on("instanceReady",function(n){e(n)})}},0)},t.setCkEditorForTitle=function(t,i,r,u,f){setTimeout(function(){n.Loader.$mars("#"+t.attr("id")).ckeditor({toolbarGroups:[{name:"others"},{name:"insert",groups:["SpecialChar"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"colors",groups:["TextColor"]},],height:40,removeButtons:"Subscript,Superscript,Image,Table,HorizontalRule,BGColor,Strike,-,RemoveFormat,Anchor,Unlink,Flash,Smiley,PageBreak,Iframe",removePlugins:"elementspath,liststyle,tabletools,scayt,contextmenu",autoParagraph:!1});n.Loader.$mars("#"+t.attr("id")).ckeditor(function(){this.on("key",function(n){n.data.keyCode==13&&n.cancel()})});var e=window.CKEDITOR.instances[t.attr("id")];if(e!=null){e.on("change",function(){u(this)});e.on("instanceReady",function(){n.Loader.$mars(".lpath-propertyTab").show()});e.on("contentDom",function(){var t=e.editable();t.attachListener(t,"focus",function(){var u=this.editor.name,t;return i.hide(),r.focus(),t=n.Loader.$mars("#"+u).parent().closest("[id^='lPathTemplateContentContainer']"),t.trigger("click"),!1})});f&&f()}},0)},t}();t.lPathCkEditor=i})(i=t.Content||(t.Content={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var u=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{}},t.prototype.initialize=function(){},t}(BackboneMars.Model),r;i.BackboneControlConfigurationContainerModel=u;r=function(r){function u(n){r.call(this);this.collection=n.collection;this.$el=n.el}return __extends(u,r),u.prototype.initialize=function(){},u.prototype.close=function(){},u.prototype.render=function(){var n=this,r=i.TemplateEngine.applyTemplate(t.Util.Constants.configurationContainerTemplate,this.collection,!1,!0,!1);this.$el.find("#lpath-gt-configuration").append(r);this.currentView=new i.SecurityRolesView({collection:null,el:this.$el});this.currentView.render();this.$el.on("click","#lpath-gt-publish-backtomars",function(t){n.backToMars(t)});return this.$el.find("#lpath-gt-publish-backtomars").keypress(function(n){n.keyCode==13&&this.click()}),this},u.prototype.backToMars=function(n){this.currentView.hasChanges?this.HandleNavigation(n):t.App.show()},u.prototype.HandleNavigation=function(){try{t.Util.Common.showAlertMessage(t.Locale.alertMessage,t.Locale.unSavedChangesPopupMessage,this.$el,!0,t.Locale.yesCaption,t.Locale.no,function(){t.App.show()},function(){n.Loader.$mars("#lpath-gt-publish-backtomars").focus()})}catch(i){n.Loader.marsExceptionHandler.execute(i.name,i.message)}},u}(BackboneMars.View);i.ConfigurationContainerView=r})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var u=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{}},t.prototype.initialize=function(){},t}(BackboneMars.Model),r;i.BackboneControlConfigurationMenuModel=u;r=function(r){function u(n){r.call(this);this.currentView=null;this.collection=n.collection;this.$el=n.el}return __extends(u,r),u.prototype.initialize=function(){},u.prototype.close=function(){},u.prototype.render=function(){var r=this,u=i.TemplateEngine.applyTemplate(t.Util.Constants.configurationMenuTemplate,this.collection,!1,!0,!1);return this.$el.find("#lpath-gt-configuration").html(u),this.$el.find(".lpath-gt-config-menuitemslist > li").click(function(n){return r.ConfigMenuSelect(n)}),this.$el.find(".lpath-gt-config-menuitemslist > li").keydown(function(n){return r.handleGridNavigation(n)}),this.$el.find(".lpath-gt-config-menuitemslist > li").filter(function(){return this.getAttribute("data-value").toLowerCase()==n.Loader.marsLocale.securityRoles.toLowerCase()}).addClass("active"),this},u.prototype.ConfigMenuSelect=function(n){this.currentView.hasChanges?this.HandleNavigation(n):this.renderContent(n)},u.prototype.handleGridNavigation=function(n){var i=this.$el.find(n.target);n.keyCode===t.Utility.KeyCodeEnum.TabKey&&(n.shiftKey&&t.App.lPathDesignerContainer.find("#backToCRMLink").focus(),n.shiftKey||this.$el.find("#lpath-gt-publish-backtomars").focus(),n.stopPropagation(),n.preventDefault());n.keyCode===t.Utility.KeyCodeEnum.EnterKey&&this.ConfigMenuSelect(n);n.keyCode===t.Utility.KeyCodeEnum.UpArrowKey&&i.prev().focus();n.keyCode===t.Utility.KeyCodeEnum.DownArrowKey&&i.next().focus()},u.prototype.HandleNavigation=function(i){var u=this;try{t.Util.Common.showAlertMessage(t.Locale.unSavedChangesPopupTitle,t.Locale.unSavedChangesPopupMessage,this.$el,!0,t.Locale.yesCaption,t.Locale.no,function(){u.renderContent(i)},function(){n.Loader.$mars(".lpath-gt-config-menu-container ul li.active").focus()})}catch(r){n.Loader.marsExceptionHandler.execute(r.name,r.message)}},u.prototype.renderContent=function(r){var f,e;this.$el.find(".lpath-gt-config-menuitemslist > li").removeClass("active");n.Loader.$mars(r.currentTarget).addClass("active");this.$el.find(".lpath-gt-securityroles-selecteditem").text(r.currentTarget.innerText);var o=n.Loader.$mars(r.currentTarget).attr("data-value").toLowerCase(),s=n.Loader.marsLocale.publishingConfiguration.toLowerCase(),h=n.Loader.marsLocale.microsoftSettings.toLowerCase(),u=t.App.lPathDesignerContainer.find("#backToCRMLink");u.removeClass();f="lpath_gt_"+n.Loader.marsLocale.securityRoles;e="lpath_gt_"+n.Loader.marsLocale.publishingConfiguration;switch(o){case s:this.currentView=new i.PublishingConfigurationView({collection:null,el:this.$el});t.App.SetPageTitleToMars(n.Loader.marsLocale.publishingConfiguration);n.Loader.$mars(r.currentTarget).removeAttr("aria-describedby");this.$el.find('[id="'+f+'"]').attr("aria-describedby","securityRolesNavigationMenu");u.addClass("lpath-ap-close lpath-publishingconfigview");break;case h:this.currentView=new i.MicrosoftSettingsView({collection:null,el:this.$el});t.App.SetPageTitleToMars(n.Loader.marsLocale.microsoftSettings);u.addClass("lpath-ap-close");break;default:this.currentView=new i.SecurityRolesView({collection:null,el:this.$el});t.App.SetPageTitleToMars(n.Loader.marsLocale.securityRoles);n.Loader.$mars(r.currentTarget).removeAttr("aria-describedby");this.$el.find('[id="'+e+'"]').attr("aria-describedby","publishingConfigurationNavigationMenu");u.addClass("lpath-ap-close lpath-securityrolesview")}this.currentView&&(this.currentView.render(),this.currentView.hasChanges=!1);r.preventDefault()},u}(BackboneMars.View);i.ConfigurationMenuView=r})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var f=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{}},t.prototype.initialize=function(){},t}(BackboneMars.Model),u;r.BackboneControlConfigurationModel=f;u=function(u){function f(n){u.call(this);this.isChanges=!1;this.collection=n.collection;this.$el=n.el}return __extends(f,u),f.prototype.initialize=function(){},f.prototype.close=function(){},f.prototype.render=function(){var o=r.TemplateEngine.applyTemplate(i.Util.Constants.configurationTemplate,null,!1,!0,!1),u,f,e;return this.$el.html(o),u=[t.Loader.marsLocale.securityRoles,t.Loader.marsLocale.publishingConfiguration],n.Client.Utility.FFFUtility.isFeatureEnabled(n.Client.Utility.FFFUtility.MSSetting)&&u.push(t.Loader.marsLocale.microsoftSettings),f={listItems:u,selectedItem:t.Loader.marsLocale.securityRoles},this.loadConfigMenu(f),this.loadConfigContainer(f),this.menuView.currentView=this.containerView.currentView,i.App.SetPageTitleToMars(f.selectedItem),e=i.App.lPathDesignerContainer.find("#backToCRMLink"),e.removeClass(),e.addClass("lpath-ap-close lpath-securityrolesview"),this.addAriaDescribedByAttribute(u),this},f.prototype.addAriaDescribedByAttribute=function(n){var t="lpath_gt_"+n[0],i="lpath_gt_"+n[1];this.$el.find('[id="'+t+'"]').attr("aria-describedby","securityRolesNavigationMenu");this.$el.find('[id="'+t+'"]').removeAttr("title");this.$el.find('[id="'+i+'"]').attr("aria-describedby","publishingConfigurationNavigationMenu");this.$el.find('[id="'+i+'"]').removeAttr("title")},f.prototype.loadConfigMenu=function(n){this.menuView=new r.ConfigurationMenuView({collection:n,el:this.$el});this.menuView.render()},f.prototype.loadConfigContainer=function(n){this.containerView=new r.ConfigurationContainerView({collection:n,el:this.$el});this.containerView.render()},f.prototype.getMarsChanges=function(){return this.menuView.currentView.hasChanges},f}(BackboneMars.View);r.ConfigurationView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var f=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{}},t.prototype.initialize=function(){},t}(BackboneMars.Model),u;r.BackboneControlSecurityRolesModel=f;u=function(u){function f(n){u.call(this);this.hasChanges=!1;this.collection=n.collection;this.$el=n.el;this.isFirstLoad=!0}return __extends(f,u),f.prototype.initialize=function(){},f.prototype.close=function(){},f.prototype.render=function(){return this.getLatestSecurityRoles(),this.isFirstLoad=!1,this},f.prototype.deleteRoleClick=function(r,u){var o=this,f,e;this.changedSecurityData.SyncRolesList[r].ObjectState=n.Client.Utility.UserRoleState.deleted;t.Loader.$mars.each(this.changedSecurityData.SyncRolesList,function(t,i){t>r&&(i.Precedence=t,i.ObjectState=n.Client.Utility.UserRoleState.modified)});f=new t.Loader.ConfigurationAPI;e=f.post(this.changedSecurityData.SyncRolesList,"SyncUserRole");e.done(function(n){n!=null&&n.Result!=null&&o.ReloadConfiguration(f,i.Locale.deleteSuccess,u)});e.fail(function(){try{i.Util.Common.showAlertMessage(i.Locale.deleteFailed,"",o.$el,!1,i.Locale.okButtonCaption,!1,function(){t.Loader.$mars("#lpath-gt-config-overflowtable table tbody tr:eq('"+r+"')").find(".lpath-config-delete-icon-wf").focus()},function(){})}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message)}})},f.prototype.setPrecedence=function(){t.Loader.$mars.each(this.changedSecurityData.SyncRolesList,function(t,i){(i.Precedence!=1||i.Precedence!=t)&&(i.Precedence=t+1,i.ObjectState=n.Client.Utility.UserRoleState.modified);i.Precedence==1&&t==1&&(i.Precedence=t+1,i.ObjectState=n.Client.Utility.UserRoleState.modified)})},f.prototype.changeOrder=function(u){var a,v,s,h;this.hasChanges=!0;var y=t.Loader.$mars(u.currentTarget).parents("tr:first"),f=t.Loader.$mars(y).prop("sectionRowIndex"),c=!0;if(this.changedSecurityData.SyncRolesList=t.Loader._mars.sortBy(this.changedSecurityData.SyncRolesList,"Precedence"),t.Loader.$mars(u.target).is(".lpath-gt-config-arrow-up-wf")){if(f!=0){var e=this.changedSecurityData.SyncRolesList[f],o=this.changedSecurityData.SyncRolesList[f-1],l=e.Precedence;e.Precedence=o.Precedence;o.Precedence=l;e.ObjectState=n.Client.Utility.UserRoleState.modified;o.ObjectState=n.Client.Utility.UserRoleState.modified;this.changedSecurityData.SyncRolesList[f]=o;this.changedSecurityData.SyncRolesList[f-1]=e}}else if(a=t.Loader.$mars(u.currentTarget).closest("tbody").find("tr").length,a!=f+1){var e=this.changedSecurityData.SyncRolesList[f],o=this.changedSecurityData.SyncRolesList[f+1],l=e.Precedence;e.Precedence=o.Precedence;o.Precedence=l;e.ObjectState=n.Client.Utility.UserRoleState.modified;o.ObjectState=n.Client.Utility.UserRoleState.modified;this.changedSecurityData.SyncRolesList[f]=o;this.changedSecurityData.SyncRolesList[f+1]=e;c=!1}v=r.TemplateEngine.applyTemplate(i.Util.Constants.securityRolesTemplate,this.changedSecurityData,!1,!0,!1);this.bindSecurityRoleContent(v);c?(s=this.$el.find(".lpath-gt-config-table-bordered > tbody > tr").eq(f-1),s.find(".lpath-gt-config-arrow-up-wf").is(":disabled")?(h=this.$el.find(".lpath-gt-config-table-bordered > tbody > tr").eq(f),h.find(".lpath-gt-config-arrow-up-wf").focus()):s.find(".lpath-gt-config-arrow-up-wf").focus()):(s=this.$el.find(".lpath-gt-config-table-bordered > tbody > tr").eq(f+1),s.find(".lpath-config-arrow-down-wf").is(":disabled")?(h=this.$el.find(".lpath-gt-config-table-bordered > tbody > tr").eq(f),h.find(".lpath-config-arrow-down-wf").focus()):s.find(".lpath-config-arrow-down-wf").focus());u.stopPropagation();u.preventDefault()},f.prototype.wireEvent=function(){var n=this,r=this;i.App.lPathDesignerContainer.find('div[id^="lpathSimpleDialogOverlay"]')&&i.App.lPathDesignerContainer.find('div[id^="lpathSimpleDialogOverlay"]').length>0?i.App.lPathDesignerContainer.find('button[id^="lpath-simple-btnOk"]')&&i.App.lPathDesignerContainer.find('button[id^="lpath-simple-btnOk"]').focus():this.$el.find("#syncRoleButton").focus();this.$el.off("keydown",".lpath-gt-config-arrow-up-wf").on("keydown",".lpath-gt-config-arrow-up-wf",function(n){return r.handleUpKeyImageKeydown(n,r)});this.$el.off("keydown",".lpath-config-arrow-down-wf").on("keydown",".lpath-config-arrow-down-wf",function(n){return r.handleDownKeyImageKeydown(n,r)});this.$el.off("keydown",".lpath-config-delete-icon-wf").on("keydown",".lpath-config-delete-icon-wf",function(n){return r.handleDeleteImageKeydown(n,r)});this.$el.off("click",".lpath-gt-config-arrow-up-wf,.lpath-config-arrow-down-wf").on("click",".lpath-gt-config-arrow-up-wf,.lpath-config-arrow-down-wf",function(t){n.changeOrder(t)});this.$el.off("click",".lpath-gt-config-save").on("click",".lpath-gt-config-save",function(t){n.onSecurityRoleSaveClick(t)});this.$el.off("click","#securityRoleCancel").on("click","#securityRoleCancel",function(t){n.onSecurityRoleCancelClick(t)});this.$el.off("keydown","#securityRoleCancel").on("keydown","#securityRoleCancel",function(t){if(t.keyCode===i.Utility.KeyCodeEnum.TabKey&&!t.shiftKey)return i.App.lPathDesignerContainer.find("#backToCRMLink").focus(),!1;if(t.keyCode===13){n.onSecurityRoleCancelClick(t);return!1}return!0});this.$el.off("click",".lpath-gt-config-sync-role").on("click",".lpath-gt-config-sync-role",function(r){try{i.Util.Common.showAlertMessage(i.Locale.alertTitle,i.Locale.syncConfirmation,n.$el,!0,i.Locale.yesCaption,i.Locale.no,function(){n.initiateUserRoleSync()},function(){t.Loader.$mars(".lpath-gt-config-sync-role").focus()})}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message)}r.preventDefault()});this.$el.off("click",".lpath-config-delete-icon-wf").on("click",".lpath-config-delete-icon-wf",function(r){var u=t.Loader.$mars(r.currentTarget).closest("tr").index(),e=t.Loader.$mars(r.currentTarget).closest("tr").next("tr").length>0?"#lpath-gt-config-overflowtable table tbody tr:eq('"+u+"') .lpath-config-delete-icon-wf":t.Loader.$mars(r.currentTarget).closest("tr").prev("tr").length>0?"#lpath-gt-config-overflowtable table tbody tr:eq("+(u-1)+") .lpath-config-delete-icon-wf":"#syncRoleButton";try{i.Util.Common.showAlertMessage(i.Locale.alertTitle,i.Locale.deleteConfirmation,n.$el,!0,i.Locale.yesCaption,i.Locale.no,function(){n.deleteRoleClick(u,e)},function(){t.Loader.$mars("#lpath-gt-config-overflowtable table tbody tr:eq('"+u+"')").find(".lpath-config-delete-icon-wf").focus()})}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message)}});this.$el.off("keydown","#lpath-gt-publish-backtomars").on("keydown","#lpath-gt-publish-backtomars",function(t){t.keyCode==i.Utility.KeyCodeEnum.TabKey&&(t.shiftKey&&n.$el.find(".lpath-gt-config-menu-container ul li.active").focus(),t.shiftKey||n.$el.find("#syncRoleButton").focus(),t.stopPropagation(),t.preventDefault())})},f.prototype.setShortcutKeys=function(){var r=this,n=[];t.Loader.$mars(".lpath_gt_config_container_breadcrumb").off("keydown");t.Loader.$mars(".lpath_gt_config_container_breadcrumb").off("keyup");t.Loader.$mars(".lpath_gt_config_container_breadcrumb").keydown(function(t){n.push(t.keyCode)}).keyup(function(t){if(n=jQuery.unique(n),n.indexOf(i.Utility.KeyCodeEnum.CtrlKey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.Altkey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.SKey)!==-1)r.onSecurityRoleSaveClick(t);n=[]});t.Loader.$mars(".lpath-gt-config-menubar").off("keydown");t.Loader.$mars(".lpath-gt-config-menubar").off("keyup");t.Loader.$mars(".lpath-gt-config-menubar").keydown(function(t){n.push(t.keyCode)}).keyup(function(t){if(n=jQuery.unique(n),n.indexOf(i.Utility.KeyCodeEnum.CtrlKey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.Altkey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.SKey)!==-1)r.onSecurityRoleSaveClick(t);n=[]});t.Loader.$mars("#lpath-gt-cofiguration-container-content").off("keydown");t.Loader.$mars("#lpath-gt-cofiguration-container-content").off("keyup");t.Loader.$mars("#lpath-gt-cofiguration-container-content").keydown(function(t){n.push(t.keyCode)}).keyup(function(t){if(n.push(t.keyCode),n=jQuery.unique(n),n.indexOf(i.Utility.KeyCodeEnum.CtrlKey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.Altkey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.SKey)!==-1)r.onSecurityRoleSaveClick(t);n=[]})},f.prototype.onSecurityRoleSaveClick=function(){var n=this,r=new t.Loader.ConfigurationAPI,u=r.post(this.changedSecurityData.SyncRolesList,"SyncUserRole");u.done(function(t){t!=null&&t.Result!=null&&n.ReloadConfiguration(r,i.Locale.saveSuccess,".lpath-gt-config-save")});u.fail(function(){try{i.Util.Common.showAlertMessage(i.Locale.saveFailed,"",n.$el,!1,i.Locale.okButtonCaption,!1,function(){i.App.lPathDesignerContainer.find(".lpath-gt-config-save").focus()},function(){})}catch(r){t.Loader.marsExceptionHandler.execute(r.name,r.message)}})},f.prototype.onSecurityRoleCancelClick=function(){this.securityData.getCRMOrgName=t.Loader.appContext.getOrgName();this.hasChanges=!1;this.cloneDataFromSecuredData(this.securityData.SyncRolesList,this.securityData.LastUserRoleSync,this.securityData.getCRMOrgName);this.securityData.SyncRolesList=t.Loader._mars.sortBy(this.securityData.SyncRolesList,"Precedence");var n=r.TemplateEngine.applyTemplate(i.Util.Constants.securityRolesTemplate,this.securityData,!1,!0,!1);this.bindSecurityRoleContent(n);this.$el.find("#syncRoleButton").focus()},f.prototype.ReloadConfiguration=function(r,u,f){var e=this,o;r===void 0&&(r=null);u===void 0&&(u=null);r==null&&(r=new t.Loader.ConfigurationAPI);o=r.getAllConfigurations();o.done(function(r){n.Client.Utility.ConfigurationUtil.loadConfigurationData(r);try{u!=null&&i.Util.Common.showAlertMessage(u,"",e.$el,!1,i.Locale.okButtonCaption,!1,function(){f&&i.App.lPathDesignerContainer.find(f).focus()},function(){f&&i.App.lPathDesignerContainer.find(f).focus()})}catch(o){t.Loader.marsExceptionHandler.execute(o.name,o.message)}e.hasChanges=!1;e.render()})},f.prototype.initiateUserRoleSync=function(){var u=this,r;if(this.hasChanges)try{i.Util.Common.showAlertMessage(i.Locale.syncRolesDiscardChanges,i.Locale.unSavedChangesPopupMessage,this.$el,!0,i.Locale.yesCaption,i.Locale.no,function(){u.hasChanges=!1;u.initiateUserRoleSync();i.App.lPathDesignerContainer.find(".lpath-gt-config-sync-role")},function(){t.Loader.$mars(".lpath-gt-config-sync-role").focus()})}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message)}else r=new n.Client.Utility.UserRoleSync,r.onSuccess=this.ReloadConfiguration.bind(this),r.invokeUserRoleSync()},f.prototype.getLatestSecurityRoles=function(){var u=this,f=n.Client.Loader.appContext.Util.getConfigurationData(n.Client.Loader.appContext.Util.AuthoringGroup),e=new t.Loader.ConfigurationAPI,o=e.post("","GetCurrentOrgMarsUserRoles");o.done(function(e){e==null||e.Result==null||u.isFirstLoad||n.Client.Utility.ConfigurationUtil.saveConfigurationUserRolesToLocalStore(e.Result);u.securityData={SyncRolesList:e.Result};u.securityData.SyncRolesList=t.Loader.$mars.grep(e.Result,function(n){return n.IsActive!=!1&&n.IsPseudo!=!0});u.securityData.getCRMOrgName=t.Loader.appContext.getOrgName();u.securityData.LastUserRoleSync=i.Util.Common.convertMMddyyyToyyyymmdd(i.Util.Common.getLocalDateTime(f.LastUserRoleSync));u.cloneDataFromSecuredData(u.securityData.SyncRolesList,u.securityData.LastUserRoleSync,u.securityData.getCRMOrgName);u.changedSecurityData.SyncRolesList=t.Loader._mars.sortBy(u.changedSecurityData.SyncRolesList,"Precedence");u.setPrecedence();u.changedSecurityData.LastUserRoleSync=i.Util.Common.convertMMddyyyToyyyymmdd(i.Util.Common.getLocalDateTime(f.LastUserRoleSync));var o=r.TemplateEngine.applyTemplate(i.Util.Constants.securityRolesTemplate,u.changedSecurityData,!1,!0,!1);u.bindSecurityRoleContent(o);u.wireEvent();u.setShortcutKeys()})},f.prototype.cloneDataFromSecuredData=function(n,i,r){var u=[];this.changedSecurityData={};t.Loader.$mars.each(n,function(n,t){var i={};i.AuthoringId=t.AuthoringId;i.Id=t.Id;i.IsActive=t.IsActive;i.IsAdmin=t.IsAdmin;i.MarsObjectCompositeKey=t.MarsObjectCompositeKey;i.MarsObjectId=t.MarsObjectId;i.Name=t.Name;i.ObjectState=t.ObjectState;i.Precedence=t.Precedence;i.Value=t.Value;u.push(i)});this.changedSecurityData.SyncRolesList=u;this.changedSecurityData.LastUserRoleSync=i;this.changedSecurityData.getCRMOrgName=r},f.prototype.handleUpKeyImageKeydown=function(n,t){this.handleKeyboardNavigation(n,t,".lpath-gt-config-arrow-up-wf",".lpath-config-arrow-down-wf","")},f.prototype.handleDownKeyImageKeydown=function(n,t){this.handleKeyboardNavigation(n,t,".lpath-config-arrow-down-wf",".lpath-config-delete-icon-wf",".lpath-gt-config-arrow-up-wf")},f.prototype.handleDeleteImageKeydown=function(n,t){this.handleKeyboardNavigation(n,t,".lpath-config-delete-icon-wf","",".lpath-config-arrow-down-wf")},f.prototype.handleKeyboardNavigation=function(n,r,u,f,e){var s=r.$el.find(n.target),h,c,o;n.keyCode==i.Utility.KeyCodeEnum.TabKey&&(n.shiftKey?n.shiftKey&&this.$el.find("#syncRoleButton").focus():this.$el.find(".lpath-gt-config-save").focus(),n.stopPropagation(),n.preventDefault());n.keyCode==i.Utility.KeyCodeEnum.EnterKey&&(u===".lpath-config-delete-icon-wf"?t.Loader.$mars(n.currentTarget).click():this.changeOrder(n));n.keyCode==i.Utility.KeyCodeEnum.DownArrowKey&&(h=s.closest("tr").next(),h.find(u).focus(),n.preventDefault());n.keyCode==i.Utility.KeyCodeEnum.UpArrowKey&&(c=s.closest("tr").prev(),c.find(u).focus(),n.preventDefault());n.keyCode==i.Utility.KeyCodeEnum.RightArrowKey&&(o=s.closest("tr"),o.find(f).is(":disabled")?o.find(".lpath-config-delete-icon-wf").focus():o.find(f).focus());n.keyCode==i.Utility.KeyCodeEnum.LeftArrowKey&&(o=s.closest("tr"),o.find(e).is(":disabled")?o.find(".lpath-gt-config-arrow-up-wf").focus():o.find(e).focus());this.$el.find(".lpath-gt-td-securityimage *").attr("tabindex","-1");s.attr("tabindex","0")},f.prototype.bindSecurityRoleContent=function(n){var r,t,u;this.$el.find("#lpath-gt-cofiguration-container-content").html(n);r=i.Locale.securityRolesConfiguration;this.$el.find("#lpath-gt-cofiguration-container-content").attr("aria-label",r);t=this.$el.find("#lpath-gt-config-overflowtable table");u=t.find("tbody tr").length;t.attr("summary",i.Locale.securityRoleTableSummary.replace("[[1]]",u))},f}(BackboneMars.View);r.SecurityRolesView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var f=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{}},t.prototype.initialize=function(){},t}(BackboneMars.Model),u;r.BackboneControlPublishingConfigurationModel=f;u=function(u){function f(n){u.call(this);this.allConfigurationKey="allConfigurationKey";this.INVALIDATE_CONFIG_CACHE_KEY="INVALIDATE_CONFIG_CACHE_KEY";this.MARS_ETAGS="ETags";this.hasChanges=!1;this.isNewPublish=0;this.collection=n.collection;this.$el=n.el}return __extends(f,u),f.prototype.initialize=function(){},f.prototype.close=function(){},f.prototype.render=function(){var u=this,f,e,o,s;this.hasChanges=!1;f=!1;e=n.Client.Loader.appContext.Util.getConfigurationData(n.Client.Loader.appContext.Util.PublishGroupSetting);e=t.Loader.$mars.grep(e,function(t){return t.PublishGroupType!=n.Client.Utility.PublishGroupType.Draft});this.publishingGroup={PublishingGroupList:e,orgsList:this.orgsList};o=i.App.serviceHandler.getTenantInstances();o.done(function(n){n.Result&&(u.orgsList=n.Result,u.publishingGroup={PublishingGroupList:e,orgsList:u.orgsList})});o.fail(function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Retrieving instances within tenant failed")});s=r.TemplateEngine.applyTemplate(i.Util.Constants.publishingConfigurationTemplate,this.publishingGroup,!1,!0,!1);this.$el.find("#lpath-gt-cofiguration-container-content").html(s);this.setShortcutKeys();this.checkForHighContrastMode();this.$el.find("#lpath-gt-publish-addnewAG").focus();this.$el.find(".lpath-gt-publish-checkbox-publishgroup").first().attr("tabindex","0");this.$el.find("#lpath-gt-cofiguration-container-content").attr("aria-label",i.Locale.publishConfig);this.$el.off("change",".lpath-gt-publish-name,.lpath-gt-publish-description").on("change",".lpath-gt-publish-name,.lpath-gt-publish-description",function(){u.hasChanges=!0});this.$el.off("click","#lpath-gt-publish-addnewAG").on("click","#lpath-gt-publish-addnewAG",function(){u.$el.find("#lpath-gt-publish-addnewAG").addClass("lpath-gt-publish-newag");u.$el.find(".lpath-gt-publish-checkbox-publishgroup").attr("tabindex","-1");u.$el.find("#lpath-gt-publish-deletePG").attr("tabindex","-1");u.onAddNewPublishGroupClick();f=!0});this.$el.find("#lpath-gt-publish-addnewAG").keydown(function(t){n.Client.Loader.appContext.Util.isEnterPressed(t,!0)&&(this.click(),f=!0);t.keyCode!=i.Utility.KeyCodeEnum.TabKey||t.shiftKey?t.keyCode==i.Utility.KeyCodeEnum.TabKey&&t.shiftKey&&i.App.lPathDesignerContainer.find("#lpath-gt-publish-backtomars").focus():(i.App.lPathDesignerContainer.find("#lpath-gt-publish-deletePG").attr("tabindex","0"),f&&i.App.lPathDesignerContainer.find(".lpath-gt-publish-checkbox-publishgroup").attr("tabindex","0"),i.App.lPathDesignerContainer.find("#lpath-gt-publish-deletePG").focus(),f=!1);t.stopPropagation();t.preventDefault()});this.$el.find("#lpath-gt-publish-deletePG").keydown(function(t){n.Client.Loader.appContext.Util.isEnterPressed(t,!0)&&this.click()});this.$el.off("keydown","#lpath-gt-publish-backtomars").on("keydown","#lpath-gt-publish-backtomars",function(n){n.keyCode==i.Utility.KeyCodeEnum.TabKey&&(n.shiftKey&&u.$el.find(".lpath-gt-config-menu-container ul li.active").focus(),n.shiftKey||u.$el.find("#lpath-gt-publish-addnewAG").focus(),n.stopPropagation(),n.preventDefault())});this.$el.off("click",".lpath-gt-publishgroup-table-row").on("click",".lpath-gt-publishgroup-table-row",function(n){u.onPublishGroupRowEditClick(n.currentTarget);f=!1});this.$el.off("click","#lpath-gt-publish-deletePG").on("click","#lpath-gt-publish-deletePG",function(n){var i=u.$el.find(".lpath-gt-publish-checkbox-publishgroup:checked");i.length>0?u.ShowingAlertWithOkAndCancel(t.Loader.marsLocale.deletePublishEnvTitle,t.Loader.marsLocale.deletePublishConfirmation,t.Loader.marsLocale.deleteRole,t.Loader.marsLocale.cancelCaption,"deletePublishGroup",i):u.ShowingAlertWithOk(t.Loader.marsLocale.NoPGSelectedMessage,"deletePublishGroupOk",u.$el.find("#lpath-gt-publish-deletePG"));n.preventDefault()});this.$el.off("click",".lpath-gt-config-save").on("click",".lpath-gt-config-save",function(){u.onSavePublishGroupClick()});this.$el.off("click","#lpath-gt-config-pg-cancel").on("click","#lpath-gt-config-pg-cancel",function(){u.onCancelNewPublishGroupClick()});this.$el.off("keydown","#lpath-gt-config-pg-cancel").on("keydown","#lpath-gt-config-pg-cancel",function(n){return n.keyCode===9&&!n.shiftKey?(u.$el.parents("#lPathDesignerContainer").find(".lpath-ap-close").focus(),!1):n.keyCode===13?(u.onCancelNewPublishGroupClick(),!1):!0});this.$el.off("keydown","td.lpath-gt-td-publishgroupdescription:last").on("keydown","td.lpath-gt-td-publishgroupdescription:last",function(n){if(n.keyCode===9&&!n.shiftKey&&(u.$el.find(".lpath-gt-publish-rightside-bodysection")==undefined||u.$el.find(".lpath-gt-publish-rightside-bodysection").length==0))return t.Loader.$mars("#headerMars").focus(),!1});this.$el.off("change",".lpath-gt-publish-checknewpublish").on("change",".lpath-gt-publish-checknewpublish",function(n){u.onChangeOfCheckboxProperty(n);u.hasChanges=!0;u.addAndRemoveSpecificOrgDetails(n)});this.$el.off("change",".lpath-gt-publish-checkbox-publishgroup").on("change",".lpath-gt-publish-checkbox-publishgroup",function(n){u.onChangeOfCheckboxProperty(n);u.hasChanges=!0;u.addAndRemoveSpecificOrgDetails(n)});this.$el.on("keydown",".lpath-gt-publish-checkbox-publishgroup",function(n){return u.handleUpDownArrowNavigation(n,self,1)});this.$el.on("keydown",".lpath-gt-publish-checknewpublish",function(n){return u.handleUpDownArrowNavigation(n,self,2)});return this},f.prototype.setShortcutKeys=function(){var r=this,n=[];t.Loader.$mars(".lpath_gt_config_container_breadcrumb").off("keydown");t.Loader.$mars(".lpath_gt_config_container_breadcrumb").off("keyup");t.Loader.$mars(".lpath_gt_config_container_breadcrumb").keydown(function(t){n.push(t.keyCode)}).keyup(function(){n=jQuery.unique(n);n.indexOf(i.Utility.KeyCodeEnum.CtrlKey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.Altkey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.SKey)!==-1&&r.onSavePublishGroupClick();n=[]});t.Loader.$mars(".lpath-gt-config-menubar").off("keydown");t.Loader.$mars(".lpath-gt-config-menubar").off("keyup");t.Loader.$mars(".lpath-gt-config-menubar").keydown(function(t){n.push(t.keyCode)}).keyup(function(){n=jQuery.unique(n);n.indexOf(i.Utility.KeyCodeEnum.CtrlKey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.Altkey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.SKey)!==-1&&r.onSavePublishGroupClick();n=[]});t.Loader.$mars("#lpath-gt-cofiguration-container-content").off("keydown");t.Loader.$mars("#lpath-gt-cofiguration-container-content").off("keyup");t.Loader.$mars("#lpath-gt-cofiguration-container-content").keydown(function(t){n.push(t.keyCode)}).keyup(function(){n=jQuery.unique(n);n.indexOf(i.Utility.KeyCodeEnum.CtrlKey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.Altkey)!==-1&&n.indexOf(i.Utility.KeyCodeEnum.SKey)!==-1&&r.onSavePublishGroupClick();n=[]})},f.prototype.onChangeOfCheckboxProperty=function(n){var r=t.Loader.$mars(n.currentTarget),u=r.parent().next().text(),f=i.Locale.selectOrg+" "+u,e=i.Locale.deselectOrg+" "+u;r.prop("checked")==!0?r.attr("aria-label",e):r.attr("aria-label",f)},f.prototype.onAddNewPublishGroupClick=function(){this.hasChanges?this.ShowingAlertWithOkAndCancel(t.Loader.marsLocale.unSavedChangesPopupTitle,t.Loader.marsLocale.unSavedChangesPopupMessage,t.Loader.marsLocale.deleteChangesCaption,t.Loader.marsLocale.stayOnPageCaption,"addNewPublishGroup",""):this.newPublishGroupAction()},f.prototype.newPublishGroupAction=function(){var f,u,e;this.removeNewPublishGroupFromList();this.isNewPublish=1;f=this.$el.find(".lpath-gt-publish-checkbox-publishgroup:checked");t.Loader.$mars.each(f,function(n,i){i.checked=!1;t.Loader.$mars(i).closest("tr").removeClass("active")});this.publishGroupId=i.Utility.Util.newGuid();u={Id:this.publishGroupId,SpecificPGOrgAccesses:[],ObjectState:n.Client.Utility.UserRoleState.added,AuthoringId:n.Client.Loader.appContext.getAuthoringId(),OwnerAuthoringId:n.Client.Loader.appContext.getAuthoringId(),PublishGroupType:n.Client.Utility.PublishGroupType.Specific};t.Loader.$mars.each(this.orgsList,function(n,t){t.checked=!1});this.publishingGroup.PublishingGroupList.push(u);this.publishingGroup.PublishingGroupDetail=u;e=r.TemplateEngine.applyTemplate(i.Util.Constants.addNewPublishingGroupTemplate,this.publishingGroup,!1,!0,!1);this.$el.find("#lpath-gt-publish-addnewpublish").html(e);this.$el.find("#lpath-gt-publish-name").focus()},f.prototype.onPublishGroupRowEditClick=function(n){this.hasChanges?this.ShowingAlertWithOkAndCancel(t.Loader.marsLocale.unSavedChangesPopupTitle,t.Loader.marsLocale.unSavedChangesPopupMessage,t.Loader.marsLocale.deleteChangesCaption,t.Loader.marsLocale.stayOnPageCaption,"publishGroupRowEdit",n):(this.publishGroupEditAction(n),this.$el.find(".lpath-gt-publish-checkbox-publishgroup").attr("tabindex","-1"),i.App.lPathDesignerContainer.find(n).find(".lpath-gt-publish-checkbox-publishgroup").attr("tabindex","0"))},f.prototype.publishGroupEditAction=function(n){var f=this,u;t.Loader.$mars(n).closest("tbody").find("tr").not(n).removeClass("active").find(".lpath-gt-publish-checkbox-publishgroup").removeAttr("checked");this.$el.find(n).hasClass("active")?(this.$el.find(n).removeClass("active"),this.$el.find(n).find(".lpath-gt-publish-checkbox-publishgroup:first").prop("checked",!1),this.$el.find(".lpath-gt-publish-rightside-bodysection").remove(),this.$el.find(n).find(".lpath-gt-publish-checkbox-publishgroup:first").focus()):(this.$el.find(n).addClass("active"),this.$el.find(n).find(".lpath-gt-publish-checkbox-publishgroup:first").prop("checked",!0),this.publishingGroup.PublishingGroupDetail=t.Loader.$mars.grep(this.publishingGroup.PublishingGroupList,function(t){return"row_"+t.Id==n.id})[0],this.publishingGroup.orgsList=this.orgsList,t.Loader.$mars.each(this.publishingGroup.orgsList,function(n,i){var r=t.Loader.$mars.grep(f.publishingGroup.PublishingGroupDetail.SpecificPGOrgAccesses,function(n){return n.ProductOrgId==i.ProductOrgId&&n.ProductOrgId});i.checked=r.length>0?!0:!1}),u=r.TemplateEngine.applyTemplate(i.Util.Constants.addNewPublishingGroupTemplate,this.publishingGroup,!1,!0,!1),this.$el.find("#lpath-gt-publish-addnewpublish").html(u),this.$el.find("#lpath-gt-publish-name").focus())},f.prototype.onDeletePublishGroupClick=function(){var i=this,u=[],f=new t.Loader.ConfigurationAPI,e=this.$el.find(".lpath-gt-publish-checkbox-publishgroup:checked"),r;t.Loader.$mars.each(e,function(r,f){var e={},o;e=t.Loader.$mars.grep(i.publishingGroup.PublishingGroupList,function(n){return n.Id==f.id})[0];e.ObjectState=n.Client.Utility.UserRoleState.deleted;o={ItemType:1,Item:e};u.push(o)});r=f.post(u,"CUDConfigurationItems");r.done(function(r){if(r!=null&&r.Result!=null){var u=f.getAllConfigurations();u.done(function(r){n.Client.Utility.ConfigurationUtil.loadConfigurationData(r);i.ShowingAlertWithOk(t.Loader.marsLocale.deleteSuccess,"deleteReRender")})}});r.fail(function(){i.ShowingAlertWithOk(t.Loader.marsLocale.deleteFailed,"deleteReRender")})},f.prototype.onSavePublishGroupClick=function(){var u=this,e,o;if(this.$el.find(".lpath-gt-publish-name").val().length>0)if(this.$el.find(".lpath-gt-publish-checknewpublish:checked").length>0){var r={},f={},s,h=this.$el.find(".lpath-gt-publish-checkbox-publishgroup:checked");s=h.length>0?h[0].id:this.publishGroupId;r=t.Loader.$mars.grep(this.publishingGroup.PublishingGroupList,function(n){return n.Id==s})[0];r.Name=this.$el.find("#lpath-gt-publish-name").val();r.Description=this.$el.find(".lpath-gt-publish-description").val();r.ObjectState=this.isNewPublish==1?n.Client.Utility.UserRoleState.added:n.Client.Utility.UserRoleState.modified;f.ItemType=1;f.Item=r;e=new t.Loader.ConfigurationAPI;i.App.showActionOverlay();o=e.post(f,"CUDConfigurationItem");o.done(function(r){if(r!=null&&r.Result!=null){var f=e.getAllConfigurations();f.done(function(r){i.App.hideActionOverlay();n.Client.Utility.ConfigurationUtil.loadConfigurationData(r);u.ShowingAlertWithOk(t.Loader.marsLocale.saveSuccess,"onSavePublishGroup",u.$el.find("#lpath-gt-publish-addnewAG"))})}});o.fail(function(){i.App.hideActionOverlay();u.ShowingAlertWithOk(t.Loader.marsLocale.saveFailed,"",u.$el.find("#lpath-gt-publish-addnewAG"))})}else this.ShowingAlertWithOk(t.Loader.marsLocale.orgsSelectedEmptyAlter,"",this.$el.find(".lpath-gt-publish-checknewpublish:first"));else this.ShowingAlertWithOk(t.Loader.marsLocale.publishingNameEmptyAlert,"publishgrouopnameempty",this.$el.find("#lpath-gt-publish-name"))},f.prototype.onCancelNewPublishGroupClick=function(){this.hasChanges?this.ShowingAlertWithOkAndCancel(t.Loader.marsLocale.unSavedChangesPopupTitle,t.Loader.marsLocale.unSavedChangesPopupMessage,t.Loader.marsLocale.deleteChangesCaption,t.Loader.marsLocale.stayOnPageCaption,"cancelNewPublishGroup",""):(this.removeHeightlightOfRow(),this.$el.find(".lpath-gt-publish-rightside-bodysection").remove(),this.$el.find("#lpath-gt-publish-addnewAG").focus())},f.prototype.removeHeightlightOfRow=function(){this.$el.find(".lpath-gt-publish-checkbox-publishgroup").removeAttr("checked");this.$el.find(".lpath-gt-publishgroup-table-row").removeClass("active")},f.prototype.removeNewPublishGroupFromList=function(){var n=this;this.isNewPublish==1&&(this.isNewPublish=0,this.publishingGroup.PublishingGroupList=t.Loader.$mars.grep(this.publishingGroup.PublishingGroupList,function(t){return t.Id!=n.publishGroupId}))},f.prototype.addAndRemoveSpecificOrgDetails=function(r){var u,e=this.$el.find(".lpath-gt-publish-checkbox-publishgroup:checked"),f,o,s;u=e.length>0?e[0].id:this.publishGroupId;r.currentTarget.checked?(f=t.Loader.$mars.grep(this.publishingGroup.PublishingGroupList,function(n){return n.Id==u})[0],o=t.Loader.$mars.grep(f.SpecificPGOrgAccesses,function(n){return n.ProductOrgId==r.currentTarget.id}),o.length>0?t.Loader.$mars.each(f.SpecificPGOrgAccesses,function(t,i){i.ProductOrgId==r.currentTarget.id&&(i.ObjectState=n.Client.Utility.UserRoleState.modified)}):(s={Id:i.Utility.Util.newGuid(),ObjectState:n.Client.Utility.UserRoleState.added,PgId:u,ProductOrgId:r.currentTarget.id},f.SpecificPGOrgAccesses.push(s))):t.Loader.$mars.each(this.publishingGroup.PublishingGroupList,function(n,i){i.Id==u&&t.Loader.$mars.each(i.SpecificPGOrgAccesses,function(n,t){t.ProductOrgId==r.currentTarget.id&&(t.ObjectState=3)})})},f.prototype.ShowingAlertWithOk=function(n,r,u){var f=this;try{i.Util.Common.showAlertMessage(t.Loader.marsLocale.alertTitle,n,this.$el,!1,t.Loader.marsLocale.okButtonCaption,"",function(){switch(r){case"deleteReRender":f.render();f.$el.find("#lpath-gt-publish-deletePG").focus();break;case"onSavePublishGroup":f.isNewPublish=0;f.render();f.$el.find("#lpath-gt-publish-addnewAG").focus();break;case"publishgrouopnameempty":f.$el.find(".lpath-gt-publish-name").focus();break;case"deletePublishGroupOk":f.$el.find(".lpath-gt-publish-deletetext").focus()}},function(){},!0,u)}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message)}},f.prototype.checkForHighContrastMode=function(){var t,r,u,f,e;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishingConfiguration:checkForHighContrastMode START");i.$mars("#checkHighContrastDiv").css("background-image")==="none"?(t=!1,i.$mars("body").css("background-color")==="rgb(255, 255, 255)"&&(t=!0),i.App.lPathDesignerContainer.hasClass("lpath-highcontrast")||i.App.lPathDesignerContainer.addClass("lpath-highcontrast"),i.$mars("lpath-landingpage-container").addClass("lpath_highcontrast"),i.$mars("#lPathDesignerOverlay").hasClass("lpath-highcontrast")||i.$mars("#lPathDesignerOverlay").addClass("lpath-highcontrast"),i.$mars("#lPathDesignerOverlay").hasClass("lpath-overlay-initial-highcontrast")||i.$mars("#lPathDesignerOverlay").addClass("lpath-overlay-initial-highcontrast"),r=this.$el.find("#lpath-gt-publish-deletePG").find("img"),u=this.$el.find("#lpath-gt-publish-addnewAG").find("img"),r&&(f=t?n.Client.Loader.marsImageMapping.ImagePath.deletestage:n.Client.Loader.marsImageMapping.ImagePath.deletestageHC,r.attr("src",n.Client.Loader.serverUrl+"images/"+f)),u&&(e=t?n.Client.Loader.marsImageMapping.ImagePath.configNewStage:n.Client.Loader.marsImageMapping.ImagePath.configNewStageHighContrast,u.attr("src",n.Client.Loader.serverUrl+"images/"+e))):i.$mars("#lPathDesignerOverlay").hasClass("mars_highcontrast")&&i.$mars("#lPathDesignerOverlay").removeClass("mars_highcontrast");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishingConfiguration:checkForHighContrastMode END")},f.prototype.ShowingAlertWithOkAndCancel=function(n,r,u,f,e,o){var s=this;try{i.Util.Common.showAlertMessage(n,r,this.$el,!0,u,f,function(){if(e=="deletePublishGroup")s.onDeletePublishGroupClick(o);else e=="addNewPublishGroup"?(s.hasChanges=!1,s.newPublishGroupAction(),s.$el.find("#lpath-gt-publish-name").focus()):e=="publishGroupRowEdit"?(s.hasChanges=!0,s.publishGroupEditAction(o),s.$el.find(".lpath-gt-publish-checkbox-publishgroup").attr("tabindex","-1"),s.$el.find(o).find(".lpath-gt-publish-checkbox-publishgroup:first").attr("tabindex","0")):e=="cancelNewPublishGroup"&&(s.hasChanges=!1,s.render(),s.$el.find("#lpath-gt-publish-addnewAG").focus())},function(){if(e=="deletePublishGroup")s.$el.find("#lpath-gt-publish-deletePG").focus();else if(e=="cancelNewPublishGroup")s.$el.find(".lpath-gt-config-cancel").focus();else if(e=="publishGroupRowEdit"){var n=s.$el.find(".lpath-gt-publish-checkbox-publishgroup:checked").length;n==0?(s.$el.find(o).find(".lpath-gt-publish-checkbox-publishgroup:first").prop({checked:!0,tabindex:"0"}),s.$el.find(o).find(".lpath-gt-publish-checkbox-publishgroup:first").focus()):n==1?(s.$el.find(o).find(".lpath-gt-publish-checkbox-publishgroup:first").prop({checked:!1,tabindex:"0"}),s.$el.find(o).find(".lpath-gt-publish-checkbox-publishgroup:first").focus()):(s.$el.find(o).find(".lpath-gt-publish-checkbox-publishgroup:first").prop({checked:!1,tabindex:"-1"}),s.$el.find("#lpath-gt-publish-name").focus())}})}catch(h){t.Loader.marsExceptionHandler.execute(h.name,h.message)}},f.prototype.handleUpDownArrowNavigation=function(n,t,r){var f=this.$el.find(n.target),e,u;r===1&&this.$el.find("#lpath-gt-publish-name").length===1&&(e=this.$el.find("#lpath-gt-publish-name"));n.keyCode===i.Utility.KeyCodeEnum.TabKey&&(n.shiftKey||r===1&&e===undefined&&(this.$el.parent().find(".lpath-ap-close").focus(),n.stopPropagation(),n.preventDefault()),r===1?this.$el.find(".lpath-gt-publish-checkbox-publishgroup").attr("tabindex","-1"):r===2&&this.$el.find(".lpath-gt-publish-checknewpublish").attr("tabindex","-1"),f.attr("tabindex","0"));n.keyCode==i.Utility.KeyCodeEnum.DownArrowKey&&(r===1?(u=f.closest("tr").next(),u.find(".lpath-gt-publish-checkbox-publishgroup").focus()):r===2&&(u=f.closest("tr").next(),u.find(".lpath-gt-publish-checknewpublish").focus()),n.stopPropagation(),n.preventDefault());n.keyCode==i.Utility.KeyCodeEnum.UpArrowKey&&(r===1?(u=f.closest("tr").prev(),u.find(".lpath-gt-publish-checkbox-publishgroup").focus()):r===2&&(u=f.closest("tr").prev(),u.find(".lpath-gt-publish-checknewpublish").focus()),n.stopPropagation(),n.preventDefault())},f}(BackboneMars.View);r.PublishingConfigurationView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(Client){var t;(function(Designer){var t;(function(t){"use strict";var r=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.defaults=function(){return{}},t.prototype.initialize=function(){},t}(BackboneMars.Model),i;t.BackboneControlMicrosoftSettingsModel=r;i=function(i){function r(n){i.call(this);this.hasChanges=!1;this.authoringId="aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa";this.isChanged=!1;this.collection=n.collection;this.$el=n.el}return __extends(r,i),r.prototype.initialize=function(){},r.prototype.close=function(){},r.prototype.render=function(){var i=this,r;this.productOrgDetailSetting=n.Client.Loader.appContext.Util.getConfigurationData(n.Client.Loader.appContext.Util.OrgDetailSetting);r=t.TemplateEngine.applyTemplate(Designer.Util.Constants.microsoftSettingsTemplate,this.productOrgDetailSetting,!1,!0,!1);this.$el.find("#lpath-gt-cofiguration-container-content").html(r);this.$el.find("#lpath-gt-cofiguration-container-content").attr("aria-label",Designer.Locale.microsoftSettingsConfiguration);this.getMicrosoftSetting();this.$el.off("click",".lpath-gt-config-save").on("click",".lpath-gt-config-save",function(n){i.onSaveMicrosoftSaveClick(n)});this.$el.off("click","#lpath-gt-config-ms-cancel").on("click","#lpath-gt-config-ms-cancel",function(){i.$el.find("#lpath-gt-ms-setting-check").prop("checked",i.isChanged);i.$el.parents("#lPathDesignerContainer").find("#headerMars").focus()});this.$el.off("keydown","#lpath-gt-config-ms-cancel").on("keydown","#lpath-gt-config-ms-cancel",function(n){return n.keyCode===9&&!n.shiftKey?(i.$el.parents("#lPathDesignerContainer").find("#headerMars").focus(),!1):!0});return this},r.prototype.getMicrosoftSetting=function(){this.productOrgDetailSetting.AuthoringId==this.authoringId?(this.$el.find("#lpath-gt-ms-setting-check").prop("checked",!0),this.$el.find("#lpath-gt-ms-setting-check").prop("disabled",!0),this.$el.find(".lpath-gt-config-save").prop("disabled",!0),this.isChanged=!0):this.$el.find("#lpath-gt-ms-setting-check").prop("checked",!1)},r.prototype.onSaveMicrosoftSaveClick=function(){var _this=this,i=new Client.Loader.ConfigurationAPI,r,t;this.$el.find("#lpath-gt-ms-setting-check").is(":checked")&&(r={AuthoringId:this.authoringId,ProductOrgId:this.productOrgDetailSetting.ProductOrgId},t=i.post(r,"AttachToAuthoringGroup"),t.done(function(t){if(t!=null&&t.Result!=null){var r=i.getAllConfigurations();r.done(function(t){n.Client.Utility.ConfigurationUtil.loadConfigurationData(t);try{Designer.Util.Common.showAlertMessage(Designer.Locale.alertTitle,Designer.Locale.saveSuccess,_this.$el,!1,Designer.Locale.okButtonCaption,!1,function(){_this.render();_this.$el.parents("#lPathDesignerContainer").find("#headerMars").focus()},function(){})}catch(i){Client.Loader.marsExceptionHandler.execute(i.name,i.message)}})}}),t.fail(function(err){var alertTitle,alertMessage,localeKey,localeMessage,title;try{alertTitle=Designer.Locale.alertTitle;alertMessage=Designer.Locale.saveFailed;err.responseJSON&&err.responseJSON.ErrorCode>0&&(localeKey="Error_"+err.responseJSON.ErrorCode,localeMessage=eval("_MicrosoftMars.Client.Loader.marsLocale."+localeKey),localeMessage&&(alertMessage=localeMessage,title=eval("_MicrosoftMars.Client.Loader.marsLocale."+localeKey+"Title"),title&&(alertTitle=title)));Designer.Util.Common.showAlertMessage(alertTitle,alertMessage,_this.$el,!1,Designer.Locale.okButtonCaption,!1,function(){},function(){})}catch(err){Client.Loader.marsExceptionHandler.execute(err.name,err.message,err.responseJSON)}}))},r}(BackboneMars.View);t.MicrosoftSettingsView=i})(t=Designer.Renderer||(Designer.Renderer={}))})(t=Client.Designer||(Client.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(r){function u(n,i,u,f,e){r.call(this,{},f);this.parentControlId=n;this.content=u;this.rootElement=f;this.innerControlUpdateCallback=e;this.initializeControls();this.sectionIndex=i;this.ControlTypes=t.Utility.ControlTypes}return __extends(u,r),u.prototype.getTemplate=function(){return t.Util.Constants.addExistingGuidedTaskTemplate},u.prototype.initializeControls=function(){try{this.viewDataValue=this.content;r.prototype.build.call(this);this.genericPopupHolder=this.getGenericDialogHolder(t.App.lPathDesignerContainer);this.containerId=this.rootElement.attr("id");r.prototype.isHighContrastModeActive.call(this)&&this.handleExistingGTHc();this.attachEvents();this.createMiniGridPopup()}catch(i){n.Loader.marsExceptionHandler.execute(i.name,i.message)}},u.prototype.attachEvents=function(){var n=this,u=this.rootElement.find('input[id="lPathSectionTextTemplateTitle"]'),f,r,i,e;u.attr("id",this.containerId+"_"+u.attr("id"));u.on("change",function(){n.content.Title=t.$mars(this).val();n.innerControlUpdateCallback(n.content,!1,n.sectionIndex);n.reload(!0)});f=this.rootElement.find('button[name="lPathExistingGuidedTaskPlus"]');f.attr("id",this.containerId+"_"+f.attr("id"));this.subscribe(f,"click",this.onPlusClick);r=this.rootElement.find('button[id="lPathAddListOfLinksDelete"]');r&&(r.attr("id",this.containerId+"_"+r.attr("id")),this.subscribe(r,"click",this.deleteSelectedLink));i=this.rootElement.find('button[id="lPathAddListOfLinksEdit"]');i&&(i.attr("id",this.containerId+"_"+i.attr("id")),this.subscribe(i,"click",function(t,i){n.editButtonSelectedLink(t,i)}));e=this.rootElement.find('input[id="lPathListOfLinkTitle"]');e&&(e.attr("id",this.containerId+"_"+i.attr("id")),this.subscribe(e,"change",function(t,i){n.updateTitle(t,i)}));u.focus()},u.prototype.handleExistingGTHc=function(){var t=this.rootElement.find('button[id="lPathAddListOfLinksDelete"]'),i=this.rootElement.find('button[id="lPathAddListOfLinksEdit"]');r.prototype.isBlackHighContrastMode.call(this)?(t.length>0&&t.find("img").attr("src",n.Loader.serverUrl+"images/"+n.Loader.marsImageMapping.ImagePath.deleteSectionContentHCB),i.length>0&&i.find("img").attr("src",n.Loader.serverUrl+"images/"+n.Loader.marsImageMapping.ImagePath.editTitleHCB)):(t.length>0&&t.find("img").attr("src",n.Loader.serverUrl+"images/"+n.Loader.marsImageMapping.ImagePath.deleteSectionContentHCW),i.length>0&&i.find("img").attr("src",n.Loader.serverUrl+"images/"+n.Loader.marsImageMapping.ImagePath.editTitleHCW))},u.prototype.onPlusClick=function(){var n=this;n.content&&n.content.Links&&(n.selectedLinkIndex=n.content.Links.length);this.selectExistingControlByType(t.Utility.LinkType.GuidedTask,!1)},u.prototype.deleteSelectedLink=function(n,t){var i=this.rootElement.find(t);i&&(this.selectedLinkIndex=i.data("linkindex"),this.content.Links.splice(this.selectedLinkIndex,1),this.reload())},u.prototype.editButtonSelectedLink=function(n,i){var r=this.rootElement.find(i);r&&(this.selectedLinkIndex=r.data("linkindex"),this.selectExistingControlByType(t.Utility.LinkType.GuidedTask,!0))},u.prototype.updateTitle=function(n,t){var i=this.rootElement.find(t);this.selectedLinkIndex=i.data("linkindex");this.content.Links[this.selectedLinkIndex].Title=i.val();this.reload(!0)},u.prototype.createMiniGridPopup=function(){this.dialogContainer=n.Loader.$mars('<div id="'+this.genericPopupHolder.attr("Id")+'_lPath-buildercontrol-dialog" class= "lpath_dialog lpath-lol-dialog-main-container"><\/div>');this.genericPopupHolder.append(this.dialogContainer)},u.prototype.selectExistingControlByType=function(r,u){var f=this,r,e="",o="",s;f.createMiniGridHolder("_lPath-LinkOfGTPopUP-placeholder");r=f.ControlTypes.GuidedTask;e=t.Locale.flowViewMiniGridHeader;o=t.Locale.selectTheGuidedTask;this.listOfLinkDialog&&this.listOfLinkDialog.hide();s=new i.MiniGrid(o,e,r,f.miniGridHolder,!0,1,5,f.parentControlId,function(t){n.Loader.$mars("#"+f.placeHolderId).remove();f.onMiniGridokClick(t,u);f.dialogContainer.fadeOut(300);f.reload();u&&f.rootElement.find('button[id="'+f.containerId+'_lPathAddListOfLinksEdit"]')?f.rootElement.find('button[id="'+f.containerId+'_lPathAddListOfLinksEdit"]').focus():f.rootElement.find('button[id="'+f.containerId+'_lPathExistingGuidedTaskPlus"]').focus()},function(){n.Loader.$mars("#"+f.placeHolderId).remove();f.dialogContainer.fadeOut(300);u&&f.rootElement.find('button[id="'+f.containerId+'_lPathAddListOfLinksEdit"]')?f.rootElement.find('button[id="'+f.containerId+'_lPathAddListOfLinksEdit"]').focus():f.rootElement.find('button[id="'+f.containerId+'_lPathExistingGuidedTaskPlus"]').focus()});f.dialogContainer.append(f.miniGridHolder);f.dialogContainer.fadeIn("slow",function(){n.Loader.$mars("#lPathMiniGridSearchText").focus()})},u.prototype.onMiniGridokClick=function(n,t){var i=this;i.getData(n,i,t);i.reload()},u.prototype.getData=function(r,u,f){for(var o,h,s,e=0;e<r.length;e++)o=(new t.Content.MetaDataJsonElementStructure).LinksModel,o.ControlReference.ControlId=r[e].controlId,o.ControlReference.ControlVersionId=r[e].controlVersionId,o.LinkType=t.Utility.LinkType.GuidedTask,o.Title=!r[e].title||r[e].title.trim()==""?r[e].controlName:r[e].title,u.content.Links.length!=0&&u.checkExistingControl(u.content.Links,r[e],f)?(h='<div class= "mars-float-left"> <img id="warningIcon" src= "'+n.Loader.serverUrl+'images/dialog_alert-icon_20x20.png" /><\/div>',h+='<div class= "mars-float-left changeContenttypeDialog" tabindex="0">'+t.Locale.duplicateSelectedGtMessage+"<\/div>",s=new i.SimpleDialogView({},t.$mars("#mars_popup_container"),"ChangeContenttypePopup",t.Locale.selectAnotherGtTitle,h,function(){},function(){}),s.showCancel=!0,s.ariaDescribedById="ChangeContenttypePopup",s.show(),t.$mars('div[name="mars_builderControlContainer"]').hide(),t.$mars('div[name="commentsViewContainer"]').hide()):u.selectedLinkIndex!=undefined?(u.content.Links[u.selectedLinkIndex]=o,u.selectedLinkIndex++):u.content.Links.push(o)},u.prototype.reload=function(n){n===void 0&&(n=!1);n||(this.unsubscribe(),this.initializeControls());this.innerControlUpdateCallback(this.content,!1,this.sectionIndex)},u.prototype.createMiniGridHolder=function(i){var r=this;r.placeHolderId=r.containerId+i;r.miniGridHolder=n.Loader.$mars('<div class="lpath-lol-minigrid-placeholder" id="'+r.placeHolderId+'" style="width:100%;"/>');r.miniGridHolder.css("z-index",t.App.lPathDesignerContainerZIndex+5);r.dialogContainer.html("");r.dialogContainer.append(r.miniGridHolder)},u.prototype.checkExistingControl=function(i,r,u){for(var f=this,o,s=[],e=0;e<i.length;e++)if(i[e].ControlReference&&i[e].ControlReference.ControlId==r.controlId)return s.push(t.Locale.gtAlreadyExists),o=u&&f.rootElement.find('button[id="'+f.containerId+'_lPathAddListOfLinksEdit"]')?f.containerId+"_lPathAddListOfLinksEdit":f.containerId+"_lPathExistingGuidedTaskPlus",t.Util.Common.showErrorMessage(s,function(){n.Loader.$mars("#"+o).focus()},function(){n.Loader.$mars("#"+o).focus()}),!0;return!1},u}(i.View);i.AddExistingGuidedTask=r})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t,r,f,e,o){u.call(this,{},f);this.parentControlId=n;this.content=r;this.rootElement=f;this.innerControlUpdateCallback=o;this.buttonType=i.Util.Constants.oneButton;this.buttonType=e;this.viewDataValue=this.content;this.initializeControls();this.sectionIndex=t;this.ControlTypes=i.Utility.ControlTypes}return __extends(f,u),f.prototype.getTemplate=function(){return this.buttonType==i.Util.Constants.oneButton?i.Util.Constants.onebuttonTemplate:i.Util.Constants.twobuttonTemplate},f.prototype.initializeControls=function(){try{this.viewDataValue=this.content;this.createModel();this.build();u.prototype.isHighContrastModeActive.call(this)&&this.handleButtonHc();this.genericPopupHolder=this.getGenericDialogHolder(i.App.lPathDesignerContainer);this.containerId=this.rootElement.attr("id");this.attachEvents();this.createMiniGridPopup()}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message)}},f.prototype.createModel=function(){var n,t;this.buttonType==i.Util.Constants.oneButton?(n=(new i.Content.MetaDataJsonElementStructure).LinksModel,this.content.Links[0]==undefined&&(n.Title=i.Locale.buttonOne,this.content.Links[0]=n)):(n=(new i.Content.MetaDataJsonElementStructure).LinksModel,t=(new i.Content.MetaDataJsonElementStructure).LinksModel,this.buttonType==i.Util.Constants.twoButton&&this.content.Links[0]==undefined&&(n.Title=i.Locale.buttonOne,this.content.Links[0]=n),this.buttonType==i.Util.Constants.twoButton&&this.content.Links[1]==undefined&&(t.Title=i.Locale.buttonTwo,this.content.Links[1]=t))},f.prototype.attachEvents=function(){var r=this,c=t.Loader.$mars(this),o=this.rootElement.find('input[id="lPathSectionTextTemplateTitle"]'),h,s,e,u,f,n;o.attr("id",this.containerId+"_"+o.attr("id"));o.on("change",function(){r.content.Title=i.$mars(this).val();r.innerControlUpdateCallback(r.content,!1,r.sectionIndex);r.reload(!1,!0)});for(h=t.Loader.$mars('div[name="lPathBuilderControlContainer"]'),s=this.rootElement.find('textarea[id="lPathText"]'),s.attr("id",this.containerId+"_"+s.attr("id")),i.Content.lPathCkEditor.setCkEditorForSectionContent(s,h,c,function(n){var t=i.Util.Common.addPlaceHolderForCKEditor(n.getData());r.content.Text=t;r.innerControlUpdateCallback(r.content,!1,r.sectionIndex);r.reload(!1,!0)},function(){},this.ckEditorReadyCallback),e=this.rootElement.find('input[name="lPathButtonEdit"]'),n=0;n<e.length;n++)e[n].setAttribute("id",this.containerId+"_"+e[n].getAttribute("id")),this.subscribe(i.$mars("#"+e[n].getAttribute("id")),"click",this.onEditClick);if(u=this.rootElement.find('input[name="lPathButtonDelete"]'),u)for(n=0;n<u.length;n++)u[n].setAttribute("id",this.containerId+"_"+u[n].getAttribute("id")),this.subscribe(i.$mars("#"+u[n].getAttribute("id")),"click",this.deleteSelectedLink);if(f=this.rootElement.find('div[name="lPathButtonTitle"]'),f)for(n=0;n<f.length;n++)f[n].setAttribute("id",this.containerId+"_"+f[n].getAttribute("id")),this.subscribe(i.$mars("#"+f[n].getAttribute("id")),"focusout",function(n,t){r.updateButtonTitle(n,t)});this.nextFocusableElement?(document.getElementById(this.nextFocusableElement).focus(),this.nextFocusableElement=undefined):this.ckEditorReadyCallback||o.focus()},f.prototype.handleButtonHc=function(){for(var i=this.rootElement.find('input[name="lPathButtonEdit"]'),n=0;n<i.length;n++)u.prototype.isBlackHighContrastMode.call(this)?i[n].setAttribute("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.buttonLinkHCB):i[n].setAttribute("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.buttonLinkHCW)},f.prototype.onEditClick=function(n,t){var i=this.rootElement.find(t);i&&(this.selectedLinkIndex=i.data("linkindex"));this.openListOfLinkPopUp(this,null)},f.prototype.onTitleChange=function(n,t){var i=this.rootElement.find(t);this.content.Title=i.val();this.reload(!1)},f.prototype.deleteSelectedLink=function(n,t){var r=this.rootElement.find(t);r&&(this.selectedLinkIndex=r.data("linkindex"),this.content.Links[this.selectedLinkIndex]=(new i.Content.MetaDataJsonElementStructure).LinksModel,this.content.ControlReference=null,this.content.Links[this.selectedLinkIndex].Title=this.selectedLinkIndex==0?i.Locale.buttonOne:i.Locale.buttonTwo,this.reload(!1))},f.prototype.updateButtonTitle=function(n,t){var r=this.rootElement.find(t);this.ckEditorReadyCallback=null;n.relatedTarget?this.nextFocusableElement=n.relatedTarget.getAttribute("id"):this.ckEditorReadyCallback=function(n){n.editor.focus();this.ckEditorReadyCallback=null};this.selectedLinkIndex=r.data("linkindex");this.content.Links[this.selectedLinkIndex].Title=r.text()&&r.text().trim()!=""?r.text():i.Locale.buttonIndex+" "+(this.selectedLinkIndex+1);this.reload(!1,!1)},f.prototype.createMiniGridPopup=function(){this.dialogContainer=t.Loader.$mars('<div id="'+this.genericPopupHolder.attr("Id")+'_lPath-buildercontrol-dialog" class= "lpath_dialog lpath-lol-dialog-main-container"><\/div>');this.genericPopupHolder.append(this.dialogContainer)},f.prototype.openListOfLinkPopUp=function(u,f,e,o){var c=r.TemplateEngine.applyTemplate(i.Util.Constants.listOfLinksPopupTemplate,f),s,h;this.listOfLinkDialog=new r.SimpleDialogView({},this.genericPopupHolder,"ListOfLinkPopupTemplate",i.Locale.defineLink,c,function(){u.onNextClick(u,o)},function(){});this.listOfLinkDialog.okCaption=i.Locale.nextValue;this.listOfLinkDialog.addDoNotShowCheck=!1;this.listOfLinkDialog.okValidationCallback=u.validateListofLink;this.listOfLinkDialog.showCancel=!0;this.listOfLinkDialog.cancelElementFocus=this.rootElement.find('input[id="'+u.containerId+"_lPathButtonEdit_"+u.selectedLinkIndex+'"]');this.listOfLinkDialog.show();n.Client.Loader.appContext.getAppName()!="Crm"&&t.Loader.$mars("#lPathOpenInlineDiv").hide();s=t.Loader.$mars(t.Loader.$mars.find('select[id="lPathListOfLinkTypes"]'));h=t.Loader.$mars(t.Loader.$mars.find("#lPathLinkToWebPage input[type='radio']"));h.on("change",function(){if(this.value=="window")t.Loader.$mars("#lPathOpenInNewWindow").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide();else if(this.value=="inline"){t.Loader.$mars("#lPathOpenInline").prop("checked",!0);t.Loader.$mars("#lPathDialogHeightWidth").css("display","block");t.Loader.$mars('input[id="lPathDialogHeight"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars('input[id="lPathDialogWidth"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars("#lPathCallback").show()}else t.Loader.$mars("#lPathOpenInNewTab").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide()});e?s.val(e):e=Number(s[0].options[0].value.toLowerCase());this.updateLinkType(this,e);s.on("change",function(){u.updateLinkType(u,Number(this.value))})},f.prototype.updateLinkType=function(r,u){var f,e,o;r.selectedLinkName=u;f=t.Loader.$mars('div[id="lPathLinkToWebPage"]');e=t.Loader.$mars("#lPathLinkToPageInApp");f.hide();e.hide();t.Loader.$mars("#lpath-linkTo-MDD-dialog").hide();t.Loader.$mars("#lpath-linkToWebPage-InlineAndTab").show();switch(r.selectedLinkName){case i.Utility.LinkType.PageInApp:e.show();o=t.Loader.$mars("#lPathLinkToPageInAppCrmPageInfo");o.hide();break;case i.Utility.LinkType.WebPage:if(f.show(),t.Loader.$mars("#lpathTargetSelector").show(),this.content.Links[this.selectedLinkIndex]&&this.content.Links[this.selectedLinkIndex].OpenInNew.toLowerCase()=="window")t.Loader.$mars("#lPathOpenInNewWindow").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide();else if(this.content.Links[this.selectedLinkIndex]&&this.content.Links[this.selectedLinkIndex].OpenInNew.toLowerCase()=="inline"&&t.Loader.appContext.ClientType!=i.Util.Constants.UCIClientType){t.Loader.$mars("#lPathOpenInline").prop("checked",!0);t.Loader.$mars("#lPathDialogHeightWidth").css("display","block");t.Loader.$mars('input[id="lPathDialogHeight"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars('input[id="lPathDialogWidth"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars("#lPathCallback").show()}else t.Loader.$mars("#lPathOpenInNewTab").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide();break;case i.Utility.LinkType.DialogBox:f.show();t.Loader.$mars("#lpathTargetSelector").hide();t.Loader.$mars("#lpath-linkToWebPage-InlineAndTab").hide();t.Loader.$mars("#lpath-linkTo-MDD-dialog").show();t.Loader.$mars("#lPathOpenInline").prop("checked",!0);t.Loader.$mars("#lPathDialogHeightWidth").css("display","block");t.Loader.$mars('input[id="lPathDialogHeight"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars('input[id="lPathDialogWidth"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars("#lPathCallback").show()}},f.prototype.onNextClick=function(n,r){var u=t.Loader.$mars(t.Loader.$mars.find('select[id="lPathListOfLinkTypes"]'));n.selectedLinkName=Number(u[0].value.toLowerCase());switch(n.selectedLinkName){case i.Utility.LinkType.GuidedTask:n.selectExistingControlByType(i.Utility.LinkType.GuidedTask,n.selectsidebarnavigationmode);break;case i.Utility.LinkType.Sidebar:n.selectExistingControlByType(i.Utility.LinkType.Sidebar,n.selectsidebarnavigationmode);break;case i.Utility.LinkType.PageInApp:n.updatePageInAppLinkInModel(n,r);break;case i.Utility.LinkType.WebPage:n.updateWebPageLinkInModel(n);break;case i.Utility.LinkType.DialogBox:n.updateMDDDialogLinkInModel(n)}},f.prototype.selectExistingControlByType=function(n,u){var f=this,n,e="",o="",s;switch(n){case i.Utility.LinkType.GuidedTask:f.createMiniGridHolder("_lPath-LinkOfSideBarPopUP-placeholder");n=f.ControlTypes.GuidedTask;e=i.Locale.flowViewMiniGridHeader;o=i.Locale.selectTheGuidedTask;break;case i.Utility.LinkType.Sidebar:f.createMiniGridHolder("_lPath-LinkOfSideBarPopUP-placeholder");n=f.ControlTypes.Sidebar;e=i.Locale.addExistingSidebarPopupHeader;o=i.Locale.selectTheSideBar}this.listOfLinkDialog&&this.listOfLinkDialog.hide();s=new r.MiniGrid(o,e,n,f.miniGridHolder,!1,1,5,f.parentControlId,function(n){t.Loader.$mars("#"+f.placeHolderId).remove();u(n,f);f.dialogContainer.fadeOut(300);f.reload(!1)},function(){t.Loader.$mars("#"+f.placeHolderId).remove();f.dialogContainer.fadeOut(300);f.rootElement.find('input[id="'+f.containerId+"_lPathButtonEdit_"+f.selectedLinkIndex+'"]').focus()});f.dialogContainer.append(f.miniGridHolder);f.dialogContainer.fadeIn("slow",function(){t.Loader.$mars("#lPathMiniGridSearchText").focus()})},f.prototype.updateMDDDialogLinkInModel=function(n){var r,u;n.content.Links[n.selectedLinkIndex].EnableNavigation=!1;n.content.Links[n.selectedLinkIndex].PageNavigationInfo="";r=n.content.Links[n.selectedLinkIndex];u=t.Loader.$mars('input[id="lPathLinkToUniqueName"]').val();r.Url=u;r.OpenInNew="inline";r.Title=t.Loader.$mars('input[id="lPathLinkText"]').val();r.LinkType=i.Utility.LinkType.DialogBox;r.DialogHeight=t.Loader.$mars('input[id="lPathDialogHeight"]').val();r.DialogWidth=t.Loader.$mars('input[id="lPathDialogWidth"]').val();r.CallbackFuntion=t.Loader.$mars('input[id="lPathCallbackFunction"]').val();r.ControlReference=null;n.selectedLinkIndex<n.content.Links.length?n.content.Links[n.selectedLinkIndex]=r:n.content.Links.push(r);n.reload(!1)},f.prototype.updateWebPageLinkInModel=function(r){var u,f;r.content.Links[r.selectedLinkIndex].EnableNavigation=!1;r.content.Links[r.selectedLinkIndex].PageNavigationInfo="";u=r.content.Links[r.selectedLinkIndex];f=t.Loader.$mars('input[id="lPathLinkToUrl"]');u.LinkType=i.Utility.LinkType.WebPage;u.OpenInNew=t.Loader.$mars(t.Loader.$mars.find('input[name="openInNew"]:checked')).val();var e="http://",o="https://",s=f.val().substr(0,e.length).toLowerCase(),h=f.val().substr(0,o.length).toLowerCase();u.Url=s!==e&&h!==o&&u.OpenInNew!="inline"?e+f.val():f.val();n.Client.Utility.ParameterizedURLManager.GetInstance().Validate(u.Url).isValid&&(u.Url=n.Client.Utility.ParameterizedURLManager.GetInstance().FormatUrl(u.Url));i.Util.Common.isValidUrlExtension(u.Url)?(u.Title=t.Loader.$mars('input[id="lPathLinkText"]').val()!=""?t.Loader.$mars('input[id="lPathLinkText"]').val():i.Locale.buttonIndex+" "+(this.selectedLinkIndex+1),u.OpenInNew=t.Loader.$mars(t.Loader.$mars.find('input[name="openInNew"]:checked')).val(),u.DialogHeight=t.Loader.$mars('input[id="lPathDialogHeight"]').val(),u.DialogWidth=t.Loader.$mars('input[id="lPathDialogWidth"]').val(),u.CallbackFunction=t.Loader.$mars('input[id="lPathCallbackFunction"]').val(),u.ControlReference=null,r.selectedLinkIndex<r.content.Links.length?r.content.Links[r.selectedLinkIndex]=u:r.content.Links.push(u),r.reload(!1)):i.Util.Common.showAlertMessage(i.Locale.alertTitle,i.Locale.invalidUrlLol,r.rootElement,!1)},f.prototype.updatePageInAppLinkInModel=function(n,r){var u,f;n.content.Links[n.selectedLinkIndex].EnableNavigation=!1;n.content.Links[n.selectedLinkIndex].OpenInNew="";n.content.Links[n.selectedLinkIndex].LinkType=i.Utility.LinkType.PageInApp;u=n.content.Links[n.selectedLinkIndex];r&&(u.PageNavigationInfo=JSON.stringify(r));f=t.Loader.$mars("#lPathLinkToPageInAppNavigationPath").val();f&&(u.Title=f);u.ControlReference=null;n.selectedLinkIndex<n.content.Links.length?n.content.Links[n.selectedLinkIndex]=u:u.Title.trim()!=""&&r&&n.content.Links.push(u);t.Loader.$mars("#lPathLinkToPageInAppNavigationPath").is(":visible")?f?n.reload(!1):n.reload(!0):n.reload(!0)},f.prototype.updatePageInAppLink=function(n,i){n.openListOfLinkPopUp(n,n.content.Links[n.selectedLinkIndex],n.selectedLinkName,i);n.updateLinkType(n,n.selectedLinkName);t.Loader.$mars("#lPathLinkToPageInAppCrmPageInfo").show()},f.prototype.selectsidebarnavigationmode=function(n,t){t.listOfLinkDialog&&t.listOfLinkDialog.hide();var f=r.TemplateEngine.applyTemplate(i.Util.Constants.sidebarNavigationSelectionPopup,null),u=new r.SimpleDialogView({},t.genericPopupHolder,"sidebarnavigation",i.Locale.sideBarNavigationCaption,f,function(){t.getData(n,t);t.reload()},function(){t.rootElement.find('input[id="'+t.containerId+"_lPathButtonEdit_"+t.selectedLinkIndex+'"]').focus()});u.okCaption=i.Locale.nextValue;u.addDoNotShowCheck=!1;u.showCancel=!0;u.show()},f.prototype.getData=function(n,f){for(var o,h,s,e=0;e<n.length;e++)o=(new i.Content.MetaDataJsonElementStructure).LinksModel,o.ControlReference.ControlId=n[e].controlId,o.ControlReference.ControlVersionId=n[e].controlVersionId,o.LinkType=f.selectedLinkName,o.Title=n[e].title==undefined||n[e].title.trim()==""?n[e].controlName:n[e].title,f.selectedLinkName==i.Utility.LinkType.Sidebar&&(o.EnableNavigation=t.Loader.$mars(t.Loader.$mars.find('input[name="navigationOption"]')).is(":checked")),f.content.Links.length!=0&&f.checkExistingControl(f.content.Links,n[e],f.selectedLinkName)?(h=u.prototype.isHighContrastModeActive.call(this)&&u.prototype.isBlackHighContrastMode?'<div class= "mars-float-left" > <img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon_HCB+'" /><\/div>':'<div class= "mars-float-left" > <img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon+'" /><\/div>',h+='<div class= "mars-float-left changeContenttypeDialog" tabindex="0">'+i.Locale.duplicateSelectedSidebarMessage+"<\/div>",s=new r.SimpleDialogView({},i.$mars("#mars_popup_container"),"ChangeContenttypePopup",i.Locale.selectAnotherSidebarTitle,h,function(){},function(){}),s.showCancel=!0,s.ariaDescribedById="ChangeContenttypePopup",s.show(),i.$mars('div[name="mars_builderControlContainer"]').hide(),i.$mars('div[name="commentsViewContainer"]').hide()):f.selectedLinkIndex!=undefined?f.content.Links[f.selectedLinkIndex]=o:f.content.Links.push(o),f.selectedLinkIndex++},f.prototype.reload=function(n,r){if(r===void 0&&(r=!1),r||(this.unsubscribe(),this.initializeControls()),n){var u=this;this.innerControlUpdateCallback(this.content,!0,this.sectionIndex,function(n,t){u.updatePageInAppLink(u,n);t&&(u.originalControlPageNavigationObject=JSON.parse(t))})}else this.selectedLinkName==i.Utility.LinkType.PageInApp&&this.originalControlPageNavigationObject&&this.selectedLinkIndex!=undefined&&this.content.Links[this.selectedLinkIndex].PageNavigationInfo[t.Loader.appContext.ClientType]!=this.originalControlPageNavigationObject[t.Loader.appContext.ClientType]&&i.App.appContext.getPageNavigationInfo()[t.Loader.appContext.ClientType]!=this.originalControlPageNavigationObject[t.Loader.appContext.ClientType]&&i.App.appContext.navigateToPage(this.originalControlPageNavigationObject),this.innerControlUpdateCallback(this.content,!1,this.sectionIndex)},f.prototype.createMiniGridHolder=function(n){var r=this;r.placeHolderId=r.containerId+n;r.miniGridHolder=t.Loader.$mars('<div class="lpath-lol-minigrid-placeholder" id="'+r.placeHolderId+'" style="width:100%;"/>');r.miniGridHolder.css("z-index",i.App.lPathDesignerContainerZIndex+5);r.dialogContainer.html("");r.dialogContainer.append(r.miniGridHolder)},f.prototype.checkExistingControl=function(n,r,u){for(var o,s=this,e=[],f=0;f<n.length;f++)if(n[f].ControlReference&&n[f].ControlReference.ControlId==r.controlId)return u===i.Utility.LinkType.Sidebar?e.push(i.Locale.sidebarAlreadyExists):e.push(i.Locale.gtAlreadyExists),o=s.containerId+"_lPathButtonEdit_"+s.selectedLinkIndex,i.Util.Common.showErrorMessage(e,function(){t.Loader.$mars("#"+o).focus()},function(){t.Loader.$mars("#"+o).focus()}),!0;return!1},f.prototype.validateListofLink=function(){var n=!0,u=[],r,f=this.rootElement.find("#lPathListOfLinkTypes").val(),e,o;if(f==i.Utility.LinkType.WebPage){var s=this.rootElement.find('input[id="lPathLinkToUrl"]').val(),h=this.rootElement.find('input[id="lPathOpenInNewTab"]:checked').val(),c=this.rootElement.find('input[id="lPathOpenInNewWindow"]:checked').val(),l=this.rootElement.find('input[id="lPathOpenInline"]:checked').val();s.trim()==""&&(u.push(i.Locale.enterURL),n=!1,r="lPathLinkToUrl");h||c||l||(u.push(i.Locale.requiredRadioButtons),n=!1,r="lPathOpenInNewTab")}return e=this.rootElement.find("#lPathLinkToPageInAppCrmPageInfo").is(":visible"),f==i.Utility.LinkType.PageInApp&&e&&(o=this.rootElement.find('input[id="lPathLinkToPageInAppNavigationPath"]').val(),o.trim()==""&&(u.push(i.Locale.requiredlinkedPage),n=!1,r="lPathLinkToPageInAppNavigationPath")),n||i.Util.Common.showErrorMessage(u,function(){t.Loader.$mars("#"+r).focus()},function(){t.Loader.$mars("#"+r).focus()}),n},f}(r.View);r.AddButtonsView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t,i){u.call(this,{},i);this.controlId=n;this.controlType=t;this.rootElement=i}return __extends(f,u),f.prototype.unsubscribe=function(){u.prototype.unsubscribe.call(this);this.unsubscribeContainerElements()},f.prototype.unsubscribeContainerElements=function(){this.contentContainerElement!=null&&this.contentContainerElement.children().off()},f.prototype.setBuilderControl=function(n,i,r,u,f,e,o,s,h){try{this.contentTemplateName=n;this.contentValue=JSON.parse(JSON.stringify(i));this.contentContainerElement=u;this.innerControlUpdateCallback=o;this.onSelectTemplateCallback=e;this.placementMode=r;this.sectionIndex=f;s||this.applyContentTemplate(this.contentTemplateName);this.footerTemplateFlag=h}catch(c){t.Loader.marsExceptionHandler.execute(c.name,c.message)}},f.prototype.callSelectTemplateCallBack=function(n){if(n===void 0&&(n=!0),this.onSelectTemplateCallback!=null&&n)this.onSelectTemplateCallback(this.contentTemplateName,this.contentValue,this.sectionIndex)},f.prototype.callInnerControlUpdateCallBack=function(){this.innerControlUpdateCallback!=null&&this.innerControlUpdateCallback(this.contentTemplateName,this.contentValue,this.sectionIndex)},f.prototype.applyCompiledTemplate=function(){var i,u;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyCompiledTemplate START");i=!1;try{u=r.TemplateEngine.applyTemplate(this.contentTemplateName,this.contentValue,!0);u!==""&&(this.contentContainerElement.html(""),this.contentContainerElement.html(u),i=!0)}catch(f){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception occured at BuilderControlView:applyCompiledTemplate");t.Loader.marsExceptionHandler.execute(f.name,f.message)}return n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyCompiledTemplate END"),i},f.prototype.applyContentTemplate=function(r,u){var o,f,e;u===void 0&&(u=!0);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:getContentTemplate START");try{o=this;this.builderControlMetadata=new i.Content.MetaDataJsonElementStructure;f=!1;this.contentTemplateName&&this.contentTemplateName.toLowerCase()===r.toLowerCase()||(f=!0);this.contentTemplateName=r;e=o.contentContainerElement.attr("id");r&&o.contentContainerElement.addClass("lpath-edit-section");switch(r){case i.Util.Constants.titleTextTemplate:this.applyTitleTextTemplate(f,e);break;case i.Util.Constants.titleVideoTemplate:this.applyTitleVideoTemplate(f,e);break;case i.Util.Constants.listOflinkTemplate:this.applyListOfLinksTemplate(f,e);break;case i.Util.Constants.addExistingGuidedTaskTemplate:this.applyExistingGuidedTaskTemplate(f,e);break;case i.Util.Constants.onebuttonTemplate:this.applyButtonTemplate(f,e,i.Util.Constants.oneButton);break;case i.Util.Constants.twobuttonTemplate:this.applyButtonTemplate(f,e,i.Util.Constants.twoButton);break;case i.Util.Constants.legacyHelpTemplate:this.applyLegacyHelpTemplate(f,e);break;case i.Util.Constants.footerSectionTemplate:this.applyFooterTemplate(f,e)}o.contentContainerElement.next().filter("div[name='sectionFooterBuilderControl']").hide();this.callSelectTemplateCallBack(u)}catch(s){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception occured at BuilderControlView:getContentTemplate");t.Loader.marsExceptionHandler.execute(s.name,s.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:getContentTemplate END")},f.prototype.applyTitleTextTemplate=function(r,u){var f,s,h,c,e,o;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyTitleTextTemplate START");try{if(f=this,r&&(this.contentValue=this.builderControlMetadata.TextTitleModel),s=this.applyCompiledTemplate(),h=t.Loader.$mars(this),s){c=t.Loader.$mars('div[name="lPathBuilderControlContainer"]');e=f.contentContainerElement.find('input[name="lpath_section_title"]');e.attr("id",u+"_"+e.attr("id"));e.on("change",function(){f.contentValue.Title=i.$mars(this).val();f.callInnerControlUpdateCallBack()});e.focus();o=f.contentContainerElement.find('textarea[id="lpath-txtText"]');o.attr("id",u+"_"+o.attr("id"));i.Content.lPathCkEditor.setCkEditorForSectionContent(o,c,h,function(n){f.onUpdateTextContentValue(n)},function(){})}}catch(l){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception occured at BuilderControlView:applyTitleTextTemplate");t.Loader.marsExceptionHandler.execute(l.name,l.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyTitleTextTemplate END")},f.prototype.applyTitleVideoTemplate=function(r,u){var f,v,p,y,e,o,s,h,c,l,a;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyTitleVideoTemplate START");try{if(f=this,r&&(this.contentValue=this.builderControlMetadata.VideoTitleModel),v=t.Loader.$mars(this),p=this.applyCompiledTemplate(),p){y=t.Loader.$mars('div[name="lPathBuilderControlContainer"]');e=f.contentContainerElement.find('input[name="lpath_section_title"]');e.attr("id",u+"_"+e.attr("id"));e.on("change",function(){f.contentValue.Title=i.$mars(this).val();f.callInnerControlUpdateCallBack()});o=f.contentContainerElement.find('textarea[id="lpath-VideoHeaderText"]');o.attr("id",u+"_"+o.attr("id"));i.Content.lPathCkEditor.setCkEditorForSectionContent(o,y,v,function(n){var t=i.Util.Common.addPlaceHolderForCKEditor(n.getData());f.contentValue.VideoHeaderText=t;f.callInnerControlUpdateCallBack()},function(){});s=f.contentContainerElement.find('textarea[id="lpath-VideoFooterText"]');s.attr("id",u+"_"+s.attr("id"));i.Content.lPathCkEditor.setCkEditorForSectionContent(s,y,v,function(n){var t=i.Util.Common.addPlaceHolderForCKEditor(n.getData());f.contentValue.VideoFooterText=t;f.callInnerControlUpdateCallBack()},function(){});h=f.contentContainerElement.find('input[id="mars-txtVideoUrl"]');h.attr("id",u+"_"+h.attr("id"));c=f.contentContainerElement.find("[id='mars-videoPreviewHtml5']");c.attr("id",u+"_"+c.attr("id"));c.hide();l=f.contentContainerElement.find("[id='mars-videoPreviewYouTube']");l.attr("id",u+"_"+l.attr("id"));l.hide();a=f.contentContainerElement.find("[data-name='mars-videoPreview']");a.attr("data-name",u+"_"+a.attr("data-name"));a.hide();e.focus();this.subscribe(h,"focusout",function(n,t){f.onChangeVideoSource(t,u)},!0,f.contentContainerElement)}}catch(w){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception occured at BuilderControlView:applyTitleVideoTemplate");t.Loader.marsExceptionHandler.execute(w.name,w.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyTitleVideoTemplate END")},f.prototype.applyLegacyHelpTemplate=function(u){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyLegacyHelpTemplate START");try{var f=this;u&&(this.contentValue=this.builderControlMetadata.LegacyHelpModel);new r.LegacyHelpView(f.controlId,f.sectionIndex,f.contentValue,f.contentContainerElement,function(n,t,r,u){f.contentValue=n;f.sectionIndex=r;f.contentTemplateName=i.Util.Constants.legacyHelpTemplate;f.innerControlUpdateCallback(f.contentTemplateName,f.contentValue,f.sectionIndex,t,u)})}catch(e){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception occured at BuilderControlView:applyLegacyHelpTemplate");t.Loader.marsExceptionHandler.execute(e.name,e.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyLegacyHelpTemplate END")},f.prototype.applyButtonTemplate=function(u,f,e){var o,h;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyButtonTemplate START");try{o=this;u&&(this.contentValue=this.builderControlMetadata.AddButtonsModel);h=new r.AddButtonsView(this.controlId,o.sectionIndex,this.contentValue,this.contentContainerElement,e,function(n,t,r,u){o.contentTemplateName=this.buttonType==i.Util.Constants.oneButton?i.Util.Constants.onebuttonTemplate:i.Util.Constants.twobuttonTemplate;o.sectionIndex=r;o.contentValue=n;o.innerControlUpdateCallback(o.contentTemplateName,o.contentValue,o.sectionIndex,t,u)})}catch(s){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception occured at BuilderControlView:applyButtonTemplate");t.Loader.marsExceptionHandler.execute(s.name,s.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyButtonTemplate END")},f.prototype.applyFooterTemplate=function(u,f){var e,o;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyButtonTemplate START");try{e=this;u&&(this.contentValue=this.builderControlMetadata.FooterSectionModel);o=new r.FooterSectionView(this.controlId,e.sectionIndex,this.contentValue,this.contentContainerElement,function(n,t,r,u){e.contentTemplateName=i.Util.Constants.footerSectionTemplate;e.sectionIndex=r;e.contentValue=n;e.innerControlUpdateCallback(e.contentTemplateName,e.contentValue,e.sectionIndex,t,u)});this.footerTemplateFlag=!0;o.rootElement.find("div[id="+f+"_mars_button_title_1]").focus()}catch(s){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception occured at BuilderControlView:applyButtonTemplate");t.Loader.marsExceptionHandler.execute(s.name,s.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyButtonTemplate END")},f.prototype.handleTemplateSelection=function(f,e){var o,a,h,c,l,s;(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:onTemplateSelection START"),o=this,f)&&(a=i.Util.Common.getTemplateDisplayName(f),h="",o.contentTemplateName&&f!==o.contentTemplateName?(h=i.Util.Common.getTemplateDisplayName(o.contentTemplateName),c=u.prototype.isHighContrastModeActive.call(this)&&u.prototype.isBlackHighContrastMode.call(this)?'<div class= "lpath-float-left" > <img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon_HCB+'" /><\/div>':'<div class= "lpath-float-left" > <img id="warningIcon" src= "'+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.alertWarningIcon+'" /><\/div>',l=i.$mars("#skinnyToolbarGenericDialogHolder"),l.length>0&&(c+='<div class= "lpath-float-left changeContenttypeDialog" tabindex="-1">'+i.Locale.changeContentTypeMessagePart1+a+i.Locale.changeContentTypeMessagePart2+h+"?<br/>"+i.Locale.changeContentTypeMessagePart3+"<\/div>",s=new r.SimpleDialogView({},l,"ChangeContenttypePopup",i.Locale.changeContentTypePopupTitle,c,function(){o.pushTemplateInContainer(f)}),s.showCancel=!0,s.cancelElementFocus=this.rootElement.parent().find('button[id="lPathPropertyTabEditButton"]'),s.ariaDescribedById="ChangeContenttypePopup",s.show(),o.hide())):o.pushTemplateInContainer(f,e),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:onTemplateSelection END"))},f.prototype.pushTemplateInContainer=function(t,i){i===void 0&&(i=!0);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:pushTemplateInContainer START");this.contentContainerElement!=null&&(this.unsubscribeContainerElements(),this.applyContentTemplate(t,i));i&&(this.callSelectTemplateCallBack(),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"The type ofcontent is now : "+t));n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:pushTemplateInContainer END")},f.prototype.applyListOfLinksTemplate=function(u){var f,o;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyListOfLinksTemplate START");try{f=this;u&&(this.contentValue=this.builderControlMetadata.ListOfLinksModel);o=new r.AddListOfLinksView(this.controlId,this.sectionIndex,this.contentValue,this.contentContainerElement,function(n,t,r,u){f.contentValue=n;f.sectionIndex=r;f.contentTemplateName=i.Util.Constants.listOflinkTemplate;f.innerControlUpdateCallback(f.contentTemplateName,f.contentValue,f.sectionIndex,t,u)})}catch(e){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception occured at BuilderControlView:applyListOfLinksTemplate");t.Loader.marsExceptionHandler.execute(e.name,e.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyListOfLinksTemplate END")},f.prototype.applyExistingGuidedTaskTemplate=function(u){var f,o;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyExistingGuidedTaskTemplate START");try{f=this;u&&(this.contentValue=this.builderControlMetadata.ListOfLinksModel);o=new r.AddExistingGuidedTask(this.controlId,this.sectionIndex,this.contentValue,this.contentContainerElement,function(n,t,r,u){f.contentValue=n;f.sectionIndex=r;f.contentTemplateName=i.Util.Constants.addExistingGuidedTaskTemplate;f.innerControlUpdateCallback(f.contentTemplateName,f.contentValue,f.sectionIndex,t,u)})}catch(e){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception occured at BuilderControlView:applyExistingGuidedTaskTemplate");t.Loader.marsExceptionHandler.execute(e.name,e.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:applyExistingGuidedTaskTemplate END")},f.prototype.onUpdateTextContentValue=function(n){var t=i.Util.Common.addPlaceHolderForCKEditor(n.getData());this.contentValue.Text=this.handleImageTitle(t);this.callInnerControlUpdateCallBack()},f.prototype.handleImageTitle=function(n){var u=n.match(/(<img[^>]+>)/g),t,r,f;if(u)for(t=0;t<u.length;t++)r=i.$mars(u[t]).attr("alt").trim(),r&&!i.$mars(u[t]).attr("title")&&(f='alt="'+r+'" title="'+r+'"',n=n.replace('alt="'+r+'"',f));return n},f.prototype.onChangeVideoSource=function(n){var t=this.contentContainerElement.find(n).val();t.trim()!==""&&(this.contentValue.VideoTagSupport=this.modifyVideoUrlAndReturnTypeOfVideo(t),this.contentValue.VideoSource=this.videoSource,this.callInnerControlUpdateCallBack())},f.prototype.modifyVideoUrlAndReturnTypeOfVideo=function(t){return t.indexOf("youtube.com")>0||t.indexOf("youtu.be")>0?(this.videoSource=n.Client.Loader.appContext.Util.getFormatedYouTubeVideoUrl(t),1):t.toLowerCase().indexOf("go.microsoft.com/fwlink")>0?(this.videoSource=t,2):(this.videoSource=t,0)},f}(r.View);r.BaseBuilderControlView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(){function u(n,t,i,r){this.rootElement=n;this.controls=t;this.checkinSuccessControlCallback=i;this.checkinFailedControlCallback=r;this.controlIds=t.map(function(n){return n.ControlId})}return u.prototype.checkInControls=function(u){var e=this,f;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CheckinControl:checkin control call START");try{n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User selected "+this.controlIds.length+" valid controls for checkin those were checked out. ");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"The Id Controls Selected for Checkin are : "+this.controlIds);u?e.checkinSelectedControls(e.controlIds):(f=new r.SimpleDialogView({},this.rootElement,"CheckInPopUp",i.Locale.checkinAlertTitle,i.Locale.checkinAlertMessage,function(){e.checkinSelectedControls(e.controlIds)},function(){e.checkinFailedControlCallback&&e.checkinFailedControlCallback()}),f.addDoNotShowCheck=!0,f.showCancel=!0,f.addDefaultFocusOnOkOrClose=!0,f.cancelElementFocus=this.rootElement.parent().find('button[id="lPathSkinnyToolbarCheckinButton"]'),f.ariaDescribedById="CheckInPopUp",f.show())}catch(o){t.Loader.marsExceptionHandler.execute(o.name,o.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"CheckinControl:Exception occurred while checkin control call.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CheckinControl:checkin control call END")},u.prototype.checkinSelectedControls=function(r){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CheckinControl:checkinSelectedControls START");try{var u=this,f=i.App.postControlActionHandler.callPostControlActionForFurtherProcessing(r,i.Util.Constants.checkInAction);f.done(function(){u.checkinSuccessControlCallback&&u.checkinSuccessControlCallback();for(var t=0;t<u.controls.length;t++)i.App.trackActivity(u.controls[t],window._MicrosoftMars.Client.Telemetry.EndAction.checkedin);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Controls Checked-in Successfully");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CheckinControl:checkinSelectedControls END via savedDataPromise.done()")});f.fail(function(){u.checkinSuccessControlCallback&&u.checkinFailedControlCallback()})}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"CheckinControl:Exception occurred while checkinSelectedControls.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"CheckinControl:checkinSelectedControls END")},u}();r.CheckinPopup=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(i){function r(n,t,r,u,f,e){i.call(this,n,t);this.pinBtnCallback=r;this.saveBtnCallback=u;this.deleteBtnCallback=f;this.saveAllButtonCallback=e}return __extends(r,i),r.prototype.build=function(){i.prototype.build.call(this);this.initializeControlActionComponents();this.subscribeEvents()},r.prototype.getTemplate=function(){return t.Util.Constants.controlActionToolTab},r.prototype.initializeControlActionComponents=function(){this.pinButton=this.rootElement.find("#lPathControlToolTabPinButton");this.saveButton=this.rootElement.find("#lPathControlToolTabSaveButton");this.deleteButton=this.rootElement.find("#lPathControlToolTabDeleteButton");this.saveAllButton=this.rootElement.find("#lPathAllControlToolTabSaveButton");this.controlToolTab=this.rootElement.find("#lPathControlToolTab")},r.prototype.subscribeEvents=function(){var n=this;n.subscribe(this.pinButton,"click",function(){n.pinBtnCallback()});n.subscribe(this.saveButton,"click",function(){n.saveBtnCallback()});n.subscribe(this.deleteButton,"click",function(){n.deleteBtnCallback()});n.subscribe(this.saveAllButton,"click",function(){n.saveAllButtonCallback()});n.subscribe(this.controlToolTab,"click",function(){n.setFocusOnSave()})},r.prototype.positionToolTab=function(t){var i=this.rootElement.find("#lPathControlToolTab");n.Loader.appContext.isRTL()?i.css({left:t}):i.css({right:t})},r.prototype.setFocusOnSave=function(){this.rootElement.find("#lPathControlToolTabSaveButton").focus()},r}(i.View);i.ControlActionToolTabView=r})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(){function u(n,t,i,r){this.rootElement=n;this.controlIds=t;this.DeleteSidebarSuccessControlCallback=i;this.DeleteSidebarFailedControlCallback=r}return u.prototype.deleteSidebar=function(){var f=this,u;try{n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User selected "+this.controlIds.length+" to delete this control ");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"The Id Controls Selected for delete are : "+this.controlIds);u=new r.SimpleDialogView({},this.rootElement,"DeleteSidebarAlert",i.Locale.sidebarDeleteTitle,i.Locale.sidebarDeleteMesage,function(){f.deleteSelectedControl(f.controlIds)},function(){this.rootElement.parent().find('button[id="lPathControlToolTabDeleteButton"]').focus()});u.showCancel=!0;u.okCaption=i.Locale.deleteCaption;this.rootElement.next().attr("id")==="lPathskinnyToolbarContainer"?(u.okElementFocus=this.rootElement.parent().find('button[id="lPathControlToolTabDeleteButton"]'),u.cancelElementFocus=this.rootElement.parent().find('button[id="lPathControlToolTabDeleteButton"]')):(u.okElementFocus=this.rootElement.parent().find('div[id="imgManageControlMars"]'),u.cancelElementFocus=this.rootElement.parent().find('div[id="imgManageControlMars"]'));u.ariaDescribedById="DeleteSidebarAlert";u.show()}catch(e){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"deleteSidebar:Exception occurred while delete control call.");t.Loader.marsExceptionHandler.execute(e.name,e.message)}},u.prototype.deleteSelectedControl=function(n){try{var r=this,u=i.App.postControlActionHandler.callPostControlActionForFurtherProcessing(n,i.Util.Constants.deleteControlAction);u.done(function(){r.DeleteSidebarSuccessControlCallback&&r.DeleteSidebarSuccessControlCallback()});u.fail(function(){r.DeleteSidebarFailedControlCallback&&r.DeleteSidebarFailedControlCallback()})}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"deleteSelectedControl:Exception occurred while deleteSelectedControl.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"deleteSidebar:deleteSidebar END")},u}();r.DeleteSidebarPopup=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(){function t(n){this.rootElement=n}return t.prototype.getExportLanguageTable=function(t,i){for(var r,u,f='<div class= "mars-fetched-languages-div lpath-dialog-font" id= "mars-ExportedLanguageContainer"><div class="mars-dialog-header" id="languagesTable"><label>'+n.Locale.languageCaption+"<\/label><\/div><ul>",e=0;e<t.length;e++)f+='<li class="mars-language-list">'+t[e]+"<\/li>";f+="<\/ul><\/div>";var o='<div class= "mars-fetched-controls-div lpath-dialog-font" id= "mars-ExportedFileContainer"><div class="mars-dialog-header lpath-header-inner-div" id= "exportedFileTable"><label>'+n.Locale.names+'<\/label><\/div><div class="mars-dialog-header lpath-header-inner-div"><label>'+n.Locale.exportedFiles+'<\/label><\/div><div class="mars-fetched-inner-div">',s="<ul>",h="<ul>";for(r=0;r<i.length;r++)for(u=0;u<t.length;u++)i[r].LanguageName==t[u]&&(s+='<li class= "mars-language-list"> '+i[r].ControlName+"<\/li>",h+='<li class= "mars-language-list mars-language-export-list">'+i[r].ControlName+"_"+t[u]+".xliff<\/li>");return o+=s+"<\/ul>"+h+"<\/ul><\/div><\/div>",o+f},t.prototype.getImportLanguageTable=function(t){for(var i,r='<div class= "mars-fetched-languages-div lpath-dialog-font" id= "mars-ImportedLanguageContainer"><div class= "mars-dialog-header" id= "languagesTable"><label>'+n.Locale.languageCaption+"<\/label><\/div><ul>",u=0;u<t.length;u++)r+='<li class= "mars-language-list">'+t[u].LanguageName+"<\/li>";r+="<\/ul><\/div>";var f='<div class= "mars-fetched-controls-div lpath-dialog-font" id= "mars-importedFileContainer"><div class="mars-dialog-header lpath-header-inner-div" id= "importedFileTable"><label>'+n.Locale.names+'<\/label><\/div><div class="mars-dialog-header lpath-header-inner-div"><label>'+n.Locale.exportedFiles+'<\/label><\/div><div class="mars-fetched-inner-div">',e="<ul>",o="<ul>";for(i=0;i<t.length;i++)e+='<li class= "mars-language-list"> '+t[i].ControlName+"<\/li>",o+='<li class= "mars-language-list">'+t[i].ControlName+"_"+t[i].LanguageName+".xliff<\/li>";return f+=e+"<\/ul>"+o+"<\/ul><\/div><\/div>",f+r},t}();t.ExportedImportedControlsDialogView=i})(t=n.Renderer||(n.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(){function r(n,t,i,r){this.model=n;this.rootElement=t;this.languageNames=i;this.languageIds=r;this.build()}return r.prototype.build=function(){this.rootElement.html(i.TemplateEngine.applyTemplate(this.getTemplate(),this.getObjectForTemplate()));this.populateMultiSelectList()},r.prototype.populateMultiSelectList=function(){for(var i=this.rootElement.find("div.mars-multiSelectOptions ul"),r=t.App.appContext.isRTL(),n=0;n<this.languageNames.length;n++)r?i.append('<li class="mars-language-list mars-language-list-export"><label class="mars-language-checkbox"><input type= "checkbox" data-LanguageId= "'+this.languageIds[n]+'" value= "'+this.languageNames[n]+'" name="lPathMultiSelectElementForLanguage" /><span><\/span>'+this.languageNames[n]+"&#x200E;<\/label><\/li>"):i.append('<li class="mars-language-list mars-language-list-export"><label class="mars-language-checkbox"><input type= "checkbox" data-LanguageId= "'+this.languageIds[n]+'" value= "'+this.languageNames[n]+'" name="lPathMultiSelectElementForLanguage" /><span><\/span>'+this.languageNames[n]+"<\/label><\/li>")},r.prototype.getHtml=function(){return this.rootElement.html()},r.prototype.getTemplate=function(){return t.Util.Constants.exportSelectLanguageDialogTemplate},r.prototype.getObjectForTemplate=function(){var t=this;return n.Loader.$mars.extend(this.model,{LanguageNames:t.languageNames})},r}();i.ExportSelectLanguageDialogView=r})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,t,r,f,e){u.call(this,{},f);this.parentControlId=n;this.content=r;this.rootElement=f;this.innerControlUpdateCallback=e;this.viewDataValue=this.content;this.initializeControls();this.sectionIndex=t;this.ControlTypes=i.Utility.ControlTypes}return __extends(f,u),f.prototype.getTemplate=function(){return i.Util.Constants.footerSectionTemplate},f.prototype.initializeControls=function(){try{this.viewDataValue=this.content;this.createModel();this.build();this.genericPopupHolder=this.getGenericDialogHolder(i.App.lPathDesignerContainer);this.containerId=this.rootElement.attr("id");this.attachEvents();u.prototype.isHighContrastModeActive.call(this)&&this.handleFooterSectionHc();this.createMiniGridPopup()}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message)}},f.prototype.createModel=function(){var n=(new i.Content.MetaDataJsonElementStructure).LinksModel,t=(new i.Content.MetaDataJsonElementStructure).LinksModel,r=(new i.Content.MetaDataJsonElementStructure).LinksModel,u=(new i.Content.MetaDataJsonElementStructure).LinksModel,e=(new i.Content.MetaDataJsonElementStructure).LinksModel;this.content.Links[0]==undefined&&(n.Title=i.Locale.buyMeCRM,n.LinkHolder=f.LinkHolderType[0],this.content.Links[0]=n);this.content.Links[1]==undefined&&(t.Title=i.Locale.callMe,t.LinkHolder=f.LinkHolderType[1],this.content.Links[1]=t);this.content.Links[2]==undefined&&(r.Title=i.Locale.liveChat,r.LinkHolder=f.LinkHolderType[2],this.content.Links[2]=r);this.content.Links[3]==undefined&&(u.Title=i.Locale.previous,u.LinkHolder=f.LinkHolderType[3],this.content.Links[3]=u);this.content.Links[4]==undefined&&(e.Title=i.Locale.nextValue,e.LinkHolder=f.LinkHolderType[4],this.content.Links[4]=e)},f.prototype.attachEvents=function(){for(var t,f,e,o,r=this,u=this.rootElement.find('input[name="lPathButtonEdit"],button[name="lPathButtonEdit"]'),n=0;n<u.length;n++)u[n].setAttribute("id",this.containerId+"_"+u[n].getAttribute("id")),this.subscribe(i.$mars("#"+u[n].getAttribute("id")),"click",this.onEditClick);if(t=this.rootElement.find('div[name="lPathButtonTitle"]'),t)for(n=0;n<t.length;n++)t[n].setAttribute("id",this.containerId+"_"+t[n].getAttribute("id")),this.subscribe(i.$mars("#"+t[n].getAttribute("id")),"focusout",function(n,t){r.updateButtonTitle(n,t)});f=this.rootElement.find('div[class="lpath-footer-edit-buynow-css lpath-overflow-handling"]');this.findAndSetCheckbox(f,r,0);e=this.rootElement.find('div[class="lpath-footer-edit-cellmeandlivechatdiv"]');this.findAndSetCheckbox(e,r,1);o=this.rootElement.find('div[class="lpath-footer-edit-fsection"]');this.findAndSetCheckbox(o,r,3)},f.prototype.handleFooterSectionHc=function(){var i=this.rootElement.find('input[name="lPathButtonEdit"],button[name="lPathButtonEdit"]'),r=this.rootElement.find('#btnPrevious,input[name="left"]'),f=this.rootElement.find('#btnNext,input[name="right"]'),n;if(u.prototype.isBlackHighContrastMode.call(this))for(n=0;n<i.length;n++)i[n].setAttribute("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.editTitleHCB);else{for(n=0;n<i.length;n++)i[n].setAttribute("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.editTitleHCW);for(n=0;n<r.length;n++)r[n].setAttribute("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.sidebarFooterLeftArrowEditHCW);for(n=0;n<f.length;n++)f[n].setAttribute("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.sidebarFooterRightArrowEditHCW)}},f.prototype.findAndSetCheckbox=function(n,t,r){var u=n.find('input[name="lpathfooterSectionCheckbox"]'),f,e,o;if(u!==null&&u!==undefined)for(f=0;f<u.length;f++){u[f].setAttribute("id",this.containerId+"_LinkIndex"+r);this.bindValuesToCheckbox(u[f],r);this.rootElement.find("#"+u[f].getAttribute("id")).on("click",function(n){t.disableLink(n.target);t.onChangeOfCheckboxProperty(n)});r==0&&(e=u[0].parentElement.previousSibling.textContent,o=i.Locale.buyNowButtonCheckedText.replace("{0}",e),u[f].setAttribute("aria-label",o));r=r+1}},f.prototype.onChangeOfCheckboxProperty=function(n){var r=t.Loader.$mars(n.currentTarget),u=this.rootElement.find(r);u&&(this.selectedLinkIndex=u.data("linkindex"));var f=u.parent().prev().text(),e=i.Locale.buyNowButtonUncheckedText.replace("{0}",f),o=i.Locale.buyNowButtonCheckedText.replace("{0}",f);if(u.prop("checked")==!0)switch(this.selectedLinkIndex){case 0:r.attr("aria-label",o);break;case 1:r.attr("aria-label",i.Locale.callMeButtonCheckedText);break;case 2:r.attr("aria-label",i.Locale.liveChatButtonCheckedText);break;case 3:r.attr("aria-label",i.Locale.previousSidebarButtonCheckedText);break;case 4:r.attr("aria-label",i.Locale.nextSidebarButtonCheckedText)}else switch(this.selectedLinkIndex){case 0:r.attr("aria-label",e);break;case 1:r.attr("aria-label",i.Locale.callMeButtonUncheckedText);break;case 2:r.attr("aria-label",i.Locale.liveChatButtonUncheckedText);break;case 3:r.attr("aria-label",i.Locale.previousSidebarButtonUncheckedText);break;case 4:r.attr("aria-label",i.Locale.nextSidebarButtoUncheckedText)}},f.prototype.onEditClick=function(n,t){var i=this.rootElement.find(t);i&&(this.selectedLinkIndex=i.data("linkindex"));this.onCorrespondingLinkAction(this,null,this.selectedLinkIndex)},f.prototype.onTitleChange=function(n,t){var i=this.rootElement.find(t);this.content.Title=i.val();this.reload(!1)},f.prototype.deleteSelectedLink=function(n,t){var r=this.rootElement.find(t);r&&(this.selectedLinkIndex=r.data("linkindex"),this.content.Links[this.selectedLinkIndex]=(new i.Content.MetaDataJsonElementStructure).LinksModel,this.reload(!1))},f.prototype.disableLink=function(n){var t=this.rootElement.find(n);t&&(this.selectedLinkIndex=t.data("linkindex"),this.content.Links[this.selectedLinkIndex].LinkEnabled=!this.content.Links[this.selectedLinkIndex].LinkEnabled);this.innerControlUpdateCallback(this.content,!1,this.sectionIndex)},f.prototype.bindValuesToCheckbox=function(n,t){i.$mars(n).prop("checked",this.content.Links[t].LinkEnabled)},f.prototype.updateButtonTitle=function(n,t){var r=this.rootElement.find(t);this.selectedLinkIndex=r.data("linkindex");this.content.Links[this.selectedLinkIndex].Title=r.text()&&r.text().trim()!=""?r.text():i.Locale.buttonIndex;this.innerControlUpdateCallback(this.content,!1,this.sectionIndex)},f.prototype.createMiniGridPopup=function(){this.dialogContainer=t.Loader.$mars('<div id="'+this.genericPopupHolder.attr("Id")+'_lPath-buildercontrol-dialog" class= "lpath_dialog lpath-lol-dialog-main-container"><\/div>');this.genericPopupHolder.append(this.dialogContainer)},f.prototype.onCorrespondingLinkAction=function(n,t,r){r===void 0&&(r=0);switch(r){case 0:case 1:n.selectWebPageLink(r);break;case 3:case 4:n.selectExistingControlByType(i.Utility.LinkType.Sidebar,n.selectsidebarnavigationmode)}},f.prototype.selectWebPageLink=function(u){var f=this,e=r.TemplateEngine.applyTemplate(i.Util.Constants.listOfLinksPopupTemplate,f.content.Links[u]);this.listOfLinkDialog=new r.SimpleDialogView({},this.genericPopupHolder,"ListOfLinkPopupTemplate",i.Locale.defineLink,e,function(){f.updateWebPageLinkInModel(f);f.rootElement.find("input[data-linkindex = "+u+"]").first().focus()},function(){});this.listOfLinkDialog.okCaption=i.Locale.nextValue;this.listOfLinkDialog.addDoNotShowCheck=!1;this.listOfLinkDialog.okValidationCallback=f.validateListofLink;this.listOfLinkDialog.showCancel=!0;this.listOfLinkDialog.okElementFocus=this.rootElement.find('input[id="'+f.containerId+"_mars_button_edit_"+f.selectedLinkIndex+'"]');this.listOfLinkDialog.cancelElementFocus=this.rootElement.find('input[id="'+f.containerId+"_mars_button_edit_"+f.selectedLinkIndex+'"]');this.listOfLinkDialog.show();n.Client.Loader.appContext.getAppName()!="Crm"&&t.Loader.$mars("#lPathOpenInlineDiv").hide();var o=t.Loader.$mars("#lpathLoLDropDownSelectorContainer"),s=t.Loader.$mars('div[id="lPathLinkToWebPage"]'),h=t.Loader.$mars("#lPathLinkToPageInApp"),c=t.Loader.$mars("#lpath-linkTo-MDD-dialog");o.hide();h.hide();s.show();c.hide();f.bindWebPageOptionEvents();f.bindWebDialogValuesForEditMode()},f.prototype.selectExistingControlByType=function(n,u){var f=this,n,e="",o="",s;switch(n){case i.Utility.LinkType.Sidebar:f.createMiniGridHolder("_lPath-LinkOfSideBarPopUP-placeholder");n=f.ControlTypes.Sidebar;e=i.Locale.addExistingSidebarPopupHeader;o=i.Locale.selectTheSideBar}this.listOfLinkDialog&&this.listOfLinkDialog.hide();s=new r.MiniGrid(o,e,n,f.miniGridHolder,!1,1,5,f.parentControlId,function(n){t.Loader.$mars("#"+f.placeHolderId).remove();u(n,f);f.dialogContainer.fadeOut(300);f.reload(!1)},function(){t.Loader.$mars("#"+f.placeHolderId).remove();f.dialogContainer.fadeOut(300);f.rootElement.find('button[id="'+f.containerId+"_mars_button_edit_"+f.selectedLinkIndex+'"]').focus()});f.dialogContainer.append(f.miniGridHolder);f.dialogContainer.fadeIn("slow",function(){t.Loader.$mars("#lPathMiniGridSearchText").focus()})},f.prototype.updateWebPageLinkInModel=function(r){var u,f;r.content.Links[r.selectedLinkIndex].EnableNavigation=!1;r.content.Links[r.selectedLinkIndex].PageNavigationInfo="";u=r.content.Links[r.selectedLinkIndex];f=t.Loader.$mars('input[id="lPathLinkToUrl"]');u.LinkType=i.Utility.LinkType.WebPage;u.OpenInNew=t.Loader.$mars(t.Loader.$mars.find('input[name="openInNew"]:checked')).val();var e="http://",o="https://",s=f.val().substr(0,e.length).toLowerCase(),h=f.val().substr(0,o.length).toLowerCase();u.Url=s!==e&&h!==o&&u.OpenInNew!="inline"?e+f.val():f.val();n.Client.Utility.ParameterizedURLManager.GetInstance().Validate(u.Url).isValid&&(u.Url=n.Client.Utility.ParameterizedURLManager.GetInstance().FormatUrl(u.Url));u.Url.substr(u.Url.lastIndexOf(".")+1).toLowerCase()!="js"?(u.Title=t.Loader.$mars('input[id="lPathLinkText"]').val()!=""?t.Loader.$mars('input[id="lPathLinkText"]').val():i.Locale.buttonIndex,u.OpenInNew=t.Loader.$mars(t.Loader.$mars.find('input[name="openInNew"]:checked')).val(),u.DialogHeight=t.Loader.$mars('input[id="lPathDialogHeight"]').val(),u.DialogWidth=t.Loader.$mars('input[id="lPathDialogWidth"]').val(),u.CallbackFunction=t.Loader.$mars('input[id="lPathCallbackFunction"]').val(),u.ControlReference=null,r.selectedLinkIndex<r.content.Links.length?r.content.Links[r.selectedLinkIndex]=u:r.content.Links.push(u),r.reload(!1)):i.Util.Common.showAlertMessage(i.Locale.alertTitle,i.Locale.invalidUrlLol,r.rootElement,!1)},f.prototype.selectsidebarnavigationmode=function(n,t){t.listOfLinkDialog&&t.listOfLinkDialog.hide();var f=r.TemplateEngine.applyTemplate(i.Util.Constants.sidebarNavigationSelectionPopup,null),u=new r.SimpleDialogView({},t.genericPopupHolder,"sidebarnavigation",i.Locale.sideBarNavigationCaption,f,function(){t.getData(n,t);t.reload();var i=t.selectedLinkIndex-1;t.rootElement.find('button[id="'+t.containerId+"_mars_button_edit_"+i+'"]').focus()},function(){t.rootElement.find('button[id="'+t.containerId+"_mars_button_edit_"+t.selectedLinkIndex+'"]').focus()});u.okCaption=i.Locale.nextValue;u.addDoNotShowCheck=!1;u.showCancel=!0;u.show()},f.prototype.bindWebPageOptionEvents=function(){var i=t.Loader.$mars(t.Loader.$mars.find("#lPathLinkToWebPage input[type='radio']"));i.on("change",function(){if(this.value=="window")t.Loader.$mars("#lPathOpenInNewWindow").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide();else if(this.value=="inline"){t.Loader.$mars("#lPathOpenInline").prop("checked",!0);t.Loader.$mars("#lPathDialogHeightWidth").css("display","block");t.Loader.$mars('input[id="lPathDialogHeight"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars('input[id="lPathDialogWidth"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars("#lPathCallback").show()}else t.Loader.$mars("#lPathOpenInNewTab").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide()})},f.prototype.bindWebDialogValuesForEditMode=function(){if(this.content.Links[this.selectedLinkIndex]&&this.content.Links[this.selectedLinkIndex].OpenInNew.toLowerCase()=="window")t.Loader.$mars("#lPathOpenInNewWindow").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide();else if(this.content.Links[this.selectedLinkIndex]&&this.content.Links[this.selectedLinkIndex].OpenInNew.toLowerCase()=="inline"){t.Loader.$mars("#lPathOpenInline").prop("checked",!0);t.Loader.$mars("#lPathDialogHeightWidth").css("display","block");t.Loader.$mars('input[id="lPathDialogHeight"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars('input[id="lPathDialogWidth"]').on("keydown",function(t){return n.Client.Utility.Util.validateNumbers(t)});t.Loader.$mars("#lPathCallback").show()}else t.Loader.$mars("#lPathOpenInNewTab").prop("checked",!0),t.Loader.$mars("#lPathDialogHeightWidth").hide(),t.Loader.$mars("#lPathCallback").hide()},f.prototype.getData=function(n,u){for(var e,s,o,f=0;f<n.length;f++)e=(new i.Content.MetaDataJsonElementStructure).LinksModel,e.ControlReference.ControlId=n[f].controlId,e.ControlReference.ControlVersionId=n[f].controlVersionId,e.LinkType=i.Utility.LinkType.Sidebar,e.LinkHolder=u.content.Links[u.selectedLinkIndex].LinkHolder,e.Title=n[f].title==undefined||n[f].title.trim()==""?n[f].controlName:n[f].title,e.EnableNavigation=t.Loader.$mars(t.Loader.$mars.find('input[name="navigationOption"]')).is(":checked"),(u.content.Links.length==0||!u.checkExistingControl(u.content.Links,n[f]),e.LinkType)?u.selectedLinkIndex!=undefined?u.content.Links[u.selectedLinkIndex]=e:u.content.Links.push(e):(s='<div class= "mars-float-left" > <img id="warningIcon" src= "'+t.Loader.serverUrl+'images/dialog_alert-icon_20x20.png" /><\/div>',s+='<div class= "mars-float-left changeContenttypeDialog" tabindex="0">'+i.Locale.duplicateSelectedSidebarMessage+"<\/div>",o=new r.SimpleDialogView({},i.$mars("#mars_popup_container"),"ChangeContenttypePopup",i.Locale.selectAnotherSidebarTitle,s,function(){},function(){}),o.showCancel=!0,o.ariaDescribedById="ChangeContenttypePopup",o.show(),i.$mars('div[name="mars_builderControlContainer"]').hide(),i.$mars('div[name="commentsViewContainer"]').hide()),u.selectedLinkIndex++},f.prototype.reload=function(n,r){if(r===void 0&&(r=!1),r||(this.unsubscribe(),this.initializeControls()),n){var u=this;this.innerControlUpdateCallback(this.content,!0,this.sectionIndex,function(n,t){t&&(u.originalControlPageNavigationObject=JSON.parse(t))})}else this.selectedLinkName==i.Utility.LinkType.PageInApp&&this.originalControlPageNavigationObject&&this.selectedLinkIndex!=undefined&&this.content.Links[this.selectedLinkIndex].PageNavigationInfo[t.Loader.appContext.ClientType]!=this.originalControlPageNavigationObject[t.Loader.appContext.ClientType]&&i.App.appContext.getPageNavigationInfo()[t.Loader.appContext.ClientType]!=this.originalControlPageNavigationObject[t.Loader.appContext.ClientType]&&i.App.appContext.navigateToPage(this.originalControlPageNavigationObject),this.innerControlUpdateCallback(this.content,!1,this.sectionIndex)},f.prototype.createMiniGridHolder=function(n){var r=this;r.placeHolderId=r.containerId+n;r.miniGridHolder=t.Loader.$mars('<div class="lpath-lol-minigrid-placeholder" id="'+r.placeHolderId+'" style="width:100%;"/>');r.miniGridHolder.css("z-index",i.App.lPathDesignerContainerZIndex+5);r.dialogContainer.html("");r.dialogContainer.append(r.miniGridHolder)},f.prototype.checkExistingControl=function(n,r,u){for(var o,s=this,e=[],f=0;f<n.length;f++)if(n[f].ControlReference&&n[f].ControlReference.ControlId==r.controlId)return u===i.Utility.LinkType.Sidebar?e.push(i.Locale.sidebarAlreadyExists):e.push(i.Locale.gtAlreadyExists),o=s.containerId+"_mars_button_edit_"+s.selectedLinkIndex,i.Util.Common.showErrorMessage(e,function(){t.Loader.$mars("#"+o).focus()},function(){t.Loader.$mars("#"+o).focus()}),!0;return!1},f.prototype.validateListofLink=function(){var n=!0,u=[],r,f=this.rootElement.find("#lPathListOfLinkTypes").val(),e,o;if(f==i.Utility.LinkType.WebPage){var s=this.rootElement.find('input[id="lPathLinkToUrl"]').val(),h=this.rootElement.find('input[id="lPathOpenInNewTab"]:checked').val(),c=this.rootElement.find('input[id="lPathOpenInNewWindow"]:checked').val(),l=this.rootElement.find('input[id="lPathOpenInline"]:checked').val();s.trim()==""&&(u.push(i.Locale.enterURL),n=!1,r="lPathLinkToUrl");h||c||l||(u.push(i.Locale.requiredRadioButtons),n=!1,r="lPathOpenInNewTab")}return e=this.rootElement.find("#lPathLinkToPageInAppCrmPageInfo").is(":visible"),f==i.Utility.LinkType.PageInApp&&e&&(o=this.rootElement.find('input[id="lPathLinkToPageInAppNavigationPath"]').val(),o.trim()==""&&(u.push(i.Locale.requiredlinkedPage),n=!1,r="lPathLinkToPageInAppNavigationPath")),n||i.Util.Common.showErrorMessage(u,function(){t.Loader.$mars("#"+r).focus()},function(){t.Loader.$mars("#"+r).focus()}),n},f.LinkHolderType=["btnLink","callMeImg","liveChatImg","prevImg","nxtImg"],f}(r.View);r.FooterSectionView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";Handlebars.registerHelper("_parameter",function(n){if(n){var t=Handlebars.compile(n);return t(this.AppContext)}return null});Handlebars.registerHelper("isEqual",function(n,t,i){return n===t?i.fn(this):i.inverse(this)});Handlebars.registerHelper("or",function(n,t){var i=t.hash.firstOperand,r=t.hash.secondOperand;return n===i||n===r?t.fn(this):t.inverse(this)});Handlebars.registerHelper("isDraftControl",function(n,t){return i.App.isDraftControl===n?t.fn(this):t.inverse(this)});Handlebars.registerHelper("select",function(n,i){var r=t.Loader.$mars("<select />").html(i.fn(this));return n&&r.find("[value="+n+"]").attr({selected:"selected"}),r.html()});Handlebars.registerHelper("checked",function(n){return n=="1"?' checked="checked"':""});Handlebars.registerHelper("getImage",function(n){return t.Loader.marsImageMapping.ImagePath[n]});Handlebars.registerHelper("getServerUrl",function(){return t.Loader.serverUrl});Handlebars.registerHelper("getLocale",function(n){return t.Loader.marsLocale[n]});Handlebars.registerHelper("isUCIClient",function(n){return document.getElementById("ClientApiFrame_MARS")?n.fn(this):n.inverse(this)});Handlebars.registerHelper("iflt",function(n,t,i){if(n<t)return""+i.fn(this)});Handlebars.registerHelper("ifgt",function(n,t,i){if(n>t)return""+i.fn(this)});Handlebars.registerHelper("strip-scripts",function(n){var t=n;return new Handlebars.SafeString(t)});Handlebars.registerHelper("searchcontainer",function(n,t){return r.TemplateEngine.applyTemplate(i.Util.Constants.searchtemplate,n,!0,t)});Handlebars.registerHelper("json",function(n){return JSON.stringify(n)});Handlebars.registerHelper("resolve-title",function(t){return n.Client.Utility.Util.resolveTitle(t)});Handlebars.registerHelper("validateLCID",function(t){return n.Client.Utility.Util.validateWhiteListLCID()?t.fn(this):t.inverse(this)});Handlebars.registerHelper("ExecuteSection",function(n,t){if(n.MetadataJson.Template!=="")return r.TemplateEngine.applyTemplate(n.MetadataJson.Template+"preview",n,!0,t)});Handlebars.registerHelper("ExecuteEditSection",function(n){return r.TemplateEngine.applyTemplate(i.Util.Constants.editSectionTemplate,n,!1)});Handlebars.registerHelper("if_even",function(n,t){return n%2==0?t.fn(this):t.inverse(this)});Handlebars.registerHelper("if_odd",function(n,t){return n%2!=0?t.fn(this):t.inverse(this)});Handlebars.registerHelper("math",function(n,t,i){return n=parseFloat(n),i=parseFloat(i),{"+":n+i,"-":n-i,"*":n*i,"/":n/i,"%":n%i}[t]});Handlebars.registerHelper("stepheader",function(n){return r.TemplateEngine.applyTemplate(i.Util.Constants.stepheader,n,!0)});Handlebars.registerHelper("ExecuteTemplate",function(n){return r.TemplateEngine.applyTemplate(n.MetadataJson.Template,n,!0)});Handlebars.registerHelper("ExecuteFooterSection",function(n,t){if(n.MetadataJson.Template==i.Util.Constants.footerSectionTemplate)return r.TemplateEngine.applyTemplate(n.MetadataJson.Template+"preview",n,!0,t)});Handlebars.registerHelper("IsValidSection",function(n,t){return n==i.Util.Constants.footerSectionTemplate||!n?t.inverse(this):t.fn(this)});Handlebars.registerHelper("enabledSidebarTemplate",function(){for(var r=i.App.enabledTemplates,u="",t=0;t<r.length;t++)r[t].ControlType==i.Utility.ControlTypes.Sidebar&&r[t].ControlName.indexOf("preview")<0&&r[t].ControlName.indexOf("search")<0&&(u=u+'<option value="'+r[t].ControlName+'">'+n.Client.Loader.marsLocale[r[t].ControlName]+"<\/option>");return u});Handlebars.registerHelper("publishGroups",function(){var r=n.Client.Loader.appContext.Util.getConfigurationData("PublishGroupSetting"),f="",e,u,o,t;if(r)for(e="",u="",t=0;t<r.length;t++)e=r[t].Id,u=r[t].Name,o=r[t].PublishGroupType,i.Utility.PublishGroupType[o]==i.Utility.PublishGroupType[i.Utility.PublishGroupType.Draft]&&(u=n.Client.Loader.marsLocale.draft),f=f+'<option data-publishgrouptype="'+o+'" title="'+u+'" value="'+e+'">'+u+"<\/option>";return f});Handlebars.registerHelper("isFeatureEnabled",function(t,i){return n.Client.Utility.FFFUtility.isFeatureEnabled(t)?i.fn(this):i.inverse(this)});Handlebars.registerHelper("isAnyChildFeatureEnabled",function(t,i){for(var u=JSON.parse(t),r=0;r<u.length;r++)if(n.Client.Utility.FFFUtility.isFeatureEnabled(u[r]))return i.fn(this);return i.inverse(this)});Handlebars.registerHelper("renderFooter",function(n,t){var u=[],o=new Handlebars.SafeString(""),e=r.TemplateEngine.applyTemplate(i.Util.Constants.sectionfooterTemplate,n,!0);for(var f in t.hash)u.push(f+'="'+t.hash[f]+'"');return new Handlebars.SafeString("<div "+u.join(" ")+">"+e+"<\/div>")});Handlebars.registerHelper("renderWildcardOptions",function(n){var t=[];return t=i.Util.Common.wildCardOptions(n),r.TemplateEngine.applyTemplate(i.Util.Constants.sidebarAdvancedOptionsViewWildcardTableTemplate,t,!1)});Handlebars.registerHelper("appModuleList",function(){var n=[];return n=i.Util.Common.getAppModuleList(),r.TemplateEngine.applyTemplate(i.Util.Constants.sidebarAdvancedOptionsViewAppModuleListTable,n,!1)});Handlebars.registerHelper("getLocaleByLcid",function(n){var i="locale_"+n;return t.Loader.marsLocale[i]});Handlebars.registerHelper("checkHighContrast",function(n){return i.$mars("#checkHighContrastDiv").css("background-image")==="none"?n.fn(this):n.inverse(this)});Handlebars.registerHelper("foreach",function(n,t){return t.inverse&&!n.length?t.inverse(this):n.map(function(i,r){return i.$index=r,i.$first=r===0,i.$last=r===n.length-1,t.fn(i)}).join("")})})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n){n===void 0&&(n=!1);u.call(this,null,null,null,!1);this.importJson=n;this.build()}return __extends(f,u),f.prototype.build=function(){this.rootElement=t.Loader.$mars('<div class="mars-placeholder"  id="lpath-multiSelectListContainerDiv" style="width:100%;"/>');this.rootElement.html(r.TemplateEngine.applyTemplate(this.getTemplate(),{}));this.handleHighContrastMode()},f.prototype.getHtml=function(){return this.rootElement.html()},f.prototype.getTemplate=function(){return i.Util.Constants.importLanguageDialogTemplate},f.prototype.unsubscribeEvents=function(){i.$mars("#lpathBrowseButton").off("keyup")},f.prototype.unsubscribe=function(){u.prototype.unsubscribe.call(this);this.unsubscribeEvents()},f.prototype.handleKeyDown=function(){var r=this;i.$mars("#lpathBrowseButton").keyup(function(t){n.Client.Loader.appContext.Util.isEnterPressed(t,!0)&&r.files.click()});i.$mars("#lpath-simple-btnOk_ImportLanguagePopUp").keydown(function(n){n.keyCode==t.Utility.KeyCodeEnum.TabKey&&n.shiftKey&&i.$mars("#lpathBrowseButton").focus()})},f.prototype.createTemplateDialog=function(){var o=this,u=this,f=i.$mars.Deferred(),n=new r.SimpleDialogView({},i.$mars("#lPath-simpleDialogHolder"),"ImportLanguagePopUp",i.Locale.importDialogTitleMessage,u.getHtml(),function(){var n=u.importJson?u.importControlJson():u.importLanguageForControls();n.done(function(){f.resolve()});n.fail(function(){f.reject()})}),e;return n.showCancel=!0,n.okCaption=i.Locale.import,n.okAriaDescribedByValue=i.Locale.importSelectedControls,n.cancelAriaDescribedByValue=i.Locale.cancelImport,this.focusElementOnPopupClose&&(n.okElementFocus=this.focusElementOnPopupClose,n.cancelElementFocus=this.focusElementOnPopupClose),n.showElementFocus='button[class="lpath-browse-button"]',e=n.show(),e.done(function(){o.unsubscribe()}),e.fail(function(){o.unsubscribe()}),this.handleKeyDown(),this.files=t.Loader.$mars("#lpath-importLaguagesForControls"),this.dragAndDropHandler(),this.browsedFileHandler(),f},f.prototype.handleDragOver=function(n){n.stopPropagation();n.preventDefault();n.dataTransfer.dropEffect="copy"},f.prototype.handleFileSelectAndReturn=function(n){var r,u;if(n.stopPropagation(),n.preventDefault(),this.draggedFiles=n.dataTransfer.files,this.draggedFiles.length>1)this.importDialogHolder=t.Loader.$mars("#lPath-importDialogHolder"),i.Util.Common.showAlertMessage(i.Locale.selectSingleFileTitle,i.Locale.selectSingleFile,this.importDialogHolder,!1,i.Locale.okCaption);else{for(this.fileContainer=document.getElementById("lpath-importFileContainer"),r=0;r<this.draggedFiles.length;r++)this.draggedFiles[0].name.match(/\.(xlf)$/i)||this.draggedFiles[0].name.match(/\.(zip)$/i)||(this.draggedFiles="");t.Loader.$mars("lpath-drag-message").css("display","none");this.fileContainer.innerHTML="";this.fileContainer.appendChild(this.createTextDiv(this.draggedFiles[0].name));this.browsedFiles!==undefined&&(this.browsedFiles=undefined,u=document.getElementById("lpath-browseFilePath"),t.Loader.$mars("#lpath-importLaguagesForControls").val(""),u.setAttribute("placeholder",i.Locale.browseFileCaption),u.removeAttribute("title"))}},f.prototype.fileSelectHandler=function(n){var r,u,f,e,o;if(n.stopPropagation(),this.browsedFiles=this.files.get(0).files,r="",u=document.getElementById("lpath-browseFilePath"),this.browsedFiles){for(f=0;f<this.browsedFiles.length;f++)r+=this.browsedFiles[0].name+",";u.setAttribute("placeholder",r);u.setAttribute("title",r);e=document.getElementById("browseButtonAriaDescribedby");e.innerHTML=i.Locale.browseControl+" "+r}this.draggedFiles!==undefined&&(this.draggedFiles=undefined,o=document.getElementById("lpath-importFileContainer"),o.innerHTML="",t.Loader.$mars("lpath-drag-message").css("display","inline"))},f.prototype.createTextDiv=function(n){var t=document.createElement("div");return t.appendChild(document.createTextNode(n)),t},f.prototype.dragAndDropHandler=function(){var n=this;this.fileContainer=document.getElementById("lpath-importFileContainer");this.fileContainer.addEventListener("dragover",function(t){n.handleDragOver(t)},!1);this.fileContainer.addEventListener("drop",function(t){n.handleFileSelectAndReturn(t)},!1)},f.prototype.browsedFileHandler=function(){var n=this;this.files.on("change",function(t){n.fileSelectHandler(t)})},f.prototype.importLanguageForControls=function(){var n=this,o=i.$mars.Deferred(),s=new FileReader,u=this.draggedFiles,f=this.files.get(0).files,h="",e;if(s.onload=function(){var u=this.result,r;n.importDialogHolder=t.Loader.$mars("#lPath-importDialogHolder");r=i.App.serviceHandler.importLanguageControl(u,h);r.done(function(t){var r;if(t.Result.length>0){var u=0,f=0,e=0;t.Result.forEach(function(n){switch(n.XliffState){case"added":u++;break;case"updated":f++;break;case"error":e++;break;default:e++}});r=i.Locale.ImportSuccessful.replace("[[1]]",t.Result.length.toString());r=r.replace("[[2]]",u);r=r.replace("[[3]]",f);i.Util.Common.showAlertMessage(i.Locale.importSuccessTitle,r,n.importDialogHolder,!1,i.Locale.okCaption);o.resolve()}});r.fail(function(){i.Util.Common.showAlertMessage(i.Locale.importFailureTitle,i.Locale.Xliffimportfailuremessage,n.importDialogHolder,!1,i.Locale.okCaption,null,function(){n.focusElementOnPopupClose.focus()},function(){n.focusElementOnPopupClose.focus()},!1);o.reject()})},u==undefined&&f.length==0)e=new r.SimpleDialogView({},i.$mars("#lPath-simpleDialogHolder"),i.Util.Constants.NoControlSelctedPopup,i.Locale.noFileSelectedCaption,i.Locale.noFileSelectedMessage,function(){n.createTemplateDialog()}),e.okElementFocus=t.Loader.$mars('button[id="lpath-simple-btnOk_ImportLanguagePopUp"]'),e.cancelElementFocus=t.Loader.$mars('button[id="lpath-simple-btnOk_ImportLanguagePopUp"]'),e.ariaDescribedById=i.Util.Constants.NoControlSelctedPopup,e.show();else return f&&f.length>0&&(h=f[0].name,s.readAsDataURL(f[0])),u&&u.length>0&&(h=u[0].name,s.readAsDataURL(u[0])),o},f.prototype.importControlJson=function(){var n=this,o=i.$mars.Deferred(),s=new FileReader,u=this.draggedFiles,f=this.files.get(0).files,h="",e;if(s.onload=function(){var r=this.result,t=i.App.serviceHandler.importControl(r,h);t.done(function(){i.Util.Common.showAlertMessage(i.Locale.importSuccessTitle,i.Locale.controlImportSuccessfulCaption,n.importDialogHolder,!1,i.Locale.okCaption);o.resolve()});t.fail(function(){i.Util.Common.showAlertMessage(i.Locale.xmlImportFailure,i.Locale.importfailuremessage,n.importDialogHolder,!1,i.Locale.okCaption,null,function(){n.focusElementOnPopupClose.focus()},function(){n.focusElementOnPopupClose.focus()},!1);o.reject()})},u==undefined&&f.length==0)e=new r.SimpleDialogView({},i.$mars("#lPath-simpleDialogHolder"),i.Util.Constants.NoControlSelctedPopup,i.Locale.noFileSelectedCaption,i.Locale.noFileSelectedMessage,function(){n.createTemplateDialog()}),e.okElementFocus=t.Loader.$mars('button[id="lpath-simple-btnOk_ImportLanguagePopUp"]'),e.cancelElementFocus=t.Loader.$mars('button[id="lpath-simple-btnOk_ImportLanguagePopUp"]'),e.ariaDescribedById=i.Util.Constants.NoControlSelctedPopup,e.show();else return f&&f.length>0&&(h=f[0].name,s.readAsDataURL(f[0])),u&&u.length>0&&(h=u[0].name,s.readAsDataURL(u[0])),this.importDialogHolder=t.Loader.$mars("#lPath-importDialogHolder"),o},f.prototype.handleHighContrastMode=function(){var t,r,u;i.$mars("#marsIFrame").css("background-image")==="none"&&(t=!1,i.$mars("body").css("background-color")==="rgb(255, 255, 255)"&&(t=!0),r=this.rootElement.find("#lpathBrowseButton").find("img"),r&&(u=t?n.Client.Loader.marsImageMapping.ImagePath.searchSidebarIcon:n.Client.Loader.marsImageMapping.ImagePath.librarySearchHighContrast,r.attr("src",n.Client.Loader.serverUrl+"images/"+u)))},f}(r.View);r.ImportLanguageDialogView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(){function u(){this.itemArray=[];this.columnArray=[];this.formFactorImgs="";this.filterCriteria=[];this.defaultFilter={Operator:1,Name:"ControlType",Details:[{Condition:6,Value:"2"},{Condition:6,Value:"1"}]};this.filterTextValue={ColumnName:"",TextValue:"",Index:""};this.searchGridId=i.App.lPathDesignerContainer.find("#searchGrid");this.sortedColumn={ColumnName:"",AttachCss:""};this.hideShowCoulumnArray=["LastPublishedTime","Enabled","Languages","AuthorName","AppVersion","Tags"];this.initiateAndcreateGrid();this.bindWindowResizeEvent();this.attachEventsToGrid();this.lPathlandingPageContainer=i.App.lPathDesignerContainer.find("#lPathlandingPageContainer")}return u.getGridRowDataFromService=function(t,r,f,e,o,s,h,c,l){var a=new n.Client.Loader.SearchCriteria(t,r,f,e,o,s,h,c,l),v;return a.GroupBy==""&&delete a.GroupBy,v=u.getOdataUrl(a),i.App.serviceHandler.searchSync(v)},u.getOdataUrl=function(n){var i="?",r=!0;return t.Loader.$mars.each(n,function(n,t){if(t!=null)if(r)i+="$"+n+"="+t,r=!1;else switch(n){case"top":case"orderby":i+="&$"+n+"="+t;break;case"SortOrder":i+=" "+t;break;case"search":t=encodeURIComponent(t);i+=" and (contains(ControlName,'"+t+"') or contains(Title,'"+t+"') or contains(AuthorName,'"+t+"') or contains(Tags,'"+t+"'))";break;case"AuthoringId":i+="&$filter="+n+" eq "+t;break;case"PublishGroupId":jQuery.isEmptyObject(t)||(i+=" and PublishGroupId eq "+t);break;case"Lcid":i+=" and Lcid eq "+t;break;case"Filters":i+=u.gridFilterOdataUrl(t)}}),i},u.gridFilterOdataUrl=function(n){for(var r,u,i="",t=0;t<n.length;t++)if(n[t].Details.length<=1){r=encodeURIComponent(n[t].Details[0].Value);i+=" and ";switch(n[t].Details[0].Condition.toString()){case"0":i+="startswith(cast("+n[t].Name+",'Edm.String'),'"+r+"')";break;case"1":i+="endswith(cast("+n[t].Name+",'Edm.String'),'"+r+"')";break;case"4":i+="contains(cast("+n[t].Name+",'Edm.String'),'"+r+"')";break;case"5":i+="not contains(cast("+n[t].Name+",'Edm.String'),'"+r+"')";break;case"6":i+="cast("+n[t].Name+",'Edm.String') eq '"+r+"'";break;case"7":i+="cast("+n[t].Name+",'Edm.String') ne '"+r+"'"}}else for(u=0;u<n[t].Details.length;u++)i+=u==0?" and (":" or ",i+="cast("+n[t].Name+",'Edm.String') eq '"+encodeURIComponent(n[t].Details[u].Value)+"'",u==n[t].Details.length-1&&(i+=")");return i},u.prototype.changeTitle=function(n){var t=n.landingPageGrid.find(".jqgrow").find('span[data-name="landingpage_control_name_cell"]');t.each(function(n,t){var r=t.innerText,u=i.App.lPathDesignerContainer.find(t).closest("td");u.attr("title",r)})},u.prototype.setAttributeToNameAndLanguage=function(t){var r=t.landingPageGrid.find(".jqgrow").find('span[data-name="landingpage_control_name_cell"]');r.each(function(t,r){var u=r.innerText,o=i.App.lPathDesignerContainer.find(r).closest("td").parent().find(".cbox"),f,e;o.attr("aria-label",i.Locale.selectControl+" "+u);i.App.lPathDesignerContainer.find(r).closest("td").find(".lpath_name_col").attr("aria-label",u);i.App.lPathDesignerContainer.find(r).closest("td").find(".lpath_name_col").addClass("lpath-content-library-link-column").addClass("lpath-content-library-link-focusable");f=i.App.lPathDesignerContainer.find(r).closest("td").parent().find(".lpath_language_col").text();e=n.Client.Loader.marsLocale.LanguageCount.replace("{0}",u).replace("{1}",f);i.App.lPathDesignerContainer.find(r).closest("td").parent().find(".lpath_language_col").attr("aria-label",e);i.App.lPathDesignerContainer.find(r).closest("td").parent().find(".lpath_language_col").addClass("lpath-content-library-link-column").addClass("lpath-content-library-link-focusable")})},u.prototype.initiateAndcreateGrid=function(){var n,r;try{n=this;n.initializeGrid();i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterCriteria")||this.prepareDefaultFilter();i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_sortedColumn",i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedColumn")?i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedColumn"):JSON.stringify(this.sortedColumn));n.createGrid();r=this.getGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize")),t.Loader.appContext.getAuthoringId(),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortColumnName"),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedOrder"),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_searchString"),undefined,i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"));r.done(function(){n.resetGrid();n.addEllipsisToColumnHeader();n.addFilters(n);n.changeTitle(n);n.setAttributeToNameAndLanguage(n);u.gridFilterDiv=t.Loader.$mars("#gridFilterDiv");n.filterCondition=t.Loader.$mars("#filterCondition");u.gridFilterDiv.hide();n.attachNamePropertyToSpanImage();window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg-filter");n.addTabEventsToPagination();n.modifyTabbingSettingsOfPagination();n.supportJawsForJQGrid();n.addKeyEventsToGrid(n);n.addKeyEventToToolbar(n);n.highlightFilteredColumns();t.Loader.$mars("#landingPageGuidedTask").length>0?t.Loader.$mars("#landingPageGuidedTask").focus():t.Loader.$mars("#landingPageSidebar").length>0?t.Loader.$mars("#landingPageSidebar").focus():t.Loader.$mars("#searchGrid").focus();i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName")&&i.App.lPathDesignerContainer.find("select#filterGroupChange").val(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"));i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize")&&(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize")===i.Util.Constants.MaximumPageSize?i.App.lPathDesignerContainer.find("select.ui-pg-selbox").val("10000000"):i.App.lPathDesignerContainer.find("select.ui-pg-selbox").val(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize")));t.Loader.$mars(n.searchGridId).val(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_searchString"));window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg");n.checkForHighContrastMode();n.handleHeaderCheckboxClick()}.bind(n))}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message)}},u.prototype.assignTitleToTotalRowsDropDown=function(){var n=i.App.lPathDesignerContainer.find("select.ui-pg-selbox"),t=i.Locale.landingShow.replace("{0}",n.find("option[value='"+n.val()+"']").text());n.attr("aria-label",t)},u.prototype.assignAriaLabelToCurrentPageNumber=function(){var n=i.App.lPathDesignerContainer.find("input.ui-pg-input"),t=i.Locale.currentPageNumber.replace("{0}",n.val()).replace("{1}",i.App.lPathDesignerContainer.find("#sp_1_marsLandingPageGridPager").text());n.attr("aria-label",t)},u.prototype.checkForHighContrastMode=function(){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"LAndingPage:checkForHighContrastMode START");r.LandingPageView.isHighContrastModeEnabled()?(i.App.lPathDesignerContainer.hasClass("lpath-highcontrast")||i.App.lPathDesignerContainer.addClass("lpath-highcontrast"),i.$mars("lpath-landingpage-container").addClass("lpath_highcontrast"),i.$mars("#lPathDesignerOverlay").hasClass("lpath-highcontrast")||i.$mars("#lPathDesignerOverlay").addClass("lpath-highcontrast"),i.$mars("#lPathDesignerOverlay").hasClass("lpath-overlay-initial-highcontrast")||i.$mars("#lPathDesignerOverlay").addClass("lpath-overlay-initial-highcontrast"),i.$mars('td[id="next_marsLandingPageGridPager"]').find("span").removeClass("ui-icon"),i.$mars('td[id="last_marsLandingPageGridPager"]').find("span").removeClass("ui-icon"),i.$mars('td[id="prev_marsLandingPageGridPager"]').find("span").removeClass("ui-icon"),i.$mars('td[id="first_marsLandingPageGridPager"]').find("span").removeClass("ui-icon"),r.LandingPageView.isHighContrastWhiteModeEnabled()?(i.$mars('span[class="ui-icon-seek-next"]').append('<img src="'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.gridNext_HCW+'"/>'),i.$mars('span[class="ui-icon-seek-end"]').append('<img src="'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.gridLast_HCW+'"/>'),i.$mars('span[class="ui-icon-seek-prev"]').append('<img src="'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.gridPrev_HCW+'"/>'),i.$mars('span[class="ui-icon-seek-first"]').append('<img src="'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.gridFirst_HCW+'"/>')):(i.$mars('span[class="ui-icon-seek-next"]').append('<img src="'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.gridNextHighContrast+'"/>'),i.$mars('span[class="ui-icon-seek-end"]').append('<img src="'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.gridLastHighContrast+'"/>'),i.$mars('span[class="ui-icon-seek-prev"]').append('<img src="'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.gridPrevHighContrast+'"/>'),i.$mars('span[class="ui-icon-seek-first"]').append('<img src="'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.gridFirstHighContrast+'"/>'))):i.$mars("#lPathDesignerOverlay").hasClass("mars_highcontrast")&&i.$mars("#lPathDesignerOverlay").removeClass("mars_highcontrast");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"LandingPage:checkForHighContrastMode END")},u.prototype.addKeyEventsToGrid=function(n){var f=n.lPathlandingPageContainer.find("select.ui-pg-selbox"),r;n.lPathlandingPageContainer.find(".ui-jqgrid-view tr").addClass("jqgridRow");r=n.lPathlandingPageContainer.find('tr[class*="jqgrow"]');n.lPathlandingPageContainer.find('[class= "'+u.checkBoxColumnClass+'"]').attr("tabindex",-1);n.lPathlandingPageContainer.find("#cb_marsLandingPageGrid").attr("tabindex",0);n.lPathlandingPageContainer.find("a").attr("tabindex",-1);n.lPathlandingPageContainer.find('[class*="'+u.filterButtonClass+'"]').attr("tabindex",-1);n.lPathlandingPageContainer.find("#marsLandingPageGrid").attr("tabindex",-1);n.lPathlandingPageContainer.find(".ui-jqgrid-bdiv").attr("tabindex",-1);n.lPathlandingPageContainer.find(".lpath-grid-formfactor").closest("td").attr("aria-label",i.Locale.FFDTPMS);n.lPathlandingPageContainer.find(".cbox").off("change").on("change",function(n){var r=t.Loader.$mars(n.currentTarget),u=r.parent().parent().find('span[data-name="landingpage_control_name_cell"]').text(),f=i.Locale.unSelectControl+" "+u,e=i.Locale.selectControl+" "+u;r.prop("checked")===!0?r.removeAttr("aria-label").attr("aria-label",f):r.removeAttr("aria-label").attr("aria-label",e)});r.on("keydown",function(t){n.handleArrowNavigationInGridRows(t,n)});f.off("change.lpathLandingPageGrid").on("change.lpathLandingPageGrid",function(){n.rowListDropDownChange(n)})},u.prototype.addKeyEventToToolbar=function(n){var t=n.lPathlandingPageContainer.find(".ui-jqgrid-htable");t.off("keydown").on("keydown",function(t){var r=n.lPathlandingPageContainer.find(t.target),o=t.target.className,s,f;if(t.keyCode==i.Utility.KeyCodeEnum.LeftArrowKey)r.attr("tabindex",-1),f=r.closest("th").prevAll("th:visible").first().find(".lpath-grid-Header-btn"),f.length===0&&(f=r.closest("th").prevAll("th:visible").first().find("input")),f.focus();else if(t.keyCode==i.Utility.KeyCodeEnum.RightArrowKey)r.attr("tabindex",-1),s=r.closest("th").nextAll("th:visible").first(),s.find(".lpath-grid-Header-btn").focus();else{if(t.keyCode==i.Utility.KeyCodeEnum.DownArrowKey){var c=r.closest(".ui-jqgrid-hdiv").next(),h=r.closest("th").attr("id"),e=c.find('tr:not(".jqgfirstrow")').first();return r.attr("tabindex",-1),o.indexOf(u.checkBoxColumnClass)>=0?e.find('[class*="'+u.checkBoxColumnClass+'"]').focus():o.indexOf(u.filterButtonClass)>=0&&(h===u.controlNameHeaderId?e.find(".lpath_name_col").focus():h===u.LanguageHeaderId&&e.find(".lpath_language_col").focus()),t.preventDefault(),!1}t.keyCode==i.Utility.KeyCodeEnum.TabKey&&(n.lPathlandingPageContainer.find("#cb_marsLandingPageGrid").attr("tabindex",-1),r.attr("tabindex",0))}})},u.prototype.bindWindowResizeEvent=function(){t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"bindWindowResizeEvent:Reset grid width on screen resolution change START");try{var r=this;n.Client.Loader.$mars(window).off("resize.lpathlandingpageview").on("resize.lpathlandingpageview",function(){var n=i.$mars("#marsLandingPageGrid");n!=undefined&&n.length>0&&(r.resetJQGridWidth(),r.resetJQGridHeight())})}catch(u){t.Loader.marsExceptionHandler.execute(u.name,u.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"bindWindowResizeEvent:Exception occurred while resetting grid width on screen resolution change.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"bindWindowResizeEvent:Reset grid width on screen resolution change END")},u.prototype.handleArrowNavigationInGridRows=function(i,r){var f=i.target.className,e=r.lPathlandingPageContainer.find(i.target).closest("tr"),o=e.prev(),s=e.next();if(i.keyCode==t.Utility.KeyCodeEnum.UpArrowKey)return r.lPathlandingPageContainer.find(i.target).attr("tabindex",-1),o.hasClass("jqgfirstrow")?f.indexOf(u.checkBoxColumnClass)>=0?r.lPathlandingPageContainer.find("#cb_marsLandingPageGrid").focus():f.indexOf(u.nameColumnClass)>=0?r.lPathlandingPageContainer.find(".ui-jqgrid-htable #marsLandingPageGrid_ControlName .grid-header-filter-btn").focus():f.indexOf(u.languageColumnClass)>=0&&r.lPathlandingPageContainer.find(".ui-jqgrid-htable #marsLandingPageGrid_Languages .grid-header-filter-btn").focus():f.indexOf(u.checkBoxColumnClass)>=0?o.find('[class*="'+u.checkBoxColumnClass+'"]').focus():f.indexOf(u.nameColumnClass)>=0?o.find('[class*="'+u.nameColumnClass+'"]').focus():f.indexOf(u.languageColumnClass)>=0&&o.find('[class*="'+u.languageColumnClass+'"]').focus(),i.preventDefault(),!1;if(i.keyCode==t.Utility.KeyCodeEnum.DownArrowKey)return r.lPathlandingPageContainer.find(i.target).attr("tabindex",-1),f.indexOf(u.checkBoxColumnClass)>=0?s.find('[class*="'+u.checkBoxColumnClass+'"]').focus():f.indexOf(u.nameColumnClass)>=0?s.find('[class*="'+u.nameColumnClass+'"]').focus():f.indexOf(u.languageColumnClass)>=0&&s.find('[class*="'+u.languageColumnClass+'"]').focus(),i.preventDefault(),!1;i.keyCode==t.Utility.KeyCodeEnum.LeftArrowKey?(r.lPathlandingPageContainer.find(i.target).attr("tabindex",-1),f.indexOf(u.checkBoxColumnClass)>=0?e.find('[class*="'+u.checkBoxColumnClass+'"]').focus():f.indexOf(u.nameColumnClass)>=0?e.find('[class*="'+u.checkBoxColumnClass+'"]').focus():f.indexOf(u.languageColumnClass)>=0&&e.find('[class*="'+u.nameColumnClass+'"]').focus()):i.keyCode==t.Utility.KeyCodeEnum.RightArrowKey?(r.lPathlandingPageContainer.find(i.target).attr("tabindex",-1),f.indexOf(u.checkBoxColumnClass)>=0?e.find('[class*="'+u.nameColumnClass+'"]').focus():f.indexOf(u.nameColumnClass)>=0?e.find('[class*="'+u.languageColumnClass+'"]').focus():f.indexOf(u.languageColumnClass)>=0&&e.find('[class*="'+u.languageColumnClass+'"]').focus()):i.keyCode==t.Utility.KeyCodeEnum.TabKey?r.lPathlandingPageContainer.find(i.target).attr("tabindex",0):(r.lPathlandingPageContainer.find(i.target).hasClass(u.languageColumnClass)||r.lPathlandingPageContainer.find(i.target).hasClass(u.nameColumnClass))&&n.Client.Loader.appContext.Util.isEnterPressed(i,!1)&&r.lPathlandingPageContainer.find(i.target).click()},u.prototype.getInitialGridWidth=function(){return t.Loader.$mars("#lpathGridContainer").width()},u.prototype.resetJQGridWidth=function(){var t=this.getInitialGridWidth(),e=i.$mars("#marsLandingPageGrid").width(),r=screen.width,f=i.$mars(window).width(),o=n.Client.Loader.appContext.util.getBrowserInfo();t>0&&this.landingPageGrid&&Math.abs(t-this.landingPageGrid.width())>5&&(o.name=="Safari"?t<=u.gridDefaultWidth&&t>e&&r<=f?this.showJQGridColumns():t!=u.gridDefaultWidth&&t<e&&r>f?this.hideJQGridColumns(r):r>f?this.hideJQGridColumns(r):r<=f&&this.showJQGridColumns():this.handleJQGridWidth(),this.landingPageGrid.setGridWidth(t),i.$mars(".ui-jqgrid-htable").css("width",t),i.$mars("#marsLandingPageGrid").css("width",t))},u.prototype.handleJQGridWidth=function(){var n=100,r,u,t;screen.deviceXDPI?n=Math.round(screen.deviceXDPI/screen.logicalXDPI*100):window.devicePixelRatio&&(n=Math.round(window.devicePixelRatio*100));r=screen.width;u=i.$mars(window).width();r!=u?this.hideJQGridColumns(r):(t=0,n>100&&n<=110?t=1:n>110&&n<=125?t=2:n>125&&n<=140?t=3:n>140&&n<=150?t=4:n>150&&n<=165?t=5:n>165?t=this.hideShowCoulumnArray.length:n<=100&&this.showJQGridColumns());t>this.hideShowCoulumnArray.length&&(t=this.hideShowCoulumnArray.length);this.hideSpecificJQGridColumns(t)},u.prototype.resetJQGridHeight=function(){var n=i.$mars(window).height(),t=i.$mars("#marsLandingPageGridPager").height(),r=i.$mars("#divHeader").offset().top+45,u=n-50-t-r;i.$mars(".ui-jqgrid-bdiv").css("height",u)},u.prototype.hideSpecificJQGridColumns=function(n){for(var t=0;t<n;t++)this.landingPageGrid.jqGrid("hideCol",this.hideShowCoulumnArray[t])},u.prototype.hideJQGridColumns=function(n){var u=i.$mars(window).width(),t=(n-u)/7,r;this.showJQGridColumns();r=0;r=t>0&&t<10?1:t>10&&t<20?2:t>20&&t<35?3:t>35&&t<50?4:t>50&&t<60?5:t>60&&t<70?6:this.hideShowCoulumnArray.length;r>this.hideShowCoulumnArray.length&&(r=this.hideShowCoulumnArray.length);this.hideSpecificJQGridColumns(r)},u.prototype.showJQGridColumns=function(){this.landingPageGrid.jqGrid("showCol",this.hideShowCoulumnArray)},u.prototype.attachEventsToGrid=function(){var n=this;i.App.lPathDesignerContainer.find('a[class="selectRow lpath_name_col"]').off("click").on("click",function(t){return n.openControlEditView(t,this),!1});i.App.lPathDesignerContainer.find('a[name="languages"]').off("click").on("click",function(t){return n.showControlInAvailableLanguages(t),!1});i.App.lPathDesignerContainer.find('input[id="searchGrid"]').off("keyup").on("keyup",function(t){n.searchGrid(t,n)});i.App.lPathDesignerContainer.find('button[id="searchGridImage"]').off("click").on("click",function(t){n.searchGrid(t,n)});i.App.lPathDesignerContainer.find('input[id="filterGridBtn"]').off("click").on("click",function(t){n.filterGrid(t,n)});i.App.lPathDesignerContainer.find('button[id="refreshGridImg"]').off("click").on("click",function(){n.refreshGrid(n)});i.App.lPathDesignerContainer.find('select[id="filterGroupChange"]').off("click").on("click",function(t){n.groupChange(t,n)});i.$mars(".ui-jqgrid-hdiv").marsScrollComplete(function(){i.App.lPathDesignerContainer.find(".ui-jqgrid-bdiv").scrollLeft(i.App.lPathDesignerContainer.find(".ui-jqgrid-hdiv").scrollLeft())},0)},u.prototype.initializeGrid=function(){u.dataSource={landingPageGridData:[],total:"",records:"",pageNo:""};i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_IsGroupable",i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_IsGroupable")?i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_IsGroupable"):!1);i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_sortColumnName",i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortColumnName")?i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortColumnName"):"LastUpdatedDate");i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_filterColumnName",i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")?i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName"):"ControlName");i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")?i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount"):1);i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_pagesize",i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize")?i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize"):10)},u.prototype.createGrid=function(){var n=this;this.landingPageGrid=i.App.lPathDesignerContainer.find("#marsLandingPageGrid");u.ladingPageGridPager=i.App.lPathDesignerContainer.find("#marsLandingPageGridPager");this.landingPageGrid.jqGrid({datatype:"local",data:u.dataSource.landingPageGridData,colModel:n.createColumnsForGrid(),autowidth:!0,shrinkToFit:!0,width:null,viewrecords:!0,multiselect:!0,multiselectWidth:52,localReader:{root:function(){return u.dataSource.landingPageGridData},page:function(){return u.dataSource.pageNo},total:function(){return u.dataSource.total},records:function(){return u.dataSource.records}},rowNum:i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize"),rowList:[10,25,i.Locale.allLabel],loadComplete:function(){t.Loader.$mars(".ui-pg-selbox option:last-child").val("10000000")},pager:"#marsLandingPageGridPager",onPaging:function(t){return n.paginateGrid(t)},recordtext:i.Locale.showingLabel+"{0} - {1} "+i.Locale.ofLabel+" {2}",pgtext:i.Locale.page+" {0} "+i.Locale.ofLabel+" {1}",recordpos:"left",pagerpos:"right",gridview:!0,gridComplete:function(){n.landingPageGrid.jqGrid("groupingToggle","marsLandingPageGridghead_0_0");u.gridDefaultWidth=n.getInitialGridWidth();n.landingPageGrid.setGridWidth(u.gridDefaultWidth);n.resetJQGridWidth();n.resetJQGridHeight();n.attachEventsToGrid()},grouping:JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_IsGroupable")),groupingView:{groupField:[i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName")],groupColumnShow:[!0],groupText:[r.columnNames[i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName")]+": {0}"],groupOrder:["ASC"],groupSummary:[!1],groupCollapse:!0},resizeStop:n.updateColumnWidth,headertitles:!0,cmTemplate:{sortable:!1}})},u.prototype.getGridData=function(f,e,o,s,h,c,l,a){var w,p;s===void 0&&(s="LastUpdatedDate");h===void 0&&(h="desc");c===void 0&&(c="");l===void 0&&(l=JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterCriteria")));a===void 0&&(a="");try{w=window._MicrosoftMars.Client.Utility;n.Client.Loader.currentInstance.UpdateMarsAriaLiveContent(n.Client.Loader.marsLocale.ContentLibraryGridLoading,w.AriaLiveType.assertive);var v=this,y=t.Loader.$mars.Deferred(),k=i.App.lPathDesignerContainer.find('select[id="lpathPublishGroupList"]').val();return i.$mars("#load_marsLandingPageGrid").show(),p=u.getGridRowDataFromService(f,e,o,s,h,c,l,a,k),p.done(function(n){var s={Items:n.Items,TotalRecordCount:n.Count,PageCount:Math.floor(n.Count/e)+(n.Count%e?1:0),PageNo:f,PageSize:e},l,k,o,st,ht,ut,ft,g,h,nt,et,c,tt,p,lt,ot,b,at;for(u.dataSource.landingPageGridData=[],l=t.Designer.Util.Common.getUserIdLoggedInDateTime(),k=!1,i.$mars("#checkHighContrastDiv").css("background-image")==="none"&&(k=!0),o=0;o<s.Items.length;o++){var it="",d="",rt="";for(l&&(st=Date.parse(new Date(s.Items[o].CreatedDate+"Z").toUTCString()),ht=Date.parse(new Date(s.Items[o].LastUpdatedDate+"Z").toUTCString()),l[0]===u.userId&&l[1]<st?it='<label class="lpath-newControlIndicator lpath-ellipsis">'+i.Locale.newCaption.toUpperCase()+"<\/label>":l[0]===u.userId&&l[1]<ht&&(d='<label class="lpath-updatedControlIndicator">*<\/label>')),s.Items[o].CheckedOut&&(ut="",d.trim()!==""&&(ut="lpath-checkedoutbywithupdated"),rt='<img class="lpath-checkedoutby '+ut+'" src="'+t.Loader.serverUrl+'images/grid_lock-icon_10x10.png" title="'+i.Locale.CheckedoutByCaption+" "+s.Items[o].AuthorName+'" alt="'+i.Locale.CheckedOutCaption+" "+s.Items[o].AuthorName+'"/>'),ft="",ft=s.Items[o].Enabled?i.Locale.landingPageEnabledCaption:i.Locale.landingPageDisabledCaption,g=s.Items[o].Status,h={},h[i.Utility.StatusType.Draft]=r.status[1],h[i.Utility.StatusType.Review]=r.status[2],h[i.Utility.StatusType.ReadytoPublish]=r.status[3],h[i.Utility.StatusType.Published]=r.status[4],h[i.Utility.StatusType.Archive]=r.status[5],h[i.Utility.StatusType.Hold]=r.status[6],h[i.Utility.StatusType.ReadytoPublishonHold]=r.status[7],h[i.Utility.StatusType.ContentCheck]=r.status[8],h[i.Utility.StatusType.ReviewDone]=r.status[9],h[i.Utility.StatusType.LocHandoff]=r.status[10],h[i.Utility.StatusType.LocHandbackComplete]=r.status[11],g=h[g],nt=s.Items[o].FormFactor,nt=nt.replace(/\s/g,""),et=nt.split(",").map(function(n){return parseInt(n,10)}),c={},c[i.Util.Constants.DesktopFormFactor]={caption:i.Locale.desktopCaption,imagePath:t.Loader.marsImageMapping.ImagePath.gridDesktop,label:i.Locale.FFDesktopPMS},c[i.Util.Constants.TabletFormFactor]={caption:i.Locale.tabletCaption,imagePath:t.Loader.marsImageMapping.ImagePath.gridTablet,label:i.Locale.FFTabletPMS},c[i.Util.Constants.PhoneFormFactor]={caption:i.Locale.mobileCaption,imagePath:t.Loader.marsImageMapping.ImagePath.gridMobile},c[i.Util.Constants.ExtraLargeFormFactor]={caption:i.Locale.extraLargeCaption,imagePath:t.Loader.marsImageMapping.ImagePath.gridDesktop},c[i.Util.Constants.LargeFormFactor]={caption:i.Locale.largeCaption,imagePath:t.Loader.marsImageMapping.ImagePath.gridTablet},c[i.Util.Constants.Medium]={caption:i.Locale.mediumCaption,imagePath:t.Loader.marsImageMapping.ImagePath.gridMedium},v.formFactorImgs="",tt=0;tt<et.length;tt++)p=c[et[tt].toString()],v.setImageAttribute(v.formFactorImgs,p.imagePath,p.caption,k,p.label,p.description);var ct=s.Items[o].ControlType,a=t.Loader.$mars("<button/>",{disabled:"disabled"}),w=t.Loader.$mars("<img/>",{"class":"lpath-control-type mars-Default-Cursor lpath-svg"});ct==2?(w.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.gridGT),a.attr("alt",i.Locale.headerGuidedTaskText),a.attr("aria-label",i.Locale.headerGuidedTaskText)):ct==1&&(w.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.gridSidebar),a.attr("alt",i.Locale.answerPanelCaption),a.attr("aria-label",i.Locale.sideBar));k&&(r.LandingPageView.isHighContrastWhiteModeEnabled()?w.addClass("highContrastWhiteModeSVG"):w.addClass("highContrastSVG"));a.append(w);lt=i.Util.Common.getLocalDateTime(s.Items[o].LastPublishedTime);ot='<span data-rowIndex="'+o+'" data-colIndex="2" data-name="landingpage_control_name_cell">'+s.Items[o].ControlName+"<\/span>";(it.trim()!==""||d.trim()!==""||rt.trim()!=="")&&(ot='<span data-rowIndex="'+o+'" data-colIndex="2" data-name="landingpage_control_name_cell" class="mars-controlnamewithindicator">'+s.Items[o].ControlName+"<\/span>"+it+d+rt);b=s.Items[o].Title;b!=null&&(b=b.replace(/(\r\n|\n|\r)/gm,"").replace(/(<([^>]+)>)/ig,""));at={Id:s.Items[o].ControlId,ControlName:ot,Title:b,ControlType:a.prop("outerHTML"),FormFactor:v.formFactorImgs,Tags:s.Items[o].Tags,Version:s.Items[o].Version,AppVersion:s.Items[o].AppVersion,AuthorName:s.Items[o].AuthorName,Languages:s.Items[o].Languages.toString()+"_"+s.Items[o].ControlId,CheckedOut:s.Items[o].CheckedOut,CheckedOutByUserId:s.Items[o].CheckedOutByUserId,CheckedOutByUserName:s.Items[o].CheckedOutByUserName,Status:g,Enabled:ft,LastPublishedTime:lt};u.dataSource.landingPageGridData.push(at)}u.dataSource.records=s.TotalRecordCount;u.dataSource.total=s.PageCount;u.dataSource.pageNo=s.PageNo;v.addUserDetailMarsLocalStorage();y.resolve()}),p.fail(function(n){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON);y.reject()}),y.promise()}catch(b){t.Loader.marsExceptionHandler.execute(b.name,b.message)}},u.prototype.setImageAttribute=function(n,i,u,f,e,o){var h=t.Loader.$mars("<button/>",{disabled:"disabled",alt:u,"aria-label":e,"aria-describedby":o}),s=t.Loader.$mars("<img/>",{"class":"mars-Default-Cursor lpath-svg lpath-grid-formfactor lpath-form-factor-margin",src:t.Loader.serverUrl+"images/"+i});f&&(r.LandingPageView.isHighContrastWhiteModeEnabled()?s.addClass("highContrastWhiteModeSVG"):s.addClass("highContrastSVG"));h.append(s);this.formFactorImgs+=h.prop("outerHTML")},u.prototype.resetGrid=function(){var t=this,f=window._MicrosoftMars.Client.Utility,e={root:function(){return u.dataSource.landingPageGridData},page:function(){return u.dataSource.pageNo},total:function(){return u.dataSource.total},records:function(){return u.dataSource.records}};this.landingPageGrid.jqGrid("clearGridData");this.landingPageGrid.jqGrid("setGridParam",{data:u.dataSource.landingPageGridData,localReader:e,grouping:JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_IsGroupable")),groupingView:{groupField:[i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName")],groupText:[r.columnNames[i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName")]+": {0}"]}});t.landingPageGrid.trigger("reloadGrid");t.highlightFilteredColumns();t.modifyTabbingSettingsOfPagination();t.addKeyEventsToGrid(t);t.assignTitleToTotalRowsDropDown();t.assignAriaLabelToCurrentPageNumber();window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg");n.Client.Loader.currentInstance.UpdateMarsAriaLiveContent(n.Client.Loader.marsLocale.ContentLibraryGridLoaded,f.AriaLiveType.assertive)},u.prototype.paginateGrid=function(n){try{var o=i.App.lPathDesignerContainer.find(".ui-pg-input").val(),r=JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),s=r+1,f=r-1;switch(n){case"prev_marsLandingPageGridPager":r>1&&(i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",f),this.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId()),f===1&&u.ladingPageGridPager.find(".ui-pg-input").focus());break;case"next_marsLandingPageGridPager":r<u.dataSource.total&&(i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",s),this.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId()));break;case"first_marsLandingPageGridPager":t.Loader.$mars("#first_marsLandingPageGridPager").hasClass("ui-state-disabled")||(i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",1),this.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId()),u.ladingPageGridPager.find(".ui-pg-input").focus());break;case"last_marsLandingPageGridPager":t.Loader.$mars("#last_marsLandingPageGridPager").hasClass("ui-state-disabled")||(i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",u.dataSource.total),this.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId()));break;case"user":this.validateUserInput(o)||(i.App.lPathDesignerContainer.find(".ui-pg-input").val()>u.dataSource.total?(u.dataSource.total==0&&(u.dataSource.total=1),i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",u.dataSource.total)):i.App.lPathDesignerContainer.find(".ui-pg-input").val()<1?i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",1):i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",i.App.lPathDesignerContainer.find(".ui-pg-input").val()),this.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId()))}}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message)}},u.prototype.validateUserInput=function(n){return isNaN(n)},u.prototype.updateGridData=function(n,r,u){var f,e;try{f=this;this.sortedColumn=JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedColumn"));this.sortedColumn.ColumnName.length>0&&(r=this.sortedColumn.ColumnName);i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_searchString",this.searchGridId.val());e=this.getGridData(n,JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize")),u,r,i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedOrder"),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_searchString"),JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterCriteria")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"));e.done(function(){f.resetGrid();f.attachEventsToGrid();f.changeTitle(f);f.setAttributeToNameAndLanguage(f);window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg")})}catch(o){t.Loader.marsExceptionHandler.execute(o.name,o.message)}},u.prototype.setSortOrder=function(n,t){i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_sortedOrder",n);t.sortGrid()},u.prototype.sortGrid=function(){var n,r,u;try{n=this;this.sortedColumn.ColumnName=i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName");r=t.Loader.$mars(".lpath-sort");r.removeClass("mars_activateSorting");i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedOrder")&&(u=this.getGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize")),t.Loader.appContext.getAuthoringId(),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName"),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedOrder"),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_searchString"),undefined,i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName")),u.done(function(){n.resetGrid();var r=i.App.lPathDesignerContainer.find("#sortAscending").find("svg"),u=i.App.lPathDesignerContainer.find("#sortDescending").find("svg");switch(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedOrder")){case"asc":n.sortedColumn.AttachCss=t.Loader.$mars("#sortAscending").addClass("mars_activateSorting").attr("Id");window._MicrosoftMars.Client.Utility.Util.addClassInElement(r,"lpath-svg-sort-applied");window._MicrosoftMars.Client.Utility.Util.removeClassInElement(u,"lpath-svg-sort-applied");break;case"desc":n.sortedColumn.AttachCss=t.Loader.$mars("#sortDescending").addClass("mars_activateSorting").attr("Id");window._MicrosoftMars.Client.Utility.Util.addClassInElement(u,"lpath-svg-sort-applied");window._MicrosoftMars.Client.Utility.Util.removeClassInElement(r,"lpath-svg-sort-applied")}i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_sortedColumn",JSON.stringify(n.sortedColumn));i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_sortColumnName",n.sortedColumn.ColumnName)}))}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message)}},u.prototype.searchGrid=function(r,u){var f,e;try{r.keyCode==t.Utility.KeyCodeEnum.EscapeKey&&u.lPathlandingPageContainer.focus();(n.Client.Loader.appContext.Util.isEnterPressed(r,!1)||r.type=="click")&&(i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",1),u.sortedColumn=JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedColumn")),i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_searchString",i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(i.App.lPathDesignerContainer.find("#searchGrid").val()))),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_searchString")!=undefined&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_searchString").length>0?(f=undefined,u.sortedColumn.ColumnName.length>0&&(f=u.sortedColumn.ColumnName),e=u.getGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize")),t.Loader.appContext.getAuthoringId(),f,i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedOrder"),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_searchString"),undefined,i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName")),e.done(function(){u.resetGrid()})):(u.searchGridId.val(""),i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_searchString",""),u.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId())))}catch(o){t.Loader.marsExceptionHandler.execute(o.name,o.message)}},u.prototype.returnSortColumn=function(){return!i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName")&&this.sortedColumn.ColumnName.length>0?this.sortedColumn.ColumnName:i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName")},u.prototype.addFilters=function(f){try{this.landingPageGrid.closest("div.ui-jqgrid-view").find("div.ui-jqgrid-hdiv table.ui-jqgrid-htable tr.ui-jqgrid-labels > th.ui-th-column > div.ui-jqgrid-sortable").each(function(e){var o=this,s=this.getElementsByClassName("lpath-Grid-Header-Columns-Ellipsis");t.Loader.$mars('<button id="filterbtn_'+e+'"tabindex="0" aria-label="'+i.Locale.filterColumn+'" class = "lpath-grid-Header-btn" title="'+s[0].innerText+" "+i.Locale.filterCaption+'">').addClass("grid-header-filter-btn").appendTo(this).button({icons:{primary:"ui-icon-gear"},text:!1}).click(function(e){var w,d,s,h,c,l,g,p,nt,b,k,a,v,tt;try{if(f.attachEventsToGrid(),f.currentFilter=e.target,w="jqgh_marsLandingPageGrid_",d=t.Loader.$mars(e.target).closest("div.ui-jqgrid-sortable")[0].id,d.substr(0,w.length)===w){i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_filterColumnName",d.substr(w.length));f.filterTxtValue=t.Loader.$mars("#filterValueTxt");f.filterDrpDwnValue=t.Loader.$mars("#filterValueDrpDwn");t.Loader.$mars("#filterGridBtn").addClass("lpath-filter-button-active");t.Loader.$mars("#clearfilterGridBtn").removeClass("lpath-filter-button-active");u.selectedIndex[i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")]?f.filterCondition.prop("selectedIndex",u.selectedIndex[i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")]):f.filterCondition.prop("selectedIndex",0);f.filterDrpDwnValue.html()&&f.filterDrpDwnValue.remove();f.filterTxtValue&&(o.filterTextValue=f.filterTextValue,f.filterTxtValue.remove());h="";switch(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")){case"ControlType":t.Loader.$mars.each(r.controlType,function(t,r){h+=r===i.Locale.headerGuidedTaskText&&n.Client.Utility.FFFUtility.isFeatureEnabled(r.replace(/ /g,""))?'<option value="'+t+'">'+r+"<\/option>":'<option value="'+t+'">'+r+"<\/option>"});s='<select id="filterValueDrpDwn">'+h+"<\/select>";break;case"Status":t.Loader.$mars.each(r.status,function(n,t){h+='<option value="'+n+'">'+t+"<\/option>"});s='<select id="filterValueDrpDwn">'+h+"<\/select>";break;case"FormFactor":t.Loader.$mars.each(r.formFactor,function(n,t){h+='<option value="'+n+'">'+t+"<\/option>"});s='<select id="filterValueDrpDwn">'+h+"<\/select>";break;case"Enabled":t.Loader.$mars.each(r.enabled,function(n,t){h+='<option value="'+n+'">'+t+"<\/option>"});s='<select id="filterValueDrpDwn">'+h+"<\/select>";break;default:s='<input type="text" id="filterValueTxt" class="grid-search-btn"/>'}f.filterCondition.after(s);i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="Enabled"&&(t.Loader.$mars("#filterValueDrpDwn>option[value=2]").insertBefore("#filterValueDrpDwn>option[value=0]"),t.Loader.$mars("#filterValueDrpDwn>option[value=2]").prop("selected",!0));f.sortedColumn=JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedColumn"));c=i.App.lPathDesignerContainer.find("#sortAscending").find("img");l=i.App.lPathDesignerContainer.find("#sortDescending").find("img");c.length===0?(c=i.App.lPathDesignerContainer.find("#sortAscending").find("svg"),l=i.App.lPathDesignerContainer.find("#sortDescending").find("svg")):(c.attr("src",t.Loader.serverUrl+"images/"+i.Utility.ImageMapping.ImagePath.sortAscending),l.attr("src",t.Loader.serverUrl+"images/"+i.Utility.ImageMapping.ImagePath.sortDescending));window._MicrosoftMars.Client.Utility.Util.addClassInElement(c,"lpath-svg");window._MicrosoftMars.Client.Utility.Util.addClassInElement(c,"lpath-svg-sort");window._MicrosoftMars.Client.Utility.Util.addClassInElement(l,"lpath-svg");window._MicrosoftMars.Client.Utility.Util.addClassInElement(l,"lpath-svg-sort");i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")!==f.sortedColumn.ColumnName?(t.Loader.$mars(".lpath-sort").removeClass("mars_activateSorting"),window._MicrosoftMars.Client.Utility.Util.removeClassInElement(c,"lpath-svg-sort-applied"),window._MicrosoftMars.Client.Utility.Util.removeClassInElement(l,"lpath-svg-sort-applied")):f.sortedColumn.AttachCss&&(i.App.lPathDesignerContainer.find("#"+f.sortedColumn.AttachCss).addClass("mars_activateSorting"),f.sortedColumn.AttachCss=="sortAscending"?(window._MicrosoftMars.Client.Utility.Util.addClassInElement(c,"lpath-svg-sort-applied"),window._MicrosoftMars.Client.Utility.Util.removeClassInElement(l,"lpath-svg-sort-applied")):f.sortedColumn.AttachCss=="sortDescending"?(window._MicrosoftMars.Client.Utility.Util.addClassInElement(l,"lpath-svg-sort-applied"),window._MicrosoftMars.Client.Utility.Util.removeClassInElement(c,"lpath-svg-sort-applied")):(window._MicrosoftMars.Client.Utility.Util.removeClassInElement(c,"lpath-svg-sort-applied"),window._MicrosoftMars.Client.Utility.Util.removeClassInElement(l,"lpath-svg-sort-applied")));f.checkForFilterInThisColumn(s,i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName"))&&(t.Loader.$mars("#clearfilterGridBtn").addClass("lpath-filter-button-active"),t.Loader.$mars("#filterGridBtn").removeClass("lpath-filter-button-active"));var rt=u.filterFlyoutTop,ut=u.filterFlyoutLeft,y=t.Loader.$mars("#"+o.parentElement.id);u.filterFlyoutTop=y.offset().top+y.height()+t.Loader.$mars("#lPathlandingPageContainer").scrollTop();u.filterFlyoutLeft=y.offset().left;g=i.App.landingPageContainer.width();p=g-44;u.filterFlyoutLeft+u.gridFilterDiv.width()>p&&(b=u.filterFlyoutLeft+u.gridFilterDiv.width()-p,u.filterFlyoutLeft=u.filterFlyoutLeft-b);u.gridFilterDiv.css({top:u.filterFlyoutTop,left:u.filterFlyoutLeft,"z-index":i.App.lPathDesignerContainerZIndex+1});i.App.isRTL&&(nt=g-(y.offset().left+y.width()),u.filterFlyoutRight=nt-5,u.filterFlyoutRight+u.gridFilterDiv.width()>p&&(b=u.filterFlyoutRight+u.gridFilterDiv.width()-p,u.filterFlyoutRight=u.filterFlyoutRight-b),u.gridFilterDiv.css({top:u.filterFlyoutTop,left:"auto",right:u.filterFlyoutRight,"z-index":i.App.lPathDesignerContainerZIndex+1}));k=[];k=f.hideShowSortFilterDiv(s);a=k[0];v=k[1];rt==u.filterFlyoutTop&&ut==u.filterFlyoutLeft?(u.filterFlyoutTop=0,u.filterFlyoutLeft=0):(tt=t.Loader.$mars('div[name = "marsFlyOutDiv"]'),tt.hide());u.gridFilterDiv.slideToggle("medium",function(){u.gridFilterDiv.css("display")==="block"?t.Loader.$mars("#"+t.Loader.$mars(s).attr("Id")).focus():u.gridFilterDiv.css("display")==="none"&&(f.removeGridFilterFlyOutEvent(),t.Loader.$mars(f.currentFilter).closest("button").focus())});r.LandingPageView.hideAllMenuFlyOuts();t.Loader.$mars("#"+t.Loader.$mars(s).attr("Id")).focus();f.focusElementInFlyOut(e);v.off("click keydown").on("click keydown",function(i){i.keyCode!=t.Utility.KeyCodeEnum.TabKey||i.shiftKey?v.attr("id")==="sortAscending"&&(n.Client.Loader.appContext.Util.isEnterPressed(i,!0)||i.type==="click")?f.sortgrid(f,"asc",i):v.attr("id")==="sortDescending"&&(n.Client.Loader.appContext.Util.isEnterPressed(i,!0)||i.type==="click")?f.sortgrid(f,"desc",i):v.attr("id")==="clearfilterGridBtn"&&i.type==="click"&&f.clearFilter(i,f):(a.focus(),i.stopPropagation(),i.preventDefault())});a.off("click keydown").on("click keydown",function(i){i.shiftKey&&i.keyCode==t.Utility.KeyCodeEnum.TabKey?(v.focus(),i.stopPropagation(),i.preventDefault()):a.attr("id")==="sortAscending"&&(n.Client.Loader.appContext.Util.isEnterPressed(i,!0)||i.type==="click")?f.sortgrid(f,"asc",i):a.attr("id")==="sortDescending"&&(n.Client.Loader.appContext.Util.isEnterPressed(i,!0)||i.type==="click")?f.sortgrid(f,"desc",i):a.attr("id")==="clearfilterGridBtn"&&i.type==="click"&&f.clearFilter(i,f)});if(a.attr("id")!="sortAscending"&&v.attr("id")!="sortAscending")i.App.lPathDesignerContainer.find('div[id="sortAscending"]').off("click keydown").on("click keydown",function(t){(t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!0))&&f.sortgrid(f,"asc",t)});if(a.attr("id")!="sortDescending"&&v.attr("id")!="sortDescending")i.App.lPathDesignerContainer.find('div[id="sortDescending"]').off("click keydown").on("click keydown",function(t){(t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!0))&&f.sortgrid(f,"desc",t)});if(a.attr("id")!="clearfilterGridBtn"&&v.attr("id")!="clearfilterGridBtn")i.App.lPathDesignerContainer.find('input[id="clearfilterGridBtn"]').off("click").on("click",function(n){n.type==="click"&&f.clearFilter(n,f)});t.Loader.$mars("#gridFilterDiv").off("keydown").on("keydown",function(n){n.keyCode==t.Utility.KeyCodeEnum.EscapeKey&&(u.gridFilterDiv.slideUp("medium"),f.removeGridFilterFlyOutEvent(),t.Loader.$mars(f.currentFilter).closest("button").focus(),t.Loader.$mars(f.currentFilter).closest("button").attr("tabindex",0),n.stopPropagation(),n.preventDefault())});return window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg"),!1}}catch(it){t.Loader.marsExceptionHandler.execute(it.name,it.message)}})})}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message)}},u.prototype.sortgrid=function(n,i,r){n.setSortOrder(i,n);u.gridFilterDiv.hide();t.Loader.$mars(n.currentFilter).closest("button").focus();r.stopPropagation();r.preventDefault()},u.prototype.filterGrid=function(n,r){var o,f,e,s,h;try{o=undefined;i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",1);u.selectedIndex[i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")]=r.filterCondition.prop("selectedIndex");r.filterTxtValue=t.Loader.$mars("#filterValueTxt");f=i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(r.filterTxtValue.val()));r.filterDrpDwnValue=t.Loader.$mars("#filterValueDrpDwn");e=f!=undefined||f!=null?f:r.filterDrpDwnValue.val();r.filterTextValue={ColumnName:i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName"),TextValue:f?f:t.Loader.$mars("#filterValueDrpDwn option:selected").text(),Index:e};s=r.filterCondition.val();r.updateFilterForExistingColumn(s,e);o=r.returnSortColumn();h=r.getGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_pagesize")),t.Loader.appContext.getAuthoringId(),o,i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_sortedOrder"),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_searchString"),JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterCriteria")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"));h.done(function(){r.resetGrid()});e=="0"&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")!=="Enabled"||e=="2"&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="Enabled"||(t.Loader.$mars("#clearfilterGridBtn").addClass("lpath-filter-button-active"),t.Loader.$mars("#filterGridBtn").removeClass("lpath-filter-button-active"));t.Loader.$mars(r.currentFilter).closest("button").focus();u.gridFilterDiv.hide();this.removeGridFilterFlyOutEvent()}catch(c){t.Loader.marsExceptionHandler.execute(c.name,c.message)}},u.prototype.prepareDefaultFilter=function(){var u;this.filterCriteria=[];var t=[],r=n.Client.Utility.FFFUtility;t.push({Condition:6,Value:"1"});r.isFeatureEnabled(r.GuidedTaskFeatureName)&&(u={Condition:6,Value:"2"},t.push(u));this.defaultFilter={Operator:1,Name:"ControlType",Details:t};this.filterCriteria.push(this.defaultFilter);i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_filterCriteria",JSON.stringify(this.filterCriteria))},u.prototype.createFilterObject=function(n,t){return i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="Status"&&(n=="0"||n=="1"||n=="4"?n="6":n=="5"&&(n="7")),{Operator:0,Name:i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName"),Details:[{Condition:n,Value:t}]}},u.prototype.checkForFilterInThisColumn=function(n,r){for(var u=1;u<this.filterCriteria.length;u++)if(r==this.filterCriteria[u].Name)return n=='<input type="text" id="filterValueTxt" class="grid-search-btn"/>'?t.Loader.$mars("#filterValueTxt").val(i.EncodeDecode.MarsHtmlDecode(this.filterCriteria[u].Details[0].Value)):t.Loader.$mars("#filterValueDrpDwn").val(i.EncodeDecode.MarsHtmlDecode(this.filterCriteria[u].Details[0].Value)),!0;return!1},u.prototype.updateFilterForExistingColumn=function(n,t){var r=1,f=!1,u;if(this.filterCriteria=JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterCriteria")),this.filterCriteria.length==1&&!(t=="0"&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")!=="Enabled"||t=="2"&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="Enabled")){u=this.createFilterObject(n,t);this.filterCriteria.push(u);i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_filterCriteria",JSON.stringify(this.filterCriteria));return}while(this.filterCriteria[r]){if(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")==this.filterCriteria[r].Name){t=="0"&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")!=="Enabled"||t=="2"&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="Enabled"?this.deleteColumnFilter(r):(this.updateColumnFilter(r,n,t),f=!0);i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_filterCriteria",JSON.stringify(this.filterCriteria));return}r++}if(!f&&!(t=="0"&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")!=="Enabled"||t=="2"&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="Enabled")){u=this.createFilterObject(n,t);this.filterCriteria.push(u);i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_filterCriteria",JSON.stringify(this.filterCriteria));return}},u.prototype.deleteColumnFilter=function(n){var r=t.Loader.$mars("#jqgh_marsLandingPageGrid_"+this.filterCriteria[n].Name);i.App.lPathDesignerContainer.hasClass("lpath-highcontrast")?window._MicrosoftMars.Client.Utility.Util.removeClassInElement(r.find('span[name="marsFilterSpanImg"] svg'),"lpath-svg-filter-applied"):window._MicrosoftMars.Client.Utility.Util.removeClassInElement(r.find('span[name="marsFilterSpanImg"] svg'),"lpath-svg-filter-applied");t.Loader.$mars("#clearfilterGridBtn").removeClass("lpath-filter-button-active");t.Loader.$mars("#filterGridBtn").addClass("lpath-filter-button-active");this.filterCriteria.splice(n,1);u.selectedIndex[i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")]=0},u.prototype.updateColumnFilter=function(n,t,i){var r=this.createFilterObject(t,i);this.filterCriteria[n]=r},u.prototype.clearFilter=function(n,r){try{i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",1);u.selectedIndex={};i.Util.MarsCookies.deleteCookie("LandingPageView_filterColumnName");r.clearAllHighlightedFilteredColumns();r.searchGridId.val("");i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_searchString","");r.prepareDefaultFilter();r.filterTxtValue.val()&&r.filterTxtValue.val("");t.Loader.$mars("#filterValueTxt").val("");r.filterTextValue={ColumnName:"",TextValue:"",Index:""};r.sortedColumn={ColumnName:"",AttachCss:""};i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_filterColumnName",JSON.stringify(r.sortedColumn));r.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId());t.Loader.$mars(".lpath-sort").removeClass("mars_activateSorting");r.filterDrpDwnValue.html()&&r.filterDrpDwnValue.prop("selectedIndex",0);r.filterCondition.prop("selectedIndex",0);u.filterFlyoutTop=0;u.filterFlyoutLeft=0;u.gridFilterDiv.hide();t.Loader.$mars("#clearfilterGridBtn").removeClass("lpath-filter-button-active");t.Loader.$mars("#filterGridBtn").addClass("lpath-filter-button-active");this.removeGridFilterFlyOutEvent();t.Loader.$mars(r.currentFilter).closest("button").focus()}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message)}},u.prototype.highlightFilteredColumns=function(){var n,r;for(this.filterCriteria=JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterCriteria")),n=1;n<this.filterCriteria.length;n++)r=t.Loader.$mars("#jqgh_marsLandingPageGrid_"+this.filterCriteria[n].Name),i.App.lPathDesignerContainer.hasClass("lpath-highcontrast")?window._MicrosoftMars.Client.Utility.Util.addClassInElement(r.find('span[name="marsFilterSpanImg"] svg'),"lpath-svg-filter-applied"):window._MicrosoftMars.Client.Utility.Util.addClassInElement(r.find('span[name="marsFilterSpanImg"] svg'),"lpath-svg-filter-applied")},u.prototype.clearAllHighlightedFilteredColumns=function(){var n,r;for(this.filterCriteria=JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterCriteria")),n=1;n<this.filterCriteria.length;n++)r=t.Loader.$mars("#jqgh_marsLandingPageGrid_"+this.filterCriteria[n].Name),i.App.lPathDesignerContainer.hasClass("lpath-highcontrast")?window._MicrosoftMars.Client.Utility.Util.removeClassInElement(r.find('span[name="marsFilterSpanImg"] svg'),"lpath-svg-filter-applied"):window._MicrosoftMars.Client.Utility.Util.removeClassInElement(r.find('span[name="marsFilterSpanImg"] svg'),"lpath-svg-filter-applied")},u.prototype.attachNamePropertyToSpanImage=function(){var i=n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.gridFilter;t.Loader.$mars('span[class="ui-button-icon-primary ui-icon ui-icon-gear"]').attr("name","marsFilterSpanImg").append("<img class='lpath-svg-filter' src ='"+i+"' />")},u.prototype.refreshGrid=function(n){n.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId())},u.prototype.addEllipsisToColumnHeader=function(){for(var i=this,r=t.Loader.$mars("[id^=jqgh_marsLandingPageGrid][class=ui-jqgrid-sortable]"),n=0;n<r.length;n++)t.Loader.$mars(r[n]).html(function(){return this.innerHTML.replace(i.columnArray[n].label,'<div class = "lpath-Grid-Header-Columns-Ellipsis">'+i.columnArray[n].label+"<\/div>")})},u.prototype.removeFilterGroupByOptions=function(){for(var f,u=t.Loader.$mars("#filterGroupChange").children(),r=u.length-1;r>=0;r<r--)(u[r].value=="FormFactor"||u[r].value=="AppVersion")&&(f=(new n.Client.Utility.Util).getBrowserInfo(),f.name==i.Util.Constants.internetExplorer?u[r].parentNode.removeChild(u[r]):u[r].remove())},u.prototype.groupChange=function(n,r){var u=r.value;u&&(u==="clear"?(this.landingPageGrid.jqGrid("groupingRemove",!0),i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_searchString",""),i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_IsGroupable",!1),i.Util.MarsCookies.deleteCookie("LandingPageView_groupByColName"),this.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId())):(i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",1),i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_IsGroupable",!0),i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_groupByColName",u),this.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId())))},u.prototype.rowListDropDownChange=function(n){i.App.lPathDesignerContainer.find("select.ui-pg-selbox").val()>=u.dataSource.records&&(u.ladingPageGridPager.find("#next_marsLandingPageGridPager").addClass("ui-state-disabled").attr("tabindex","-1"),u.ladingPageGridPager.find("#last_marsLandingPageGridPager").addClass("ui-state-disabled").attr("tabindex","-1"),u.ladingPageGridPager.find("#first_marsLandingPageGridPager").addClass("ui-state-disabled").attr("tabindex","-1"),u.ladingPageGridPager.find("#prev_marsLandingPageGridPager").addClass("ui-state-disabled").attr("tabindex","-1"));i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_pagesize",i.App.lPathDesignerContainer.find("select.ui-pg-selbox").val()=="10000000"?i.Util.Constants.MaximumPageSize:i.App.lPathDesignerContainer.find("select.ui-pg-selbox").val());i.Util.LPathLocalStorage.setLocalStorage("LandingPageView_currentPageCount",1);this.assignTitleToTotalRowsDropDown();n.refreshGrid(n);i.App.lPathDesignerContainer.find(".ui-pg-selbox").focus()},u.prototype.createColumnsForGrid=function(){var u=t.Loader.appContext.ClientType!==i.Util.Constants.WebClientType,e=this.getInitialGridWidth(),n,f;return this.setColumnWidth(u,e),n=JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("columnWidthArray")),f=[{name:"Id",label:r.columnNames.Id,key:!0,hidden:!0},{name:"CheckedOut",label:r.columnNames.CheckedOut,hidden:!0},{name:"CheckedOutByUserId",label:r.columnNames.CheckedOutByUserId,hidden:!0},{name:"ControlName",label:r.columnNames.ControlName,formatter:this.addAnchorTagToName,fixed:!0,width:n[4]},{name:"Title",label:r.columnNames.Title,fixed:!0,width:n[5]},{name:"ControlType",label:r.columnNames.ControlType,fixed:!0,width:n[6]},{name:"FormFactor",label:r.columnNames.FormFactor,sortable:!1,hidden:u,fixed:!0,width:n[7]},{name:"Tags",label:r.columnNames.Tags,fixed:!0,width:n[8]},{name:"Version",label:r.columnNames.Version,hidden:!0,fixed:!0,width:n[9]},{name:"AppVersion",label:r.columnNames.AppVersion,hidden:u,fixed:!0,width:n[10]},{name:"AuthorName",label:r.columnNames.AuthorName,fixed:!0,width:n[11]},{name:"Languages",label:r.columnNames.Languages,formatter:this.addAnchorTagToLanguages,hidden:u,fixed:!0,width:n[12]},{name:"Status",label:r.columnNames.Status,fixed:!0,width:n[13]},{name:"Enabled",label:r.columnNames.Enabled,fixed:!0,width:n[14]},{name:"LastPublishedTime",label:r.columnNames.LastPublishedTime,fixed:!0,width:n[15]}],u&&this.removeFilterGroupByOptions(),this.columnArray=f,f},u.prototype.setColumnWidth=function(n,t){i.Util.LPathLocalStorage.getLocalStorage("columnWidthArray")||(u.columnWidthArray[4]=n?t*.135:t*.09,u.columnWidthArray[5]=n?t*.125:t*.087,u.columnWidthArray[6]=n?t*.125:t*.067,u.columnWidthArray[7]=t*.082,u.columnWidthArray[8]=n?t*.125:t*.07,u.columnWidthArray[9]=t*.087,u.columnWidthArray[10]=t*.082,u.columnWidthArray[11]=n?t*.125:t*.087,u.columnWidthArray[12]=t*.082,u.columnWidthArray[13]=n?t*.1:t*.087,u.columnWidthArray[14]=n?t*.09:t*.087,u.columnWidthArray[15]=n?t*.125:t*.082,i.Util.LPathLocalStorage.setLocalStorage("columnWidthArray",JSON.stringify(u.columnWidthArray)))},u.prototype.updateColumnWidth=function(n,t){u.columnWidthArray[t]=n;i.Util.LPathLocalStorage.setLocalStorage("columnWidthArray",JSON.stringify(u.columnWidthArray))},u.prototype.handleHeaderCheckboxClick=function(){var n=this;this.lPathlandingPageContainer.find("#cb_marsLandingPageGrid").off("change").on("change",function(r){var u=n.landingPageGrid.find(".jqgrow").find('span[data-name="landingpage_control_name_cell"]'),f=t.Loader.$mars(r.currentTarget);u.each(function(n,t){var r=t.innerText,u=i.App.lPathDesignerContainer.find(t).closest("td").parent().find(".cbox"),e=i.Locale.unSelectControl+" "+r,o=i.Locale.selectControl+" "+r;f.prop("checked")===!0?u.removeAttr("aria-label").attr("aria-label",e):u.removeAttr("aria-label").attr("aria-label",o)})})},u.prototype.addTabEventsToPagination=function(){var t=this;u.ladingPageGridPager.find("#prev_marsLandingPageGridPager").keydown(function(n){t.handleKeyDownEventInPagination(n,"prev_marsLandingPageGridPager")});u.ladingPageGridPager.find("#next_marsLandingPageGridPager").keydown(function(n){t.handleKeyDownEventInPagination(n,"next_marsLandingPageGridPager")});u.ladingPageGridPager.find("#first_marsLandingPageGridPager").keydown(function(n){t.handleKeyDownEventInPagination(n,"first_marsLandingPageGridPager")});u.ladingPageGridPager.find("#last_marsLandingPageGridPager").keydown(function(n){t.handleKeyDownEventInPagination(n,"last_marsLandingPageGridPager")});u.ladingPageGridPager.find(".ui-pg-button.ui-corner-all").attr("role","button");u.ladingPageGridPager.find("#prev_marsLandingPageGridPager").attr("title",n.Client.Loader.marsLocale.previousPage).attr("aria-label",n.Client.Loader.marsLocale.previous).attr("aria-describedby","previousPage");u.ladingPageGridPager.find("#next_marsLandingPageGridPager").attr("title",n.Client.Loader.marsLocale.nextPage).attr("aria-label",n.Client.Loader.marsLocale.nextValue).attr("aria-describedby","nextPage");u.ladingPageGridPager.find("#first_marsLandingPageGridPager").attr("title",n.Client.Loader.marsLocale.firstPage).attr("aria-label",n.Client.Loader.marsLocale.firstValue).attr("aria-describedby","firstPage");u.ladingPageGridPager.find("#last_marsLandingPageGridPager").attr("title",n.Client.Loader.marsLocale.lastPage).attr("aria-label",n.Client.Loader.marsLocale.lastValue).attr("aria-describedby","lastPage")},u.prototype.modifyTabbingSettingsOfPagination=function(){u.dataSource.total==0?(u.ladingPageGridPager.find("#prev_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find("#next_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find("#first_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find("#last_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find("#next_marsLandingPageGridPager").hasClass("ui-state-disabled")&&u.ladingPageGridPager.find("#last_marsLandingPageGridPager").hasClass("ui-state-disabled")||(u.ladingPageGridPager.find("#next_marsLandingPageGridPager").addClass("ui-state-disabled"),u.ladingPageGridPager.find("#last_marsLandingPageGridPager").addClass("ui-state-disabled"))):(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")=="1"||u.dataSource.total==0)&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")==u.dataSource.total?(u.ladingPageGridPager.find("#prev_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find("#next_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find("#first_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find("#last_marsLandingPageGridPager").attr("tabindex","-1")):i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")=="1"&&i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")!==u.dataSource.total?(u.ladingPageGridPager.find("#prev_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find("#next_marsLandingPageGridPager").attr("tabindex","0"),u.ladingPageGridPager.find("#first_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find("#last_marsLandingPageGridPager").attr("tabindex","0")):i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")==u.dataSource.total?(u.ladingPageGridPager.find("#prev_marsLandingPageGridPager").attr("tabindex","0"),u.ladingPageGridPager.find("#next_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find("#first_marsLandingPageGridPager").attr("tabindex","0"),u.ladingPageGridPager.find("#last_marsLandingPageGridPager").attr("tabindex","-1"),u.ladingPageGridPager.find(".ui-pg-selbox").focus()):(u.ladingPageGridPager.find("#prev_marsLandingPageGridPager").attr("tabindex","0"),u.ladingPageGridPager.find("#next_marsLandingPageGridPager").attr("tabindex","0"),u.ladingPageGridPager.find("#first_marsLandingPageGridPager").attr("tabindex","0"),u.ladingPageGridPager.find("#last_marsLandingPageGridPager").attr("tabindex","0"))},u.prototype.supportJawsForJQGrid=function(){i.App.lPathDesignerContainer.find(".ui-jqgrid-labels").removeAttr("role");i.App.lPathDesignerContainer.find("#cb_marsLandingPageGrid").attr("title",i.Locale.selectAll);i.App.lPathDesignerContainer.find(".ui-jqgrid-htable").attr("role","presentation");i.App.lPathDesignerContainer.find("#marsLandingPageGrid").removeAttr("aria-multiselectable").find("tr").removeAttr("tabindex");i.App.lPathDesignerContainer.find("#gbox_marsLandingPageGrid").attr("role","region").attr("aria-label",i.Locale.contentGridCaption);i.App.lPathDesignerContainer.find("#marsLandingPageGrid").find("tr.jqgfirstrow").attr("aria-hidden","true");i.App.lPathDesignerContainer.find("#marsLandingPageGrid").removeAttr("aria-labelledby")},u.prototype.handleKeyDownEventInPagination=function(t,i){n.Client.Loader.appContext.Util.isEnterPressed(t,!0)&&(this.paginateGrid(i),t.stopPropagation(),t.preventDefault())},u.prototype.addAnchorTagToName=function(n,t){var i,f="<\/span>",r=n.split(f);return r.length>1?(i="<a class='selectRow "+u.nameColumnClass+"' id='name_"+t.rowId+"' role='link'>"+r[0]+f+"<\/a>",i=i+r[1]):i="<a class='selectRow "+u.nameColumnClass+"' id='name_"+t.rowId+"' role='link'>"+n+"<\/a>",i},u.prototype.addAnchorTagToLanguages=function(n,t){this.itemArray=[];this.itemArray=n.split("_");var i="";return parseInt(this.itemArray[0])>0&&(i="<a name='languages' class='"+u.languageColumnClass+"' controlVersion='"+this.itemArray[1]+"' id='language_"+t.rowId+"' role='link'>"+this.itemArray[0]+"<\/a>"),i},u.prototype.addUserDetailMarsLocalStorage=function(){u.userId=i.App.appContext.UserId;var n=new Date,t=u.userId+"_"+Date.parse(n.toUTCString());i.Util.LPathLocalStorage.save("userIdLastLoginTime",t)},u.prototype.focusElementInFlyOut=function(n){(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="LastPublishedTime"||i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="Languages")&&(u.gridFilterDiv.find('div[id="sortAscending"]').focus(),n.preventDefault(),n.stopPropagation())},u.prototype.hideShowSortFilterDiv=function(){var t=u.gridFilterDiv.find("#lpath-filter-sortoption"),r=u.gridFilterDiv.find("#marsfilterOptionsDiv"),n=[];return t.show(),r.show(),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="ControlType"||i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="Enabled"||i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="Status"?(t.hide(),n[0]=r.find("#filterCondition"),n[1]=r.find("#clearfilterGridBtn")):i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="LastPublishedTime"||i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_filterColumnName")=="Languages"?(r.hide(),u.gridFilterDiv.find('div[id="sortAscending"]').focus(),n[0]=t.find("#sortAscending"),n[1]=t.find("#sortDescending")):(t.show(),r.show(),n[0]=t.find("#sortAscending"),n[1]=r.find("#clearfilterGridBtn")),n},u.prototype.showControlInAvailableLanguages=function(n){var u=new r.controlModelForExport,e=n.currentTarget,o=this,f;u.ControlIds=[];u.ControlIds.push(n.currentTarget.id);u.DraftPublishGroupId=t.Loader.appContext.getDraftPublishGroupId();f=i.App.serviceHandler.GetExportedControlMetadata(u);f.done(function(n){var h=[],u,f,s;for(t.Loader.$mars.each(n.Result,function(n,t){h.push(t.LanguageName)}),u=new r.SimpleDialogView({},t.Loader.$mars("#mars-simpleDialogHolder"),"ControlLanguagesPopUp",i.Locale.ControlLanguagePopUpTitle,""),u.onOkCallback=function(){o.onDialogCallback(e);this.hide();this.hideDialog=!1},u.onCancelCallback=function(){o.onDialogCallback(e)},f="<div>",s=0;s<h.length;s++)f+="<p>"+h[s]+"<\/p>";f+="<\/div>";u.alertHtmlContent=f;u.ariaDescribedById="ControlLanguagesPopUp";u.show()});f.fail(function(n){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON)})},u.prototype.removeGridFilterFlyOutEvent=function(){u.gridFilterDiv.find("*").off("keydown");u.gridFilterDiv.find("*").off("click")},u.prototype.openControlEditView=function(n,r){var u,f,e;try{this.viewName="LandingPageGrid";u=r.id;u=t.Loader.$mars(r).parents("tr").attr("id");f=null;e=i.App.lPathDesignerContainer.find('select[id="lpathPublishGroupList"]');e&&(f=e.val());i.App.openControl(u,null,null,null,f);i.App.CancelCaller=this}catch(o){t.Loader.marsExceptionHandler.execute(o.name,o.message)}},u.prototype.onDialogCallback=function(n){n.focus()},u.landingPageGridData=[],u.columnWidthArray=[],u.selectedIndex={},u.filterFlyoutTop=0,u.filterFlyoutLeft=0,u.filterFlyoutRight=0,u.checkBoxColumnClass="cbox",u.languageColumnClass="lpath_language_col",u.nameColumnClass="lpath_name_col",u.filterButtonClass="lpath-grid-Header-btn",u.controlNameHeaderId="marsLandingPageGrid_ControlName",u.LanguageHeaderId="marsLandingPageGrid_Languages",u}();r.LandingPageGrid=u;r.controlType={"0":i.Locale.noFilters,1:i.Locale.answerPanelCaption,2:i.Locale.headerGuidedTaskText};r.status={"0":i.Locale.noFilters,"1":i.Locale.draft,"2":i.Locale.review,"3":i.Locale.readytoPublish,"4":i.Locale.published,"5":i.Locale.archive,"6":i.Locale.hold,"7":i.Locale.readytoPublishonHold,"8":i.Locale.contentCheck,"9":i.Locale.reviewDone,"10":i.Locale.locHandoff,"11":i.Locale.locHandbackComplete,"12":i.Locale.inProgressCaption,"13":i.Locale.failedPublishCaption};r.formFactor={"0":i.Locale.noFilters,"1":i.Locale.desktopCaption,"2":i.Locale.tabletCaption,"3":i.Locale.phoneCaption,"4":i.Locale.extraLargeCaption,"5":i.Locale.largeCaption,"6":i.Locale.mediumCaption};r.enabled={"false":i.Locale.landingPageDisabledCaption,"true":i.Locale.landingPageEnabledCaption,"2":i.Locale.noFilters};r.columnNames={Id:i.Locale.idCaption,CheckedOut:i.Locale.CheckedOutCaption,CheckedOutByUserId:i.Locale.CheckedOutByUserIdCaption,ControlName:i.Locale.nameCaption,Title:i.Locale.title,ControlType:i.Locale.typeCaption,FormFactor:i.Locale.formFactorCaption,Version:i.Locale.versionCaption,AppVersion:i.Locale.appVersion,AuthorName:i.Locale.authorCaption,Status:i.Locale.statusCaption,Tags:i.Locale.tagCaption,Languages:i.Locale.languagesCaption,Enabled:i.Locale.headerEnabledCaption,LastPublishedTime:i.Locale.LastPublishedTime}})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var e=function(e){function o(){e.apply(this,arguments);this.selectedControls=[];this.controlNames=[];this.LanguageNames=[];this.LanguageIds=[];this.selectedLanguages=[];this.controlsContentList=[];this.buildControls=0;this.publishedControls=0;this.draftControls=0;this.dropdownElementNotSelectedBackground="#ffffff";this.dropdownElementSelectedBackground="#D5E5F3"}return __extends(o,e),o.disableHighlightForToolbarItem=function(){var n=t.Loader.$mars("div .lpath-landing-toolbar-item.lpath-landing-toolbar-active");var i=o.isHighContrastModeEnabled(),r=o.isHighContrastWhiteModeEnabled(),u=t.Loader.$mars(n).find('img[class="lpath-toolbar-icons"]');i?r?n.find('img[class="lpath-toolbar-dropdown-icon"]').attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuDropdown_HCW):n.find('img[class="lpath-toolbar-dropdown-icon"]').attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuDropDownHighContrast):n.find('img[class="lpath-toolbar-dropdown-icon"]').attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuDropdown);switch(n.attr("id")){case"imgManageControlMars":this.setImageAttribute(u,t.Loader.marsImageMapping.ImagePath.landingPageMenuManage,t.Loader.marsImageMapping.ImagePath.landingPageMenuMangeHighContrast,t.Loader.marsImageMapping.ImagePath.landingPageMenuMange_HCW,i,r);break;case"imgBuildControlMars":this.setImageAttribute(u,t.Loader.marsImageMapping.ImagePath.landingPageMenuPublish,t.Loader.marsImageMapping.ImagePath.landingPageMenuPublishHighContrast,t.Loader.marsImageMapping.ImagePath.landingPageMenuPublish_HCW,i,r);break;case"imgLocalizeControlMars":this.setImageAttribute(u,t.Loader.marsImageMapping.ImagePath.landingPageMenuLocalization,t.Loader.marsImageMapping.ImagePath.landingPageMenuLocalizationHighContrast,t.Loader.marsImageMapping.ImagePath.landingPageMenuLocalization_HCW,i,r);break;case"imgAnalyzeControlMars":this.setImageAttribute(u,t.Loader.marsImageMapping.ImagePath.landingPageMenuAnalyze,t.Loader.marsImageMapping.ImagePath.landingPageMenuAnalyzeHighContrast,t.Loader.marsImageMapping.ImagePath.landingPageMenuAnalyze_HCW,i,r);break;case"imgConfigurationControlMars":this.setImageAttribute(u,t.Loader.marsImageMapping.ImagePath.landingPageMenuConfiguration,t.Loader.marsImageMapping.ImagePath.landingPageMenuConfigurationHighContrast,t.Loader.marsImageMapping.ImagePath.landingPageMenuConfiguration_HCW,i,r)}n.removeClass("lpath-landing-toolbar-active")},o.setImageAttribute=function(n,i,r,u,f,e){f&&e?n.attr("src",""+t.Loader.serverUrl+"images/"+u):f&&!e?n.attr("src",""+t.Loader.serverUrl+"images/"+r):n.attr("src",""+t.Loader.serverUrl+"images/"+i)},o.isHighContrastWhiteModeEnabled=function(){return this.isHighContrastModeEnabled()&&i.$mars("body").css("background-color")==="rgb(255, 255, 255)"},o.isHighContrastModeEnabled=function(){return i.$mars("#checkHighContrastDiv").css("background-image")==="none"},o.hideAllMenuFlyOuts=function(){t.Loader.$mars('div[data-name="marsTopBarMenuFlyOut"]').hide();o.disableHighlightForToolbarItem(this)},o.prototype.getTemplate=function(){return i.Util.Constants.landingPagePanelViewTemplate},o.prototype.displayUnAuthorizedPopUp=function(){var n=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.UnAuthorizedPopup,i.Locale.UnAuthorized,i.Locale.UnAuthorizedMessage);n.addDefaultFocusOnOkOrClose=!0;n.ariaDescribedById=i.Util.Constants.UnAuthorizedPopup;n.show()},o.prototype.build=function(){var r,u;try{r=this;e.prototype.build.call(this);t.Loader.$mars("#contentLibraryTitle").show();this.bindPublishGroupDropdown();t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.authorRoleName.toLowerCase())?(this.subscribe('button[id="landingPageSidebar"]',"click",this.onSidebarClick),this.subscribe('button[id="landingPageSidebar"]',"keydown",function(t){n.Client.Loader.appContext.Util.isEnterPressed(t,!1)&&this.onSidebarClick()},!1),this.subscribe('button[id="landingPageGuidedTask"]',"click",this.onGuidedTaskClick),this.subscribe('button[id="landingPageGuidedTask"]',"keydown",function(t){n.Client.Loader.appContext.Util.isEnterPressed(t,!1)&&this.onGuidedTaskClick()},!1)):this.subscribe('div[id="imgOpenNewControlMars"]',"click",function(){this.displayUnAuthorizedPopUp()});this.subscribe("#backToCRMLink","click",this.onBackToCRMLink);u=i.App.lPathDesignerContainer.find("#backToCRMLink");u.removeClass();u.addClass("lpath-ap-close lpath-landingpage");i.App.lPathDesignerContainer.find("#backToCRMLink").off("keydown").on("keydown",function(n){r.crossImageKeyDownHandling(n)});t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.authorRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.editorRoleName.toLowerCase())?(this.subscribe('div[id="imgManageControlMars"]',"click",function(n){var t=this.rootElement.find(n.target).closest("div").attr("id");this.toggleDropDown(t)},!1),this.subscribe('div[id="imgManageControlMars"]',"keydown",function(n,t){r.toggleDropdownonEnter(n,t)},!1)):this.subscribe('div[id="imgManageControlMars"]',"click",function(){this.displayUnAuthorizedPopUp()});this.subscribe('ul[id="manageSelectionLandingPageMars"] li',"click",function(n,t){this.onSelectDropDownManageMenuOption(n,t)});t.Loader.marsUserRole&&t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()?(this.subscribe('div[id="imgConfigurationControlMars"]',"click",this.openConfig),this.subscribe('div[id="imgConfigurationControlMars"]',"keydown",function(n){r.handleConfigOnKeydown(n)},!1)):this.subscribe('div[id="imgConfigurationControlMars"]',"click",function(){this.displayUnAuthorizedPopUp()});t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.editorRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.localizerRoleName.toLowerCase())?(this.subscribe('div[id="imgLocalizeControlMars"]',"click",function(n){var t=this.rootElement.find(n.target).closest("div").attr("id");this.toggleDropDown(t)}),this.subscribe('div[id="imgLocalizeControlMars"]',"keydown",function(n,t){r.toggleDropdownonEnter(n,t)},!1),this.subscribe('ul[id="localizeSelectionLandingPageMars"] li',"click",function(n,t){this.onSelectDropDownLocalizeMenuOption(n,t)})):this.subscribe('div[id="imgLocalizeControlMars"]',"click",function(){this.displayUnAuthorizedPopUp()});this.subscribe('div[id="imgBuildControlMars"]',"click",function(n){var t=this.rootElement.find(n.target).closest("div").attr("id");this.toggleDropDown(t)});this.subscribe('div[id="imgBuildControlMars"]',"keydown",function(n,t){r.toggleDropdownonEnter(n,t)},!1);this.subscribe('ul[id="publishSelectionLandingPageMars"] li',"click",this.onSelectDropDownPublishMenuOption);t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.authorRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.editorRoleName.toLowerCase())?(this.subscribe('div[id="imgAnalyzeControlMars"]',"click",this.openAnalyze),this.subscribe('div[id="imgAnalyzeControlMars"]',"keydown",function(n){r.handleAnalyzeOnKeydown(n)},!1)):this.subscribe('div[id="imgAnalyzeControlMars"]',"click",function(){this.displayUnAuthorizedPopUp()});this.subscribe('div[class="lpath-landing-toolbar-item"]',"click",this.onSelectToolbarItem);this.subscribe('div[id="mars-lp-focusguard"]',"focus",this.onLastTabIndex);this.answerPanelMetadata=new i.Content.SidebarMetadata;this.newControlDropDown=this.rootElement.find('div[id="dropDownMenuOnNewControlMars"]');this.simpleDialogHolder=t.Loader.$mars("#mars-simpleDialogHolder");this.lPathlandingPageContainer=t.Loader.$mars("#lPathlandingPageContainer");this.lPathlandingPageContainer.children().off("click",this.expandCollapseFlyOut).on("click",this.expandCollapseFlyOut);this.setShortcutKeys()}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message)}},o.prototype.close=function(){n.Client.Loader.$mars(window).off("resize.lpathlandingpageview");e.prototype.close.call(this)},o.prototype.show=function(){try{e.prototype.show.call(this);this.landinGpageGrid=new r.LandingPageGrid}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message)}},o.prototype.checkForHighContrast=function(){if(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"LandingPage:checkForHighContrastMode START"),o.isHighContrastModeEnabled()){i.App.lPathDesignerContainer.hasClass("lpath-highcontrast")||i.App.lPathDesignerContainer.addClass("lpath-highcontrast");i.$mars("lpath-landingpage-container").addClass("lpath_highcontrast");i.$mars("#lPathDesignerOverlay").hasClass("lpath-highcontrast")||i.$mars("#lPathDesignerOverlay").addClass("lpath-highcontrast");i.$mars("#lPathDesignerOverlay").hasClass("lpath-overlay-initial-highcontrast")||i.$mars("#lPathDesignerOverlay").addClass("lpath-overlay-initial-highcontrast");var r=!1;i.$mars("body").css("background-color")==="rgb(255, 255, 255)"&&(r=!0);this.handleHighContrastForCommandBar(r);r&&(this.lPathlandingPageContainer.find("#backToCRMLink").attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.closeContentLibrary_HCW+""),this.lPathlandingPageContainer.find(".lpath-toolbar-dropdown-icon").attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuDropdown_HCW+""))}else i.$mars("#lPathDesignerOverlay").hasClass("mars_highcontrast")&&(i.$mars("#lPathDesignerOverlay").removeClass("mars_highcontrast"),o.isHighContrastWhiteModeEnabled()?window._MicrosoftMars.Client.Utility.Util.removeClassInSVGs("img.lpath-svg","highContrastSVG"):window._MicrosoftMars.Client.Utility.Util.removeClassInSVGs("img.lpath-svg","highContrastWhiteModeSVG"))},o.prototype.handleHighContrastForCommandBar=function(n){var u=t.Loader.$mars('div [class="lpath-landing-toolbar-item"]'),r,f,i;if(u){for(r=0;r<u.length;r++){f=t.Loader.$mars(u[r]).attr("id");i=t.Loader.$mars(u[r]).find('img[class="lpath-toolbar-icons"]');t.Loader.$mars(u[r]).find('img[class="lpath-toolbar-dropdown-icon"]').attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuDropDownHighContrast+"");switch(f){case"imgManageControlMars":n?i.attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuMange_HCW):i.attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuMangeHighContrast);break;case"imgBuildControlMars":n?i.attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuPublish_HCW):i.attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuPublishHighContrast);break;case"imgLocalizeControlMars":n?i.attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuLocalization_HCW):i.attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuLocalizationHighContrast);break;case"imgAnalyzeControlMars":n?i.attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuAnalyze_HCW):i.attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuAnalyzeHighContrast);break;case"imgConfigurationControlMars":n?i.attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuConfiguration_HCW):i.attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuConfigurationHighContrast)}}o.isHighContrastWhiteModeEnabled()?window._MicrosoftMars.Client.Utility.Util.addClassInSVGs("img.lpath-svg","highContrastSVG"):window._MicrosoftMars.Client.Utility.Util.addClassInSVGs("img.lpath-svg","highContrastWhiteModeSVG")}},o.prototype.openAnalyzeDashboard=function(){window.open("https://msit.powerbi.com/groups/me/dashboards","_blank")},o.prototype.handleConfigOnKeydown=function(i){var r=this.rootElement.find(i.target),u=this.rootElement.find(".lpath-landing-toolbar-item");n.Client.Loader.appContext.Util.isEnterPressed(i,!0)?this.openConfig():i.keyCode==t.Utility.KeyCodeEnum.DownArrowKey||i.keyCode==t.Utility.KeyCodeEnum.RightArrowKey?(u.attr("tabindex",-1),r.next(".lpath-landing-toolbar-item").length>0?r.next(".lpath-landing-toolbar-item").focus():u.first().focus()):i.keyCode==t.Utility.KeyCodeEnum.UpArrowKey||i.keyCode==t.Utility.KeyCodeEnum.LeftArrowKey?(u.attr("tabindex",-1),r.prev(".lpath-landing-toolbar-item").focus()):i.keyCode==t.Utility.KeyCodeEnum.TabKey&&(r.attr("tabindex",0),i.shiftKey?i.shiftKey&&this.rootElement.find("#backToCRMLink").focus():this.rootElement.find("#lpathPublishGroupList").focus(),i.stopPropagation(),i.preventDefault())},o.prototype.handleAnalyzeOnKeydown=function(i){var r=this.rootElement.find(i.target),u=this.rootElement.find(".lpath-landing-toolbar-item");n.Client.Loader.appContext.Util.isEnterPressed(i,!0)?this.openAnalyze():i.keyCode==t.Utility.KeyCodeEnum.EscapeKey?this.lPathlandingPageContainer.focus():i.keyCode==t.Utility.KeyCodeEnum.DownArrowKey||i.keyCode==t.Utility.KeyCodeEnum.RightArrowKey?(u.attr("tabindex",-1),r.next(".lpath-landing-toolbar-item").focus()):i.keyCode==t.Utility.KeyCodeEnum.UpArrowKey||i.keyCode==t.Utility.KeyCodeEnum.LeftArrowKey?(u.attr("tabindex",-1),r.prev(".lpath-landing-toolbar-item").focus()):i.keyCode==t.Utility.KeyCodeEnum.TabKey&&(r.attr("tabindex",0),i.shiftKey?i.shiftKey&&this.rootElement.find("#backToCRMLink").focus():this.rootElement.find("#lpathPublishGroupList").focus(),i.stopPropagation(),i.preventDefault())},o.prototype.bindPublishGroupDropdown=function(){var n=this.rootElement.find('select[id="lpathPublishGroupList"]');this.rootElement.find('select[id="lpathPublishGroupList"] option[data-publishgrouptype = "'+i.Utility.PublishGroupType.Draft+'"]').prop("selected",!0);this.subscribe(n,"change",this.onPublishGroupChange);this.addEllipsisToPublishGroupDropDown();t.Loader.$mars("#lpathPublishingGroupContainer").show()},o.prototype.addEllipsisToPublishGroupDropDown=function(){t.Loader.$mars("#lpathPublishGroupList option").each(function(){t.Loader.$mars(this).text().length>25&&t.Loader.$mars(this).text(t.Loader.$mars.trim(t.Loader.$mars(this).text()).substring(0,23).trim(this)+"...")})},o.prototype.onPublishGroupChange=function(){this.landinGpageGrid.refreshGrid(this.landinGpageGrid)},o.prototype.retrieveValues=function(){try{var r=i.App.appContext;this.multiSelectProductVersion.populateValues(this.rootElement.find('div[id="mars-editAppVersion"]'),r.AppVersion);this.multiSelectProductVersion.rootElement.find("ul input[checked=true]").length==this.getProductVersion().length&&this.rootElement.find('#mars-editAppVersion dl li input[value="All"]').prop("checked",!0)}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message)}},o.prototype.getProductVersion=function(){return t.Loader.supportedVersions},o.prototype.setShortcutKeys=function(){var n=this,r=[];n.lPathlandingPageContainer.off("keydown");n.lPathlandingPageContainer.off("keyup");n.lPathlandingPageContainer.keydown(function(i){if(r.push(i.keyCode),i.keyCode==t.Utility.KeyCodeEnum.EscapeKey&&(t.Loader.$mars(document.activeElement).parents("#lPathlandingPageContainer").length===0||t.Loader.$mars(document.activeElement).attr("id")==="lPathlandingPageContainer")){var u=t.Loader.$mars('div[name = "marsFlyOutDiv"]');u.length>0&&(u.slideUp("medium"),n.lPathlandingPageContainer.focus())}}).keyup(function(){if(r=jQuery.unique(r),r.indexOf(i.Utility.KeyCodeEnum.Altkey)!==-1&&r.indexOf(i.Utility.KeyCodeEnum.MKey)!==-1&&r.length==3){var u=i.$mars.extend(!0,[],r);u.splice(u.indexOf(i.Utility.KeyCodeEnum.Altkey),1);u.splice(u.indexOf(i.Utility.KeyCodeEnum.MKey),1);switch(u[0]){case i.Utility.KeyCodeEnum.YKey:n.openAnalyze();break;case i.Utility.KeyCodeEnum.IKey:n.onBackToCRMLink();break;case i.Utility.KeyCodeEnum.NKey:n.toggleMenuDropDown();o.disableHighlightForToolbarItem(this);t.Loader.$mars("#landingPageSidebar").focus();break;case i.Utility.KeyCodeEnum.UKey:t.Loader.$mars("#imgBuildControlMars").click();t.Loader.$mars("#imgBuildControlMars").focus();break;case i.Utility.KeyCodeEnum.LKey:t.Loader.$mars("#imgLocalizeControlMars").click();t.Loader.$mars("#imgLocalizeControlMars").focus();break;case i.Utility.KeyCodeEnum.GKey:n.openConfig();break;case i.Utility.KeyCodeEnum.QKey:n.toggleMenuDropDown();o.disableHighlightForToolbarItem(this);i.App.lPathDesignerContainer.find("#searchGrid").focus();break;case i.Utility.KeyCodeEnum.RKey:t.Loader.$mars("#imgManageControlMars").click();t.Loader.$mars("#imgManageControlMars").focus()}}r=[]})},o.prototype.onSelectToolbarItem=function(n,i){var s=t.Loader.$mars(i).attr("id"),f=t.Loader.$mars(i).find('img[class="lpath-toolbar-icons"]'),r,u,e;t.Loader.$mars(i).addClass("lpath-landing-toolbar-active");r=o.isHighContrastModeEnabled();u=r&&o.isHighContrastWhiteModeEnabled();r?u?t.Loader.$mars(i).find('img[class="lpath-toolbar-dropdown-icon"]').attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuDropdownHover_HCW):t.Loader.$mars(i).find('img[class="lpath-toolbar-dropdown-icon"]').attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuDropdownHover_HCB):t.Loader.$mars(i).find('img[class="lpath-toolbar-dropdown-icon"]').attr("src",""+t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.landingPageMenuDropdownHover);e=this.rootElement.find(".lpath-landing-toolbar-item");e.attr("tabindex",-1);t.Loader.$mars(i).attr("tabindex",0);switch(s){case"imgManageControlMars":o.setImageAttribute(f,t.Loader.marsImageMapping.ImagePath.landingPageMenuManageHover,t.Loader.marsImageMapping.ImagePath.landingPageMenuMangeHover_HCB,t.Loader.marsImageMapping.ImagePath.landingPageMenuMangeHover_HCW,r,u);break;case"imgBuildControlMars":o.setImageAttribute(f,t.Loader.marsImageMapping.ImagePath.landingPageMenuPublishHover,t.Loader.marsImageMapping.ImagePath.landingPageMenuPublishHover_HCB,t.Loader.marsImageMapping.ImagePath.landingPageMenuPublishHover_HCW,r,u);break;case"imgLocalizeControlMars":o.setImageAttribute(f,t.Loader.marsImageMapping.ImagePath.landingPageMenuLocalizationHover,t.Loader.marsImageMapping.ImagePath.landingPageMenuLocalizationHover_HCB,t.Loader.marsImageMapping.ImagePath.landingPageMenuLocalizationHover_HCW,r,u);break;case"imgAnalyzeControlMars":o.setImageAttribute(f,t.Loader.marsImageMapping.ImagePath.landingPageMenuAnalyzeHover,t.Loader.marsImageMapping.ImagePath.landingPageMenuAnalyzeHover_HCB,t.Loader.marsImageMapping.ImagePath.landingPageMenuAnalyzeHover_HCW,r,u);break;case"imgConfigurationControlMars":o.setImageAttribute(f,t.Loader.marsImageMapping.ImagePath.landingPageMenuConfigurationHover,t.Loader.marsImageMapping.ImagePath.landingPageMenuConfigurationHover_HCB,t.Loader.marsImageMapping.ImagePath.landingPageMenuConfigurationHover_HCW,r,u)}},o.prototype.openConfig=function(){this.configView=new r.ConfigurationView({collection:{},el:t.Loader.$mars("#mainContainer")});this.configView.render();var i=(new t.Loader.ConfigurationAPI).getAllConfigurations();i.done(function(t){n.Client.Utility.ConfigurationUtil.loadConfigurationData(t)})},o.prototype.openAnalyze=function(){this.analyzeView=new r.AnalyzeView({model:{},el:t.Loader.$mars("#mainContainer")});this.analyzeView.render()},o.prototype.openReports=function(){var n=t.Loader.$mars("#contentLibraryHolder"),i=t.Loader.$mars("#mainContainer");t.Loader.$mars(n).hide();i.html(r.TemplateEngine.applyTemplate("reports_publishreport",null));o.disableHighlightForToolbarItem(this)},o.prototype.downloadControlReport=function(){var n=i.App.serviceHandler.downloadControlReport();n.done(function(n){var i=encodeURI("data:text/csv;charset=utf-8,"+n),t=document.createElement("a");t.setAttribute("href",i);t.setAttribute("download","ContentControlReport.csv");t.click()});n.fail(function(n){return t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON),null})},o.prototype.HandleNavigation=function(){try{i.Util.Common.showAlertMessage(i.Locale.alertMessage,i.Locale.unSavedChangesPopupMessage,t.Loader.$mars("#mainContainer"),!0,i.Locale.yesCaption,i.Locale.no,function(){},function(){i.App.show()})}catch(n){t.Loader.marsExceptionHandler.execute(n.name,n.message)}},o.prototype.onBackToCRMLink=function(){this.removeUserIdLoggedInDateTime();t.Loader.$mars("#lPathlandingPageContainer").children().off("click",this.expandCollapseFlyOut);i.App.close()},o.prototype.crossImageKeyDownHandling=function(n){var o=t.Loader.$mars(n.currentTarget),f,r,u,e;f=o.attr("class");e=f.split(" ")[1];switch(e){case"lpath-analyzeview":u=i.App.lPathDesignerContainer.find(".lpath-analyze-menuitemslist > li.active");r=i.App.lPathDesignerContainer.find("#lpath-analyze-container-content").find("iframe");break;case"lpath-publishingconfigview":u=i.App.lPathDesignerContainer.find(".lpath-gt-config-menu-container ul li.active");r=i.App.lPathDesignerContainer.find("#lpath-gt-config-pg-cancel").length!=0?i.App.lPathDesignerContainer.find("#lpath-gt-config-pg-cancel"):i.App.lPathDesignerContainer.find('.lpath-gt-publish-checkbox-publishgroup[tabindex="0"]');break;case"lpath-securityrolesview":u=i.App.lPathDesignerContainer.find(".lpath-gt-config-menu-container ul li.active");r=i.App.lPathDesignerContainer.find("#securityRoleCancel");break;default:u=i.App.lPathDesignerContainer.find(".lpath-landing-toolbar-item[tabindex=0]");r=i.App.lPathDesignerContainer.find(".ui-pg-selbox")}n.keyCode==i.Utility.KeyCodeEnum.TabKey&&(n.shiftKey&&r.focus(),n.shiftKey||u.focus(),n.stopPropagation(),n.preventDefault())},o.prototype.checkinControls=function(){var f,e,o,u;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"LandingPageView:checkinControls START");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User selected controls and clicked checkin");try{if(f=this,f.getRows(i.Util.Constants.checkInAction),f.controlNames.length>0){for(e="<div>"+i.Locale.notEligibleCheckinControlsMessage+"<br/>",o=0;o<f.controlNames.length;o++)e+=i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(f.controlNames[o]))+"<br/>";e+="<\/div>";u=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.ControlExistPopup,i.Locale.notEligibleCheckinControls,e);u.addDefaultFocusOnOkOrClose=!0;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Selected controls for checkin were not checked out");u.ariaDescribedById=i.Util.Constants.ControlExistPopup;u.okElementFocus=this.rootElement.parent().find('div[id="imgManageControlMars"]');u.cancelElementFocus=this.rootElement.parent().find('div[id="imgManageControlMars"]');u.ariaDescribedById=i.Util.Constants.ControlExistPopup;u.show()}else f.selectedControls.length>0?(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User selected "+f.selectedControls.length+" valid controls for checkin those were checked out. "),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"The Id Controls Selected for Checkin are : "+f.selectedControls),u=new r.SimpleDialogView({},this.simpleDialogHolder,"CheckInPopUp",i.Locale.checkinAlertTitle,i.Locale.checkinAlertMessage,function(){f.checkinSelectedControls()}),u.addDoNotShowCheck=!0,u.showCancel=!0,u.addDefaultFocusOnOkOrClose=!0,u.ariaDescribedById="CheckInPopUp",u.okElementFocus=this.rootElement.parent().find('div[id="imgManageControlMars"]'),u.cancelElementFocus=this.rootElement.parent().find('div[id="imgManageControlMars"]'),u.show()):(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"No Controls Selected for check-in"),u=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.NoControlSelctedPopup,i.Locale.NoControlSelected,i.Locale.OnCheckInNoControlSelectedMessage),u.addDefaultFocusOnOkOrClose=!0,u.showClose=!0,u.ariaDescribedById=i.Util.Constants.NoControlSelctedPopup,u.okElementFocus=this.rootElement.parent().find('div[id="imgManageControlMars"]'),u.cancelElementFocus=this.rootElement.parent().find('div[id="imgManageControlMars"]'),u.show())}catch(s){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Exception in checking-in controls from LandingPageView:checkinControls");t.Loader.marsExceptionHandler.execute(s.name,s.message)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"LandingPageView:checkinControls END")},o.prototype.deleteControls=function(){var u,o,c,f,e,s,n;try{if(u=this,o=this.getGenericDialogHolder(),c=u.getRows(i.Util.Constants.deleteControlAction),this.controlNames.length>0)for(f="<div>"+i.Locale.notEligibleDeleteControlsMessage+"<br/>",e=0;e<this.controlNames.length;e++)f+=i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(this.controlNames[e]))+"<br/>",f+="<\/div>",n=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.DeleteContentPopUp,i.Locale.deleteSelectedControlsCaption,f),n.addDefaultFocusOnOkOrClose=!0,n.okElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),n.cancelElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),n.ariaDescribedById=i.Util.Constants.DeleteContentPopUp,n.show();else u.selectedControls.length>0?(s=new r.DeleteSidebarPopup(o,u.selectedControls,function(){i.App.show()},function(){}),s.deleteSidebar()):(n=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.NoControlSelctedPopup,i.Locale.NoControlSelected,i.Locale.OnDeleteNoControlSelectedMessage),n.addDefaultFocusOnOkOrClose=!0,n.showClose=!1,n.okElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),n.cancelElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),n.ariaDescribedById=i.Util.Constants.NoControlSelctedPopup,n.show())}catch(h){t.Loader.marsExceptionHandler.execute(h.name,h.message)}},o.prototype.exportControls=function(){var f,n,u;try{f=this;f.getRows(i.Util.Constants.exportControlAction);f.selectedControls.length>0?(n=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.exportLearningPath,i.Locale.exportControlPopupTitle,i.Locale.exportControlPopupMessage,function(){f.exportSelectedControls(f.selectedControls)}),n.ariaDescribedById=i.Util.Constants.exportLearningPath,n.showCancel=!0,n.okCaption=i.Locale.export,n.okElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),n.cancelElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),n.show()):(u=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.NoLearningPathSelectedPopup,i.Locale.noExportControlSelectedPopupTitle,i.Locale.noExportControlSelectedPopupMessage),u.ariaDescribedById=i.Util.Constants.NoLearningPathSelectedPopup,u.addDefaultFocusOnOkOrClose=!0,u.showClose=!1,u.okElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),u.cancelElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),u.show())}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message)}},o.prototype.getRows=function(n){var u=this.rootElement.find('tr[aria-selected="true"]'),r,s;this.selectedControls=[];this.controlNames=[];this.buildControls=0;this.publishedControls=0;this.draftControls=0;try{for(r=0;r<u.length;r++){var f=t.Loader.$mars(u.find('td[aria-describedby="marsLandingPageGrid_Id"]')[r]).text(),o=t.Loader.$mars(u.find('td[aria-describedby="marsLandingPageGrid_CheckedOut"]')[r]).text(),c=t.Loader.$mars(u.find('td[aria-describedby="marsLandingPageGrid_CheckedOutByUserId"]')[r]).text(),e=t.Loader.$mars(u.find('td[aria-describedby="marsLandingPageGrid_Status"]')[r]).text();n==i.Util.Constants.checkInAction&&(t.Loader.marsUserRole.toLowerCase()==i.Util.Constants.adminRoleName.toLowerCase()&&o.toLowerCase()=="true"&&e.toLowerCase()!==i.Util.Constants.inProgress?this.selectedControls.push(f):this.controlNames.push(u.find('td[aria-describedby="marsLandingPageGrid_ControlName"] a')[r].innerText));(n==i.Util.Constants.publishAction||n==i.Util.Constants.buildAction)&&(o.toLowerCase()==="false"&&e.toLowerCase()!==i.Util.Constants.inProgress?this.selectedControls.push(f):this.controlNames.push(u.find('td[aria-describedby="marsLandingPageGrid_ControlName"] a')[r].innerText),e.toLowerCase().replace(/ /g,"")==i.Util.Constants.locHandoff.toLowerCase()?this.buildControls++:e.toLowerCase()==i.Util.Constants.published.toLowerCase()?this.publishedControls++:e.toLowerCase()==i.Util.Constants.draft.toLowerCase()&&this.draftControls++);s=t.Designer.Util.Common.getUserIdLoggedInDateTime()[0].slice(1,-1);n==i.Util.Constants.deleteControlAction&&(o.toLowerCase()=="true"&&c==s.toLowerCase()?this.selectedControls.push(f):o.toLowerCase()=="false"?this.selectedControls.push(f):this.controlNames.push(u.find('td[aria-describedby="marsLandingPageGrid_ControlName"] a')[r].innerText));n==i.Util.Constants.exportControlAction&&t.Loader.marsUserRole.toLowerCase()==i.Util.Constants.adminRoleName.toLowerCase()&&this.selectedControls.push(f)}}catch(h){t.Loader.marsExceptionHandler.execute(h.name,h.message)}return this.selectedControls},o.prototype.getRowsForReadyToPublish=function(n){var u=this.rootElement.find('tr[aria-selected="true"]'),r,f,s,h,e;this.selectedControls=[];this.controlNames=[];try{for(r=0;r<u.length;r++)f=t.Loader.$mars(u.find('td[aria-describedby="marsLandingPageGrid_Id"]')[r]).text(),s=t.Loader.$mars(u.find('td[aria-describedby="marsLandingPageGrid_CheckedOut"]')[r]).text(),h=t.Loader.$mars(u.find('td[aria-describedby="marsLandingPageGrid_CheckedOutByUserId"]')[r]).text(),e=t.Loader.$mars(u.find('td[aria-describedby="marsLandingPageGrid_Status"]')[r]).text(),n==i.Util.Constants.publishAction&&e.toLowerCase()!==i.Util.Constants.readytoPublish?this.controlNames.push(u.find('td[aria-describedby="marsLandingPageGrid_ControlName"]')[r].title):this.selectedControls.push(f)}catch(o){t.Loader.marsExceptionHandler.execute(o.name,o.message)}return this.selectedControls},o.prototype.checkinSelectedControls=function(){var r=this,u,f;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"LandingPage:checkinSelectedControls START");u=this.getSelectedRows();f=i.App.postControlActionHandler.callPostControlActionForFurtherProcessing(this.selectedControls,i.Util.Constants.checkInAction);f.done(function(){r.landinGpageGrid.updateGridData(JSON.parse(i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_currentPageCount")),i.Util.LPathLocalStorage.getLocalStorage("LandingPageView_groupByColName"),t.Loader.appContext.getAuthoringId());r.showControlsCheckedAfterAnyOperation(r.selectedControls);for(var f=0;f<u.length;f++)i.App.trackActivity(u[f],window._MicrosoftMars.Client.Telemetry.EndAction.checkedin);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Controls Checked-in Successfully");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"LandingPage:checkinSelectedControls END via savedDataPromise.done()")})},o.prototype.exportSelectedControls=function(n){var u,r,f;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"LandingPageView : call to onExportControl to get exported data files : START");try{for(u=[],r=0;r<n.length;r++)u.push(n[r]);f=t.Loader.$mars("#lpathPublishGroupList").val();i.App.serviceHandler.getExportedControl(u,f,i.Util.Constants.Lcid)}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"LandingPageView : call to onExportControl to get exported data files : END")}},o.prototype.toggleMenuDropDown=function(){var n=this,i=t.Loader.$mars('div[name = "marsFlyOutDiv"]').not(n.newControlDropDown);i.hide();t.Loader.$mars("#lPathlandingPageContainer").on("click",function(){n.hideDropDownOnContainerClick(n.newControlDropDown)});this.newControlDropDown.slideToggle("medium")},o.prototype.expandCollapseFlyOut=function(n){var r=t.Loader.$mars('div[name="marsFlyOutDiv"]');r.is(n.target)||r.has(n.target).length!==0||(i.App.lPathDesignerContainer.find("#gridFilterDiv").find("*").off("keydown"),i.App.lPathDesignerContainer.find("#gridFilterDiv").find("*").off("click"),r.slideUp("medium"));o.disableHighlightForToolbarItem(this);n.stopPropagation()},o.prototype.hideDropDownOnContainerClick=function(n){n.slideUp("medium");t.Loader.$mars("#lPathlandingPageContainer").off("click");o.disableHighlightForToolbarItem(this)},o.prototype.slideDownDropDown=function(){this.newControlDropDown.slideDown("medium")},o.prototype.onSelectDropDownAnalyzeOption=function(n,r){var u=t.Loader.$mars(r).attr("value");u.toLowerCase()==i.Util.Constants.selectedContent.toLowerCase()?window.open("https://msit.powerbi.com/groups/me/reports/e887563b-4ef3-4f19-a7ee-1168fad54987","_blank"):u.toLowerCase()==i.Util.Constants.insightsPortal.toLowerCase()&&window.open("https://msit.powerbi.com/groups/me/dashboards/a91537c2-4b00-48ee-ac86-70a0f8d7a2ef","_blank")},o.prototype.onSelectDropDownLocalizeMenuOption=function(n,u){var a=t.Loader.$mars(u).attr("value"),s=this.rootElement.find('tr[aria-selected="true"]'),e,v,y,h,f,c,l;if(this.selectedControls=[],a.toLowerCase()===i.Util.Constants.exportControl.toLowerCase())if(s.length>0){for(o.hideAllMenuFlyOuts(),e=0;e<s.length;e++)v=t.Loader.$mars(s.find('td[aria-describedby="marsLandingPageGrid_Id"]')[e]).text(),this.selectedControls.push(v);y=[];h=i.App.serviceHandler.getExportedControlMetadataForSelectedLanguages(this.selectedControls,y);h.done(function(){});h.fail(function(){i.Util.Common.showAlertMessage(i.Locale.xmlExportFailure,i.Locale.exportfailuremessage,this.simpleDialogHolder,!1,i.Locale.okCaption,null,null,null,!1)})}else f=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.NoControlSelctedPopup,i.Locale.NoControlSelected,i.Locale.OnLocalizedExportNoControlSelectedMessage),f.addDefaultFocusOnOkOrClose=!0,f.showClose=!0,f.ariaDescribedById=i.Util.Constants.NoControlSelctedPopup,f.show(),f.okElementFocus=this.rootElement.find('div[id="imgLocalizeControlMars"]'),f.cancelElementFocus=this.rootElement.find('div[id="imgLocalizeControlMars"]'),o.hideAllMenuFlyOuts();else a.toLowerCase()===i.Util.Constants.importControl.toLowerCase()&&(o.hideAllMenuFlyOuts(),t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.localizerRoleName.toLowerCase())?(c=new r.ImportLanguageDialogView,c.focusElementOnPopupClose=this.rootElement.find('div[id="imgLocalizeControlMars"]'),l=c.createTemplateDialog(),l.done(function(){}),l.fail(function(n){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON)})):this.displayUnAuthorizedPopUp())},o.prototype.onSelectDropDownManageMenuOption=function(n,u){var c=i.App.landingPageContainer.find(u),l=c.closest("div .lpath-landing-toolbar-item").attr("id"),e,f,s,h;this.toggleDropDown(l);e=t.Loader.$mars(u).attr("value");e.toLowerCase()===i.Util.Constants.checkInAction.toLowerCase()?t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.authorRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.editorRoleName.toLowerCase())?(this.getRows(i.Util.Constants.checkInAction),this.checkinControls()):(f=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.UnAuthorizedPopup,i.Locale.UnAuthorized,i.Locale.UnAuthorizedMessage),f.addDefaultFocusOnOkOrClose=!0,f.okElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),f.cancelElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),f.ariaDescribedById=i.Util.Constants.UnAuthorizedPopup,f.show()):e.toLowerCase()===i.Util.Constants.bulkEditAction.toLowerCase()?t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.editorRoleName.toLowerCase())||(f=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.UnAuthorizedPopup,i.Locale.UnAuthorized,i.Locale.UnAuthorizedMessage),f.addDefaultFocusOnOkOrClose=!0,f.okElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),f.cancelElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),f.ariaDescribedById=i.Util.Constants.UnAuthorizedPopup,f.show()):e.toLowerCase()===i.Util.Constants.exportControlAction.toLowerCase()?this.exportControls():e.toLowerCase()===i.Util.Constants.deleteControlAction.toLowerCase()?t.Loader.marsUserRole&&t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()?this.deleteControls():(f=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.UnAuthorizedPopup,i.Locale.UnAuthorized,i.Locale.UnAuthorizedMessage),f.addDefaultFocusOnOkOrClose=!0,f.okElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),f.cancelElementFocus=this.rootElement.find('div[id="imgManageControlMars"]'),f.ariaDescribedById=i.Util.Constants.UnAuthorizedPopup,f.show()):e.toLowerCase()===i.Util.Constants.controlImport.toLowerCase()&&(o.hideAllMenuFlyOuts(),t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.localizerRoleName.toLowerCase())?(s=new r.ImportLanguageDialogView(!0),s.focusElementOnPopupClose=this.rootElement.find('div[id="imgManageControlMars"]'),h=s.createTemplateDialog(),h.fail(function(n){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON)})):this.displayUnAuthorizedPopUp())},o.prototype.onSelectDropDownPublishMenuOption=function(n,r){this.toggleMenuDropDown();o.disableHighlightForToolbarItem(n);var u=t.Loader.$mars(r).attr("value");u.toLowerCase()===i.Util.Constants.publishAction.toLowerCase()?t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.publisherRoleName.toLowerCase())?(this.getRows(i.Util.Constants.publishAction),this.onPublish()):this.displayUnAuthorizedPopUp():u.toLowerCase()===i.Util.Constants.buildAction.toLowerCase()?t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.publisherRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.authorRoleName.toLowerCase())?this.onBuild():this.displayUnAuthorizedPopUp():u.toLowerCase()===i.Util.Constants.viewReportsAction.toLowerCase()?t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.publisherRoleName.toLowerCase())?this.openReports():this.displayUnAuthorizedPopUp():u.toLowerCase()===i.Util.Constants.viewControlReport.toLowerCase()&&(t.Loader.marsUserRole&&(t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.adminRoleName.toLowerCase()||t.Loader.marsUserRole.toLowerCase()===i.Util.Constants.publisherRoleName.toLowerCase())?this.downloadControlReport():this.displayUnAuthorizedPopUp())},o.prototype.toggleDropDown=function(n){var i;n==="imgManageControlMars"?(i=this.rootElement.find('div[id = "imgManageControlMars"]'),this.dropDown=this.rootElement.find('div[id="dropDownMenuOnManageControlMars"]')):n==="imgBuildControlMars"?(i=this.rootElement.find('div[id = "imgBuildControlMars"]'),this.dropDown=this.rootElement.find('div[id="dropDownMenuOnPublishControlMars"]')):n==="imgLocalizeControlMars"&&(i=this.rootElement.find('div[id = "imgLocalizeControlMars"]'),this.dropDown=this.rootElement.find('div[id="dropDownMenuOnLocalizeControlMars"]'));var u=i.offset(),e=i.outerWidth(),s=i.outerHeight(),r=this,f;this.dropDown.css({left:u.left,width:e,top:s+u.top});f=t.Loader.$mars('div[name = "marsFlyOutDiv"]').not(r.dropDown);f.hide();t.Loader.$mars("#lPathlandingPageContainer").on("click",function(){r.hideDropDownOnContainerClick(r.dropDown)});this.dropDown.slideToggle("medium");o.disableHighlightForToolbarItem(this)},o.prototype.toggleDropdownonEnter=function(n,r){var c=i.App.landingPageContainer.find(r),s=this.rootElement.find(n.target),h=this.rootElement.find(".lpath-landing-toolbar-item"),e=c.closest("div .lpath-landing-toolbar-item").attr("id"),f,u;e==="imgManageControlMars"?this.dropDown=this.rootElement.find('div[id="dropDownMenuOnManageControlMars"]'):e==="imgBuildControlMars"?this.dropDown=this.rootElement.find('div[id="dropDownMenuOnPublishControlMars"]'):e==="imgLocalizeControlMars"?this.dropDown=this.rootElement.find('div[id="dropDownMenuOnLocalizeControlMars"]'):e===undefined&&(this.dropDown=c.closest("div .lpath-landing-toolbar-item"));f=this.dropDown.find("li");switch(n.keyCode){case i.Utility.KeyCodeEnum.EnterKey:if(f.is(":visible")){for(u=0;u<f.length;u++)if(f[u].selected)if(e==="imgManageControlMars")this.onSelectDropDownManageMenuOption(n,f[u]);else if(e==="imgBuildControlMars")this.onSelectDropDownPublishMenuOption(n,f[u]);else if(e==="imgLocalizeControlMars")this.onSelectDropDownLocalizeMenuOption(n,f[u]);this.dropDown.slideUp("medium")}else{this.toggleDropDown(e);this.onSelectToolbarItem(n,r);for(u=0;u<f.length;u++)f[u].selected&&(f[u].selected=!1,f[u].style.backgroundColor=this.dropdownElementNotSelectedBackground)}break;case i.Utility.KeyCodeEnum.UpArrowKey:f.is(":visible")?this.toggleUpDown(n.keyCode,f):(h.attr("tabindex",-1),s.prev(".lpath-landing-toolbar-item").length>0?s.prev(".lpath-landing-toolbar-item").focus():h.last().focus());break;case i.Utility.KeyCodeEnum.DownArrowKey:f.is(":visible")?this.toggleUpDown(n.keyCode,f):(h.attr("tabindex",-1),s.next(".lpath-landing-toolbar-item").focus());break;case i.Utility.KeyCodeEnum.RightArrowKey:f.is(":visible")||(h.attr("tabindex",-1),s.next(".lpath-landing-toolbar-item").focus());break;case i.Utility.KeyCodeEnum.LeftArrowKey:f.is(":visible")||(h.attr("tabindex",-1),s.prev(".lpath-landing-toolbar-item").length>0?s.prev(".lpath-landing-toolbar-item").focus():h.last().focus());break;case i.Utility.KeyCodeEnum.ShiftKey:if(n.keyCode==t.Utility.KeyCodeEnum.TabKey)for(this.dropDown.slideUp("medium"),u=0;u<f.length;u++)f[u].selected=!1,f[u].style.backgroundColor=this.dropdownElementNotSelectedBackground;break;case i.Utility.KeyCodeEnum.TabKey:if(this.dropDown.slideUp("medium"),n.shiftKey){for(u=0;u<f.length;u++)f[u].selected=!1,f[u].style.backgroundColor=this.dropdownElementNotSelectedBackground;o.disableHighlightForToolbarItem(this);t.Loader.$mars('input[id="backToCRMLink"]').focus()}else{for(u=0;u<f.length;u++)f[u].selected=!1,f[u].style.backgroundColor=this.dropdownElementNotSelectedBackground;o.disableHighlightForToolbarItem(this);t.Loader.$mars("#lpathPublishGroupList").focus()}n.preventDefault();n.stopPropagation();s.closest(".lpath-landing-toolbar-item").attr("tabindex",0);break;case i.Utility.KeyCodeEnum.EscapeKey:this.dropDown.is(":visible")&&this.dropDown.slideUp("medium");c.focus();n.preventDefault();n.stopPropagation();o.disableHighlightForToolbarItem(this)}},o.prototype.toggleUpDown=function(n,t){var u=!1,r,f;if(i.$mars("#checkHighContrastDiv").css("background-image")==="none"&&(u=!0),n==38){if(t.is(":visible")){for(f=0;f<t.length;f++)if(t[f].selected){r=f;break}r!==undefined?r===0?(t[r].selected=!1,t[r].style.backgroundColor=this.dropdownElementNotSelectedBackground,u&&i.$mars(t[r]).hasClass("lpath-landingpage-menu-border")&&i.$mars(t[r]).removeClass("lpath-landingpage-menu-border"),t[t.length-1].selected=!0,t[t.length-1].focus(),t[t.length-1].style.backgroundColor=this.dropdownElementSelectedBackground,u&&(i.$mars(t[t.length-1]).hasClass("lpath-landingpage-menu-border")||i.$mars(t[t.length-1]).addClass("lpath-landingpage-menu-border"))):(t[r].selected=!1,t[r].style.backgroundColor=this.dropdownElementNotSelectedBackground,u&&i.$mars(t[r]).hasClass("lpath-landingpage-menu-border")&&i.$mars(t[r]).removeClass("lpath-landingpage-menu-border"),t[r-1].selected=!0,t[r-1].focus(),t[r-1].style.backgroundColor=this.dropdownElementSelectedBackground,u&&(i.$mars(t[r-1]).hasClass("lpath-landingpage-menu-border")||i.$mars(t[r-1]).addClass("lpath-landingpage-menu-border"))):(t[t.length-1].selected=!0,t[t.length-1].focus(),t[t.length-1].style.backgroundColor=this.dropdownElementSelectedBackground,u&&(i.$mars(t[t.length-1]).hasClass("lpath-landingpage-menu-border")||i.$mars(t[t.length-1]).addClass("lpath-landingpage-menu-border")))}}else if((n=40)&&t.is(":visible")){for(f=0;f<t.length;f++)if(t[f].selected){r=f;break}r!==undefined?r===t.length-1?(t[r].selected=!1,t[r].style.backgroundColor=this.dropdownElementNotSelectedBackground,u&&i.$mars(t[r]).hasClass("lpath-landingpage-menu-border")&&i.$mars(t[r]).removeClass("lpath-landingpage-menu-border"),t[0].selected=!0,t[0].focus(),t[0].style.backgroundColor=this.dropdownElementSelectedBackground,u&&(i.$mars(t[0]).hasClass("lpath-landingpage-menu-border")||i.$mars(t[0]).addClass("lpath-landingpage-menu-border"))):(t[r].selected=!1,t[r].style.backgroundColor=this.dropdownElementNotSelectedBackground,u&&i.$mars(t[r]).hasClass("lpath-landingpage-menu-border")&&i.$mars(t[r]).removeClass("lpath-landingpage-menu-border"),t[r+1].selected=!0,t[r+1].focus(),t[r+1].style.backgroundColor=this.dropdownElementSelectedBackground,u&&(i.$mars(t[r+1]).hasClass("lpath-landingpage-menu-border")||i.$mars(t[r+1]).addClass("lpath-landingpage-menu-border"))):(t[0].selected=!0,t[0].focus(),t[0].style.backgroundColor=this.dropdownElementSelectedBackground,u&&(i.$mars(t[0]).hasClass("lpath-landingpage-menu-border")||i.$mars(t[0]).addClass("lpath-landingpage-menu-border")))}},o.prototype.removeUserIdLoggedInDateTime=function(){i.Util.LPathLocalStorage.checkKeyExist("userIdLastLoginTime")&&i.Util.LPathLocalStorage.remove("userIdLastLoginTime")},o.prototype.getSelectedRows=function(n,u){var f,l,e,o,p;if(this.selectedControls=[],this.controlNames=[],f=this.rootElement.find('tr[aria-selected="true"]'),l=[],f.length>0)for(e=0;e<f.length;e++){var s=t.Loader.$mars(f.find('td[aria-describedby="marsLandingPageGrid_CheckedOut"]')[e]).text(),w=t.Loader.$mars(f.find('td[aria-describedby="marsLandingPageGrid_CheckedOutByUserId"]')[e]).text(),a=t.Loader.$mars(f.find('td[aria-describedby="marsLandingPageGrid_Id"]')[e]).text(),v=t.Loader.$mars(f.find('td[aria-describedby="marsLandingPageGrid_Enabled"]')[e]).text(),h=f.find('td[aria-describedby="marsLandingPageGrid_ControlName"] a')[e].innerText,b=t.Loader.$mars(f.find('td[aria-describedby="marsLandingPageGrid_ControlType"] button')[e])[0].getAttribute("alt"),k=f.find('td[aria-describedby="marsLandingPageGrid_AppVersion"]')[e].title,c=t.Loader.$mars(f.find('td[aria-describedby="marsLandingPageGrid_FormFactor"]')[e]).find("button"),y="";for(o=0;o<c.length;o++)y+=(c[o].getAttribute("alt")?c[o].getAttribute("alt"):c[o].getAttribute("title"))+"\n";if(n&&v.toLowerCase()!==i.Util.Constants.enabled.toLowerCase())break;v.toLowerCase()!==i.Util.Constants.inProgress?u?s.toLowerCase()=="false"||this.isCheckedOutByCurrentUser(r.LandingPageGrid.userId,w,s)?this.selectedControls.push(a):this.controlNames.push(h):s.toLowerCase()=="false"||t.Loader.marsUserRole.toLowerCase()==i.Util.Constants.adminRoleName.toLowerCase()&&s.toLowerCase()=="true"?this.selectedControls.push(a):this.controlNames.push(h):this.controlNames.push(h);p={ControlId:a,ControlName:h,ControlType:b=="Sidebar"?i.Utility.ControlTypes.Sidebar:i.Utility.ControlTypes.GuidedTask,AppVersion:k,FormFactor:y};l.push(p)}return l},o.prototype.isCheckedOutByCurrentUser=function(n,t,i){return n.substring(1,n.length-1).toLowerCase()==t.toLowerCase()&&i.toLowerCase()=="true"},o.prototype.onPublish=function(){var u,f,e,n;try{if(t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"LandingPageView:onPublish START"),t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"LandingPageView:onPublish START"),u=this,u.controlNames.length>0){for(f="<div>"+i.Locale.notEligiblePublishControlsMessage+"<br/>",e=0;e<this.controlNames.length;e++)f+=i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(u.controlNames[e]))+"<br/>";f+="<\/div>";n=new r.SimpleDialogView({},u.simpleDialogHolder,i.Util.Constants.ControlExistPopup,i.Locale.notEligiblePublishControls,f);n.addDefaultFocusOnOkOrClose=!0;n.okElementFocus=this.rootElement.find('div[id="imgBuildControlMars"]');n.cancelElementFocus=this.rootElement.find('div[id="imgBuildControlMars"]');n.ariaDescribedById=i.Util.Constants.ControlExistPopup;n.show();t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.WARNING,"Selected contents are not eligible for publish. Message : "+f)}else if(u.selectedControls.length>0){var h=this.getSelectedRows(!1,!1),c=this.getGenericDialogHolder(),o=new r.PublishPopup(c,h);o.publishControls();o.setFocusOnPopupLoad()}else n=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.NoControlSelctedPopup,i.Locale.NoControlSelected,i.Locale.NoControlSelectedMessage),n.addDefaultFocusOnOkOrClose=!0,n.okElementFocus=u.rootElement.find('div[id="imgBuildControlMars"]'),n.cancelElementFocus=this.rootElement.find('div[id="imgBuildControlMars"]'),n.ariaDescribedById=i.Util.Constants.NoControlSelctedPopup,n.show()}catch(s){t.Loader.marsExceptionHandler.execute(s.name,s.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"LandingPageView:onPublish Exception occurred while publishing controls.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"LandingPageView:onPublish END")},o.prototype.onBuild=function(){var u,f,n;try{if(this.controlNames.length>0){for(u="<div>"+i.Locale.notEligibleBuildControlsMessage+"<br/>",f=0;f<this.controlNames.length;f++)u+=i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(this.controlNames[f]))+"<br/>";u+="<\/div>";n=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.ControlExistPopup,i.Locale.notEligiblebuildControls,u);n.okElementFocus=this.rootElement.find('div[id="imgBuildControlMars"]');n.cancelElementFocus=this.rootElement.find('div[id="imgBuildControlMars"]');n.addDefaultFocusOnOkOrClose=!0;n.ariaDescribedById=i.Util.Constants.ControlExistPopup;n.show()}else{if(this.selectedControls.length>0)return i.App.postControlActionHandler.callPostControlAction(this.selectedControls,i.Locale.buildCaption,null,this.exportControlLanguages,this);n=new r.SimpleDialogView({},this.simpleDialogHolder,i.Util.Constants.NoControlSelctedPopup,i.Locale.NoControlSelected,i.Locale.NoControlSelectedMessage);n.okElementFocus=this.rootElement.find('div[id="imgBuildControlMars"]');n.cancelElementFocus=this.rootElement.find('div[id="imgBuildControlMars"]');n.addDefaultFocusOnOkOrClose=!0;n.ariaDescribedById=i.Util.Constants.NoControlSelctedPopup;n.show()}}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message)}},o.prototype.updateSelectedLanguages=function(){var i=this;i.selectedLanguages=[];i.selectedLanguageIds=[];var n=this.rootElement.find('input[id="mars-simple-btnOk_ExportSelectLanguagePopUp"]'),r=this.rootElement.find('input[id="mars-simple-btnCancel_ExportSelectLanguagePopUp"]'),u=t.Loader.$mars('input[name="lPathMultiSelectElementForLanguage"]');t.Loader.$mars.each(u,function(n,t){t.checked==!0&&(i.selectedLanguages.push(t.value),i.selectedLanguageIds.push(t.getAttribute("data-LanguageId")))});i.selectedLanguages.length<1?(n.prop("disabled",!0),n.addClass("mars-btn-disable"),n.attr("tabindex","-1"),r.focus()):(n.prop("disabled",!1),n.hasClass("mars-btn-disable")&&(n.removeClass("mars-btn-disable"),n.attr("tabindex","0"),n.focus()))},o.prototype.updateSelectedControls=function(){var i=this.rootElement.find('tr[aria-selected="true"]'),n;if(i.length>0){for(this.selectedControlsDTO=new f,this.selectedControlsDTO.ControlIds=[],n=0;n<i.length;n++)this.selectedControlsDTO.ControlIds.push(t.Loader.$mars(i.find('td[aria-describedby="marsLandingPageGrid_Id"]')[n]).text());this.selectedControlsDTO.DraftPublishGroupId=t.Loader.appContext.getDraftPublishGroupId()}},o.prototype.onSidebarClick=function(){i.App.openControl(i.Util.Constants.EmptyGuid,i.Utility.ControlTypes.Sidebar);i.App.CancelCaller=this},o.prototype.onGuidedTaskClick=function(){i.App.openControl(i.Util.Constants.EmptyGuid,i.Utility.ControlTypes.GuidedTask);i.App.CancelCaller=this},o.prototype.showControlsCheckedAfterAnyOperation=function(n){for(var r,i=0;i<n.length;i++)this.rootElement.find("#"+n[i]).attr("aria-selected","true"),r=t.Loader.$mars("#jqg_marsLandingPageGrid_"+n[i]),r.prop("checked",!0)},o.prototype.displayXliffFileList=function(){var u=this,n=new r.SimpleDialogView({},t.Loader.$mars("#mars-DownloadControlLanguagesPopUpHolder"),"DownloadControlLanguagesPopUp",i.Locale.importDialogShowlanguagesTitleMessage,i.Locale.checkinAlerttMessage,function(){u.downloadExportedControlsXliffs(u.controlsContentList)}),f,e;n.showCancel=!0;n.addDefaultFocusOnOkOrClose=!0;f=t.Loader.$mars('<div class="mars-placeholder"  id="mars-ExportedLanguageContainer" style="width:100%;"/>');e=new r.ExportedImportedControlsDialogView(f);n.alertHtmlContent=e.getExportLanguageTable(u.selectedLanguages,u.controlsContentList);n.ariaDescribedById="DownloadControlLanguagesPopUp";n.show()},o.prototype.downloadExportedControlsXliffs=function(n){var f,u,r;for(n===void 0&&(n=[]),f=[],u=0;u<this.selectedLanguageIds.length;u++)for(r=0;r<n.length;r++)n[r].Lcid==this.selectedLanguageIds[u]&&f.push(n[r]);var o=JSON.stringify(f),e="DownloadedXliffFiles.zip",s="Export";jQuery.when(window.marsLoader.getMarsAuthToken()).then(function(n){var r=new XMLHttpRequest,u=i.App.serviceHandler.downloadControlsXliffs(s,{});r.open("post",u,!0);r.setRequestHeader("Authorization","Bearer "+n);r.responseType="blob";r.setRequestHeader("Content-type","application/json");r.onload=function(){var i=r.response,u=URL.createObjectURL(i),n;typeof window.navigator.msSaveBlob!="undefined"?window.navigator.msSaveBlob(i,e):(n=document.createElement("a"),typeof n.getAttribute("download")=="undefined"?t.Loader.$mars.window.location=u:(n.href=u,n.setAttribute("download",e),document.body.appendChild(n),n.click()))};r.send(o)})},o.prototype.onLastTabIndex=function(){this.rootElement.find("#backToCRMLink").focus()},o.prototype.exportControlLanguages=function(n){var s=i.App.serviceHandler.GetExportedControlMetadata(n.selectedControlsDTO),f=n,e=n.LanguageNames,o=n.LanguageIds;s.done(function(n){var s,h,c;e=[];f.controlsContentList=[];t.Loader.$mars.each(n.Result,function(n,i){var r=new u;r.ControlId=i.ControlId;r.ControlName=i.ControlName;r.LanguageName=i.LanguageName;r.Lcid=i.Lcid;r.Version=i.Version;f.controlsContentList.push(r);t.Loader.$mars.inArray(i.LanguageName,e)===-1&&e.push(i.LanguageName);t.Loader.$mars.inArray(i.Lcid,o)===-1&&o.push(i.Lcid)});s=new r.SimpleDialogView({},t.Loader.$mars("#mars-simpleDialogHolder"),"ExportSelectLanguagePopUp",i.Locale.exportDialogTitleMessage,"",function(){f.displayXliffFileList()});s.okCaption=i.Locale.nextValue;s.showCancel=!0;s.addDefaultFocusOnOkOrClose=!0;h=t.Loader.$mars('<div class="mars-placeholder"  id="lpath-multiSelectListContainerDiv" style="width:100%;"/>');c=new r.ExportSelectLanguageDialogView({},h,e,o);s.alertHtmlContent=c.getHtml();s.show();f.rootElement.find('input[id="mars-simple-btnOk_ExportSelectLanguagePopUp"]').prop("disabled",!0);f.rootElement.find('input[id="mars-simple-btnOk_ExportSelectLanguagePopUp"]').addClass("mars-btn-disable");f.subscribe('input[name="lPathMultiSelectElementForLanguage"]',"change",f.updateSelectedLanguages);f.rootElement.find('input[id="mars-simple-btnOk_ExportSelectLanguagePopUp"]').attr("tabindex","-1");f.rootElement.find("#mars-simple-btnCancel_ExportSelectLanguagePopUp").focus()});s.fail(function(n){t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON)})},o}(r.View),u,f;r.LandingPageView=e;u=function(){function t(){this.ControlId="";this.Version="";this.ControlName="";this.LanguageName="";this.Lcid=n.Client.Loader.defaultLanguageLcid}return t}();r.controlModelForLanguageExport=u;f=function(){function n(){this.ControlIds=[];this.DraftPublishGroupId=""}return n}();r.controlModelForExport=f})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(i){function r(t,r,u,f,e){i.call(this,f);this.parentControlId=t;this.content=u;this.rootElement=f;this.innerControlUpdateCallback=e;this.build();this.sectionIndex=r;this.ControlTypes=n.Utility.ControlTypes}return __extends(r,i),r.prototype.getTemplate=function(){return n.Util.Constants.legacyHelpTemplate},r.prototype.subscribe=function(n,t,i,r,u){var e,f;r===void 0&&(r=!0);e=this;this.eventSources.push(n);f=this.rootElement;u&&(f=u);f.find(n).off(t).on(t,function(n){return(i.call(e,n,this),r)?!1:!0})},r.prototype.unsubscribe=function(){for(var n=0;n<this.eventSources.length;n++)this.rootElement.find(this.eventSources[n]).off();this.eventSources=[]},r.prototype.build=function(){var i=this,r,u;this.rootElement.empty();this.containerId=this.rootElement.attr("id");this.rootElement.html(t.TemplateEngine.applyTemplate(this.getTemplate(),this.content,!0));r=this.rootElement.find('input[id="lPathSectionTextTemplateTitle"]');r.attr("id",this.containerId+"_"+r.attr("id"));r.on("change",function(){i.content.Title=n.$mars(this).val();i.innerControlUpdateCallback(i.content,!1,i.sectionIndex);i.reload(!1,!0)});u=this.rootElement.find('input[name="lpathlegacyHelpLinkText"]');u&&(u.attr("name",this.containerId+"_"+u.attr("name")),this.subscribe(u,"change",function(n,t){i.updateLinkText(n,t)}));r.focus()},r.prototype.reload=function(n,t){t===void 0&&(t=!1);t||(this.unsubscribe(),this.build());this.innerControlUpdateCallback(this.content,!1,this.sectionIndex)},r.prototype.updateLinkText=function(n,t){var i=this.rootElement.find(t);i&&i.length>0&&(this.content.LinkText=i.val(),this.reload(!1,!0))},r}(t.ControlView);t.LegacyHelpView=i})(t=n.Renderer||(n.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(){function u(n,t,i,r,u,f,e,o,s,h,c){this.parentControlId=o;this.onOkClickCallback=s;this.onCancelClickCallback=h;this.extraFilters=c;this.selectedControls=[];this.status="5";this.enabled="true";this.eventSources=[];this.equalFilterExpression=6;this.notEqualFilterExpression=7;this.rootElement=r;this.controlType=i;this.headerTitle=n;this.headerText=t;this.boolMultiSelect=u;this.pageNumber=f;this.pageSize=e;this.initializeMiniGrid();this.prepareMiniGrid()}return u.prototype.initializeMiniGrid=function(){u.dataSource={MiniGridData:[],total:"",records:"",pageNo:""};this.gridWidth=507;this.gridHieght=192},u.prototype.paginateGrid=function(n){if(!t.Loader.$mars("#"+n).hasClass("ui-state-disabled"))switch(n){case"prev_lPathMiniGridPager":this.pageNumber--;this.createCriteriaAndBuildGrid(this.pageNumber,this.pageSize,this.searchText);break;case"next_lPathMiniGridPager":this.pageNumber++;this.createCriteriaAndBuildGrid(this.pageNumber,this.pageSize,this.searchText);break;case"first_lPathMiniGridPager":this.pageNumber=1;this.createCriteriaAndBuildGrid(this.pageNumber,this.pageSize,this.searchText);break;case"last_lPathMiniGridPager":this.pageNumber=u.dataSource.total;this.createCriteriaAndBuildGrid(this.pageNumber,this.pageSize,this.searchText);break;case"user":this.pageNumber=this.rootElement.find(".ui-pg-input").val();var i=!isNaN(this.pageNumber);i&&(this.pageNumber<=1?this.pageNumber=1:this.pageNumber>u.dataSource.total&&(this.pageNumber=u.dataSource.total),this.createCriteriaAndBuildGrid(this.pageNumber,this.pageSize,this.searchText),u.dataSource.pageNo=this.rootElement.find(".ui-pg-input").val())}},u.prototype.onDone=function(){var n=this.rootElement.find('tr[aria-selected="true"]'),u,f,e;if((!n||n.length==0)&&this.controlType==i.Utility.ControlTypes.Sidebar.toString()){u=new r.SimpleDialogView({},this.rootElement,"sidebarnavigation",i.Locale.alertNoSidebarSelected,i.Locale.errorMsgSidebarSelected,function(){},function(){});u.addDoNotShowCheck=!1;u.showCancel=!1;u.okElementFocus=this.rootElement.find('button[id="lPathMiniGridDone"]');u.cancelElementFocus=this.rootElement.find('button[id="lPathMiniGridDone"]');u.ariaDescribedById="sidebarnavigation";u.show();return}for(f=0;f<n.length;f++)e={controlId:t.Loader.$mars(n.find('td[aria-describedby="lPathMiniGridDataTable_Id"]')[f]).text(),controlVersionId:t.Loader.$mars(n.find('td[aria-describedby="lPathMiniGridDataTable_VersionId"]')[f]).text(),controlName:t.Loader.$mars(n.find('td[aria-describedby="lPathMiniGridDataTable_ControlName"]')[f]).text(),title:t.Loader.$mars(n.find('td[aria-describedby="lPathMiniGridDataTable_Title"]')[f]).text()},this.selectedControls.push(e);this.closeGrid();this.onOkClickCallback(this.selectedControls)},u.prototype.onKeyDownOfDone=function(t){t.shiftKey&&t.keyCode==i.Utility.KeyCodeEnum.TabKey?this.gridPager.find("#last_lPathMiniGridPager").hasClass("ui-state-disabled")?this.gridPager.find("input[class='ui-pg-input']").focus():this.gridPager.find("#last_lPathMiniGridPager").focus():t.keyCode==i.Utility.KeyCodeEnum.TabKey?this.rootElement.find('button[id="lPathMiniGridCancel"]').focus():n.Client.Loader.appContext.Util.isEnterPressed(t,!0)&&this.onDone()},u.prototype.onKeyDownOfCancel=function(t){t.shiftKey&&t.keyCode==i.Utility.KeyCodeEnum.TabKey?this.rootElement.find('button[id="lPathMiniGridDone"]').focus():t.keyCode==i.Utility.KeyCodeEnum.TabKey?this.rootElement.find('button[id="lPathMiniGridCross"]').focus():n.Client.Loader.appContext.Util.isEnterPressed(t,!0)&&this.onCancel()},u.prototype.setFocusOnSearch=function(){this.rootElement.find('input[id="lPathMiniGridSearchText"]').focus()},u.prototype.onKeyDownOfCross=function(t){t.shiftKey&&t.keyCode==i.Utility.KeyCodeEnum.TabKey?this.rootElement.find('button[id="lPathMiniGridCancel"]').focus():t.keyCode==i.Utility.KeyCodeEnum.TabKey?this.rootElement.find('input[id="lPathMiniGridSearchText"]').focus():n.Client.Loader.appContext.Util.isEnterPressed(t,!0)&&this.onCancel()},u.prototype.handleKeyDownEventInPagination=function(t,i){n.Client.Loader.appContext.Util.isEnterPressed(t,!0)&&this.paginateGrid(i)},u.prototype.handleKeyDownEventForPageNumber=function(n){n.shiftKey&&n.keyCode==i.Utility.KeyCodeEnum.TabKey&&this.rootElement.find("table[id='lPathMiniGridDataTable'] tr").length==1?(this.rootElement.find('input[id="lPathMiniGridSearchText"]').focus(),n.preventDefault(),n.stopPropagation()):!n.shiftKey&&n.keyCode==t.Utility.KeyCodeEnum.TabKey&&this.gridPager.find("#next_lPathMiniGridPager").hasClass("ui-state-disabled")&&(this.rootElement.find('button[id="lPathMiniGridDone"]').focus(),n.preventDefault(),n.stopPropagation())},u.prototype.closeOnEsc=function(n,t){n.keyCode==i.Utility.KeyCodeEnum.EscapeKey&&t.onCancel()},u.prototype.addTabEventsToPagination=function(){var i=this;this.gridPager.find("#prev_lPathMiniGridPager").off("keydown").keydown(function(n){i.handleKeyDownEventInPagination(n,"prev_lPathMiniGridPager")});this.gridPager.find("#next_lPathMiniGridPager").off("keydown").keydown(function(n){i.handleKeyDownEventInPagination(n,"next_lPathMiniGridPager")});this.gridPager.find("#first_lPathMiniGridPager").off("keydown").keydown(function(n){i.handleKeyDownEventInPagination(n,"first_lPathMiniGridPager")});this.gridPager.find("#last_lPathMiniGridPager").off("keydown").keydown(function(n){i.handleKeyDownEventInPagination(n,"last_lPathMiniGridPager");n.keyCode!==t.Utility.KeyCodeEnum.TabKey||n.shiftKey||(i.rootElement.find('button[id="lPathMiniGridDone"]').focus(),n.preventDefault(),n.stopPropagation())});this.gridPager.find("input[class='ui-pg-input']").off("keydown").keydown(function(n){i.handleKeyDownEventForPageNumber(n)});this.gridPager.find("#prev_lPathMiniGridPager").attr("title",n.Client.Loader.marsLocale.previousPage);this.gridPager.find("#next_lPathMiniGridPager").attr("title",n.Client.Loader.marsLocale.nextPage);this.gridPager.find("#first_lPathMiniGridPager").attr("title",n.Client.Loader.marsLocale.firstPage);this.gridPager.find("#last_lPathMiniGridPager").attr("title",n.Client.Loader.marsLocale.lastPage)},u.prototype.modifyTabbingSettingsOfPagination=function(){u.dataSource.total==0?(this.gridPager.find("#prev_lPathMiniGridPager").attr("tabindex","-1"),this.gridPager.find("#next_lPathMiniGridPager").attr("tabindex","-1"),this.gridPager.find("#first_lPathMiniGridPager").attr("tabindex","-1"),this.gridPager.find("#last_lPathMiniGridPager").attr("tabindex","-1"),this.gridPager.find("#next_lPathMiniGridPager").hasClass("ui-state-disabled")&&this.gridPager.find("#last_lPathMiniGridPager").hasClass("ui-state-disabled")||(this.gridPager.find("#next_lPathMiniGridPager").addClass("ui-state-disabled"),this.gridPager.find("#last_lPathMiniGridPager").addClass("ui-state-disabled"))):this.pageNumber=="1"&&this.pageNumber==u.dataSource.total?(this.gridPager.find("#prev_lPathMiniGridPager").attr("tabindex","-1"),this.gridPager.find("#next_lPathMiniGridPager").attr("tabindex","-1"),this.gridPager.find("#first_lPathMiniGridPager").attr("tabindex","-1"),this.gridPager.find("#last_lPathMiniGridPager").attr("tabindex","-1")):this.pageNumber=="1"&&this.pageNumber!==u.dataSource.total?(this.gridPager.find("#prev_lPathMiniGridPager").attr("tabindex","-1"),this.gridPager.find("#next_lPathMiniGridPager").attr("tabindex","0"),this.gridPager.find("#first_lPathMiniGridPager").attr("tabindex","-1"),this.gridPager.find("#last_lPathMiniGridPager").attr("tabindex","0")):this.pageNumber==u.dataSource.total?(this.gridPager.find("#prev_lPathMiniGridPager").attr("tabindex","0"),this.gridPager.find("#next_lPathMiniGridPager").attr("tabindex","-1"),this.gridPager.find("#first_lPathMiniGridPager").attr("tabindex","0"),this.gridPager.find("#last_lPathMiniGridPager").attr("tabindex","-1")):(this.gridPager.find("#prev_lPathMiniGridPager").attr("tabindex","0"),this.gridPager.find("#next_lPathMiniGridPager").attr("tabindex","0"),this.gridPager.find("#first_lPathMiniGridPager").attr("tabindex","0"),this.gridPager.find("#last_lPathMiniGridPager").attr("tabindex","0"))},u.prototype.onCancel=function(){this.closeGrid();this.onCancelClickCallback()},u.prototype.checkForDisabledButtons=function(){i.$mars(document.activeElement).attr("id")!=="lPathMiniGridSearchText"&&(this.gridPager.find("#prev_lPathMiniGridPager").hasClass("ui-state-disabled")||this.gridPager.find("#next_lPathMiniGridPager").hasClass("ui-state-disabled")||this.gridPager.find("#last_lPathMiniGridPager").hasClass("ui-state-disabled")||this.gridPager.find("#first_lPathMiniGridPager").hasClass("ui-state-disabled"))&&this.gridPager.find("input[class='ui-pg-input']").focus()},u.prototype.handleKeyDownForGridRecords=function(){var r=this;this.gridTable.find('tr[class="jqgfirstrow"]').next().attr("tabindex",0);i.$mars("#lPathMiniGridDataTable tr").not(":first").off("keydown").on("keydown",function(i){var u=r.gridTable.find(i.target).closest("tr"),f=u.prev(),e=u.next();if(n.Client.Loader.appContext.Util.isEnterPressed(i,!0))this.click();else if(i.keyCode!=t.Utility.KeyCodeEnum.UpArrowKey||f.hasClass("jqgfirstrow")){if(i.keyCode==t.Utility.KeyCodeEnum.DownArrowKey)return u.attr("tabindex",-1),e.focus(),i.preventDefault(),!1;i.keyCode==t.Utility.KeyCodeEnum.TabKey&&u.attr("tabindex",0)}else return u.attr("tabindex",-1),f.focus(),i.preventDefault(),!1})},u.prototype.closeGrid=function(){this.unsubscribe();this.gridWrapper.remove()},u.prototype.updateAriaLabelForDialogElements=function(){var n;n=this.controlType===i.Utility.ControlTypes.Sidebar.toString()?i.Locale.miniGridClose+i.Locale.sidebarsString:i.Locale.miniGridClose+i.Locale.guidedTasksString;i.App.lPathDesignerContainer.find("#miniGridCrossImgAriaDesc").html(n)},u.prototype.updateAriaLabelForGridElements=function(){var n=i.Locale.miniGridFirstPage,t=i.Locale.miniGridLastPage,r=i.Locale.miniGridPrevPage,u=i.Locale.miniGridNextPage;this.controlType==i.Utility.ControlTypes.Sidebar.toString()?(n=n+i.Locale.sidebarsString,t=t+i.Locale.sidebarsString,r=r+i.Locale.sidebarsString,u=u+i.Locale.sidebarsString):(n=n+i.Locale.guidedTasksString,t=t+i.Locale.guidedTasksString,r=r+i.Locale.guidedTasksString,u=u+i.Locale.guidedTasksString);i.App.lPathDesignerContainer.find("#first_lPathMiniGridPager").attr("role","button");i.App.lPathDesignerContainer.find("#first_lPathMiniGridPager").attr("aria-label",i.Locale.firstPage);i.App.lPathDesignerContainer.find("#first_lPathMiniGridPager").attr("aria-describedby","firstPage");i.App.lPathDesignerContainer.find("#prev_lPathMiniGridPager").attr("role","button");i.App.lPathDesignerContainer.find("#prev_lPathMiniGridPager").attr("aria-label",i.Locale.previousPage);i.App.lPathDesignerContainer.find("#prev_lPathMiniGridPager").attr("aria-describedby","previousPage");i.App.lPathDesignerContainer.find("#next_lPathMiniGridPager").attr("role","button");i.App.lPathDesignerContainer.find("#next_lPathMiniGridPager").attr("aria-label",i.Locale.nextPage);i.App.lPathDesignerContainer.find("#next_lPathMiniGridPager").attr("aria-describedby","nextPage");i.App.lPathDesignerContainer.find("#last_lPathMiniGridPager").attr("role","button");i.App.lPathDesignerContainer.find("#last_lPathMiniGridPager").attr("aria-label",i.Locale.lastPage);i.App.lPathDesignerContainer.find("#last_lPathMiniGridPager").attr("aria-describedby","lastPage")},u.prototype.updateControlNameToAriaLabel=function(){var n=i.App.lPathDesignerContainer.find("#lPathMiniGridDataTable").find('td[aria-describedby="lPathMiniGridDataTable_ControlName"]');n.each(function(n,t){var r=t.textContent,u=i.App.lPathDesignerContainer.find(t).closest("tr");u.attr("aria-label",i.Locale.selectText+" "+r)})},u.prototype.subscribe=function(n,t,i,r){r===void 0&&(r=!0);var u=this;this.eventSources.push(n);this.rootElement.find(n).off(t).on(t,function(n){return(i.call(u,n,this),r)?!1:!0})},u.prototype.unsubscribe=function(){for(var n=0;n<this.eventSources.length;n++)this.rootElement.find(this.eventSources[n]).off();this.eventSources=[]},u.prototype.prepareMiniGrid=function(){this.prepareGridWrapper();this.showData()},u.prototype.prepareGridWrapper=function(){var n;n=this.controlType==i.Utility.ControlTypes.Sidebar.toString()?i.Locale.miniGridSearchPreText+i.Locale.sidebarsString:i.Locale.miniGridSearchPreText+i.Locale.guidedTasksString;this.miniGridTemplate='<div id="lPathMiniGrid" class="lpath-minigrid-wrapper" role="dialog" aria-labelledby="miniGrid-headerTitle"><div class="lpath-alert-title"><h1 ><span  id="miniGrid-headerTitle">'+this.headerTitle+'<\/span><\/h1><button id="lPathMiniGridCross" class="lpath-float-right" type="image" tabindex="0" aria-label="'+i.Locale.close+'" aria-describedby="miniGridCrossImgAriaDesc"><img alt="'+i.Locale.close+'" src="'+t.Loader.serverUrl+'images/Close_12x12.png"><\/button><div hidden id="miniGridCrossImgAriaDesc"><\/div><\/div><div class="lpath-minigrid-header"><div class="lpath-minigrid-header-text-container"><label class="crm-lpath-title">'+this.headerText+'<\/label><\/div><div class="lpath-minigrid-search-container"><input id="lPathMiniGridSearchText" type="text" tabindex="0" placeholder="'+i.Locale.placeHolderCaption+'" aria-label="'+n+'"/><\/div><div hidden id="miniGridSearchBoxAriaLabel"><\/div><table id="lPathMiniGridDataTable"><\/table><div id="lPathMiniGridPager"><\/div><\/div><div class="lpath-minigrid-footer lpath-alert-footer"><div class="lpath-alert-footerright"><button id="lPathMiniGridCancel" title="'+i.Locale.cancelCaption+'"  aria-label="'+i.Locale.miniGridCancel+'">'+i.Locale.cancelCaption+'<\/button><button id="lPathMiniGridDone" title="'+i.Locale.okCaption+'" class="lpath-overflow-handling lpath-focussable-class" aria-label="'+i.Locale.miniGridSave+'">'+i.Locale.okCaption+'<\/button><\/div><\/div><span hidden id="firstPage">'+i.Locale.firstPage+'<\/span><span hidden id= "previousPage" >'+i.Locale.previousPage+'<\/span><span hidden id= "nextPage" >'+i.Locale.nextPage+'<\/span><span hidden id= "lastPage">'+i.Locale.lastPage+"<\/span><\/div>"},u.prototype.showGrid=function(){this.rootElement.find('div[id="lPathLolMinigridBlock"]').length==0&&this.rootElement.append('<div id="lPathLolMinigridBlock" class="lpath-lol-minigrid-placeholder-block"><\/div>');this.rootElement.find('div[id="lPathLolMinigridBlock"]').find('div[id="lPathMiniGrid"]').length==0&&this.rootElement.find('div[id="lPathLolMinigridBlock"]').append(this.miniGridTemplate)},u.prototype.attachEventsToMiniGrid=function(){var n=this;this.subscribe('input[id="lPathMiniGridSearchText"]',"keyup",this.showDataOnSearchText);this.subscribe('button[id="lPathMiniGridDone"]',"click",this.onDone);this.subscribe('button[id="lPathMiniGridDone"]',"keydown",this.onKeyDownOfDone);this.subscribe('button[id="lPathMiniGridCancel"]',"click",this.onCancel);this.subscribe('button[id="lPathMiniGridCancel"]',"keydown",this.onKeyDownOfCancel);this.subscribe('button[id="lPathMiniGridCross"]',"click",this.onCancel);this.subscribe('button[id="lPathMiniGridCross"]',"keydown",this.onKeyDownOfCross);t.Loader.$mars("#lPathMiniGrid").off("keyup").keyup(function(t){n.closeOnEsc(t,n)})},u.prototype.showData=function(){this.createCriteriaAndBuildGrid(this.pageNumber,this.pageSize," ")},u.prototype.showDataOnSearchText=function(n){if(n.keyCode==13){this.searchText=this.rootElement.find('input[id="lPathMiniGridSearchText"]').val();var t=i.EncodeDecode.MarsHtmlEncode(i.EncodeDecode.MarsHtmlDecode(this.searchText));this.createCriteriaAndBuildGrid(this.pageNumber,this.pageSize,t)}this.closeOnEsc(n,this)},u.prototype.createCriteriaAndBuildGrid=function(r,u,f){var l;try{var o=[],s=[],h=[],c=[],e=[];o.push(new n.Client.Loader.Details(this.notEqualFilterExpression,this.status));e.push(new n.Client.Loader.Filters("AND",i.Util.Constants.status,o));c.push(new n.Client.Loader.Details(this.equalFilterExpression,this.controlType.toString()));e.push(new n.Client.Loader.Filters("AND",i.Util.Constants.controlType,c));s.push(new n.Client.Loader.Details(this.notEqualFilterExpression,this.parentControlId));e.push(new n.Client.Loader.Filters("AND",i.Util.Constants.controlId,s));h.push(new n.Client.Loader.Details(this.equalFilterExpression,this.enabled));e.push(new n.Client.Loader.Filters("AND",i.Util.Constants.enabled,h));this.extraFilters&&this.extraFilters.length>0&&t.Loader.$mars.merge(e,this.extraFilters);l={pageNumber:r,pageSize:u,searchText:f,filters:e};this.buildGrid(l,this.boolMultiSelect)}catch(a){this.attachEventsToMiniGrid();t.Loader.marsExceptionHandler.execute(a.name,a.message)}},u.prototype.buildGrid=function(n,r){var f=this,o,e;f.showGrid();o=t.Loader.appContext.getDraftPublishGroupId();e=i.Util.Common.getGridRowDataFromService(n.pageNumber,n.pageSize,t.Loader.appContext.getAuthoringId(),"ControlName","asc",n.searchText,n.filters,null,o);e.done(function(t){var o,e,a,v,h;f.attachEventsToMiniGrid();f.updateAriaLabelForDialogElements(f.controlType);var s=[],c="right",l="left";for(i.App.isRTL||(c="left",l="right"),o=0;o<t.Items.length;o++)e=t.Items[o].LastUpdatedDate,e&&(e.toString().indexOf("Z")<0&&e.toString().indexOf("UTC")<0&&e.toString().indexOf("GMT")<0?(a=Date.parse(t.Items[o].LastUpdatedDate+"Z"),e=i.Util.Common.convertUtcToLocal(new Date(a))):e=i.Util.Common.convertUtcToLocal(new Date(e)),e=e.replace("  UTC","")),v={Id:t.Items[o].ControlId,VersionId:t.Items[o].ControlVersionId,ControlName:t.Items[o].ControlName,LastUpdatedDate:e,AuthorName:t.Items[o].AuthorName,Title:t.Items[o].Title},s.push(v);u.dataSource.MiniGridData=s;u.dataSource.records=t.Count;u.dataSource.total=Math.floor(t.Count/n.pageSize)+(t.Count%n.pageSize?1:0);u.dataSource.pageNo=n.pageNumber;h={root:function(){return s},page:function(){return u.dataSource.pageNo},total:function(){return u.dataSource.total},records:function(){return u.dataSource.records}};f.gridPager=f.rootElement.find("#lPathMiniGridPager");f.gridTable=f.rootElement.find("#lPathMiniGridDataTable");f.gridWrapper=f.rootElement.find("#lPathMiniGrid");f.gridTable.jqGrid({datatype:"local",data:s,rowNum:f.pageSize,width:f.gridWidth,height:f.gridHieght,viewrecords:!0,recordpos:c,pagerpos:l,multiselect:r,colModel:[{label:i.Locale.idCaption,name:"Id",width:75,key:!0,hidden:!0},{label:i.Locale.versionCaption,name:"VersionId",width:75,hidden:!0},{label:i.Locale.nameCaption,name:"ControlName",width:167},{label:i.Locale.title,name:"Title",width:75,Key:!0,hidden:!0},{label:i.Locale.dateModifiedCaption,name:"LastUpdatedDate",width:167},{label:i.Locale.authorCaption,name:"AuthorName",width:185}],localReader:h,pager:"#lPathMiniGridPager",recordtext:"{0} - {1} "+i.Locale.ofLabel+" {2}",pgtext:i.Locale.page+" {0} "+i.Locale.ofLabel+" {1}",onPaging:function(n){return f.paginateGrid(n)}});f.gridTable.jqGrid("hideCol","cb");f.gridTable.jqGrid("clearGridData");f.gridTable.jqGrid("setGridParam",{data:s,localReader:h});f.gridTable.trigger("reloadGrid");f.gridTable.removeAttr("tabindex");f.addTabEventsToPagination();f.modifyTabbingSettingsOfPagination();f.checkForDisabledButtons();f.handleKeyDownForGridRecords();f.gridTable.attr("tabindex","-1");f.updateAriaLabelForGridElements(f.controlType);f.updateControlNameToAriaLabel(f);f.assignAriaLabelToCurrentPageNumber()});e.fail(function(n){f.gridPager=f.rootElement.find("#lPathMiniGridPager");f.gridTable=f.rootElement.find("#lPathMiniGridDataTable");f.gridWrapper=f.rootElement.find("#lPathMiniGrid");f.attachEventsToMiniGrid();f.updateAriaLabelForDialogElements(f.controlType);f.setFocusOnSearch();f.addTabEventsToPagination();f.modifyTabbingSettingsOfPagination();t.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON)})},u.prototype.assignAriaLabelToCurrentPageNumber=function(){var n=this.rootElement.find("input.ui-pg-input"),t=i.Locale.currentPageNumber.replace("{0}",n.val()).replace("{1}",this.rootElement.find("#sp_1_lPathMiniGridPager").text());n.attr("aria-label",t)},u}();r.MiniGrid=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(r){function u(n,t,i){r.call(this,n,t);this.viewDataValue=n;this.rootElement=t;this.controlRootElement=i;this.listSelector=".lpath-multiselect-dropdown dd ul";this.selectedValueCount=1;this.populatedValueCount=1;this.build()}return __extends(u,r),u.prototype.getTemplate=function(){return i.Util.Constants.multiSelectDropdownTemplate},u.prototype.build=function(){r.prototype.build.call(this)},u.prototype.populateDropdown=function(r){var u,s,f,e,o;try{for(u=this,s=this.rootElement.find("div.lpath-mutliSelectOptions ul"),f=0;f<r.length;f++)if(e=r[f].Id,o=r[f].Name,e&&o)s.append('<li><div data-name="multiSelectListItem" class = "multiselect-listitem"  data-id = "'+e+'" data-value = "'+o+'"><input type= "checkbox" id="'+e+'" value= "'+o+'" data-name="lPathMultiSelectElement" /><label Id="'+e+'">'+o+"<label><div><\/li>");else throw new Error("Id & Name of Elements is required");this.rootElement.find(".lpath-multiselect-dropdown dt a").off("keydown").on("keydown",function(t){return n.Client.Loader.appContext.Util.isEnterPressed(t,!0)?(u.expandDropdownList(),!1):t.keyCode==i.Utility.KeyCodeEnum.DownArrowKey||t.keyCode==i.Utility.KeyCodeEnum.RightArrowKey?(u.shiftFocusToFirstChildCross(this,t),!1):t.keyCode==i.Utility.KeyCodeEnum.TabKey&&!t.shiftKey?(u.shiftFocusToNextControl(this,t),!1):!0});this.subscribe(this.rootElement.find(".lpath-multiselect-dropdown dt a"),"click",this.expandDropdownList);this.rootElement.find('.lpath-mutliSelectOptions input[type="checkbox"]').on("click",function(n){u.displaySelectedValue(n,this)});this.subscribe(this.rootElement.find('div[data-name="multiSelectListItem"]'),"click",function(n,t){u.clickCorrespondingCheckBoxMultiSelect(u.rootElement.find(t))});this.controlRootElement.off("click",this.expandCollapseMultiSelect).on("click",this.expandCollapseMultiSelect);this.controlRootElement.off("keydown").on("keydown",function(n){n.keyCode==i.Utility.KeyCodeEnum.EscapeKey&&u.expandCollapseMultiSelect(n)});this.controlRootElement.find(".lpath-multiSelectList li").off("click").on("click",function(){t.Loader.$mars(this).find('[type="checkbox"]').click()});this.controlRootElement.find(".lpath-multiSelectList li").off("keydown").on("keydown",function(r){var h=t.Loader.$mars(this),e=n.Client.Loader.appContext.Util.getBrowserInfo(),o,f,s;r.keyCode==i.Utility.KeyCodeEnum.DownArrowKey&&(f=t.Loader.$mars("#lPathControlSetupView").scrollTop(),o=h.next().find('input[type="checkbox"]'),o.attr("aria-label",o.val()),o.focus(),e.name=="Chrome"||e.name=="Firefox"?t.Loader.$mars("#lPathControlSetupView").scrollTop(f):i.$mars("#lPathControlSetupView").animate({scrollTop:f},"slow"),r.preventDefault());r.keyCode==i.Utility.KeyCodeEnum.UpArrowKey&&(f=t.Loader.$mars("#lPathControlSetupView").scrollTop(),s=h.prev().find('input[type="checkbox"]'),s.attr("aria-label",s.val()),s.focus(),e.name=="Chrome"||e.name=="Firefox"?t.Loader.$mars("#lPathControlSetupView").scrollTop(f):i.$mars("#lPathControlSetupView").animate({scrollTop:f},"slow"),r.preventDefault());r.keyCode!=i.Utility.KeyCodeEnum.TabKey||r.shiftKey?r.keyCode==i.Utility.KeyCodeEnum.TabKey&&r.shiftKey&&(u.expandCollapseMultiSelect(r),u.rootElement.find("#lPathLinkText")[0].focus(),r.stopPropagation(),r.preventDefault()):u.expandCollapseMultiSelect(r)});this.populatedValueCount=r.length}catch(h){t.Loader.marsExceptionHandler.execute(h.name,h.message)}},u.prototype.expandCollapseMultiSelect=function(n){var r=t.Loader.$mars('ul[name="lPathMultiSelectUnOrdListId"]');r.parent().css("display","none");r.parent().css("bottom","");(r.is(n.target)||r.has(n.target).length!==0)&&n.keyCode!=i.Utility.KeyCodeEnum.EscapeKey&&n.keyCode!=i.Utility.KeyCodeEnum.TabKey||(r.hide(),t.Loader.$mars(n.target).parents(".lpath-multiselect-dropdown").find("a[name=lPathMultiSelectElement]").focus());n.stopPropagation()},u.prototype.clickCorrespondingCheckBoxMultiSelect=function(n){var t=n.attr("data-value"),i=this.rootElement.find('input[type= "checkbox"][value="'+t+'"]');i.trigger("click")},u.prototype.expandDropdownList=function(){var r=t.Loader.$mars("#lPathControlSetupView"),u,f,e,o;this.setupViewScrollTop=r.scrollTop();u=t.Loader.$mars('ul[name="lPathMultiSelectUnOrdListId"]').not(this.rootElement.find(this.listSelector));t.Loader.$mars('ul[name="lPathMultiSelectUnOrdListId"]').parent().css("display","block");u.hide();Math.abs(r.height()-this.rootElement.find("#lPathLinkText").offset().top)<102&&this.rootElement.find('ul[name="lPathMultiSelectUnOrdListId"]').parent().css("bottom","41px");!navigator.userAgent.match(/Trident.*rv[ :]?[1-9]{2}\./)||(f=u.parent().get(0),f.className=f.className+" lpath-mutliSelectOptionsIE");this.rootElement.find(this.listSelector).slideToggle("fast");e=t.Loader.$mars(this.rootElement.find(".lpath-multiSelectList li").first()).find("[type='checkbox']");e.attr("aria-label",i.Locale.selectAll);o=n.Client.Loader.appContext.Util.getBrowserInfo();o.name=="Chrome"?r.scrollTop(this.setupViewScrollTop):i.$mars("#lPathControlSetupView").animate({scrollTop:this.setupViewScrollTop},"slow");e.focus()},u.prototype.displaySelectedValue=function(r,u){var a,st,s,d,ut,g;try{var nt=t.Loader.$mars(u).parent().text(),tt=t.Loader.$mars(u).val(),it=t.Loader.$mars(u).attr("id"),p=t.Loader.$mars(u).prop("checked"),c=t.Loader.$mars(u).parents("div.lpath-multiSelectControl"),h=c.find(".lpath-selectedDropdownValues"),et=t.Loader.$mars("#lPathControlSetupView"),ot=h.find("ul li span"),w=[];ot.each(function(){w.push(t.Loader.$mars(this).text())});var v=t.Loader.$mars(u).parents("div.lpath-multiSelectControl").find(".lpath-clickToSelect"),f=[],e=[],o=[],l="";if(w.length!==0&&(e=w,f=h.attr("localized-values").split(", "),o=h.attr("data-id").split(", ")),t.Loader.$mars(u).val()=="Select all"&&p)for(c.find('.lpath-multiSelectList li input[type="checkbox"]').prop("checked",!0),v.hide(),h.empty(),l=t.Loader.$mars(u).closest("ul").children(),this.selectedValueCount=l.length-1,f=[],e=[],o=[],a=1;a<l.length;a++)e.push(t.Loader.$mars(l[a]).text()),f.push(t.Loader.$mars(l[a]).find("div").attr("data-value")),o.push(t.Loader.$mars(l[a]).find("div").attr("data-id"));else t.Loader.$mars(u).val()!="Select all"||p?p?(f.push(tt),e.push(nt),o.push(it),this.selectedValueCount=this.selectedValueCount+1,v.hide()):(st=h.text(),f.splice(f.indexOf(tt),1),e.splice(e.indexOf(nt),1),o.splice(o.indexOf(it),1),this.selectedValueCount--,c.find('.lpath-multiSelectList li input[value="Select all"]').prop("checked",!1),h.empty(),f.length<=0&&v.show()):(c.find('.lpath-multiSelectList li input[type="checkbox"]').prop("checked",!1),f.splice(0,f.length),e.splice(0,e.length),o.splice(0,o.length),this.selectedValueCount=0,h.empty(),v.show());this.selectedValueCount==t.Loader.$mars(u).closest("ul").children().length-1&&c.find('.lpath-multiSelectList li input[value="Select all"]').prop("checked",!0);var b="",y="",k="",rt=t.Loader.$mars('<ul class="lpath-MultiSelectDisplayedList"><\/ul>');for(s=0;s<f.length;s++)d=e[s],ut=t.Loader.$mars('<li class="lpath-multiselect-displayeditems"><span>'+d+'<\/span><img src="'+t.Loader.serverUrl+'images/Close_12x12.png" tabindex="-1" class="lpath-multiselect-item-cross" aria-label="'+t.Loader.marsLocale.deleteCaption+" "+d+'" role="button" alt="'+t.Loader.marsLocale.close+'"/><\/li>'),rt.append(ut),y+=y!==""?", "+f[s]:f[s],k+=k!==""?", "+e[s]:e[s],b+=b!==""?", "+o[s]:o[s];t.Loader.$mars(u).parents("div.lpath-multiSelectControl").find(".lpath-selectedDropdownValues").attr("title",k);t.Loader.$mars(u).parents("div.lpath-multiSelectControl").find(".lpath-selectedDropdownValues").attr("localized-values",y);t.Loader.$mars(u).parents("div.lpath-multiSelectControl").find(".lpath-selectedDropdownValues").attr("data-id",b);this.rootElement.find("a#lPathLinkText").attr("aria-label",y);h.empty();h.append(rt);g=n.Client.Loader.appContext.Util.getBrowserInfo();g.name=="Chrome"||g.name=="Firefox"?et.scrollTop(this.setupViewScrollTop):i.$mars("#lPathControlSetupView").animate({scrollTop:this.setupViewScrollTop},"slow");this.attachCrossImgEvent(c);r.stopPropagation()}catch(ft){t.Loader.marsExceptionHandler.execute(ft.name,ft.message)}},u.prototype.getSelectedValues=function(){try{return this.rootElement.find(".lpath-selectedDropdownValues").attr("localized-values").replace(/&nbsp;/gi," ")}catch(n){return this.rootElement.find(".lpath-selectedDropdownValues").html().replace(/&nbsp;/gi," ")}},u.prototype.getSelectedIds=function(){try{return this.rootElement.find(".lpath-selectedDropdownValues").attr("data-id").replace(/&nbsp;/gi," ")}catch(n){return this.rootElement.find(".lpath-selectedDropdownValues").html().replace(/&nbsp;/gi," ")}},u.prototype.getSelectedTexts=function(){return this.rootElement.find(".lpath-selectedDropdownValues").html().replace(/&nbsp;/gi," ")},u.prototype.getSelectedValuesArray=function(){var n;try{n=this.rootElement.find(".lpath-selectedDropdownValues").attr("localized-values").split(", ")}catch(t){n=this.rootElement.find(".lpath-selectedDropdownValues").html().split(", ")}return n.splice(-1,1),n},u.prototype.getSelectedTextsArray=function(){var n=this.rootElement.find(".lpath-selectedDropdownValues").html().split(", ");return n.splice(-1,1),n},u.prototype.populateValues=function(n){var i,c,o,r,u,f,a;try{if(n!=""){i=this.rootElement;c=i.find("ul").children().length;i.find(".lpath-clickToSelect").hide();i.find(".lpath-selectedDropdownValues").empty();var s="",h="",e="",l=t.Loader.$mars('<ul class="lpath-MultiSelectDisplayedList"><\/ul>');for(o=0;o<n.length;o++)for(r=1;r<c;r++)if(u=t.Loader.$mars(i.find('.lpath-multiSelectList li div[data-name="multiSelectListItem"]')[r]),n[o].toLowerCase().replace(/\s/g," ").trim()==u.attr("data-id").toLowerCase().replace(/&nbsp;/gi," ").replace(/\s/g," ").trim()){f=t.Loader.$mars(i.find(".lpath-multiSelectList li")[r]).text();a='<li class="lpath-multiselect-displayeditems"><span>'+f+'<\/span><img src="'+t.Loader.serverUrl+'images/Close_12x12.png" tabindex="-1" class="lpath-multiselect-item-cross" aria-label="'+t.Loader.marsLocale.deleteCaption+" "+f+'" role="button" alt="'+t.Loader.marsLocale.close+'"/><\/li>';l.append(a);h+=h!=""?", "+f:f;e+=e!=""?", "+u.attr("data-value"):u.attr("data-value");s+=s!=""?", "+u.attr("data-id"):u.attr("data-id");t.Loader.$mars(i.find('.lpath-multiSelectList li input[type="checkbox"]')[r]).prop("checked",!0);break}i.find(".lpath-selectedDropdownValues").append(l);this.attachCrossImgEvent(i)}i.find(".lpath-selectedDropdownValues").attr("data-id",s);i.find(".lpath-selectedDropdownValues").attr("title",h);i.find(".lpath-selectedDropdownValues").attr("localized-values",e);this.rootElement.find("a#lPathLinkText").attr("aria-label",e);n.length==this.populatedValueCount&&this.rootElement.find('input[value="Select all"]').prop("checked",!0)}catch(v){t.Loader.marsExceptionHandler.execute(v.name,v.message)}},u.prototype.attachCrossImgEvent=function(n){var t=this;n.find(".lpath-multiselect-item-cross").off("click").on("click",function(n){t.crossImageEventHandler(this,n)});n.find(".lpath-multiselect-item-cross").off("keydown").on("keydown",function(n){n.keyCode==i.Utility.KeyCodeEnum.EnterKey||n.keyCode==i.Utility.KeyCodeEnum.SpaceKey?t.crossImageEventHandler(this,n):n.keyCode==i.Utility.KeyCodeEnum.DownArrowKey||n.keyCode==i.Utility.KeyCodeEnum.RightArrowKey?t.moveDownCrossImage(this,n):n.keyCode==i.Utility.KeyCodeEnum.UpArrowKey||n.keyCode==i.Utility.KeyCodeEnum.LeftArrowKey?t.moveUpCrossImage(this,n):n.keyCode==i.Utility.KeyCodeEnum.TabKey&&n.shiftKey?t.fireShiftTabOnCross(this,n):n.keyCode!=i.Utility.KeyCodeEnum.TabKey||n.shiftKey||t.shiftFocusToNextControl(this,n)})},u.prototype.crossImageEventHandler=function(n,i){var n=t.Loader.$mars(n),r=n.siblings().text(),u=n.closest('a[id="lPathLinkText"]');n.closest("dl").find('[data-value="'+r+'"]').click();u.focus();i.preventDefault();i.stopPropagation()},u.prototype.moveUpCrossImage=function(n,i){var n=t.Loader.$mars(n),r=n.parent().prev();r&&r.find(".lpath-multiselect-item-cross").focus();i.preventDefault();i.stopPropagation()},u.prototype.moveDownCrossImage=function(n,i){var n=t.Loader.$mars(n),r=n.parent().next();r&&r.find(".lpath-multiselect-item-cross").focus();i.preventDefault();i.stopPropagation()},u.prototype.fireShiftTabOnCross=function(n,i){var r=t.Loader.$mars(n).closest("#lPathLinkText");r&&(r[0].focus(),i.preventDefault(),i.stopPropagation())},u.prototype.shiftFocusToFirstChildCross=function(n,i){var r=t.Loader.$mars(n).find(".lpath-multiselect-item-cross");r&&(r[0].focus(),i.preventDefault(),i.stopPropagation())},u.prototype.shiftFocusToNextControl=function(n,i){var r=t.Loader.$mars(n).closest(".lpath-designer-setup-row");r&&(r.next().find("[tabindex]")[0].focus(),i.preventDefault(),i.stopPropagation())},u.prototype.close=function(){this.controlRootElement.off("click",this.expandCollapseMultiSelect);r.prototype.close.call(this)},u}(r.View);r.MultiSelectDropDownView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(r){function u(n,t,i,u){r.call(this,n,t,i);this.controlId=n;this.controlType=t;this.rootElement=i;this.builderControlTemplateTypeList=u;this.initializeControls()}return __extends(u,r),u.prototype.initializeControls=function(){try{this.rootElement.find('div[name="BuilderTemplateSelector"]').css("cursor","pointer");this.sectionIndex=0;var n=this;this.subscribe('div[name="BuilderTemplateSelector"]',"click",this.onTemplateSelection);this.rootElement.find('ul[name="builderControlToolBarList"] li').keydown(function(n){if(n.keyCode==13)return t.Loader.$mars(this).find("div").trigger("click"),!1;if(n.keyCode==27){t.Loader.$mars("#lpathPropertyTabBuilderControlContainer").hide();var i=t.Loader.$mars("#lPathPropertyTabEditButton");return i&&i.length>0&&i[0].clientHeight>0?t.Loader.$mars("#lPathPropertyTabEditButton").focus():t.Loader.$mars(this).parents(".lpath-edit-section-container").find("#lpath-toolbar-moreTemplate-option").parent().focus(),!1}});this.rootElement.find('ul[name="builderControlToolBarList"] li').hide().filter(function(){var i=n.rootElement.find(this);if(t.Loader.$mars.inArray(i.data("templatetypeenum"),n.builderControlTemplateTypeList)!==-1)return i}).show()}catch(i){t.Loader.marsExceptionHandler.execute(i.name,i.message)}},u.prototype.hideSelectedTemplate=function(n){var t=this;this.rootElement.find('ul[name="builderControlToolBarList"] li').hide().filter(function(){var r=t.rootElement.find(this),u=r.data("templatetypeenum")===i.Util.BuilderControlTemplateTypeEnum.renderer_footersectiontemplate,f=r.data("templatename")===n;if(!(u&&t.footerTemplateFlag)&&!f)return r}).show()},u.prototype.getTemplate=function(){return i.Util.Constants.propertyTabBuilderControlTemplate},u.prototype.onTemplateSelection=function(i,r){var u=t.Loader.$mars(r).parent("li").data("templatename"),f=t.Loader.$mars(r).parent("li").data("applyonload"),e=this;t.Loader.$mars(".lpath-propertyTab").hide();this.handleTemplateSelection(u,f);e.enablePropertyTab();n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:onTemplateSelection END")},u.prototype.pushTemplateInContainer=function(t,i){i===void 0&&(i=!0);r.prototype.pushTemplateInContainer.call(this,t,i);this.rootElement.hide();n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:pushTemplateInContainer END")},u.prototype.enablePropertyTab=function(){setTimeout(t.Loader.$mars(".lpath-propertyTab").show(),4e3)},u}(r.BaseBuilderControlView);r.PropertyTabBuilderControlView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(){function u(n,t,i,r,u){this.rootElement=n;this.controls=t;this.publishSuccessControlCallback=i;this.publishFailedControlCallback=r;this.isCheckedOut=u;this.controlIds=t.map(function(n){return n.ControlId})}return u.prototype.publishControls=function(u){var l=this,h;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishPopup:Publish control call START");try{var f=this,c="lPathskinnyToolbarContainer",o=[],w=n.Client.Loader.appContext.Util.getConfigurationData("AuthoringGroup"),s=n.Client.Loader.appContext.Util.getConfigurationData("PublishGroupSetting"),v=[];if(s!==null&&s!==undefined)for(h=0;h<s.length;h++)s[h].Id&&s[h].PublishGroupType!=1&&v.push(s[h]);var b={authoringGroup:w,publishGroups:v},k=r.TemplateEngine.applyTemplate(i.Util.Constants.publishPopupTemplate,b),e=new r.SimpleDialogView({},this.rootElement,"PublishPopUp",i.Locale.publishAlertTitle,k,function(){o=f.getSelectedRows();t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Selected publish environment : "+o);u&&o.length>0&&f.displayLoadingAnimation()},function(){l.rootElement.parent().find('button[id="lPathSkinnyToolbarPublishButton"]').focus()});e.addDoNotShowCheck=!1;e.showCancel=!0;e.addDefaultFocusOnOkOrClose=!0;e.okCaption=i.Locale.publishCaption;e.okAriaLabelValue=i.Locale.publishCaption;e.okAriaDescribedByValue=i.Locale.PublishControlsPublishAriaDescription;e.cancelAriaLabelValue=i.Locale.cancelCaption;e.cancelAriaDescribedByValue=i.Locale.PublishControlsCancelAriaDescription;this.rootElement.parent().attr("id")!=c&&(e.okElementFocus=this.rootElement.parent().find('div[id="imgBuildControlMars"]'),e.cancelElementFocus=this.rootElement.parent().find('div[id="imgBuildControlMars"]'));var d=e.show(),a,g=i.$mars("#lpath-publish-popup-description *").not("div"),y="";if(i.$mars.each(g,function(n,t){y+=t.innerText?t.innerText+"":t.value?t.value:t.title}),i.$mars("#publishControlsDialogAriaDescId")[0].innerText=y,i.$mars("[id^=lpathSimpleDialog_]").attr("aria-describedby","publishControlsDialogAriaDescId"),i.$mars(".lpath-publishgroup-grid-checkbox").length>0){a=i.$mars(".lpath-publish-lp-grid").find(".lpath-publishgroup-grid-checkbox")[0];a.setAttribute("tabindex","0");e.showElementFocus=a;i.$mars(".lpath-publishgroup-grid-checkbox").on("keydown",function(n){return f.handleKeyDownEventInGrid(n,f)});i.$mars(".lpath-publishgroup-grid-checkbox").on("change",function(n){return f.handleCheckboxChange(n,f)})}i.$mars("#lpath-simple-btnClose_PublishPopUp").off("keydown").on("keydown",function(n){return f.handleCloseKeyDown(n)});i.$mars("#lpath-simple-btnOk_PublishPopUp").off("keydown").on("keydown",function(n){return f.handlePublishKeyDown(n)});d.then(function(t){var r,e;t.toString().toLowerCase()=="true"&&(r=i.$mars.Deferred(),f.isCheckedOut?(e=l.forcefulCheckin(l.rootElement,l.controls),e.done(function(){r.resolve()}),e.fail(function(){r.reject()})):r.resolve(),r.fail(function(){f.removeLoadingAnimation()}),r.done(function(){var t;if(o.length>0)f.publishEnvironment=o,t=u?i.App.postControlActionHandler.callPostControlAction(f.controlIds,i.Locale.publishSyncCaption,o):i.App.postControlActionHandler.callPostControlAction(f.controlIds,i.Locale.publishCaption,o),t.done(function(){for(var t,r=0;r<f.publishEnvironment.length;r++)for(t=0;t<f.controls.length;t++)f.controls[t].pgId=f.publishEnvironment[r].Id,f.controls[t].pgName=f.publishEnvironment[r].Name,i.App.trackActivity(f.controls[t],window._MicrosoftMars.Client.Telemetry.EndAction.published);f.publishSuccessControlCallback&&(f.removeLoadingAnimation(),f.publishSuccessControlCallback());u||i.Util.Common.showAlertMessage(i.Locale.publishSccessfulTitle,i.Locale.publishSccessfulMessage,f.rootElement,!1,i.Locale.okCaption,null,function(){f.rootElement.parent().find('div[id="imgBuildControlMars"]').focus()},null,!1);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Controls published queued successfully");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishControl:publishControls END via savedDataPromise.done()")}),t.fail(function(){f.publishFailedControlCallback&&(f.removeLoadingAnimation(),f.publishFailedControlCallback());i.Util.Common.showAlertMessage(i.Locale.publishFailureTitle,i.Locale.publishFailureMessage,f.rootElement,!1,i.Locale.okCaption,null,function(){f.rootElement.parent().attr("id")===c?f.rootElement.parent().find('button[id="lPathSkinnyToolbarPublishButton"]').focus():f.rootElement.parent().find('div[id="imgBuildControlMars"]').focus()},function(){f.rootElement.parent().attr("id")===c?f.rootElement.parent().find('button[id="lPathSkinnyToolbarPublishButton"]').focus():f.rootElement.parent().find('div[id="imgBuildControlMars"]').focus()},!1)});else return i.Util.Common.showAlertMessage(i.Locale.alertTitle,i.Locale.selectPGAlert,f.rootElement,!1,i.Locale.okCaption,null,function(){f.rootElement.parent().attr("id")===c?f.rootElement.parent().find('button[id="lPathSkinnyToolbarPublishButton"]').focus():f.rootElement.parent().find('div[id="imgBuildControlMars"]').focus()},function(){f.rootElement.parent().attr("id")===c?f.rootElement.parent().find('button[id="lPathSkinnyToolbarPublishButton"]').focus():f.rootElement.parent().find('div[id="imgBuildControlMars"]').focus()},!1),!1}))})}catch(p){t.Loader.marsExceptionHandler.execute(p.name,p.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"PublishPopup:Exception occurred while Publish control call.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishPopup:Publish control call END")},u.prototype.forcefulCheckin=function(n,t){var u=i.$mars.Deferred(),f=new r.CheckinPopup(n,t,function(){u.resolve()},function(){u.reject()});return f.checkInControls(!0),u},u.prototype.removeLoadingAnimation=function(){i.$mars("#loadingGifDiv").remove()},u.prototype.displayLoadingAnimation=function(){var r=i.App.lPathDesignerContainerZIndex,n,u;r+=99;n="left";i.App.isRTL&&(n="right");u='<div id="loadingGifDiv" style="position: fixed; top: 50%; '+n+": 50%; z-index: "+r+';"><img id="loadingGif" src="'+t.Loader.serverUrl+'images/publishloading.gif" height="85" width="85"><\/div>';this.rootElement.append(u)},u.prototype.setFocusOnPopupLoad=function(){var n=this;if(t.Loader.$mars("#authoringGroup")&&t.Loader.$mars("#authoringGroup").focus(),t.Loader.$mars("#lpath-simple-btnClose_PublishPopUp"))t.Loader.$mars("#lpath-simple-btnClose_PublishPopUp").on("focus",n.onLastTabIndex)},u.prototype.onLastTabIndex=function(){t.Loader.$mars("#authoringGroup").focus()},u.prototype.getSelectedRows=function(){var e=[],u=n.Client.Loader.appContext.Util.getConfigurationData("PublishGroupSetting"),f=this.rootElement.find(".lpath-publish-lp-header input:checked"),r,o,i;if(f.length>0)for(r=0;r<f.length;r++)for(o=t.Loader.$mars(f[r]).data("publishgroupid"),i=0;i<u.length;i++)u[i].Id==o&&e.push(u[i]);return e},u.prototype.getPublishEnvironmentList=function(){var u,i,r;t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishPopup:Getting Publish group from configuration START");try{if(u=this.rootElement.find('select[id="lpath-publishEnvironment"]'),i=n.Client.Loader.appContext.Util.getConfigurationData("PublishGroupSetting"),i!==null&&i!==undefined)for(r=0;r<i.length;r++)i[r].Id&&i[r].Name.toLowerCase().indexOf("draft")==-1&&u.append('<option value="'+i[r].Id+'">'+i[r].Name+"<\/option>")}catch(f){t.Loader.marsExceptionHandler.execute(f.name,f.message);t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"PublishPopup:Exception occurred while getting publish group from configuration.")}t.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"PublishPopup:Getting Publish group from configuration END")},u.prototype.handleKeyDownEventInGrid=function(n){var t=n.target,u=i.$mars("#lpath-simple-btnClose_PublishPopUp"),f=i.$mars("#lpath-simple-btnOk_PublishPopUp"),r;n.keyCode===i.Utility.KeyCodeEnum.TabKey&&(n.shiftKey?n.shiftKey&&u.focus():f.focus(),n.stopPropagation(),n.preventDefault());n.keyCode===i.Utility.KeyCodeEnum.DownArrowKey||n.keyCode===i.Utility.KeyCodeEnum.RightArrowKey?(r=t.closest("tr"),t=i.$mars(r).next().find(".lpath-publishgroup-grid-checkbox"),t.focus()):(n.keyCode===i.Utility.KeyCodeEnum.UpArrowKey||n.keyCode===i.Utility.KeyCodeEnum.LeftArrowKey)&&(r=t.closest("tr"),t=i.$mars(r).prev().find(".lpath-publishgroup-grid-checkbox"),t.focus());this.rootElement.find(".lpath-publishgroup-grid-checkbox").attr("tabindex","-1");t.setAttribute("tabindex","0")},u.prototype.handleCloseKeyDown=function(n){return n.keyCode===i.Utility.KeyCodeEnum.TabKey?n.shiftKey?(this.rootElement.find("#lpath-simple-btnCancel_PublishPopUp").focus(),!1):(this.rootElement.find('.lpath-publishgroup-grid-checkbox[tabindex="0"]').focus(),!1):!0},u.prototype.handlePublishKeyDown=function(n){return n.keyCode===i.Utility.KeyCodeEnum.TabKey?n.shiftKey?(this.rootElement.find('.lpath-publishgroup-grid-checkbox[tabindex="0"]').focus(),!1):(this.rootElement.find("#lpath-simple-btnCancel_PublishPopUp").focus(),!1):!0},u.prototype.handleCheckboxChange=function(n){var r=t.Loader.$mars(n.currentTarget),u=i.Locale.PublishingEnvironmentSelectAriaDescription,f=i.Locale.PublishingEnvironmentDeselectAriaDescription;r.prop("checked")===!0?r.attr("aria-label",f+" "+r.parent().find("label").text()):r.attr("aria-label",u+" "+r.parent().find("label").text())},u}();r.PublishPopup=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(r){function u(n,t,i,u,f){r.call(this,n,t,i);this.controlId=n;this.controlType=t;this.rootElement=i;this.sectionFooterIndex=u;this.moreButtonCallback=f}return __extends(u,r),u.prototype.build=function(){var u,f,n;try{r.prototype.build.call(this);u=this.rootElement.find('button[id="moreFlyout"]');u.attr("id","SectionFooterBuilderTemplateSelector_Section"+this.sectionFooterIndex);this.subscribe(u,"click",this.onMoreButtonClick);this.handleSectionFooterBuilderHc(u);f=this.rootElement.find('button[name="SectionFooterBuilderTemplateSelector"]');n=this;f.each(function(t){i.$mars(this).attr("id","SectionFooterBuilderTemplateSelector_Section"+n.sectionFooterIndex+"_"+t);n.subscribe("#"+i.$mars(this).attr("id"),"click",function(t,i){n.onTemplateSelection(t,i)});n.handleSectionFooterBuilderHc(this)})}catch(e){t.Loader.marsExceptionHandler.execute(e.name,e.message)}},u.prototype.handleSectionFooterBuilderHc=function(n){if(r.prototype.isHighContrastModeActive.call(this)){var i=t.Loader.$mars(n).find("img");if(r.prototype.isBlackHighContrastMode.call(this))switch(i.attr("src")){case t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderText:i.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderTextHCB);break;case t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderVideo:i.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderVideoHCB);break;case t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderLOL:i.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderLOLHCB);break;case t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderMore:i.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderMoreHCB)}else switch(i.attr("src")){case t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderText:i.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderTextHCW);break;case t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderVideo:i.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderVideoHCW);break;case t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderLOL:i.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderLOLHCW);break;case t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderMore:i.attr("src",t.Loader.serverUrl+"images/"+t.Loader.marsImageMapping.ImagePath.footerSectionBuilderMoreHCW)}}},u.prototype.getTemplate=function(){return i.Util.Constants.sectionFooterbuilderControlTemplate},u.prototype.applyContentTemplate=function(n,t){t===void 0&&(t=!0);r.prototype.applyContentTemplate.call(this,n,t);this.contentContainerElement.next().filter("div[name='sectionFooterBuilderControl']").hide()},u.prototype.onMoreButtonClick=function(){this.moreButtonCallback&&this.moreButtonCallback(this.contentContainerElement)},u.prototype.onTemplateSelection=function(i,u){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BuilderControlView:onTemplateSelection START");var f=t.Loader.$mars(u).data("templatename"),e=t.Loader.$mars(u).data("applyonload");r.prototype.handleTemplateSelection.call(this,f,e)},u}(r.BaseBuilderControlView);r.SectionFooterBuilderControlView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(i){var r;(function(r){"use strict";var u=function(u){function f(n,r,f,e,o,s,h){u.call(this,n,r,{},!1);this.modelValue=n;this.rootElement=r;this.dialogName=f;this.alertTitle=e;this.alertHtmlContent=o;this.onOkCallback=s;this.onCancelCallback=h;this.addDoNotShowCheck=!1;this.showCancel=!1;this.showClose=!0;this.isOnlyModel=!1;this.simpleDialogContainer=null;this.zIndexPlus=1;this.hideDialog=!0;this.allowCancelCallbackOnclose=!0;this.okAriaLabelValue=i.Locale.okCaption;this.cancelAriaLabelValue=i.Locale.cancelCaption;this.closeButtonAriaDescribedById="closeButtonAriaDescId";this.addDefaultFocusOnOkOrClose=!1;this.elementToFocusOnPopupEscape=null;this.ariaDescribedById="";this.simpleDialogOverlay=null;this.okBtn=null;this.cancelBtn=null;this.closeBtn=null;this.dialogHolder=null;this._okCaption=i.Locale.okCaption;this._cancelCaption=i.Locale.cancelCaption;this.popupPromise=t.Loader.$mars.Deferred();this.build();var c=i.App.appContext.UserId;this.dontShowKey=c+"_"+this.dialogName}return __extends(f,u),f.prototype.build=function(){var u=this,f="lPathSimpleDialogHolder_"+this.dialogName;if(this.rootElement.find("#"+f)&&this.rootElement.find("#"+f).remove(),this.dialogHolder=t.Loader.$mars("<div id='"+f+"'><\/div>"),this.dialogHolder.append(r.TemplateEngine.applyTemplate(this.getTemplate(),this.getObjectForTemplate())),this.rootElement.append(this.dialogHolder),this.simpleDialogOverlay=this.rootElement.find("#lpathSimpleDialogOverlay").attr("id","lpathSimpleDialogOverlay_"+this.dialogName),this.simpleDialogContainer=this.rootElement.find("#lpathSimpleDialog").attr("id","lpathSimpleDialog_"+this.dialogName),this.lpathSimpleContent=this.rootElement.find("#lpathSimpleContent").attr("id","lpathSimpleContent_"+this.dialogName),this.simpleDialogOverlay.css("z-index",n.Client.Loader.appContext.Util.getMaxZIndex()+1+this.zIndexPlus),this.simpleDialogContainer.css("z-index",n.Client.Loader.appContext.Util.getMaxZIndex()+2+this.zIndexPlus),this.isOnlyModel)this.simpleDialogContainer.empty();else{this.okBtn=this.rootElement.find("#lpath-simple-btnOk").attr("id","lpath-simple-btnOk_"+this.dialogName);this.cancelBtn=this.rootElement.find("#lpath-simple-btnCancel").attr("id","lpath-simple-btnCancel_"+this.dialogName);this.closeBtn=this.rootElement.find("#lpath-simple-btnClose").attr("id","lpath-simple-btnClose_"+this.dialogName);this.lpathSimpleContent.append(this.alertHtmlContent);this.simpleDialogContainer.attr("aria-describedby","lpathSimpleContent_"+this.ariaDescribedById);this.simpleDialogContainer.attr("aria-label",this.alertTitle);this.simpleDialogContainer.attr("tabindex","-1");this.subscribe(this.okBtn,"click",this.onOkClick);this.subscribe(this.cancelBtn,"click",this.onCancelClick);this.subscribe(this.closeBtn,"click",this.onCloseClick);this.okBtn.off("keydown").on("keydown",function(n){return u.onOkKeydown(n)});this.closeBtn.off("keydown").on("keydown",function(n){return u.onCloseKeyDown(n)});this.cancelBtn.off("keydown").on("keydown",function(n){return u.onCancelKeyDown(n)});u.handleHighContrastMode()}this.dialogHolder.keydown(function(n){return n.keyCode==t.Loader.$mars.ui.keyCode.ESCAPE?(i.App.isDesignerLaunched||t.Loader.appContext.util.hideCustomizationContainer(),u.onCancelCallback&&u.onCancelCallback(),u.hide(),!1):!0});this.rootElement.find("#"+this.closeButtonAriaDescribedById).text(i.Locale.simpleDialogClosePrefix+" "+this.alertTitle+" "+i.Locale.dialogString);this.rootElement.find("#okButtonAriaDescId").text(this.okAriaDescribedByValue);this.rootElement.find("#cancelButtonAriaDescId").text(this.cancelAriaDescribedByValue);this.tabIndexZeroElements=this.rootElement.find(".lpath-alert-message").find("[tabindex=0]");t.Loader.$mars('div[id="lPathSkinnyToolbar"]')&&t.Loader.$mars('div[id="lPathSkinnyToolbar"]').length>0&&i.Util.Common.removeEventToElement(t.Loader.$mars('div[id="lPathSkinnyToolbar"]'),"keydown.skinnyDefaultFocus")},f.prototype.onOkKeydown=function(n){return n.keyCode===i.Utility.KeyCodeEnum.TabKey&&n.shiftKey?(this.addDoNotShowCheck?t.Loader.$mars("#lpath-simple-chkDontShow").focus():t.Loader.$mars("#lpath-importLaguagesForControls").length>0&&t.Loader.$mars("#lPathSimpleDialogHolder_NocontrolSelectedPopup").length==0?t.Loader.$mars("#lpath-importLaguagesForControls").focus():t.Loader.$mars("#lPathListOfLinkTypes").length>0&&t.Loader.$mars("#lpathSimpleDialog_ErrorMessageDialog").length==0?t.Loader.$mars("#lpathSimpleContent_ListOfLinkPopupTemplate").find(":visible :tabbable").last().focus():t.Loader.$mars("#lPathEnableNavigation").length>0?t.Loader.$mars("#lPathEnableNavigation").focus():this.closeBtn&&this.closeBtn.focus(),!1):n.keyCode===i.Utility.KeyCodeEnum.TabKey?(this.cancelBtn&&this.cancelBtn.length>0?this.cancelBtn.focus():this.closeBtn&&this.closeBtn.focus(),!1):n.keyCode===i.Utility.KeyCodeEnum.EnterKey?(n.target.click(),!1):!0},f.prototype.onCloseKeyDown=function(n){return this.okBtn.attr("disabled")=="disabled"&&n.shiftKey&&n.keyCode==t.Loader.$mars.ui.keyCode.TAB?(this.cancelBtn.focus(),!1):n.shiftKey&&n.keyCode==t.Loader.$mars.ui.keyCode.TAB?(this.cancelBtn.length==1?this.cancelBtn.focus():this.okBtn.focus(),!1):n.keyCode==t.Loader.$mars.ui.keyCode.ENTER?(n.target.click(),!1):!0},f.prototype.onCancelKeyDown=function(n){return this.okBtn.attr("disabled")=="disabled"&&n.keyCode==t.Loader.$mars.ui.keyCode.TAB?(this.closeBtn.focus(),!1):n.keyCode==t.Loader.$mars.ui.keyCode.ENTER?(n.target.click(),!1):this.closeBtn&&n.keyCode==t.Loader.$mars.ui.keyCode.TAB&&!n.shiftKey?(this.closeBtn.focus(),!1):!0},f.prototype.show=function(){var t=this;return n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SimpleDialogView:oshow START"),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Dailog shown on screen of type : "+this.dialogName),i.Util.LPathLocalStorage.checkKeyExist(this.dontShowKey)?this.onOkClick():(this.build(),this.simpleDialogOverlay.show(),this.simpleDialogContainer.fadeIn(300,function(){t.showElementFocus!=null?t.rootElement.find(t.showElementFocus).focus():t.okBtn&&t.okBtn.focus()})),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SimpleDialogView:show END"),this.popupPromise},f.prototype.hide=function(){var n=this;this.simpleDialogOverlay&&(this.simpleDialogOverlay.hide(),this.elementToFocusOnPopupEscape=this.elementToFocusOnPopupEscape?this.elementToFocusOnPopupEscape:this.cancelElementFocus,this.elementToFocusOnPopupEscape!=null?this.simpleDialogContainer.fadeOut("slow",function(){i.App.lPathDesignerContainer.find(n.elementToFocusOnPopupEscape).focus()}):this.simpleDialogContainer.fadeOut(300));this.dialogHolder&&this.dialogHolder.remove();this.unsubscribe();this.rootElement=null;this.modelValue=null},f.prototype.onOkClick=function(){if(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SimpleDialogView:onOkClick START"),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User Clicked on Ok"),this.okValidationCallback){if(this.okValidationCallback())return n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SimpleDialogView:onOkClick END"),this.executeOkClick()}else return n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SimpleDialogView:onOkClick END"),this.executeOkClick()},f.prototype.executeOkClick=function(){return this.SaveDoNotShowAlert(),this.onOkCallback&&(this.okElementFocus&&this.okElementFocus.length>0&&this.okElementFocus.focus(),this.onOkCallback()),this.hideDialog?(this.hide(),this.okElementFocus&&this.okElementFocus.length>0&&this.okElementFocus.focus(),this.addDefaultFocusOnOkOrClose&&(t.Loader.$mars("#lpathDesignerContainer").focus(),t.Loader.$mars("#lPathlandingPageContainer").focus()),this.popupPromise.resolve(!0)):void 0},f.prototype.onCancelClick=function(){return this.onDialogClose()},f.prototype.onCloseClick=function(){return this.onDialogClose()},f.prototype.onDialogClose=function(){return n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SimpleDialogView:onOkCancel START"),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User Clicked on Cancel"),this.allowCancelCallbackOnclose&&(i.App.isDesignerLaunched||t.Loader.appContext.util.hideCustomizationContainer(),this.onCancelCallback&&this.onCancelCallback(),this.cancelElementFocus&&this.cancelElementFocus.length>0&&i.App.lPathDesignerContainer.find(this.cancelElementFocus).focus()),this.hide(),this.addDefaultFocusOnOkOrClose&&t.Loader.$mars("#lPathlandingPageContainer").focus(),t.Loader.$mars('div[id="lPathSkinnyToolbar"]')&&i.Util.Common.attachEventToElement(t.Loader.$mars('div[id="lPathSkinnyToolbar"]'),"keydown.skinnyDefaultFocus"),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SimpleDialogView:onOkCancel END"),this.popupPromise.resolve(!1)},f.prototype.getObjectForTemplate=function(){var n=this;return t.Loader.$mars.extend(this.modelValue,{alertTitle:n.alertTitle,alertHtmlContent:n.alertHtmlContent,addDoNotShowCheck:n.addDoNotShowCheck,showCancel:n.showCancel,showClose:n.showClose,isOnlyModel:n.isOnlyModel,okCaption:n.okCaption,okAriaLabelValue:n.okAriaLabelValue,cancelCaption:n.cancelCaption,cancelAriaLabelValue:n.cancelAriaLabelValue})},f.prototype.getTemplate=function(){return i.Util.Constants.simpleDialogTemplate},f.prototype.getName=function(){return"SimpleDialogView"},f.prototype.SaveDoNotShowAlert=function(){this.rootElement.find("#lpath-simple-chkDontShow").prop("checked")&&i.Util.LPathLocalStorage.save(this.dontShowKey,!0)},f.prototype.handleHighContrastMode=function(){var t,r,u;i.$mars("#marsIFrame").css("background-image")==="none"&&(t=!1,i.$mars("body").css("background-color")==="rgb(255, 255, 255)"&&(t=!0),r=this.rootElement.find("#lpath-simple-btnClose_"+this.dialogName).find("img"),r&&(u=t?n.Client.Loader.marsImageMapping.ImagePath.closeIcon:n.Client.Loader.marsImageMapping.ImagePath.closeIconInHighContrast,r.attr("src",n.Client.Loader.serverUrl+"images/"+u)))},Object.defineProperty(f.prototype,"okCaption",{get:function(){return this._okCaption},set:function(n){this._okCaption=n;this.okAriaLabelValue=n},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"cancelCaption",{get:function(){return this._cancelCaption},set:function(n){this._cancelCaption=n;this.cancelAriaLabelValue=n},enumerable:!0,configurable:!0}),f}(r.View);r.SimpleDialogView=u})(r=i.Renderer||(i.Renderer={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(){function n(){this.AppContext=t.App.appContext;this.Locale={};this.Value=[];this.ServerUrl="";this.ImagePath="";this.SkipHelperFlag=!0}return n}(),u;i.TemplateEngineModel=r;u=function(){function i(){}return i.applyTemplate=function(u,f,e,o,s){var h,l,a,v,c;if(e===void 0&&(e=!1),o===void 0&&(o=!0),s===void 0&&(s=!1),h="",e){if(l=t.Util.LPathLocalStorage.retrieve(u.toLowerCase()).LanguageControlVersionContents,l)for(a=0;a<l.length;a++)if(l[a].Lcid===n.Loader.defaultLcidforTemplates){h=l[a].HtmlView;break}}else h=i.templates[u];return h?(v=i.compiledTemplates[u],h=o?h.replace(/\\{{skip-helper}}/g,""):h.replace(/\\{{skip-helper}}/g,"\\"),v=i.compiledTemplates[u]=Handlebars.compile(h),s?v(f):(c=new r,c.Locale=n.Loader.marsLocale,c.Value=f,c.ServerUrl=n.Loader.serverUrl,c.ImagePath=n.Loader.marsImageMapping,c.SkipHelperFlag=o,v(c))):""},i.compiledTemplates={},i.templates=[],i}();i.TemplateEngine=u})(i=t.Renderer||(t.Renderer={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";(function(n){n[n.Button=-1]="Button";n[n.renderer_titletexttemplate=0]="renderer_titletexttemplate";n[n.renderer_titlevideotemplate=1]="renderer_titlevideotemplate";n[n.TitleImage=2]="TitleImage";n[n.TitleTextLink=3]="TitleTextLink";n[n.renderer_addexistingguidedtasktemplate=4]="renderer_addexistingguidedtasktemplate";n[n.ExistingSection=5]="ExistingSection";n[n.renderer_onebuttontemplate=6]="renderer_onebuttontemplate";n[n.renderer_twobuttontemplate=7]="renderer_twobuttontemplate";n[n.TitleCustomLinks=8]="TitleCustomLinks";n[n.renderer_listoflinkstemplate=9]="renderer_listoflinkstemplate";n[n.CheckList=10]="CheckList";n[n.renderer_legacyhelptemplate=11]="renderer_legacyhelptemplate";n[n.renderer_footersectiontemplate=12]="renderer_footersectiontemplate"})(n.BuilderControlTemplateTypeEnum||(n.BuilderControlTemplateTypeEnum={}));var t=n.BuilderControlTemplateTypeEnum})(t=n.Util||(n.Util={}))})(t=n.Designer||(n.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){"use strict";var i=function(){function t(){}return t.setCookie=function(t,i,r){var u=new Date,f;u.setTime(u.getTime()+r*864e5);f="expires="+u.toUTCString();document.cookie=t+"="+n.Client.Loader.marsEncodeDecode.MarsUrlEncode(i)+"; "+f},t.getCookie=function(t){var i=document.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return i?n.Client.Loader.marsEncodeDecode.MarsUrlDecode(i[2]):undefined},t.deleteCookie=function(n){document.cookie=n+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},t}();t.MarsCookies=i})(i=t.Util||(t.Util={}))})(i=t.Designer||(t.Designer={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={}));