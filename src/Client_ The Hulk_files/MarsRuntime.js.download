var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},_MicrosoftMars,Microsoft;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(t,i,r,u,f,e,o,s){this.onErrorCallback=u;this.onAddItemCallback=f;this.onFailedToUpload=e;this.onRemoveItemCallback=o;this.closePopupCallback=s;this.index=i;this.browsedFileData=r;this.fileName=r.name;this.fileId=t;var h=this;n.$mars("#imported-File-Container").on("click","[class *='support-sidebar-delete-button']",function(){h.deleteFileClickHander(this)})}return t.prototype.uploadFileToServer=function(){var i=new n.$mars.Deferred,t=this,r=new FileReader;return this.showUploadingFilesWithLoadingGif(),r.onload=function(){var o=this.result,s=new _MicrosoftMars.Client.Loader.InAppSupportConfigurationAPI,u,f,e,r;u=_MicrosoftMars.Client.Loader.appContext.getAuthoringId();f=_MicrosoftMars.Client.Loader.appContext.UserId;e=_MicrosoftMars.Client.Loader.appContext.getOrgId();r=s.post("","WriteCloudFile?authoringId="+u+"&userId="+f+"&orgId="+e,o);r.done(function(n){t.fileData=t.getUploadedFileToList(n,t.fileId);t.removedUploadedFileLoading();t.onAddItemCallback(t.fileData);i.resolve()});r.fail(function(){t.onFailedToUpload(t.fileName,t.fileId);n.$mars("#ias_Upload_file"+t.index).remove();i.resolve()})},r.readAsDataURL(this.browsedFileData),i},t.prototype.showUploadingFilesWithLoadingGif=function(){$("#imported-File-Container").append('<div id="ias_Upload_file'+this.index+'" class= "support-sidebar-uploaded-file-links" style="display:inline-block">'+this.browsedFileData.name+'<div id="ias_Upload_fileLoading'+this.index+'" data-index="'+this.index+'" class= "support-sidebar-uploading-loader"><img data-action="loadingGif" src = "'+_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.uploadProgress+'"><\/div><\/div>')},t.prototype.removedUploadedFileLoading=function(){n.$mars("#ias_Upload_fileLoading"+this.index).remove();var i=n.$mars("#ias_Upload_file"+this.index),t=document.createElement("div");t.style.display="inline-block";t.innerHTML='<button id="supportSBFileDelete_'+this.index+'" data-uri="'+this.fileData.uri+'" role="button" aria-labelledby="ias_Upload_file'+this.index+'" aria-label="'+_MicrosoftMars.Client.Loader.marsLocale.fileDelete+'" class= "support-sidebar-delete-button" > <img data-action="removeFile" src ="'+_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.removeFile+'" alt="'+_MicrosoftMars.Client.Loader.marsLocale.remove+'"  tabindex="-1" /><\/button>';i.append(t)},t.prototype.deleteFileClickHander=function(t){var i=this,f;n.$mars("#supportImportFileForControls").val("");var r=t.id.match(/\d+/),u=n.$mars(t).attr("data-uri"),e=new n.InAppSupportDialog(n.InAppSupportDialogType.Confirmation,_MicrosoftMars.Client.Loader.marsLocale.supportSidebarConfirmRemoveImgTitle,_MicrosoftMars.Client.Loader.marsLocale.supportSidebarConfirmRemoveImgMessage,function(){i.deleteFileFromServer(u);i.onRemoveItemCallback(u);n.$mars("#ias_Upload_file"+r).remove();n.$mars(".support-sidebar-delete-button").closest("button")[0].focus()},function(){i.closePopupCallback();n.$mars("#supportSBFileDelete_"+r).focus()},function(){i.closePopupCallback();n.$mars("#supportSBFileDelete_"+r).focus()});e.show();f=n.SupportSidebar.getInstance();f.checkForHighContrastModeInApp()},t.prototype.deleteFileFromServer=function(n){var t=new _MicrosoftMars.Client.Loader.InAppSupportConfigurationAPI,i={uri:n};t.post(i,"DeleteCloudFile?fileUri="+n)},t.prototype.getUploadedFileToList=function(n,t){return{fileId:t,filename:this.fileName,filesize:n.Result.filesize,mimetype:n.Result.mimetype,uri:n.Result.uri}},t}();n.Fileupload=t})(t=n.InAppSupport||(n.InAppSupport={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))})(Microsoft||(Microsoft={})),function(n){"use strict";n.$loader=window._MicrosoftMars.Client.Loader;var t=function(){function t(){if(this._configuration=null,this._crmCurrentStatus=null,t._instance)throw new Error("Singleton instance already exists for InAppSupportConfiguration. Access it via InAppSupportConfiguration.getInstance()");else this.loadInAppSupportConfiguration()}return t.getInstance=function(){return t._instance==null&&(t._instance=new t),t._instance},Object.defineProperty(t.prototype,"Configuration",{get:function(){return this._configuration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CrmCurrentStatus",{get:function(){return this._crmCurrentStatus},set:function(n){this._crmCurrentStatus=n},enumerable:!0,configurable:!0}),t.prototype.getTemplateHtml=function(n){if(this._configuration!=null)return this._configuration[t.templateName][n]},t.prototype.getPortalUrl=function(){if(this._configuration!=null)return this._configuration[t.portalUrlName]},t.prototype.getAdminRoleTemplateIds=function(){if(this._configuration!=null)return this._configuration[t.AdminRoleTemplateName]},t.prototype.getPrivacyFwLinkBase=function(){if(this._configuration!=null)return this._configuration[t.privacyFWLinkBaseName]},t.prototype.getPrivacyFwLinkId=function(){if(this._configuration!=null)return this._configuration[t.privacyFWLinkName]},t.prototype.getFileMaxSize=function(){if(this._configuration!=null)return this._configuration[t.maxFileSizeName]},t.prototype.getTotalFileLimit=function(){if(this._configuration!=null)return this._configuration[t.totalFilelimitName]},t.prototype.getFileNameMaxLength=function(){if(this._configuration!=null)return this._configuration[t.maxFileNameLength]},t.prototype.getCrmSupportEmail=function(){if(this._configuration!=null)return this._configuration[t.crmSupportEmailName]},t.prototype.loadInAppSupportConfiguration=function(){var i=this,u=new n.$loader.InAppSupportConfigurationAPI,r=u.getInAppSupportConfiguration();r.done(function(r){var e,u,f;if(r!=null&&r.Result!=null){e=window._MicrosoftMars.Client.Utility;u=JSON.parse(r.Result);for(f in u[t.templateName])u[t.templateName].hasOwnProperty(f)&&f.toLowerCase()!=t.createSupportTicketName&&(u[t.templateName][f]=e.Util.getHtmlFromTemplate(u[t.templateName][f],n.$loader));i._configuration=u;console.log("Loading InApp configuration succeed!!!");n.Client.InAppSupport.Util.isInAppSupportFeatureEnabled(!1)&&i.createContactifNotExists()}else console.log("Loading InApp configuration returned null data.");n.Client.Loader.appContext.getUserInfo()});r.fail(function(n){console.log("Loading InApp configuration failed."+n)})},t.prototype.getSupportJsonObj=function(t,i,r,u,f){for(var o,e,a,v=n.$loader.appContext.roleTemplates,c=this.getAdminRoleTemplateIds(),l=100000001,s=0;s<c.length;s++)if(v.indexOf(c[s])>-1){l=1e8;break}o=n.$loader.appContext.UserDetails||{FirstName:n.$loader.appContext.UserName,LastName:"",Email:""};e=n.$loader.appContext.TenantId;e=="00000000-0000-0000-0000-000000000000"&&(e="AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA");var y=n.$loader.appContext.UserId.replace(/[{}]/g,""),p={TenantOrgDetails:{TenantId:e,AccountName:n.Client.Loader.appContext.TenantName,OrgId:n.Client.Loader.appContext.getOrgId(),OrgName:n.Client.Loader.appContext.getOrgName()},User:{Id:y,EmailId:o.Email,FirstName:o.FirstName,LastName:o.LastName,RoleId:l},Incident:{Title:t?t.replace(/\\/g,"\\\\").replace(/"/g,'\\"'):null,Description:i?i.replace(/\\/g,"\\\\").replace(/"/g,'\\"'):null,PageContext:{TenantId:e,TenantName:n.Client.Loader.appContext.TenantName,OrgId:n.Client.Loader.appContext.getOrgId(),OrgName:n.Client.Loader.appContext.getOrgName(),PageType:n.Client.Loader.appContext.getPageType(),PageUrl:n.Client.Loader.appContext.getPageNavigationInfo()[n.Client.Loader.appContext.ClientType]},IsCreatingCriticalWorkStoppage:r?r.toString():"false",IsPotentialCompanyWideWorkStopper:u?u.toString():"false",TimeWhenIssueOccurred:f,OrgVersion:n.Client.Loader.appContext.getAppVersion()}},h=this.getTemplateHtml("CreateSupportTicketJSON");return h=h.replace(/["]/g,'"'),a=window._MicrosoftMars.Client.Utility.Util.getHtmlFromTemplate(h,p),JSON.parse(a)},t.prototype.createContactifNotExists=function(){if(this.CrmCurrentStatus==null){var i=this.getSupportJsonObj(null,null,null,null,null),r=this,u=new n.$loader.InAppSupportConfigurationAPI,t=u.post(i,"CreateContact");t.done(function(n){n!=null&&n.Succeeded&&n.Result&&(console.log("Creating new contact succeded."),r._crmCurrentStatus=n.Result.CurrentStatus)});t.fail(function(n){console.log("Creating new contact failed."+n)})}},t.templateName="Templates",t.portalUrlName="PortalUrl",t.privacyFWLinkBaseName="PrivacyFwLinkBase",t.privacyFWLinkName="PrivacyFwLinkId",t.maxFileSizeName="FileMaxSize",t.totalFilelimitName="TotalFileLimit",t.maxFileNameLength="FileNameLength",t.createSupportTicketName="createsupportticketjson",t.crmSupportEmailName="CrmSupportEmail",t.AdminRoleTemplateName="AdminRoleTemplateIds",t._instance=null,t}();n.InAppSupportConfiguration=t}(_MicrosoftMars||(_MicrosoftMars={})),function(n){"use strict";var t=function(){function n(){}return n.supportSidebarOverlayDivId="lpathRuntimeOverlay",n.supportSidebarPanelId="supportSidebarPanel",n.supportSidebarContainerDivId="supportSidebarContainer",n.supportSidebarContentDivId="supportSidebarContent",n.lPathDialogHolderId="lPathDialogHolder",n.privacyCheckboxId="privacyCheckbox",n.createSupportContentId="CreateSupportContent",n.issueTitleBoxId="supportSidebarIssueTitleTextBox",n.issueDescriptionBoxId="issueDescriptionBox",n.issueDateId="issueDate",n.contactSupportId="contactSupport",n.openSupportPortalId="openSupportPortal",n.dialogTitleDivId="supportSBDialogTitle",n.dialogMessageDivId="supportSBDialogMessage",n.radioButtonYesValue="yes",n.radioButtonNoValue="no",n.loadingPanelId="loadingGifDiv",n.loadingPanelIdForFileUpload="loadingGifConainerForFileUpload",n.emptyGuid="00000000-0000-0000-0000-000000000000",n.supportPrefix="support_",n.sidebarHomeIconId="support-home-icon",n.feedbackButtonId=n.supportPrefix+"feedbackBtn",n.feedbackSmileDivId=n.supportPrefix+"feedbackSmile",n.feedbackFrownDivId=n.supportPrefix+"feedbackFrown",n}();n.InAppSupportConstants=t}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";(function(n){n[n.Error=0]="Error";n[n.Confirmation=1]="Confirmation"})(n.InAppSupportDialogType||(n.InAppSupportDialogType={}));var t=n.InAppSupportDialogType,i=function(){function n(n,i,r,u,f,e){this.dialogType=n;this.dialogTitle=i;this.dialogMessage=r;this.onOkCallback=u;this.onCancelIconCallback=f;this.onCancelCallback=e;this.rootElement=null;this.okBtn=null;this.cancelBtn=null;this.closeIcon=null;this.rootElement=_MicrosoftMars.Client.Loader.$mars("#"+_MicrosoftMars.InAppSupportConstants.lPathDialogHolderId);this.rootElement.empty();var o="";switch(this.dialogType){case t.Confirmation:o=_MicrosoftMars.InAppSupportConfiguration.getInstance().getTemplateHtml("ConfirmationBox");break;case t.Error:o=_MicrosoftMars.InAppSupportConfiguration.getInstance().getTemplateHtml("ErrorBox");break;default:console.log("Error : Invalid dialog type provided for In App Support Dialog")}this.rootElement.marsAppend(this.rootElement,o);this.rootElement.find("#"+_MicrosoftMars.InAppSupportConstants.dialogTitleDivId).html(this.dialogTitle);this.rootElement.find("#"+_MicrosoftMars.InAppSupportConstants.dialogMessageDivId).html(this.dialogMessage);this.okBtn=this.rootElement.find("#lpath-simple-btnOk");this.cancelBtn=this.rootElement.find("#lpath-simple-btnCancel");this.closeIcon=this.rootElement.find("#lpath-simple-btnClose")}return n.prototype.show=function(){this.rootElement.show();var n=_MicrosoftMars.Client.Loader.$mars("#"+_MicrosoftMars.InAppSupportConstants.supportSidebarOverlayDivId).find("#lpath-simple-btnOk");n.focus();this.dialogFocus(!0);this.dialogBoxEventHandling()},n.prototype.dialogBoxEventHandling=function(){var n=this;this.rootElement.off("click").on("click",function(){n.okBtn.focus()});this.okBtn.off("click").on("click",function(t){n.onOkClick();t.stopPropagation();t.preventDefault()});this.cancelBtn.off("click").on("click",function(t){n.onCancelClick();t.stopPropagation();t.preventDefault()});this.closeIcon.off("click").on("click",function(t){n.onCloseIconClick();t.stopPropagation();t.preventDefault()});switch(this.dialogType){case t.Confirmation:this.confirmBoxEventHandling();break;case t.Error:this.errorBoxEventHandling();break;default:console.log("Error : Invalid dialog type provided for In App Support Dialog")}},n.prototype.confirmBoxEventHandling=function(){var n=this;this.closeIcon.off("keydown").on("keydown",function(t){if(t.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.TabKey&&t.shiftKey)return n.cancelBtn.focus(),!1});this.cancelBtn.off("keydown").on("keydown",function(t){if(t.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.TabKey&&!t.shiftKey)return n.closeIcon.focus(),!1});_MicrosoftMars.Client.Loader.$mars("#supportSBConfirmationDialog").off("keydown").on("keydown",function(t){if(t.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.EscapeKey)return n.onCloseIconClick(),!1})},n.prototype.errorBoxEventHandling=function(){var n=this;this.okBtn.off("keydown").on("keydown",function(t){if(t.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.TabKey&&!t.shiftKey)return n.closeIcon.focus(),!1});this.closeIcon.off("keydown").on("keydown",function(t){if(t.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.TabKey&&t.shiftKey)return n.okBtn.focus(),!1});this.rootElement.off("keydown").on("keydown",function(t){if(t.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.EscapeKey)return n.onCloseIconClick(),_MicrosoftMars.Client.Loader.$mars("#supportSidebarIssueTitleTextBox").focus(),!1})},n.prototype.executeOkClick=function(){this.onOkCallback&&this.onOkCallback();this.dialogFocus(!1)},n.prototype.onDialogClose=function(){this.onCancelCallback&&this.onCancelCallback();this.dialogFocus(!1)},n.prototype.onCloseIconClicked=function(){this.onCancelIconCallback&&this.onCancelIconCallback();this.dialogFocus(!1)},n.prototype.onOkClick=function(){return this.executeOkClick()},n.prototype.onCloseIconClick=function(){return this.onCloseIconClicked()},n.prototype.onCancelClick=function(){return this.onDialogClose()},n.prototype.dialogFocus=function(n){_MicrosoftMars.Client.Loader.$mars("body").children().not("#lpathRuntimeOverlay").attr("aria-hidden",n);_MicrosoftMars.Client.Loader.$mars("#lpathRuntimeOverlay").children().not("#supportSidebarPanel").attr("aria-hidden",n);_MicrosoftMars.Client.Loader.$mars("#supportSidebarPanel").children().not("#lpathSupportSBDialogHolder").attr("aria-hidden",n)},n}();n.InAppSupportDialog=i})(t=n.InAppSupport||(n.InAppSupport={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){"use strict";n.$mars=window._MicrosoftMars.Client.Loader.$mars;n.serverUrl=window._MicrosoftMars.Client.Loader.serverUrl;var t=function(){function t(){}return t.toDisplayChatOption=function(){return n.Client.Loader.appContext.CurrentStage.toLowerCase()===t.CurrentStage?n.Client.Loader.marsLocale.feedbackChatCaption:""},t.defaultWidth=300,t.defaultBlankWidth=50,t.shadowWidth=8,t.animationSpeed=1e3,t.oneXPageSize=1,t.twoXPageSize=2,t.threeXPageSize=3,t.feedbackCharacterLimit=400,t.divsPerPageLimit=2,t.answerPanelDefaultHeight=400,t.leftBorderShadow="#999 8px 0px 5px -5px",t.leftBorder="1px solid #007735",t.CurrentStage="test drive",t.feedbackprivacyUrl="http://go.microsoft.com/fwlink/?LinkID=528361",t.iframeCSS="mars-answerpanel-container",t.sidebar2xTemplate="renderer_answerpanel2x2template",t.learningPathOverlayId="lpathRuntimeOverlay",t.sidebarHomeIconId="home-icon",t.feedbackOverlayDivId="lpathRuntimeFeedbackOverlay",t.feedbackButtonId="feedbackBtn",t.feedbackSmileDivId="feedbackSmile",t.feedbackFrownDivId="feedbackFrown",t.hotspotCSS={position:"absolute",width:"10px",height:"95%",top:"5%"},t.contentPageCSS={width:"90%","overflow-y":"auto",height:"93%",padding:"3.5%"},t.feedbackSearchContent='<div id="answerPanelSearch" class="paddingtopthree"><\/div><div id="feedback" class="feedbackOptions" role="menu"><div class="mars-feedback-options" id="feedbackSmile" tabindex="0" role="menuitem" aria-posinset="1" aria-setsize="2"><img src="'+n.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.feedbackOptionSmileyIcon+'" /><label class="mars-ellipsis" aria-label="'+n.Client.Loader.marsLocale.sendFeedbackSmile+'"><span aria-hidden="true" title="'+n.Client.Loader.marsLocale.sendFeedbackSmile+'">'+n.Client.Loader.marsLocale.sendFeedbackSmile+'<\/span><\/label><\/div><div class="mars-feedback-options" id="feedbackFrown" tabindex="0" role="menuitem" aria-posinset="2" aria-setsize="2"><img src="'+n.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.feedbackOptionFrownyIcon+'" /><label class="mars-ellipsis" aria-label="'+n.Client.Loader.marsLocale.sendFeedbackFrown+'"><span aria-hidden="true" title="'+n.Client.Loader.marsLocale.sendFeedbackFrown+'">'+n.Client.Loader.marsLocale.sendFeedbackFrown+"<\/span><\/label><\/div><\/div>",t.feedbackBoxContent='<div id="feedbackBox" aria-hidden="false" class="feedbackBox" role="dialog" aria-labelledby="feedbackHeader"><div class="mars-feedback-head" ><label id="feedbackHeader" class="mars-ellipsis"> <\/label><input type="image" id="closeFeedbackBox" src=" '+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.closeIcon+'" alt="'+n.Client.Loader.marsLocale.close+'" /><\/div><div class="mars-feedback-textarea"><textarea rows="5" id="feedbackDescription" class="verticalscroll"><\/textarea><\/div><div class="mars-feedback-footer"><div id="lpChatButton" style="display:none"><\/div><a href="#" class="mars-ellipsis" id="chatlinkText">'+t.toDisplayChatOption()+'<\/a><input type="button" class="mars-ellipsis" id="feedbackSend" value="'+n.Client.Loader.marsLocale.sendFeedbackText+'" tabindex="0" /><\/div><div class="mars-ellipsis mars-feedback-privacy-container" tabindex="0"><a tabindex="0" role="link" class="mars-feedback-privacy">'+n.Client.Loader.marsLocale.feedbackPrivacyCaption+"<\/a><\/div><\/div>",t.answerpanelPagination='<div id="prevnext"><button id="prev">« '+n.Client.Loader.$mars("#previousButtonText").text()+'<\/button><button id="next"> '+n.Client.Loader.$mars("#nextButtonText").text()+" »<\/button><\/div>",t}();n.AnswerPanelConstants=t}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){"use strict";var i,r;t.$mars=window._MicrosoftMars.Client.Loader.$mars;i=function(){function n(){}return n.width=_MicrosoftMars.AnswerPanelConstants.defaultWidth,n.isRTL=window._MicrosoftMars.Client.Loader.appContext.isRTL(),n}();t.SupportSidebarModel=i;r=function(){function r(){var i=this,n;if(this.uploadedFileDetails=[],this.listOfFileFailedToUpload=[],this.isLastDeletedFile=!1,this.answerPanelInstance=null,this.inAppSupportSubmitActivityData=[],r._instance)throw new Error("Error: Instantiation failed: Use SupportSidebar.createInstance instead of new.");this.answerPanelInstance=window._MicrosoftMars.AnswerPanel.getInstance();n=this;this.supportSidebarOverlay=t.$mars(window._MicrosoftMars.Client.Loader.appContext.util.getOrCreateOverlay());this.feedbackOverlay=t.$mars(window._MicrosoftMars.Client.Loader.appContext.util.getOrCreateFeedbackOverlay());r._instance=this;this.supportSidebarPanelElement=t.$mars().add('<div class="lpath-runner" id="'+_MicrosoftMars.InAppSupportConstants.supportSidebarPanelId+'" ><\/div>');this.supportSidebarPanelElement.addClass(_MicrosoftMars.AnswerPanelConstants.iframeCSS);this.supportSidebarPanelElement.attr("role","dialog");_MicrosoftMars.Client.Loader.appContext.clientType==="Mobile"&&this.supportSidebarPanelElement.addClass("lpath-moca-ap-height");this.shortcutKeysClickHandler=function(t){i.setShortcutKeys(t,n)};this.fileuploadIndex=0;this.answerPanelInstance=window._MicrosoftMars.AnswerPanel.getInstance();this.fileId=0;this.appContext=_MicrosoftMars.Client.Loader.appContext;this.clientType=this.appContext.ClientType;this.pageNavigationInfo=this.appContext.getPageNavigationInfo();this.pageUrl=this.pageNavigationInfo[this.clientType];this.pageType=this.appContext.getPageType();this.userId=this.appContext.UserId.replace(/[{}]/g,"");this.orgId=this.appContext.getOrgId();this.userRole=this.appContext.userRoleNames;this.crmVersion=this.appContext.version;this.pgName=this.appContext.Util.getPublishGroupDetails(_MicrosoftMars.AnswerPanelModel.publishGroupId,"Name");this.formFactor=this.appContext.getFormFactor();this.formFactorName=this.formFactor=="1"?"Desktop":this.formFactor=="2"?"Tablet":this.formFactor=="3"?"Phone":""}return Object.defineProperty(r.prototype,"isSupportSidebarVisible",{get:function(){return this._isSupportSidebarVisible},set:function(n){this._isSupportSidebarVisible=n;n?t.$mars("#"+_MicrosoftMars.InAppSupportConstants.supportSidebarOverlayDivId).bind("keydown",this.shortcutKeysClickHandler):t.$mars("#"+_MicrosoftMars.InAppSupportConstants.supportSidebarOverlayDivId).unbind("keydown",this.shortcutKeysClickHandler)},enumerable:!0,configurable:!0}),r.getInstance=function(){return r._instance==null&&(r._instance=new r),r._instance},r.prototype.createSupportSidebarOverlay=function(){this.supportSidebarPanelElement.empty();this.supportSidebarPanelElement.marsAppend(this.supportSidebarPanelElement,_MicrosoftMars.InAppSupportConfiguration.getInstance().getTemplateHtml("SupportSidebar"));t.$mars("#"+_MicrosoftMars.InAppSupportConstants.supportSidebarOverlayDivId).append(this.supportSidebarPanelElement)},r.prototype.logInAppSupportTelemetry=function(n,t){var r=this,i=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName[n],!1);i.SetUserActivityInfo(r.userId,"","","","","","","SupportSideBar");i.SetActivityData(t);i.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete)},r.prototype.openSupportSidebar=function(){var i=this,u,f,e,o,r,s,n;this.answerPanelInstance.removeAnswerPanelOverlayClickHandler();this.answerPanelInstance.hideAnswerPanelContainer();this.createSupportSidebarOverlay();this.isLastDeletedFile=!1;this.uploadedFileDetails=[];_MicrosoftMars.AnswerPanelModel.IsSideBarFooterDisabled?(u=50,this.supportSidebarPanelElement.find("#"+_MicrosoftMars.InAppSupportConstants.supportSidebarContentDivId).css("height","calc(100% - ("+u+"px)"),this.supportSidebarPanelElement.find("#support_footer").remove()):this.addFooterSection();this.setWidth();f=[this.formFactorName,this.pageUrl,this.pageType,"",(new Date).toString(),(new Date).toString(),this.orgId,this.crmVersion,this.clientType,this.userRole,"",""];this.logInAppSupportTelemetry("inAppSupportFormOpen",f,"complete");e=_MicrosoftMars.Client.Loader.$mars("#supportSidebarCloseIcon");e.off("click").on("click",function(n){i.onCancelSupportSidebarClick(t.$mars("#supportSidebarCloseIcon"));n.stopPropagation();n.preventDefault()});o=t.$mars("#privacyPolicyURL");o.attr("href",this.getPrivacyPolicyURL());r=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.issueDateId);r.attr("value",this.getCurrentDateTimeForDatePicker());r.attr("max",this.getCurrentDateTimeForDatePicker());t.$mars("#supportSidebarSubmitButton").off("click").on("click",function(){i.onSubmitButtonClick()});t.$mars("#supportSidebarCancelButton").off("click").on("click",function(n){i.onCancelSupportSidebarClick(t.$mars("#supportSidebarCancelButton"));n.stopPropagation();n.preventDefault()});s=t.$mars("#"+_MicrosoftMars.AnswerPanelConstants.feedbackOverlayDivId);this.answerPanelInstance.feedBack(this.supportSidebarPanelElement,s);n=this;n.supportSidebarPanelElement.find("#"+_MicrosoftMars.InAppSupportConstants.sidebarHomeIconId).off("click keydown").on("click keydown",function(t){if(t.type==="click"||_MicrosoftMars.Client.Loader.appContext.Util.isEnterPressed(t,!0)){n.onCancelSupportSidebarClick(n.supportSidebarPanelElement.find("#"+_MicrosoftMars.InAppSupportConstants.sidebarHomeIconId));t.stopPropagation();t.preventDefault()}});_MicrosoftMars.propertyHomeTabContainer&&_MicrosoftMars.propertyHomeTabContainer.hide();this.files=t.$mars("#supportImportFileForControls");this.handleEventsForUploadFile();this.browsedFileHandler();this.checkForHighContrastModeInApp();this.show(0);this.keyBoardHandling();setTimeout(function(){var n=$("#supportSidebarContainer");n.addClass("supportSidebar-background")},50)},r.prototype.addFooterSection=function(){this.footerElement=this.supportSidebarPanelElement.find("#support_footer");this.footerElement.addClass("paddingthree");this.footerElement.marsAppend(this.footerElement,_MicrosoftMars.InAppSupportConfiguration.getInstance().getTemplateHtml("SupportSidebarFooter"));this.feedbackOverlay.find("#feedbackBox").length==0&&this.feedbackOverlay.marsAppend(this.feedbackOverlay,_MicrosoftMars.AnswerPanelConstants.feedbackBoxContent)},r.prototype.setWidth=function(){i.displacement=i.width+_MicrosoftMars.AnswerPanelConstants.shadowWidth;i.isRTL?(this.supportSidebarPanelElement.css({width:i.width+"px",left:"-"+i.displacement+"px"}),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SupportSidebar launch for RTL")):(this.supportSidebarPanelElement.css({width:i.width+"px",right:"-"+i.displacement+"px"}),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"SupportSidebar launch for NON-RTL"))},r.prototype.show=function(){t.$mars("#"+_MicrosoftMars.InAppSupportConstants.supportSidebarOverlayDivId).show();this.isSupportSidebarVisible=!0;var n;n=i.isRTL?{left:0}:{right:0};this.supportSidebarPanelElement.css("visibility","visible");this.supportSidebarPanelElement.css(n);this.answerPanelInstance.changeHelpIconStateOnSidebarToggle("white",_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.marshelpIconSidebarLoadCompleteRTL,_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.marshelpIconSidebarLoadComplete)},r.prototype.hide=function(){var n;this.isSupportSidebarVisible=!1;n=i.isRTL?{left:"-"+i.displacement+"px"}:{right:"-"+i.displacement+"px"};this.supportSidebarPanelElement.css(n);this.supportSidebarPanelElement.css("visibility","hidden");this.feedbackOverlay.html("")},r.prototype.checkForHighContrastModeInApp=function(){var i,n,r,o,u,f,s,e,h,c;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:checkForHighContrastModeInApp START");t.$mars("#marsIFrame").css("background-image")==="none"&&(i=!1,n=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.supportSidebarPanelId),n.hasClass("lpath-highcontrast")||n.addClass("lpath-highcontrast"),n.hasClass("lpath-overlay-initial-highcontrast")||n.addClass("lpath-overlay-initial-highcontrast"),t.$mars("body").css("background-color")==="rgb(255, 255, 255)"?(i=!0,n.hasClass("supportSidebar-hc-white")||n.addClass("supportSidebar-hc-white"),n.hasClass("lpath_highcontrast_white")||n.addClass("lpath_highcontrast_white")):n.hasClass("supportSidebar-hc-black")||n.addClass("supportSidebar-hc-black"),r=this.supportSidebarPanelElement.find("#supportSidebarCloseIcon"),o=t.$mars("#lPathDialogHolder").find("#closeIcon"),r&&(u=i?_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.closeIconInHCW:_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.closeIconInHighContrast,r.attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/"+u),o.attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/"+u)),f=this.supportSidebarPanelElement.find("#imported-File-Container [data-action='removeFile']"),f&&(s=i?_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.removeFile_HighContrastWhite:_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.removeFile_HighContrastBlack,f.attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/"+s)),e=this.supportSidebarPanelElement.find("#imported-File-Container [data-action='loadingGif']"),e&&(h=i?_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.uploadProgress_HighContrastWhite:_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.uploadProgress_HighContrastBlack,e.attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/"+h)),t.$mars("#lpathRuntimeSupportSidebarOverlay").css("background","none"),c=t.$mars("#"+_MicrosoftMars.AnswerPanelConstants.feedbackOverlayDivId),this.handleHighContrastModeForFooterIcons(this.supportSidebarPanelElement,c,i));_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:checkForHighContrastModeInApp END")},r.prototype.handleHighContrastModeForFooterIcons=function(n,t,i){var o=i?_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.sidebarContextHomeIconInHCW:_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.sidebarContextHomeIconInHCB,r,u,f,e;n.find("#"+_MicrosoftMars.InAppSupportConstants.sidebarHomeIconId).attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/"+o);r=i?_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.sidebarSmileyIconInHCW:_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.sidebarSmileyIconInHCB;n.find("#"+_MicrosoftMars.InAppSupportConstants.feedbackButtonId).attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/"+r);u=i?_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.smileyIconInHCW:_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.smileyIconInHCB;n.find("#"+_MicrosoftMars.InAppSupportConstants.feedbackSmileDivId).find("img").attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/"+u);f=i?_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.frownyIconInHCW:_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.frownyIconInHCB;n.find("#"+_MicrosoftMars.InAppSupportConstants.feedbackFrownDivId).find("img").attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/"+f);e=i?_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.closeIconInHCW:_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.closeIconInHighContrast;t.find("#closeFeedbackBox").attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/"+e)},r.prototype.keyBoardHandling=function(){var n=this,i;t.$mars("#supportSidebarContainer").find("#"+_MicrosoftMars.InAppSupportConstants.feedbackButtonId).off("keydown").on("keydown",function(n){n.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.TabKey&&n.shiftKey||n.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.TabKey&&(t.$mars("#supportSidebarCloseIcon").focus(),n.stopPropagation(),n.preventDefault())});t.$mars("#supportSidebarContainer").find("#supportSidebarCloseIcon").off("keydown").on("keydown",function(i){if(i.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.TabKey&&i.shiftKey&&(t.$mars("#supportSidebarContainer").find("#"+_MicrosoftMars.InAppSupportConstants.feedbackButtonId).focus(),i.stopPropagation(),i.preventDefault()),i.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.EnterKey||i.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.SpaceKey){n.onCancelSupportSidebarClick(t.$mars("#supportSidebarCloseIcon"));return!1}});t.$mars("#supportSidebarContainer").off("keydown").on("keydown",function(i){if(i.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.EscapeKey){n.onCancelSupportSidebarClick(t.$mars("#supportSidebarCloseIcon"));i.stopPropagation();i.preventDefault()}});t.$mars("#supportSidebarContainer").find("#privacyPolicyURL").off("keydown").on("keydown",function(t){(t.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.EnterKey||t.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.SpaceKey)&&window.open(n.getPrivacyPolicyURL(),"_blank")});i=this.supportSidebarPanelElement.find("#supportSidebarIssueTitleTextBox");i.focus()},r.prototype.setShortcutKeys=function(n,i){if(n.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.EscapeKey){i.onCancelSupportSidebarClick(t.$mars("#supportSidebarCloseIcon"));n.stopPropagation();n.preventDefault()}else n.altKey&&n.ctrlKey&&(n.keyCode===103||n.keyCode===55)?t.$mars("#"+_MicrosoftMars.InAppSupportConstants.feedbackSmileDivId).trigger("click"):n.altKey&&n.ctrlKey&&(n.keyCode===104||n.keyCode===56)?t.$mars("#"+_MicrosoftMars.InAppSupportConstants.feedbackFrownDivId).trigger("click"):n.ctrlKey&&n.keyCode===117&&this.handleQuickNavigation()},r.prototype.handleQuickNavigation=function(){t.$mars("#"+_MicrosoftMars.InAppSupportConstants.sidebarHomeIconId).focus()},r.prototype.getPrivacyPolicyURL=function(){return _MicrosoftMars.InAppSupportConfiguration.getInstance().getPrivacyFwLinkBase()+"?LinkID="+_MicrosoftMars.InAppSupportConfiguration.getInstance().getPrivacyFwLinkId()+"&ClcId="+_MicrosoftMars.Client.Loader.appContext.getOrgLcid().toString(16)},r.prototype.handleEventsForUploadFile=function(){var n=this;_MicrosoftMars.$mars("#supportBrowseButton").keyup(function(t){if(_MicrosoftMars.Client.Loader.appContext.Util.isEnterPressed(t,!0)){if(n.isLastDeletedFile)return n.isLastDeletedFile=!1,!1;n.files.click()}})},r.prototype.browsedFileHandler=function(){var n=this;this.files.on("change",function(t){n.fileSelectHandler(t,n)})},r.prototype.fileSelectHandler=function(n,i){var e=this,f,s,u,r,a,v,y,h,p;n.stopPropagation();f=_MicrosoftMars.Client.Loader.marsLocale.informationRequiredError;this.browsedFiles=this.files.get(0).files;var w=_MicrosoftMars.InAppSupportConfiguration.getInstance().getFileMaxSize(),o=_MicrosoftMars.InAppSupportConfiguration.getInstance().getTotalFileLimit(),c=_MicrosoftMars.InAppSupportConfiguration.getInstance().getFileNameMaxLength(),l=[];if(this.listOfFileFailedToUpload=[],this.browsedFiles){if(this.uploadedFileDetails.length==o)s=_MicrosoftMars.Client.Loader.marsLocale.supportMaxFileUploadCountError.replace("{0}",o),this.openFileErrorDialog(this,f,s,"50101","MaxFileUploadCountError");else if(this.uploadedFileDetails.length+this.browsedFiles.length>o)s=_MicrosoftMars.Client.Loader.marsLocale.supportTotalFileCount.replace("{0}",o),this.openFileErrorDialog(this,f,s,"50102","TotalFileCountError");else{for(u=0;u<this.browsedFiles.length;u++)this.browsedFiles[u].size<=w?this.browsedFiles[u].size>0?this.validateUploadFileFormats(this.browsedFiles[u].name)?this.browsedFiles[u].name.length<c?(this.fileuploadIndex++,r=this,this.fileId=this.fileId+1,a=this.getUploadedFileObject(this.fileId,this.browsedFiles[u]),r.uploadedFileDetails.push(a),v=new t.Fileupload(this.fileId,this.fileuploadIndex,this.browsedFiles[u],function(n,t){var u=[i.formFactorName,i.pageUrl,i.pageType,"",(new Date).toString(),(new Date).toString(),i.orgId,i.crmVersion,i.clientType,i.userRole,"50100",t,"0"];i.logInAppSupportTelemetry("inAppSupportFileUploadClient",u,"incomplete");r.openErrorDialog(r,n,t)},function(n){for(var u,f,t=0;t<r.uploadedFileDetails.length;t++)if(u=r.uploadedFileDetails[t],u.fileId===n.fileId){r.uploadedFileDetails[t].uri=n.uri;break}r.bindFileList();f=[i.formFactorName,i.pageUrl,i.pageType,"",(new Date).toString(),(new Date).toString(),i.orgId,i.crmVersion,i.clientType,i.userRole,"","",n.filesize];r.logInAppSupportTelemetry("inAppSupportFileUploadClient",f,"complete")},function(n,t){for(var i=0;i<r.uploadedFileDetails.length;i++)if(r.uploadedFileDetails[i].fileId===t){r.uploadedFileDetails.splice(i,1);break}r.listOfFileFailedToUpload.push(n)},function(n){var f=r.uploadedFileDetails.map(function(n){return n.uri}).indexOf(n),u;r.uploadedFileDetails.splice(f,1);r.uploadedFileDetails.length===0&&(i.isLastDeletedFile=!0,t.$mars("#supportBrowseButton").focus());r.bindFileList();u=[i.formFactorName,i.pageUrl,i.pageType,"",(new Date).toString(),(new Date).toString(),i.orgId,i.crmVersion,i.clientType,i.userRole,"","",n];i.logInAppSupportTelemetry("inAppSupportFileDeleteClient",u,"complete");r.closeDialogBox()},function(){r.closeDialogBox()}),l.push(v.uploadFileToServer()),r.checkForHighContrastModeInApp()):(y=_MicrosoftMars.Client.Loader.marsLocale.fileNameLengthValidation+" "+c,this.openFileErrorDialog(this,f,y,"50103","FileNameLengthExceeded")):(h=_MicrosoftMars.Client.Loader.marsLocale.fileFormatNotSupported,this.openFileErrorDialog(this,f,h,"50104","FileFormatNotSupported")):(h=_MicrosoftMars.Client.Loader.marsLocale.fileUploadEmptyValidation,this.openFileErrorDialog(this,f,h,"50105","EmptyFileUpload")):(p=_MicrosoftMars.Client.Loader.marsLocale.supportMaxUploadSizeError,this.openFileErrorDialog(this,f,p,"50106","MaxUploadSizeError"));t.$mars.when.apply(undefined,l).done(function(){var n,t;if(e.listOfFileFailedToUpload.length>0){for(n=_MicrosoftMars.Client.Loader.marsLocale.fileUploadFail+"<br/>",t=0;t<e.listOfFileFailedToUpload.length;t++)n+=e.listOfFileFailedToUpload[t]+", ";n+="<br/>"+_MicrosoftMars.Client.Loader.marsLocale.tryToReuploadCaption;e.openFileErrorDialog(e,_MicrosoftMars.Client.Loader.marsLocale.errorMessage,n,"0","")}e.checkForHighContrastModeInApp();_MicrosoftMars.Client.Loader.currentInstance.UpdateMarsAriaLiveContent(_MicrosoftMars.Client.Loader.marsLocale.fileuploadedCaption,_MicrosoftMars.Client.Utility.AriaLiveType.assertive)})}$("#supportImportFileForControls").val("")}},r.prototype.bindFileList=function(){for(var n="",r=t.$mars("#support-browseFilePath"),i=0;i<this.uploadedFileDetails.length;i++)n+=this.uploadedFileDetails[i].filename+", ";r.attr("placeholder",n);r.attr("title",n)},r.prototype.openErrorDialog=function(i,r,u,f){f===void 0&&(f="");var e=new n.Mars.Client.Runtime.InAppSupport.InAppSupportDialog(t.InAppSupportDialogType.Error,r,u,function(){i.onErrorBoxCancelClick(f)},function(){i.onErrorBoxCancelClick(f)});if(e.show(),i.checkForHighContrastModeInApp(),f&&f!="")_MicrosoftMars.Client.Loader.$mars("#supportSBErrorDialog").off("keydown").on("keydown",function(n){if(n.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.EscapeKey)return i.closeDialogBox(),t.$mars("#"+f).focus(),!1})},r.prototype.openFileErrorDialog=function(i,r,u,f,e){var s=new n.Mars.Client.Runtime.InAppSupport.InAppSupportDialog(t.InAppSupportDialogType.Error,r,u,function(){i.onFileErrorBoxCancelClick()},function(){i.onFileErrorBoxCancelClick()}),o;s.show();i.checkForHighContrastModeInApp();f!==""&&e!==""&&(o=[i.formFactorName,i.pageUrl,i.pageType,"",(new Date).toString(),(new Date).toString(),i.orgId,i.crmVersion,i.clientType,i.userRole,f,e,"0"],i.logInAppSupportTelemetry("inAppSupportFileUploadClient",o,"incomplete"))},r.prototype.validateSupportSidebar=function(){var u=t.$mars("#supportSidebarIssueTitleTextBox").val(),r,i,f,n;return u=$.trim(u),r=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.issueDescriptionBoxId).val(),r=$.trim(r),i=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.issueDateId).val(),i=$.trim(i),f=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.privacyCheckboxId).prop("checked"),n={validationStatus:!0,errorElementID:"",errorMessage:[]},n=this.validateSupportSidebarFields(f===!1,_MicrosoftMars.Client.Loader.marsLocale.errorPrivacyCheckbox,_MicrosoftMars.InAppSupportConstants.privacyCheckboxId,n),n=this.validateSupportSidebarFields(this.isFutureDateSelected(),_MicrosoftMars.Client.Loader.marsLocale.dateTimeValidationMessage,_MicrosoftMars.InAppSupportConstants.issueDateId,n),n=this.validateSupportSidebarFields(isNaN(new Date(i).getTime()),_MicrosoftMars.Client.Loader.marsLocale.invalidDateTimeMessage,_MicrosoftMars.InAppSupportConstants.issueDateId,n),n=this.validateSupportSidebarFields(i==="",_MicrosoftMars.Client.Loader.marsLocale.issueDate,_MicrosoftMars.InAppSupportConstants.issueDateId,n),n=this.validateSupportSidebarFields(r==="",_MicrosoftMars.Client.Loader.marsLocale.issueDescription,_MicrosoftMars.InAppSupportConstants.issueDescriptionBoxId,n),this.validateSupportSidebarFields(u==="",_MicrosoftMars.Client.Loader.marsLocale.issueTitleBoxError,_MicrosoftMars.InAppSupportConstants.issueTitleBoxId,n)},r.prototype.validateSupportSidebarFields=function(n,t,i,r){return n===!0&&(r.errorMessage.push(t),r.errorElementID=i,r.validationStatus=!1),r},r.prototype.isFutureDateSelected=function(){var n=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.issueDateId).val(),i,r;return n?(i=this.convertDateToUTC(new Date(n)),r=this.convertDateToUTC(new Date),Date.parse(r.toString())-Date.parse(i.toString())<=0):!1},r.prototype.convertDateToUTC=function(n){return new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds())},r.prototype.getCurrentDateTimeForDatePicker=function(){var o=_MicrosoftMars.Client.Loader.appContext.Util.getBrowserInfo(),u,t=new Date,i=t.getDate(),r=t.getMonth()+1,n=t.getHours(),e=t.getMinutes(),s=n>=12?"PM":"AM",f;return n=n<10?"0"+n:n,f=t.getFullYear(),i<10&&(i="0"+i),r<10&&(r="0"+r),this.isSupportedBrowserForHtml5DateTimePicker(o.name)?u=f+"-"+r+"-"+i+"T"+n+":"+e:(n=n>=12?n-12:n,u=r+"/"+i+"/"+f+" "+n+":"+e+" "+s),u},r.prototype.isSupportedBrowserForHtml5DateTimePicker=function(n){switch(n){case"Chrome":case"Edge":return!0;case"Safari":case"Firefox":return!1;default:return!1}},r.prototype.validateUploadFileFormats=function(n){var t=n.substring(n.lastIndexOf(".")+1).toLowerCase();return["jpg","jpeg","gif","txt","png","xls","wmv","xlsx","pdf","mp4","doc","docx","avi","ppt","pptx"].indexOf(t)>-1?!0:!1},r.prototype.closeDialogBox=function(){t.$mars("#"+_MicrosoftMars.InAppSupportConstants.lPathDialogHolderId).hide()},r.prototype.onSubmitButtonClick=function(){for(var n=this.validateSupportSidebar(),r=n.validationStatus,u=n.errorElementID,f=_MicrosoftMars.Client.Loader.marsLocale.informationRequiredError,i="",t=n.errorMessage.length-1;t>=0;t--)i+="<div>"+n.errorMessage[t]+"<\/div>";r?this.submitSupportTicket():this.openErrorDialog(this,f,i,u)},r.prototype.InAppSupportTicketCancelTelemetry=function(n){var t=[n.formFactorName,n.pageUrl,n.pageType,"",(new Date).toString(),(new Date).toString(),n.orgId,n.crmVersion,n.clientType,n.userRole,"",""];this.logInAppSupportTelemetry("inAppSupportTicketCancel",t,"complete")},r.prototype.submitSupportTicket=function(){var i=this,r=new n.Mars.Client.Runtime.InAppSupport.InAppSupportDialog(t.InAppSupportDialogType.Confirmation,_MicrosoftMars.Client.Loader.marsLocale.supportSidebarConfirmationTitle,_MicrosoftMars.Client.Loader.marsLocale.supportSidebarConfirmationMessage,function(){i.closeDialogBox();i.submitTicket()},function(){i.closeDialogBox();t.$mars("#supportSidebarSubmitButton").focus()},function(){i.closeDialogBox();t.$mars("#supportSidebarSubmitButton").focus()});r.show();i.checkForHighContrastModeInApp()},r.prototype.removeLoadingAnimation=function(){t.$mars("#"+_MicrosoftMars.InAppSupportConstants.loadingPanelId).remove();t.$mars("#"+_MicrosoftMars.AnswerPanelConstants.learningPathOverlayId).removeClass("loading-container");this.closeDialogBox()},r.prototype.displayLoadingAnimation=function(){var f=_MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex()+1,r="left",u,n;i.isRTL&&(r="right");u="<div id="+_MicrosoftMars.InAppSupportConstants.loadingPanelId+' style="position: fixed; top: 50%; '+r+": 50%; z-index: "+f+';"><img id="loadingGif" src = "'+_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.loadingPanel+'" height="85" width="85"><\/div>';n=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.lPathDialogHolderId);t.$mars("#"+_MicrosoftMars.AnswerPanelConstants.learningPathOverlayId).addClass("loading-container");t.$mars(".support-sb-dialog-container").remove();n.append(u);n.show()},r.prototype.submitTicket=function(){var f,i,r,e,u;try{var o=new Date,s=o.toString(),n=this;this.closeDialogBox();this.displayLoadingAnimation();window.marsLoader.UpdateMarsAriaLiveContent(_MicrosoftMars.Client.Loader.marsLocale.inAppSupportTicketCreationInProgress);f=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.issueTitleBoxId).val();i=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.issueDescriptionBoxId).val();i=i.replace(/(?:\r\n|\r|\n)/g,"\\n");var h=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.issueDateId).val(),c=new Date(h).toISOString(),l=t.$mars("input[name='supportSbIssueStoppage']:checked").val(),a=l===_MicrosoftMars.InAppSupportConstants.radioButtonYesValue?!0:!1,v=t.$mars("input[name='supportSbcompanyWideWork']:checked").val(),y=v===_MicrosoftMars.InAppSupportConstants.radioButtonYesValue?!0:!1;this.inAppSupportSubmitActivityData=[n.formFactorName,n.pageUrl,n.pageType,"",s,(new Date).toString(),n.orgId,n.crmVersion,n.clientType,n.userRole,"","",this.uploadedFileDetails.length.toString()];r=_MicrosoftMars.InAppSupportConfiguration.getInstance().getSupportJsonObj(f,i,a,y,c);r.annotations=this.uploadedFileDetails;r.currentStatus=_MicrosoftMars.InAppSupportConfiguration.getInstance().CrmCurrentStatus;e=new _MicrosoftMars.Client.Loader.InAppSupportConfigurationAPI;u=e.post(r,"Create");u.done(function(t){var i,r,u;n.removeLoadingAnimation();i="";r="";t!=null&&t.Succeeded&&t.Result?(t.Result.CaseId!=_MicrosoftMars.InAppSupportConstants.emptyGuid?(t.Result.CaseNumber!=_MicrosoftMars.InAppSupportConstants.emptyGuid&&(i="50202",r="Case number is empty."),n.openThankYouScreen(t.Result)):(i="50201",r="Case Id is empty.",n.openWaitingScreen()),_MicrosoftMars.InAppSupportConfiguration.getInstance().CrmCurrentStatus==null&&(_MicrosoftMars.InAppSupportConfiguration.getInstance().CrmCurrentStatus=t.Result.CurrentStatus)):n.openErrorScreen();i!==""&&r!==""&&(u=n.inAppSupportSubmitActivityData.length,n.inAppSupportSubmitActivityData[u-3]=i,n.inAppSupportSubmitActivityData[u-2]=r);n.logInAppSupportTelemetry("inAppSupportTicketSubmit",n.inAppSupportSubmitActivityData,"complete")});u.fail(function(t){var i="Submiting support ticket to server failed. ",r;t&&t.responseText&&(r=JSON.parse(t.responseText),i=r.Result);n.logInAppSupportTelemetry("inAppSupportTicketSubmit",n.inAppSupportSubmitActivityData,"incomplete");console.log(i);n.removeLoadingAnimation();n.openErrorScreen()})}catch(p){this.inAppSupportSubmitActivityData[this.inAppSupportSubmitActivityData.length-3]="50301";this.inAppSupportSubmitActivityData[this.inAppSupportSubmitActivityData.length-2]="Server Error";n.logInAppSupportTelemetry("inAppSupportTicketSubmit",n.inAppSupportSubmitActivityData,"incomplete");console.log("Error occurred while submitting ticket to server : "+p);n.removeLoadingAnimation();n.openErrorScreen()}},r.prototype.addClickHandlerForPortalUrl=function(n){var r=t.$mars("#supportSidebarContent"),i=r.find("#openSupportPortalLink");i.removeAttr("href").attr("href",n);i.off("click").on("click",function(){var t=_MicrosoftMars.InAppSupportConfiguration.getInstance().getPortalUrl(),n;return _MicrosoftMars.Client.InAppSupport.Util.openLinkInNewTab(t),n=[this.formFactorName,this.pageUrl,this.pageType,"",(new Date).toString(),(new Date).toString(),this.orgId,this.crmVersion,this.clientType,this.userRole,"",""],this.logInAppSupportTelemetry("inAppSupportPortalLinkOpen",n,"complete"),!1});i.focus()},r.prototype.addClickHandlerForCrmPortalEmail=function(n){var t=_MicrosoftMars.InAppSupportConfiguration.getInstance().getCrmSupportEmail(),i,r;t||console.log("Error: Support Portal Email id not found within InAppSupport Configuration.");i=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;i.test(t)||console.log("Error: provided CrmPortalEmail is incorrect.");n.find("#crmSupportEmailLabel").text(t);r="mailto:"+t;n.find("#crmSupportEmailLink").removeAttr("href").attr("href",r)},r.prototype.addScreenDetails=function(n,i){return t.$mars("#supportSidebarHeader").text(n),t.$mars("#supportSidebarContent").html(_MicrosoftMars.InAppSupportConfiguration.getInstance().getTemplateHtml(i))},r.prototype.openThankYouScreen=function(n){var t=this.addScreenDetails(_MicrosoftMars.Client.Loader.marsLocale.thankYouCaption,"SupportSidebarThankYouScreen"),i,r,u;n&&n.CaseId!=_MicrosoftMars.InAppSupportConstants.emptyGuid&&(i=n.CaseNumber?n.CaseNumber.toString():"",t.find("#openSupportPortalLabel").text(i));r=t.find("#supportSidebarDescription").text();t.find("#supportSidebarDescriptionHiddenSpan").attr("aria-label",r);u=_MicrosoftMars.InAppSupportConfiguration.getInstance().getPortalUrl()+"edit-case/?id="+n.CaseId;this.addClickHandlerForPortalUrl(u)},r.prototype.openErrorScreen=function(){var n=this.addScreenDetails(_MicrosoftMars.Client.Loader.marsLocale.supportTicketGenerationFailureTitle,"SupportSidebarErrorScreen");this.addClickHandlerForCrmPortalEmail(n);n.find("#crmSupportEmailLink").focus()},r.prototype.openWaitingScreen=function(){var n=this.addScreenDetails(_MicrosoftMars.Client.Loader.marsLocale.supportTicketGenerationInProgressTitle,"SupportSidebarWaitingScreen"),t=_MicrosoftMars.InAppSupportConfiguration.getInstance().getPortalUrl();this.addClickHandlerForPortalUrl(t);this.addClickHandlerForCrmPortalEmail(n)},r.prototype.onErrorBoxCancelClick=function(n){n===void 0&&(n="");this.closeDialogBox();n&&n!=""?t.$mars("#"+n).focus():t.$mars("#supportSidebarSubmitButton").focus()},r.prototype.onFileErrorBoxCancelClick=function(){this.closeDialogBox();t.$mars("#supportBrowseButton").focus()},r.prototype.onCancelSupportSidebarClick=function(i){var u=t.$mars("#supportSidebarIssueTitleTextBox").val(),f=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.issueDescriptionBoxId).val(),e=t.$mars("#"+_MicrosoftMars.InAppSupportConstants.issueDateId).val();if(u=$.trim(u),f=$.trim(f),e=$.trim(e),u!=""||f!=""||e!=""){var o=_MicrosoftMars.Client.Loader.marsLocale.cancelErrorTitle,s=_MicrosoftMars.Client.Loader.marsLocale.supportSidebarCancelErrorMessage,r=this,h=new n.Mars.Client.Runtime.InAppSupport.InAppSupportDialog(t.InAppSupportDialogType.Confirmation,o,s,function(){r.InAppSupportTicketCancelTelemetry(r);r.closeDialogBox();r.closeSupportTicket(i)},function(){r.closeDialogBox();t.$mars("#supportSidebarSubmitButton").focus()},function(){r.closeDialogBox();i.focus()});h.show();r.checkForHighContrastModeInApp()}else this.InAppSupportTicketCancelTelemetry(this),this.closeSupportTicket(i)},r.prototype.closeSupportTicket=function(n){this.hide();n.is("#"+_MicrosoftMars.InAppSupportConstants.sidebarHomeIconId)?this.closeSupportTicketOnHomeClicked():this.answerPanelInstance.show(0);t.$mars("#support_feedback").hide()},r.prototype.closeSupportTicketOnHomeClicked=function(){var t=_MicrosoftMars.AnswerPanel.getInstance();t.hide(null,null,null,!0);setTimeout(function(){_MicrosoftMars.Client.Loader.contextHomeSidebar&&_MicrosoftMars.Client.Loader.contextHomeSidebar.length>0&&(n.Mars.Client.Runtime.Controls.AnswerPanelLauncher.loadAnswerPanel(_MicrosoftMars.Client.Loader.contextHomeSidebar[0]),t.show(0))},_MicrosoftMars.AnswerPanelConstants.animationSpeed+100)},r.prototype.getUploadedFileObject=function(n,t){return{fileId:n,filename:t.name,filesize:t.size,mimetype:t.type,uri:null}},r._instance=null,r}();t.SupportSidebar=r})(i=t.InAppSupport||(t.InAppSupport={}))})(i=t.Runtime||(t.Runtime={}))})(i=t.Client||(t.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(t){var i;(function(t){"use strict";var i=function(){function t(){}return t.isInAppSupportFeatureEnabled=function(i){return t.isPaidOrg()&&t.isInAppFCBEnabled()&&t.isInAppFFFEnabled()&&!i&&t.checkTenantId(n.Client.Loader.appContext.tenantId)},t.isInAppFFFEnabled=function(){return window._MicrosoftMars.Client.Utility.FFFUtility.isFeatureEnabled("InAppSupport")},t.isInAppFCBEnabled=function(){return n.Client.Loader.appContext.isInAppSupportEnabledForUser()&&n.Client.Loader.appContext.isInAppSupportEnabledForOrg()},t.isIASLaunchThroughSmileyEnabled=function(){return window._MicrosoftMars.Client.Utility.FFFUtility.isFeatureEnabled("IASLaunchThroughSmiley")},t.isPaidOrg=function(){return n.Client.Loader.appContext.isPaid},t.checkTenantId=function(n){if(n!==null||n!==undefined||n!==""){var t=n.replace(/\s+/g,"");return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.exec(t)?!0:!1}},t.addEventHandlerForCreateSupportButton=function(){var r=n.Client.Loader.$mars("#createSupportButton"),i;r.off("click keydown").on("click keydown",function(t){if(t.type==="click"||t.keyCode===n.Client.Utility.KeyCodeEnum.EnterKey){var i=Microsoft.Mars.Client.Runtime.InAppSupport.SupportSidebar.getInstance();i.openSupportSidebar()}});i=n.Client.Loader.$mars("#OpenSupportPortal");i.off("click keydown").on("click keydown",function(i){var u,r,f;if(i.type==="click"||i.keyCode===n.Client.Utility.KeyCodeEnum.EnterKey)return u=n.InAppSupportConfiguration.getInstance().getPortalUrl(),t.openLinkInNewTab(u),r=Microsoft.Mars.Client.Runtime.InAppSupport.SupportSidebar.getInstance(),f=[r.formFactorName,r.pageUrl,r.pageType,"",(new Date).toString(),(new Date).toString(),r.orgId,r.crmVersion,r.clientType,r.userRole,"",""],r.logInAppSupportTelemetry("inAppSupportPortalLinkOpen",f,"complete"),!1})},t.openLinkInNewTab=function(n){var t=window.open(n,"_blank");t.focus()},t}();t.Util=i})(i=t.InAppSupport||(t.InAppSupport={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){"use strict";var t=function(){function t(){}return t.getIndexForSearchSource=function(n){return n===t.MARS?0:n===t.VIDEO?1:n===t.END_USERS?2:n===t.ADMIN_AND_CUSTOMIZERS?3:t.UNDEFINED},t.getTitleForSearchSource=function(i){switch(i){case t.END_USERS:return n.Client.Loader.marsLocale.forEndUser;case t.ADMIN_AND_CUSTOMIZERS:return n.Client.Loader.marsLocale.forAdmin;case t.VIDEO:return n.Client.Loader.marsLocale.videos}},t.getSearchHtml=function(t,i){var r='<div id="lpath_apContainer" class= "lpath-search-template">';return n.Client.Loader.$mars("#answerPanel").find(".lpath-search-subcontainer").length>0?r=i?r+'<div class= "lpath-search-subcontainer lpath-rtl">':r+'<div class= "lpath-search-subcontainer">':n.Client.Loader.$mars("#answerPanel").find(".lpath-search-subcontainer").length>0&&(r=i?r+'<div class= "lpath-search-subcontainer lpath-rtl">':r+'<div class= "lpath-search-subcontainer">'),r+'<div id="lPathSearchSidebarContainer" class="lpath-search-sidebar-searchBox"><input id="txtSearch" role="search" class="lpath-txt-Search" type="text" tabindex="0" placeholder= "'+n.Client.Loader.marsLocale.search+'" /><button id="marsSearchImage" aria-label="'+n.Client.Loader.marsLocale.search+'" class="lpath-search-sidebar-searchImageIcon"><input  class="lpath-svg" type="image"  src= "'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.searchSidebarIcon+'" alt= "'+n.Client.Loader.marsLocale.searchCaption+'"  /><\/button><\/div><input id="closeButton" class= "lpath-search-sidebar-CrossImg" type= "image" src= "'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.closeSidebarIcon+'" alt= "'+n.Client.Loader.marsLocale.close+'"/><\/div><div id="lPathHeaderSidebarContainer" class="lpath-header-search-container " role="region" aria-label="'+n.Client.Loader.marsLocale.sidebarTitleString+'"><div id="lPathHeader" role="presentation" class="lpath-preview-sidebar-title lpath-overflow-handling"><h1 tabindex="-1">'+n.Client.Loader.marsLocale.searchResult+'<\/h1><\/div><\/div><div id="lPathSearchSectionContainer" class="lpath-sidebar-section-container-height lpath-sidebar-section-container"><div data-sectionindex="0" id="lpath_searchContentContainer_0" name="mars_answerpanel_section" class="mars-search-section"><div class="lpath-toggleImageIcon" tabindex="0" role="button" aria-expanded="true" aria-label="'+n.Client.Loader.marsLocale.marsControlsCaption+'"> <img class= "lpath-toggleImage" src= "'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.expandedIcon+'" title="'+n.Client.Loader.marsLocale.sectionExpandedToolTip+'" alt= "'+n.Client.Loader.marsLocale.expanded+'" /><\/div><div class="lpath-search-header-title"><h2 class= "crm-lpath-title lpath-ap-section-title" title="'+n.Client.Loader.marsLocale.marsControlsCaption+'" >'+n.Client.Loader.marsLocale.marsControlsCaption+'<\/h2><\/div><div id="lpath_searchContent" style="display:block;"><\/div><\/div><div data-sectionindex="1" id="lpath_searchContentContainer_1" name="mars_answerpanel_section" class="mars-search-section"><div class="lpath-toggleImageIcon" tabindex="0" role="button" aria-expanded="true" aria-label="'+n.Client.Loader.marsLocale.videos+'"><img class= "lpath-toggleImage" src= "'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.expandedIcon+'" title="'+n.Client.Loader.marsLocale.sectionExpandedToolTip+'" alt= "'+n.Client.Loader.marsLocale.expanded+'" /><\/div><div class="lpath-search-header-title"><h2 class= "crm-lpath-title lpath-ap-section-title" title="'+n.Client.Loader.marsLocale.videos+'" >'+n.Client.Loader.marsLocale.videos+'<\/h2><\/div><div id="lpath_searchContent" style="display:block;"><\/div><\/div><div data-sectionindex="2" id="lpath_searchContentContainer_2" name="mars_answerpanel_section" class="mars-search-section"><div class="lpath-toggleImageIcon" tabindex="0" role="button" aria-expanded="true" aria-label="'+n.Client.Loader.marsLocale.forEndUser+'"><img class= "lpath-toggleImage" src= "'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.expandedIcon+'" title="'+n.Client.Loader.marsLocale.sectionExpandedToolTip+'" alt= "'+n.Client.Loader.marsLocale.expanded+'" /><\/div><div class="lpath-search-header-title"><h2 class= "crm-lpath-title lpath-ap-section-title" title="'+n.Client.Loader.marsLocale.forEndUser+'" >'+n.Client.Loader.marsLocale.forEndUser+'<\/h2><\/div><div id="lpath_searchContent" style="display:block;"><\/div><\/div><div data-sectionindex="3" id="lpath_searchContentContainer_3" name="mars_answerpanel_section" class="mars-search-section"><div class="lpath-toggleImageIcon" tabindex="0" role="button" aria-expanded="true" aria-label="'+n.Client.Loader.marsLocale.forAdmin+'"><img class= "lpath-toggleImage" src= "'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.expandedIcon+'" title="'+n.Client.Loader.marsLocale.sectionExpandedToolTip+'" alt= "'+n.Client.Loader.marsLocale.expanded+'" /><\/div><div class="lpath-search-header-title"><h2 class= "crm-lpath-title lpath-ap-section-title" title="'+n.Client.Loader.marsLocale.forAdmin+'" >'+n.Client.Loader.marsLocale.forAdmin+'<\/h2><\/div><div id="lpath_searchContent" style="display:block;"><\/div><\/div><\/div><div><span style="display:none" id= "smilePlaceholderText" >'+n.Client.Loader.marsLocale.smilePlaceholderText+'<\/span><span style= "display:none" id= "frownPlaceholderText" >'+n.Client.Loader.marsLocale.frownPlaceholderText+'<\/span><span style= "display:none" id= "smileHeaderText" >'+n.Client.Loader.marsLocale.sendSmileCaption+'<\/span><span style= "display: none" id= "frownHeaderText" >'+n.Client.Loader.marsLocale.frownHeaderText+'<\/span><span style= "display: none" id= "sendFeedbackText" >'+n.Client.Loader.marsLocale.sendFeedbackText+'<\/span><span style= "display: none" id= "nextButtonText" >'+n.Client.Loader.marsLocale.nextValue+'<\/span><span style= "display:none" id= "previousButtonText" >'+n.Client.Loader.marsLocale.previous+'<\/span><\/div><div id="footer" class="lpath-sidebar-footer paddingthree" role="region" aria-label="'+n.Client.Loader.marsLocale.sidebarFooter+'"><input type="image" id="home-icon" role="button" class="lpath-float-left lpath-home-icon" title= "'+n.Client.Loader.marsLocale.defaultAnswerPanelCaption+'" alt= "'+n.Client.Loader.marsLocale.defaultAnswerPanelCaption+'" src= "'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.sidebarContextHomeIcon+'" /><span  title= "'+n.Client.Loader.marsLocale.feedbackTooltip+'"><input type="image" id="feedbackBtn" aria-haspopup="true" role="button" class="mars-float-right lpath-feedback-btn" alt= "'+n.Client.Loader.marsLocale.feedbackCaption+'" src= "'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.sidebarSmileyIcon+'" /><\/span><\/div><\/div><\/div>'},t.parseResultToHtml=function(i,r){var f=i.Title,e=i.Description,o=i.Url,u="";return n.Client.Loader.appContext.clientType!=="Mobile"||n.Client.Loader.appContext.isISHPage()||(u="mars-searchResultlink"),r===t.VIDEO?'<div class="lpath-search-content-div lpath-search-content-title" ><a tabindex="0" role="link" data-href="'+o+'" target="_blank" class="'+u+' lpath-search-content-header">'+f+"<\/a><\/div>":'<div class="lpath-search-content-div lpath-search-content-title" ><a tabindex="0" role="link" data-href="'+o+'" target="_blank" class="'+u+' lpath-search-content-header">'+f+'<\/a><\/div><div class="lpath-search-content-div lpath-search-content-description"><label title="'+n.Client.Utility.Util.resolveTitle(e)+'">'+e+"<label><\/div>"},t.displayNoResultMessage=function(i){var f=t.getIndexForSearchSource(i),e=n.Client.Loader.$mars("#lpath_searchContentContainer_"+f),u=e.find("#lpath_searchContent"),r;u.empty();r=document.createElement("div");r.innerHTML='<label class="lpath-search-content-div lpath-search-no-results">'+n.Client.Loader.marsLocale.noResults+"<\/label>";u.append(r);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"No Search result found")},t.setSearchData=function(i,r,u){var f,e,h;if(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SearchUtil:setSearchData START"),f=i.ResultSets,!f.length){t.displayNoResultMessage(r);return}for(e=0;e<f.length;e++){var s=f[e],o=s.Source,u=s.Query;o===t.ADMIN_AND_CUSTOMIZERS?(u=u.replace(" (meta:Search.MSCategoryV('dn798678CRM10') site:technet.microsoft.com)","").replace(/"/g,""),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Search result found")):o===t.VIDEO&&(u=u.replace(" (site:http://microsoft.com/showcase | site:http://microsoft.com/video)",""));h=s.Results;t.searchResultsMap[u+o]=h;n.AnswerPanel.getInstance().injectSearchElement(o,h,u)}n.Client.Loader.$mars(".mars-searchResultlink").on("click",function(t){if(t.type==="click"||t.keyCode===13){var i=t.target.getAttribute("href");i==null&&(i=n.Client.Loader.$mars(t.target).parents().find("a")[0].getAttribute("href"),i==null&&(i=t.target.getAttribute("data-href")!=null?t.target.getAttribute("data-href"):t.target.getAttribute("title")));n.Client.Loader.appContext.openExternalUrl(i)}return t.preventDefault(),t.stopPropagation(),!1});n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SearchUtil:setSearchData END")},t.search=function(i,r){var f,u,v,y,h;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SearchUtil:search START");var l=n.Client.Loader.appContext.getPageType(),a=t.getSearchSourceList(),c=new n.Client.Loader.SearchAnswerPanelApi,p=new n.Client.Loader.RuntimeControlApi;for(f=0;f<a.length;f++)if(u=a[f],t.searchResultsMap[i+u]!=null)v=t.searchResultsMap[i+u],n.AnswerPanel.getInstance().injectSearchElement(u,v,i);else if(u===t.MARS){this.contextEngine=new window._MicrosoftMars.Client.Utility.ContextEngine;var w=window.Microsoft.Mars.Client.Runtime.Controls.ControlTypes,b=n.Client.Loader.appContext.isISHPage()?this.ISHConstant:n.Client.Loader.appContext.ClientType,k=this.getSearchObject(w.Any,n.Client.Loader.contextAppVersionType,n.Client.Loader.appContext.Locale,b,!1,!1,i,!0);n.Client.Loader.ServiceProxy.webApiBaseUrl=n.Client.Loader.webApiBaseUrl;y=p.searchMarsAnswerPanel(k,"Search");y.done(function(u){var f=u.Result;t.searchResultsMap[i+t.MARS]=f;n.AnswerPanel.getInstance().injectSearchElement(t.MARS,f,i);r()})}else{var e=null,o=null,s=null;u===t.END_USERS?e=c.getEndUserResults(i):u===t.ADMIN_AND_CUSTOMIZERS?o=c.getAdminAndCustomizerResults(i):u===t.VIDEO&&(s=c.getVideoResults(i));h=["","",l,i,u,this.getIndexForSearchSource(u)];n.searchActivityEvent.SetActivityData(h);e!=null&&(e.done(function(n){t.setSearchData(n,t.END_USERS,i)}),e.fail(function(){t.displayNoResultMessage(t.END_USERS)}));o!=null&&(o.done(function(n){t.setSearchData(n,t.ADMIN_AND_CUSTOMIZERS,i)}),o.fail(function(){t.displayNoResultMessage(t.ADMIN_AND_CUSTOMIZERS)}));s!=null&&(s.done(function(n){t.setSearchData(n,t.VIDEO,i)}),s.fail(function(){t.displayNoResultMessage(t.VIDEO)}))}h=["","",l,i,"",""];n.searchActivityEvent.SetActivityData(h);n.searchActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.searched);window._MicrosoftMars.AnswerPanel.getInstance().handleHighContrastModeForExpandAndCollapseIcons();n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"SearchUtil:search END")},t.getSearchSourceList=function(){return[t.MARS,t.END_USERS,t.ADMIN_AND_CUSTOMIZERS,t.VIDEO]},t.getSearchObject=function(t,i,r,u,f,e,o,s){var h,l,b,y,p,k;this.requestJson=[];var a=JSON.parse(localStorage["allConfigurationKey"]),d=a.AuthoringDetails.length;for(h=0;h<d;h++){var c=a.AuthoringDetails[h].AuthoringGroupDetail,v=a.AuthoringDetails[h].SubscribedPGDetails,g={AuthoringId:c.AuthoringId,ProductMatchVersionCriteria:c.ProductVersionMatchCriteria},w=[];for(l=0;l<v.length;l++)b={PublishGroupId:v[l].PgId,Precedence:v[l].Precedence},w.push(b);y="";c.ConfigurationLifeCycleStages&&c.ConfigurationLifeCycleStages.length>0&&(p=n.Client.Loader.appContext.util.getAuthoringGroupLifeCycleStageMap(c.AuthoringId),p&&(y=p.Id));k=this.getControlParamJson(g,w,n.Client.Loader.appContext.RoleTemplates,r,n.Client.Loader.appContext.getAppName(),n.Client.Loader.appContext.getAppVersion(),n.Client.Loader.appContext.getPageNavigationInfo(),t,u,n.Client.Loader.appContext.getFormFactor(),n.Client.Loader.appContext.UserId,y,n.Client.Loader.appContext.PublishGroupId,i,f,e,o,s);this.requestJson.push(k)}return this.requestJson},t.getControlParamJson=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){return{AuthoringDetails:n,PublishGroupDetails:t,ContextValueMapping:{1:u,2:f,3:i,4:l,5:h,6:s,7:r,8:JSON.stringify(e)},HomeSidebarOnly:y,ErrorControlOnly:p,SearchKey:w,IsSearch:b}},t.MARS="searchMars",t.END_USERS="SPDynamicsCRM",t.ADMIN_AND_CUSTOMIZERS="BingTechNetDynamics",t.VIDEO="DynamicsVideo",t.UNDEFINED=-1,t.MAX_SEARCH_RESULTS=3,t.searchResultsMap={},t.ISHConstant="Ish",t}();n.SearchUtil=t}(_MicrosoftMars||(_MicrosoftMars={})),function(){"use strict"}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(){"use strict"})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(n){this.bubbleId=n}return t.prototype.setHtmlContent=function(n){this.htmlContent=n},t.prototype.getHtmlContent=function(){return this.htmlContent.replace(/\/\/ <!\[CDATA\[/g,"").replace(/\/\/ \]\]>/g,"")},t.prototype.getxbuttonHtml=function(){return'<img tabIndex="1" id="'+n.InfoBubbleConstants.xButtonName+'"alt="'+_MicrosoftMars.Client.Loader.marsLocale.close+'" src="'+_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.bubbleCloseIcon+'">'},t.prototype.getArrowandOverlayHtml=function(){return'<div id="'+this.bubbleId+n.BubbleUtilityConstants.transparentArrowName+'" ><\/div><div id="'+n.BubbleUtilityConstants.overlayName+'"><\/div>'},t.prototype.getBubbleId=function(){return this.bubbleId},t}();n.View=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(n){function t(t,i){n.call(this,t);this.totalSteps=i}return __extends(t,n),t.prototype.setHtmlContent=function(t,i){i?n.prototype.setHtmlContent.call(this,t):n.prototype.setHtmlContent.call(this,t+this.getProgessCirclesHtml())},t.prototype.getProgessCirclesHtml=function(){var r=this.totalSteps>1?'mars-step-indicator-section mars-step-indicator-section-gt">':'mars-step-indicator-section">',i='<div class="lpath-bubble-progress-indicator" id="'+n.prototype.getBubbleId.call(this)+'spacebeforecircle"><div class="'+r,t;if(this.totalSteps>1)for(t=1;t<=this.totalSteps;t++)i=i+'<div id="'+n.prototype.getBubbleId.call(this)+"circle"+t+'" class="lpath-gt-progress-outer mars-step-progress-circles" tabindex="-1"><div class="lpath-gt-progress-inactive-circle"><\/div><\/div>';return i+"<\/div><\/div>"},t}(n.View);n.StepBubbleView=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(n){this.appContext=null;this.bubbleId=n;this.jquerySelectorMap={};this.ispointerless=!1}return t.prototype.getAppContext=function(){return this.appContext},t.prototype.setParentControlId=function(n){this.parentControlId=n},t.prototype.getParentControlId=function(){return this.parentControlId},t.prototype.setParentControlName=function(n){this.parentControlName=n},t.prototype.getParentControlName=function(){return this.parentControlName},t.prototype.setPointerless=function(n){this.ispointerless=n},t.prototype.getPointerless=function(){return this.ispointerless},t.prototype.getBubbleId=function(){return this.bubbleId},t.prototype.getCustomAttributes=function(){return this.customAttributes},t.prototype.getJquerySelectorMap=function(){return this.jquerySelectorMap},t.prototype.setPublishGroupId=function(n){this.publishGroupId=n},t.prototype.getPublishGroupId=function(){return this.publishGroupId},t.prototype.setAuthoringGroupId=function(n){this.authoringGroupId=n},t.prototype.getAuthoringGroupId=function(){return this.authoringGroupId},t.prototype.getTargetElement=function(n,t,i){var r,u;return(n===void 0&&(n=!1),t===void 0&&(t=!1),i===void 0&&(i=!1),r=this.getCachedTargetElement(),t===!0&&r!=null)?r:this.appContext!=null?(u=_MicrosoftMars.Client.Loader.appContext.getElement(this.appContext.ElementIdentifier,n,i),u==null&&r?r:(this.jquerySelectorMap.element=u,u)):void 0},t.prototype.getCachedTargetElement=function(){return this.jquerySelectorMap.element},t.prototype.setTargetElementForMOCA=function(t){var u=t+"_info",i="<div id ='"+n.BubbleUtilityConstants.infoDivId+"'><img id="+u+" alt='"+_MicrosoftMars.Client.Loader.marsLocale.infoAlt+"' src='"+_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.bubbleRuntimeInfoIcon+"' style='position: absolute; z-index:"+_MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex()+"'><\/div>",r;this.jquerySelectorMap.element==null&&(r=_MicrosoftMars.Client.Loader.appContext.getElement(this.appContext.ElementIdentifier),this.jquerySelectorMap.element=r);_MicrosoftMars.Client.Loader.$mars(i).offset(this.jquerySelectorMap.element.elementOffset);_MicrosoftMars.Client.Loader.clientAPIEnabled?_MicrosoftMars.Client.Loader.$mars(this.jquerySelectorMap.element.getCtrlObj().getDOMNode()).append(i):this.jquerySelectorMap.element.element.append(i);this.infoIconDiv=_MicrosoftMars.Client.Loader.$mars("#"+n.BubbleUtilityConstants.infoDivId)},t.prototype.getTargetElementForMOCA=function(n){var t=this.jquerySelectorMap.element;return _MicrosoftMars.Client.Loader.clientAPIEnabled?_MicrosoftMars.Client.Loader.$mars(this.jquerySelectorMap.element.getCtrlObj().getDOMNode()).find("#"+n+"_info"):t.element.find("#"+n+"_info")},t.prototype.getButtonsModel=function(){return this.buttonsModel},t.prototype.setButtonsModel=function(n){return this.buttonsModel=n},t.prototype.removeInfoIconDiv=function(){this.infoIconDiv&&_MicrosoftMars.Client.Loader.$mars(this.infoIconDiv).remove()},t.prototype.setAppContext=function(n){this.appContext=n},t.prototype.setCustomAttributes=function(n){this.customAttributes=n},t.prototype.setJquerySelectorMap=function(n,t){this.jquerySelectorMap[n]=t},t.prototype.isRTL=function(){return this.RTL},t}();n.BubbleModel=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(t){function i(i){t.call(this,i);this.isActive=!1;this.isInjected=!1;this.initialized=!1;this.events=null;this.isExceptionBubble=!1;this.isElementInputable=!1;this.elementInputType=null;this.isHybridBubble=!1;this.placementPosition=n.BubbleUtilityConstants.bubblePositionAuto;this.hybridType="click";this.hybridCustomToken="";this.isWaitingBubble=!1;this.waitingBubbleFunctionName=null}return __extends(i,t),i.prototype.setElementInputable=function(n){this.isElementInputable=n},i.prototype.getElementInputable=function(){return this.isElementInputable},i.prototype.setElementInputType=function(n){this.elementInputType=n},i.prototype.getElementInputType=function(){return this.elementInputType},i.prototype.getWildCardNavigation=function(){return this.wildCardNavigation},i.prototype.setEvents=function(n){this.events=n},i.prototype.getEvents=function(){return this.events},i.prototype.setPlacementPosition=function(n){this.placementPosition=n},i.prototype.getPlacementPosition=function(){return this.placementPosition},i.prototype.setControlType=function(t){t===n.ControlTypes.StepThrough?this.controlType=window._MicrosoftMars.Client.Telemetry.ActivityName.guidedtask:t===n.ControlTypes.ActiveStep?this.controlType=window._MicrosoftMars.Client.Telemetry.ActivityName.activestepbubble:t===n.ControlTypes.PassiveStep?this.controlType=window._MicrosoftMars.Client.Telemetry.ActivityName.passivestepbubble:t===n.ControlTypes.InfoBubble?this.controlType=window._MicrosoftMars.Client.Telemetry.ActivityName.infobubble:t===n.ControlTypes.AnswerPanel&&(this.controlType=window._MicrosoftMars.Client.Telemetry.ActivityName.answerpanel)},i.prototype.getControlType=function(){return this.controlType},i.prototype.setAuthorId=function(n){this.authorId=n},i.prototype.getAuthorId=function(){return this.authorId},i.prototype.setLocale=function(n){this.locale=n},i.prototype.getLocale=function(){return this.locale},i.prototype.setControlName=function(n){this.controlName=n},i.prototype.getControlName=function(){return this.controlName},i.prototype.setStepActive=function(t){this.isActive=!1;(t===n.ControlTypes.ActiveStep||t===n.ControlTypes.WaitingStep)&&(this.isActive=!0)},i.prototype.isStepActive=function(){return this.isActive},i.prototype.setWaitingBubble=function(n){this.isWaitingBubble=n},i.prototype.getWaitingBubble=function(){return this.isWaitingBubble},i.prototype.setWaitingBubbleFunctionName=function(n){this.waitingBubbleFunctionName=n},i.prototype.getWaitingBubbleFunctionName=function(){return this.waitingBubbleFunctionName},i.prototype.setHybrid=function(n){this.isHybridBubble=n},i.prototype.isHybrid=function(){return this.isHybridBubble},i.prototype.setHybridType=function(n){this.hybridType=n},i.prototype.setEnableNudge=function(n){this.enableNudge=n},i.prototype.getEnableNudge=function(){return this.enableNudge},i.prototype.getHybridType=function(){return this.hybridType},i.prototype.setHybridCustomToken=function(n){this.hybridCustomToken=n},i.prototype.getHybridCustomToken=function(){return this.hybridCustomToken},i.prototype.setStepInjected=function(n){this.isInjected=n},i.prototype.isStepInjected=function(){return this.isInjected},i.prototype.setStepIndex=function(n){this.stepIndex=n},i.prototype.getStepIndex=function(){return this.stepIndex},i.prototype.setTemplate=function(n){this.template=n},i.prototype.getTemplate=function(){return this.template},i.prototype.setInitialized=function(n){this.initialized=n},i.prototype.isInitialized=function(){return this.initialized},i.prototype.setStepExceptionBubble=function(n){this.isExceptionBubble=n},i.prototype.isStepExceptionBubble=function(){return this.isExceptionBubble},i.prototype.toJSONString=function(i){for(var u,f,o=!1,r="",e=0;e<this.events.length;e++)u=this.events[e],o?r+=",":o=!0,r+='{\\"Id\\": \\"'+u.Id+'\\",',r+='\\"Trigger\\": \\"'+u.Trigger+'\\",',r+='\\"Action\\": \\"'+u.Action+'\\"}';f='"{\\"IsHybridBubble\\":'+this.isHybridBubble+",";f+='\\"IsElementInputable\\":'+this.getElementInputable()+",";f+='\\"ElementInputType\\": \\"'+this.getElementInputType()+'\\"}"';var s=n.ScenarioManager.getInstance(),h=s.getScenario(i),c=t.prototype.getButtonsModel.call(this)===undefined?"":',"twoButtons":"['+t.prototype.getButtonsModel.call(this)+']"';return'{"ControlId":"'+h.getOriginalStepId(t.prototype.getBubbleId.call(this))+'","ParentControlId":["'+i+'"],"ControlType":"'+this.getControlType()+'","IsElementInputable":'+this.getElementInputable()+',"ElementInputType":"'+this.getElementInputType()+'","ShowBubbleElementPointer":'+!this.getPointerless()+',"AppContext":'+JSON.stringify(t.prototype.getAppContext.call(this))+',"HtmlView":"'+this.template.replace(/"/g,'\\"')+'","CustomAttributes":"'+this.getCustomAttributes()+'","AuthorId":"'+this.getAuthorId()+'","ControlName":"'+this.getControlName()+'","Lcid":"'+this.getLocale()+'","MetadataJson":'+f+',"Events":"['+r+']"'+c+"}"},i}(n.BubbleModel);n.StepBubbleModel=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(){}return t.scrollIfAnimateComplete=function(t){var i=n.$mars&&n.$mars(":animated")?n.$mars(":animated").length:_MicrosoftMars.Client.Loader.$mars(":animated").length;t.is(":visible")&&i===0&&t[0].scrollIntoView()},t.setBubblePostion=function(i,r,u){var e,o,h,c,l;u===void 0&&(u=n.BubbleUtilityConstants.bubblePositionAuto);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:setBubblePosition START");e=i.getJquerySelectorMap();_MicrosoftMars.Client.Loader.appContext.util.showOverlay();_MicrosoftMars.Client.Loader.appContext.util.showCustomizationContainer();_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Overlay and Customization Container rendered");var f=e.bubbleId,v=e.arrowId,y=e.transparentArrowId,s;try{r||(i.jquerySelectorMap.element&&i.jquerySelectorMap.element.element||(i.jquerySelectorMap.element=i.getTargetElement(!1,r)),t.scrollIfAnimateComplete(i.jquerySelectorMap.element.element));o=i.getTargetElement(!1,r);h=t.getFlyoutPosition(o,f,r,u);t.addArrow(h,f,v,y);f.find(".crm-lpath-title")[0]&&(c=f.find(".crm-lpath-title")[0].innerText);l=t.findAriaLabel(o.element);s=_MicrosoftMars.Client.Loader.marsLocale.BubblePinnedOnPageElement.replace("{0}",c).replace("{1}",l);f.find("#bubbleDetails").html(s);f.attr("aria-describedby","bubbleDetails")}catch(a){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error encountered in BubbleUtility:setBubblePosition");_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchStepException,a.message,null,a)}_MicrosoftMars.Client.Loader.appContext.util.hideOverlay();_MicrosoftMars.Client.Loader.appContext.util.hideCustomizationContainer();_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:setBubblePosition END")},t.findAriaLabel=function(n){var t="",i;return t=n.attr("aria-label"),t&&t!==""||(i=n.attr("aria-labelledby"),i&&i!==""||(i=n.attr("aria-describedby")),i!=undefined&&i.length>0&&(t=n.closest("#"+i).attr("aria-label")),t||(t="")),t},t.getFlyoutPosition=function(i,r,u,f){var k,d,rt,ut,h,c,l,b,g,st,ht,ft,nt,e,w,a,v,tt,ct,it,lt;f===void 0&&(f=n.BubbleUtilityConstants.bubblePositionAuto);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:getFlyoutPosition START");k=i.element;d=i.elementX!==undefined&&i.elementY!==undefined?{top:i.elementY,left:i.elementX}:k.offset();_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"targetElementOffset: "+d);var o=d.top,s=d.left,et=o-k.offset().top,ot=s-k.offset().left,y,p;i.elementWidth&&i.elementHeight?(y=i.elementWidth,p=i.elementHeight):(y=k.width(),p=k.height());rt=s+y;ut=o+p;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"targetEndingOffsetLeft: "+rt+" targetEndingOffsetTop: "+ut);h=window.innerWidth;c=window.innerHeight;_MicrosoftMars.Client.Loader.appContext.clientType===n.BubbleUtilityConstants.mobileClientType&&(h=window.parent.innerWidth,c=window.parent.innerHeight);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"width: "+h+" height: "+c);s<h/2&&o<c/2&&rt<h/2&&ut<c/2?(l=n.BubbleUtilityConstants.quadrant1,b=[0,0],g=[c/2,h/2]):s<h/2&&o<c/2&&rt<h/2?l=n.BubbleUtilityConstants.quadrant13:s<h/2&&o<c/2&&ut<c/2?l=n.BubbleUtilityConstants.quadrant12:o<c/2&&ut<c/2?(l=n.BubbleUtilityConstants.quadrant2,b=[0,h/2+1],g=[c/2,h]):o<c/2?l=n.BubbleUtilityConstants.quadrant24:s<h/2&&rt<h/2?(l=n.BubbleUtilityConstants.quadrant3,b=[c/2+1,0],g=[c,h/2]):s<h/2?l=n.BubbleUtilityConstants.quadrant34:(l=n.BubbleUtilityConstants.quadrant4,b=[c/2+1,h/2+1],g=[c,h]);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"quadrant position: "+l);b!=null?(st=t.getRowOrColumn(b[0],g[0],o),ht=t.getRowOrColumn(b[1],g[1],s),nt=st*3+ht,_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"subQuadrantNumber: "+nt),ft=t.getArrowPosition(l,nt,i,d,r,et,ot,f)):ft=t.getArrowPosition(l,null,i,d,r,et,ot,f);e=ft[0];w=ft[1];switch(f){case n.BubbleUtilityConstants.bubblePositionAuto:nt===undefined||nt==null?l===n.BubbleUtilityConstants.quadrant12?(a=o+p+e[0],v=s+e[1]):l===n.BubbleUtilityConstants.quadrant34?(a=o-r.height()+e[0],v=s+e[1]):l===n.BubbleUtilityConstants.quadrant13?(v=s+y+e[1],a=o+e[0]):l===n.BubbleUtilityConstants.quadrant24&&(v=s-r.width()+e[1],a=o+e[0]):nt<5?l===n.BubbleUtilityConstants.quadrant1||l===n.BubbleUtilityConstants.quadrant2?(a=o+p+e[0],tt=s+r.width()+n.BubbleUtilityConstants.bubbleBorderSize,v=tt>h?h-r.width()-2*n.BubbleUtilityConstants.bubbleBorderSize:s+e[1]):(tt=s+r.width()+n.BubbleUtilityConstants.bubbleBorderSize,a=o-r.height()+e[0],v=tt>h?h-r.width()-2*n.BubbleUtilityConstants.bubbleBorderSize:s+e[1]):l===n.BubbleUtilityConstants.quadrant1||l===n.BubbleUtilityConstants.quadrant3?(it=o+r.height(),a=it<c?o+e[0]:c-r.height()-n.BubbleUtilityConstants.paddingLength,v=s+y+e[1]):(it=o+r.height(),a=it<c?o+e[0]:c-r.height()-n.BubbleUtilityConstants.paddingLength,v=s-r.width()+e[1]);break;case n.BubbleUtilityConstants.bubblePositionTopLeft:case n.BubbleUtilityConstants.bubblePositionTopRight:a=o-r.height()+e[0];tt=s+r.width()+n.BubbleUtilityConstants.bubbleBorderSize;tt>h?v=h-r.width()-2*n.BubbleUtilityConstants.bubbleBorderSize:(v=s+e[1],f===n.BubbleUtilityConstants.bubblePositionTopRight&&y>r.width()&&(v=s+y-r.width()+e[1],w[1]=v+Math.min(y,r.width())/2-n.BubbleUtilityConstants.arrowWidth/2));y<r.width()&&(w[1]=s+y/2-n.BubbleUtilityConstants.arrowHeight/2);break;case n.BubbleUtilityConstants.bubblePositionBottomLeft:case n.BubbleUtilityConstants.bubblePositionBottomRight:a=o+p+e[0];ct=s+r.width()+n.BubbleUtilityConstants.bubbleBorderSize;ct>h?v=h-r.width()-2*n.BubbleUtilityConstants.bubbleBorderSize:(v=s+e[1],f===n.BubbleUtilityConstants.bubblePositionBottomRight&&y>r.width()&&(v=s+y-r.width()+e[1],w[1]=v+Math.min(y,r.width())/2-n.BubbleUtilityConstants.arrowWidth/2));y<r.width()&&(w[1]=s+y/2-n.BubbleUtilityConstants.arrowHeight/2);break;case n.BubbleUtilityConstants.bubblePositionLeftTop:case n.BubbleUtilityConstants.bubblePositionLeftBottom:v=s-r.width()+e[1];it=o+r.height();it<c?(a=o+e[0],f===n.BubbleUtilityConstants.bubblePositionLeftBottom&&p>r.height()&&(a=o+p-r.height()+e[0],w[0]=a+ +(Math.min(p,r.height())/2)-n.BubbleUtilityConstants.arrowWidth)):a=c-r.height()-n.BubbleUtilityConstants.paddingLength;p<r.height()&&(w[0]=o+p/2-n.BubbleUtilityConstants.arrowHeight/2);break;case n.BubbleUtilityConstants.bubblePositionRightTop:case n.BubbleUtilityConstants.bubblePositionRightBottom:v=s+y+e[1];lt=o+r.height();lt<c?(a=o+e[0],f===n.BubbleUtilityConstants.bubblePositionRightBottom&&p>r.height()&&(a=o+p-r.height()+e[0],w[0]=a+Math.min(p,r.height())/2-n.BubbleUtilityConstants.arrowWidth)):a=c-r.height()-n.BubbleUtilityConstants.paddingLength;p<r.height()&&(w[0]=o+p/2-n.BubbleUtilityConstants.arrowHeight/2)}return _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:getFlyoutPosition END"),[a,v,ft]},t.addArrow=function(t,i,r,u){var e,o;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:addArrow START");var s=t[2],f=s[1],h=f[1]-t[1];u.css("top",f[0]);u.css("left",f[1]);u.addClass("mars-bubble-nudge");u.children().length>0&&u.children().remove();e=i.find(".lpath-section-header");e.length==0&&(e=i.find(".lpath-section-header-title"));o=e.outerHeight();switch(s[2]){case"left":_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"addArrow switch left");i.css("top",t[0]);i.css("left",t[1]);i.attr("data-arrow-position","right");u.css(n.BubbleUtilityConstants.arrow_left_right_common_css);f[0]+n.BubbleUtilityConstants.arrowHeight<=t[0]+o?u.addClass("triangle-left-filled"):u.addClass("triangle-left");u.addClass("mars-arrow-left-right-common");break;case"top":_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"addArrow switch top");i.css("top",t[0]);i.css("left",t[1]);h<50?i.attr("data-arrow-position","right"):i.attr("data-arrow-position","left");u.css(n.BubbleUtilityConstants.arrow_top_bottom_common_css);u.addClass("triangle-up");u.addClass("mars-arrow-top-bottom-common");break;case"bottom":_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"addArrow switch bottom");i.css("top",t[0]-n.BubbleUtilityConstants.paddingLength);i.css("left",t[1]);h<50?i.attr("data-arrow-position","right"):i.attr("data-arrow-position","left");u.css(n.BubbleUtilityConstants.arrow_top_bottom_common_css);u.addClass("triangle-down");u.addClass("mars-arrow-top-bottom-common");break;case"right":_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"addArrow switch right");i.css("top",t[0]);i.css("left",t[1]-n.BubbleUtilityConstants.paddingLength);i.attr("data-arrow-position","left");u.css(n.BubbleUtilityConstants.arrow_left_right_common_css);f[0]+n.BubbleUtilityConstants.arrowHeight<=t[0]+o?u.addClass("triangle-right-filled"):u.addClass("triangle-right");u.addClass("mars-arrow-left-right-common")}u.css("display","none");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:addArrow END")},t.clickedInsideElement=function(n,t,i){var h,c;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:clickedInsideElement START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"pageX: "+t+" pageY:"+i);var f=n.element,s=f.offset(),e,o,r=null,u=null;return(n.elementWidth&&n.elementHeight?(e=n.elementWidth,o=n.elementHeight):(e=f.width(),o=f.height()),n.elementX&&n.elementY?(r=n.elementX,u=n.elementY):(r=s.left,u=s.top),h=r+e,c=u+o,t>=r&&t<=h&&i>=u&&i<=c)?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:clickedInsideElement END returned true"),!0):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:clickedInsideElement END returned false"),!1)},t.clickedInsideBubble=function(t,i,r){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:clickedInsideBubble START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"pageX: "+i+" pageY:"+r);var u=n.BubbleUtilityConstants.paddingLength,f=t.offset().left,e=t.offset().top,o=f+t.width()+u,s=e+t.height()+u;return i>=f&&i<=o&&r>=e&&r<=s?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:clickedInsideBubble END returned true"),!0):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:clickedInsideBubble END returned false"),!1)},t.isCompleteBubbleVisible=function(n){var t=n.getJquerySelectorMap().bubbleId;return t.offset().left+t.width()>=window.innerWidth||t.offset().top+t.height()>=window.innerHeight?!1:!0},t.getArrowPosition=function(t,i,r,u,f,e,o,s){var h,c,k,a,w,d,nt,tt;s===void 0&&(s=n.BubbleUtilityConstants.bubblePositionAuto);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:getArrowPosition START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"pos: "+t+" subQuadrantNumber:"+i+"targetOffset:"+u+" flyout:"+f+" iframeOffsetTop: "+e+" iframeOffsetLeft:"+o);var g=r.element,p=0,b=0,v,l,y;if(u||(u=g.offset()),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"targetOffset: "+u),h=u.top,h>window.innerHeight&&(h=e+g.offset().top),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"topoffset: "+h),c=u.left,(c>window.innerWidth||c<0)&&(c=o+g.offset().left),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"leftoffset: "+c),r.elementWidth&&r.elementHeight?(k=r.elementWidth,a=r.elementHeight):(k=g.width(),a=g.height()),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"targetWidth: "+k+"targetHeight: "+a),i===undefined||i==null)_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"handling case where subQuadrantNumber is unknown"),d=Math.min(k,f.width()),w=Math.min(a,f.height()),t===n.BubbleUtilityConstants.quadrant12&&s===n.BubbleUtilityConstants.bubblePositionAuto||s===n.BubbleUtilityConstants.bubblePositionBottomLeft||s===n.BubbleUtilityConstants.bubblePositionBottomRight?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"The arrow direction will be TOP and arrow will be hooked to slight left of the Bubble"),c>n.BubbleUtilityConstants.arrowWidth&&(p=-n.BubbleUtilityConstants.arrowWidth),b=n.BubbleUtilityConstants.arrowSize+n.BubbleUtilityConstants.bubbleBorderSize,v=n.BubbleUtilityConstants.top,l=h+a+2*n.BubbleUtilityConstants.bubbleBorderSize,y=c+d/2-n.BubbleUtilityConstants.arrowWidth/2):t===n.BubbleUtilityConstants.quadrant34&&s===n.BubbleUtilityConstants.bubblePositionAuto||s===n.BubbleUtilityConstants.bubblePositionTopLeft||s===n.BubbleUtilityConstants.bubblePositionTopRight?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"The arrow direction will be BOTTOM and arrow will be hooked to slight left of the Bubble"),c>n.BubbleUtilityConstants.arrowWidth&&(p=-n.BubbleUtilityConstants.arrowWidth),b=-n.BubbleUtilityConstants.arrowSize-n.BubbleUtilityConstants.bubbleBorderSize,v=n.BubbleUtilityConstants.bottom,l=h-n.BubbleUtilityConstants.arrowSize,y=c+d/2-n.BubbleUtilityConstants.arrowWidth/2):t===n.BubbleUtilityConstants.quadrant13&&s===n.BubbleUtilityConstants.bubblePositionAuto||s===n.BubbleUtilityConstants.bubblePositionRightTop||s===n.BubbleUtilityConstants.bubblePositionRightBottom?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"The arrow direction will be LEFT and arrow will be hooked to slight top of the Bubble"),h>n.BubbleUtilityConstants.arrowWidth&&(b=-n.BubbleUtilityConstants.arrowWidth),p=n.BubbleUtilityConstants.arrowSize+n.BubbleUtilityConstants.bubbleBorderSize,v=n.BubbleUtilityConstants.left,y=c+k+n.BubbleUtilityConstants.bubbleBorderSize*2,l=h+w/2-n.BubbleUtilityConstants.arrowWidth):(t===n.BubbleUtilityConstants.quadrant24&&s===n.BubbleUtilityConstants.bubblePositionAuto||s===n.BubbleUtilityConstants.bubblePositionLeftTop||s===n.BubbleUtilityConstants.bubblePositionLeftBottom)&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"The arrow direction will be RIGHT and arrow will be hooked to slight top of the Bubble"),h>n.BubbleUtilityConstants.arrowWidth&&(b=-n.BubbleUtilityConstants.arrowWidth),p=-n.BubbleUtilityConstants.arrowSize-n.BubbleUtilityConstants.bubbleBorderSize,v=n.BubbleUtilityConstants.right,y=c-n.BubbleUtilityConstants.arrowSize,l=h+w/2-n.BubbleUtilityConstants.arrowWidth);else{c>n.BubbleUtilityConstants.arrowWidth&&(p=n.BubbleUtilityConstants.arrowWidth>a?-n.BubbleUtilityConstants.arrowWidth:-n.BubbleUtilityConstants.arrowWidth/2);w=Math.min(a,f.height());switch(s){case n.BubbleUtilityConstants.bubblePositionAuto:_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"handling case with bubblePositionAuto");i<5?(d=Math.min(k,f.width()),c>n.BubbleUtilityConstants.arrowWidth&&(p=n.BubbleUtilityConstants.arrowWidth>a?-n.BubbleUtilityConstants.arrowWidth:-n.BubbleUtilityConstants.arrowWidth/2),t===n.BubbleUtilityConstants.quadrant1||t===n.BubbleUtilityConstants.quadrant2?(b=n.BubbleUtilityConstants.arrowSize+n.BubbleUtilityConstants.bubbleBorderSize,v=n.BubbleUtilityConstants.top,l=h+a+2*n.BubbleUtilityConstants.bubbleBorderSize):(b=-n.BubbleUtilityConstants.arrowSize-n.BubbleUtilityConstants.bubbleBorderSize,v=n.BubbleUtilityConstants.bottom,l=h-n.BubbleUtilityConstants.arrowSize),y=i===0||i===3?t===n.BubbleUtilityConstants.quadrant1||t===n.BubbleUtilityConstants.quadrant3?c:c-n.BubbleUtilityConstants.arrowWidth/2:i===1||i===4?c+d/2-n.BubbleUtilityConstants.arrowWidth/2:c+d-n.BubbleUtilityConstants.arrowWidth):(w=Math.min(a,f.height()),h>n.BubbleUtilityConstants.arrowWidth&&(b=n.BubbleUtilityConstants.arrowWidth>a?-n.BubbleUtilityConstants.arrowWidth:-n.BubbleUtilityConstants.arrowWidth/2),t===n.BubbleUtilityConstants.quadrant1||t===n.BubbleUtilityConstants.quadrant3?(p=n.BubbleUtilityConstants.arrowSize+n.BubbleUtilityConstants.bubbleBorderSize,v=n.BubbleUtilityConstants.left,y=c+k+n.BubbleUtilityConstants.bubbleBorderSize*2,i===5||i===8?l=h:i===6&&(l=h+w-n.BubbleUtilityConstants.arrowWidth)):(p=-n.BubbleUtilityConstants.arrowSize-n.BubbleUtilityConstants.bubbleBorderSize,v=n.BubbleUtilityConstants.right,y=c-n.BubbleUtilityConstants.arrowSize,i===5||i===8?l=h+w-n.BubbleUtilityConstants.arrowWidth:i===6&&(l=h)),i===7&&(l=h+w/2-n.BubbleUtilityConstants.arrowWidth));break;case n.BubbleUtilityConstants.bubblePositionTopLeft:case n.BubbleUtilityConstants.bubblePositionTopRight:_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"if the bubble position is set to TopLeft or TopRight Arrow direction will be BOTTOM");b=-n.BubbleUtilityConstants.arrowSize-n.BubbleUtilityConstants.bubbleBorderSize;s==n.BubbleUtilityConstants.bubblePositionTopLeft&&(p=-(f.width()-3*n.BubbleUtilityConstants.arrowWidth));v=n.BubbleUtilityConstants.bottom;l=h-n.BubbleUtilityConstants.arrowSize;break;case n.BubbleUtilityConstants.bubblePositionBottomLeft:case n.BubbleUtilityConstants.bubblePositionBottomRight:_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"if the bubble position is set to BottomLeft or BottomRight Arrow direction will be TOP");b=n.BubbleUtilityConstants.arrowSize+n.BubbleUtilityConstants.bubbleBorderSize;s==n.BubbleUtilityConstants.bubblePositionBottomLeft&&(p=-(f.width()-3*n.BubbleUtilityConstants.arrowWidth));v=n.BubbleUtilityConstants.top;l=h+a+2*n.BubbleUtilityConstants.bubbleBorderSize;break;case n.BubbleUtilityConstants.bubblePositionLeftTop:case n.BubbleUtilityConstants.bubblePositionLeftBottom:_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"if the bubble position is set to LeftTop or LeftBottom Arrow direction will be Right");b=s==n.BubbleUtilityConstants.bubblePositionLeftBottom?-n.BubbleUtilityConstants.arrowWidth:-(f.height()-2*n.BubbleUtilityConstants.arrowWidth);p=-n.BubbleUtilityConstants.arrowSize-n.BubbleUtilityConstants.bubbleBorderSize;v=n.BubbleUtilityConstants.right;y=c-n.BubbleUtilityConstants.arrowSize;l=i===5||i===8?h+w-n.BubbleUtilityConstants.arrowWidth:i===6?h:t===n.BubbleUtilityConstants.quadrant1||t===n.BubbleUtilityConstants.quadrant2?h+a+2*n.BubbleUtilityConstants.bubbleBorderSize:h-n.BubbleUtilityConstants.arrowSize;break;case n.BubbleUtilityConstants.bubblePositionRightTop:case n.BubbleUtilityConstants.bubblePositionRightBottom:_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"if the bubble position is set to RightTop or RightBottom Arrow direction will be LEFT");p=n.BubbleUtilityConstants.arrowSize+n.BubbleUtilityConstants.bubbleBorderSize;b=s==n.BubbleUtilityConstants.bubblePositionRightBottom?-n.BubbleUtilityConstants.arrowWidth:-(f.height()-2*n.BubbleUtilityConstants.arrowWidth);v=n.BubbleUtilityConstants.left;y=c+k+n.BubbleUtilityConstants.bubbleBorderSize*2;l=i===5||i===8?h:i===6?h+w-n.BubbleUtilityConstants.arrowWidth:t===n.BubbleUtilityConstants.quadrant1||t===n.BubbleUtilityConstants.quadrant2?h+a+2*n.BubbleUtilityConstants.bubbleBorderSize:h-n.BubbleUtilityConstants.arrowSize}y===undefined&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"left offset of the Arrow is undefined"),w=Math.min(a,f.height()),d=Math.min(k,f.width()),i===0||i===3?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"left offset of the arrow will be left of the target element"),y=u.left):i===1||i===4?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"arrow will be placed slight left of the bubble"),y=c+d/2-n.BubbleUtilityConstants.arrowWidth/2):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"arrow will be placed slight right of the bubble"),y=c+d-n.BubbleUtilityConstants.arrowWidth));i===7&&(l=h+w/2-n.BubbleUtilityConstants.arrowWidth/2)}return v===n.BubbleUtilityConstants.left||v===n.BubbleUtilityConstants.right?n.BubbleUtilityConstants.arrowWidth>a&&(w=Math.min(a,f.height()),l=h+w/2-n.BubbleUtilityConstants.arrowWidth/2,h<n.BubbleUtilityConstants.arrowWidth&&(b=-(n.BubbleUtilityConstants.arrowWidth/2))):n.BubbleUtilityConstants.arrowWidth>k&&(d=Math.min(k,f.width()),y=c+d/2-n.BubbleUtilityConstants.arrowWidth/2,c<n.BubbleUtilityConstants.arrowWidth&&(p=-(n.BubbleUtilityConstants.arrowWidth/2))),nt=[b,p],tt=[l,y],_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"flyoutOffsetChange: "+nt.toString()+" arrowOffset:"+tt.toString()+"arrowDirection:"+v),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:getArrowPosition END"),[nt,tt,v]},t.getRowOrColumn=function(n,t,i){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:getRowOrColumn START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"startIndex: "+n+" endIndex:"+t+" offset:"+i);var r=t-n;return i<n+r/3?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:getRowOrColumn END return 0"),0):i<n+r*2/3?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:getRowOrColumn END return 1"),1):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"BubbleUtility:getRowOrColumn END return 2"),2)},t}();n.BubbleUtility=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.replaceCustomAttributes=function(n,t){var i=_MicrosoftMars.Client.Loader.appContext.Util.getConfigurationData(_MicrosoftMars.Client.Loader.appContext.Util.CustomAttributeSetting),r=Handlebars.compile(n);return r({controlCustomAttributes:t,globalCustomAttributes:i})},n}();n.CustomAttributeUtility=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){"use strict";t.$mars=window._MicrosoftMars.Client.Loader.$mars;var i=function(){function i(n){this.bubbleModel=n}return i.prototype.setView=function(n){this.view=n},i.prototype.getView=function(){return this.view},i.prototype.getBubbleModel=function(){return this.bubbleModel},i.prototype.inject=function(n,i){var h,c,l,e,o,p,f,s,w;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Bubble:inject START");h=window._MicrosoftMars.Client.Loader.appContext.Util.getOrCreateOverlay();l=i?_MicrosoftMars.Client.Loader.marsLocale.stepEditor:_MicrosoftMars.Client.Loader.marsLocale.stepPreview;c='<div role="region" aria-label="'+l+'">'+this.view.getHtmlContent()+"<\/div>";var u=t.$mars().add('<div id="'+this.bubbleModel.getBubbleId()+t.InfoBubbleConstants.layout+'"><\/div>'),r=t.$mars().add('<div role="dialog" id="'+this.bubbleModel.getBubbleId()+'" aria-label="'+_MicrosoftMars.Client.Loader.marsLocale.bubbleAlt+'" aria-describedby=""><\/div>');u.html(this.view.getArrowandOverlayHtml());var a=u.find("#"+this.bubbleModel.getBubbleId()+t.BubbleUtilityConstants.arrowName),v=u.find("#"+this.bubbleModel.getBubbleId()+t.BubbleUtilityConstants.transparentArrowName),y=u.find("#"+t.BubbleUtilityConstants.overlayName);r.css(t.BubbleUtilityConstants.bubbleCSS);r.addClass("mars-bubble");r.html(c);r.append('<span id="bubbleDetails" hidden> <\/span>');r.css("display","none");r.addClass("mars-bubble-nudge");r.addClass("mars-nudge-bubble-width");n?r.addClass("mars-nudge-bubble-width-designer"):r.addClass("lpath-flow-preview-bubble");e=r.find(" #"+t.InfoBubbleConstants.xButtonName);o=r.find(" #"+t.BubbleUtilityConstants.bubbleContainerId);o.attr("data-bubbleId",this.bubbleModel.getBubbleId());o.focus();e.addClass("mars-xbutton");p=r.find("#"+t.BubbleUtilityConstants.videoPopoutButtonId);_MicrosoftMars.Client.Loader.appContext.isRTL()&&r.addClass("mars-rtl");this.bubbleModel.setJquerySelectorMap("bubblelayout",u);this.bubbleModel.setJquerySelectorMap("bubbleId",r);this.bubbleModel.setJquerySelectorMap("xButtonId",e);this.bubbleModel.setJquerySelectorMap("arrowId",a);this.bubbleModel.setJquerySelectorMap("transparentArrowId",v);this.bubbleModel.setJquerySelectorMap("overlayId",y);this.bubbleModel.setJquerySelectorMap("videoPopoutButtonId",p);u.append(r);u.append(a);u.append(v);u.append(y);n?_MicrosoftMars.Client.Loader.$mars("#lPathDesignerOverlay").append(u[0]):(f=_MicrosoftMars.Client.Loader.$mars(h),_MicrosoftMars.Client.Utility.Util.isOngoingAutomation()&&(f=_MicrosoftMars.Client.Loader.$mars("body")),s=u[0],_MicrosoftMars.Client.Loader.appContext.Util.iswindows8Shim()&&(s=this.stripScriptsHelper(u[0])),w=_MicrosoftMars.Client.Loader.$mars(s),f.marsAppend(f,w[0].outerHTML),this.bubbleModel.setJquerySelectorMap("bubblelayout",f.find("#"+this.bubbleModel.getBubbleId()+t.InfoBubbleConstants.layout)),this.bubbleModel.setJquerySelectorMap("bubbleId",f.find("#"+this.bubbleModel.getBubbleId())),this.bubbleModel.setJquerySelectorMap("xButtonId",f.find(" #"+t.InfoBubbleConstants.xButtonName)),this.bubbleModel.setJquerySelectorMap("arrowId",f.find("#"+this.bubbleModel.getBubbleId()+t.BubbleUtilityConstants.arrowName)),this.bubbleModel.setJquerySelectorMap("transparentArrowId",f.find("#"+this.bubbleModel.getBubbleId()+t.BubbleUtilityConstants.transparentArrowName)),this.bubbleModel.setJquerySelectorMap("overlayId",f.find("#"+t.BubbleUtilityConstants.overlayName)),this.bubbleModel.setJquerySelectorMap("videoPopoutButtonId",f.find("#"+t.BubbleUtilityConstants.videoPopoutButtonId)));this.setAutoResize(n);this.applyTextOverflowLimit();_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Bubble:inject END")},i.prototype.show=function(i){var w=this,s,l,h,u,e,a,f,v,r,p;if((_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Bubble:show START"),s=_MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex(),t.$mars("#"+this.bubbleModel.getBubbleId()).css("z-index",s+3),!t.ScenarioManager.isBubbleVisible())&&(l=this.bubbleModel.getPointerless(),h=_MicrosoftMars.AnswerPanel.getInstance(),i||h==null||!h.isAnswerPanelVisible||_MicrosoftMars.Client.Utility.Util.isOngoingAutomation())){_MicrosoftMars.Client.Loader.appContext.util.showCustomizationContainer();u=this.bubbleModel.getJquerySelectorMap();u.bubbleId.css("display","block");u.arrowId.css("display","block");l?(u.transparentArrowId.css("display","none"),_MicrosoftMars.Client.Loader.$mars("#"+this.getBubbleModel().getBubbleId()).attr("aria-describedby","")):u.transparentArrowId.css("display","block");u.transparentArrowId.css("z-index",s+4);(i===undefined||i===!1)&&_MicrosoftMars.Client.Loader.appContext.util.showOverlay();e=this.getBubbleModel();a=e.getWaitingBubble();a&&(f=e.getWaitingBubbleFunctionName(),f===""||f==null?console.log("No Function Specified for Waiting Bubble in Designer"):typeof window[f]=="function"?window[f](e):console.log(f+": Function does not exist in Webresource"),_MicrosoftMars.Client.Loader.appContext.ClientType!=t.BubbleUtilityConstants.mobileClientType&&_MicrosoftMars.Client.Loader.appContext.util.hideOverlay());this.checkForHighContrastMode();t.ScenarioManager.setBubbleVisible(!0);v=_MicrosoftMars.Client.Loader.$mars('div[id^="mars-fwlinkVideoHolder"]');v.each(function(){_MicrosoftMars.Client.Loader.appContext.Util.executeFwLink(t.$mars(this))});_MicrosoftMars.Client.Loader.$mars(".mars-stepbubble-contentcontainer img").each(function(){var n=_MicrosoftMars.Client.Loader.$mars(this);(n.attr("title")===undefined||n.attr("title")==="")&&n.attr("alt")!==undefined&&n.attr("alt")!==""&&n.attr("title",n.attr("alt"))});var y=n.Mars.Client.Runtime.Controls.ScenarioUtil,b=_MicrosoftMars.Client.Loader.$mars(".mars_webPage"),k=_MicrosoftMars.Client.Loader.$mars(".mars_pageInApp"),d=_MicrosoftMars.Client.Loader.$mars(".mars-section-text a, .lpath-section-text a"),o=[],c=t.ScenarioManager.getInstance();c&&(r=c.getActiveScenario(),r&&(p=_MicrosoftMars.Client.Loader.appContext.Util.getPublishGroupDetails(r.getPublishGroupId(),"Name"),o.push(r.getAuthorId(),c.getActiveScenarioId(),r.getControlName(),r.GetVersion(),r.getScenarioType(),r.getAuthoringGroupId(),r.getPublishGroupId(),p)));b.off("click keydown").on("click keydown",{value:o},function(n){y.marsLinkClick(n,n.data.value)});d.each(function(){_MicrosoftMars.Client.Loader.$mars(this).off("click keydown").on("click keydown",{value:o},function(n){y.marsLinkClick(n,n.data.value)})});k.off("click").on("click",{value:o},function(n){w.pageInAppClickHandler(n,n.data.value)});_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Bubble:show END")}},i.prototype.hide=function(n){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Bubble:hide START");var r=window._MicrosoftMars.Client.Utility,u=this.getBubbleModel(),f=u.isStepActive(),i=this.bubbleModel.getJquerySelectorMap();i.bubbleId.css("display","none");i.arrowId.css("display","none");i.transparentArrowId.css("display","none");f&&_MicrosoftMars.Client.Loader.currentInstance.UpdateMarsAriaLiveContent("",r.AriaLiveType.off);(n===undefined||n===!1)&&_MicrosoftMars.Client.Loader.appContext.util.hideOverlay();_MicrosoftMars.Client.Loader.appContext.util.getGTPreviewState()||_MicrosoftMars.Client.Loader.appContext.util.hideCustomizationContainer();t.ScenarioManager.setBubbleVisible(!1);_MicrosoftMars.Client.Loader.$mars(window).off("resize.marsnamespace");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Bubble:hide END")},i.prototype.cleanup=function(){var n=this.bubbleModel.getJquerySelectorMap();n.bubblelayout&&n.bubblelayout.remove();t.ScenarioManager.setBubbleVisible(!1)},i.prototype.pageInAppClickHandler=function(n,i){var e=_MicrosoftMars.Client.Loader.appContext,u=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.linkClick),r,f;return u.SetUserActivityInfo(e.UserId,i[1],i[6],i[7],i[5],_MicrosoftMars.AnswerPanelModel.telemetry.Guid.newGuid(),i[0],i[2]),r=_MicrosoftMars.Client.Loader.$mars(n.target).data("pagenavigationinfo"),r=_MicrosoftMars.Client.Loader.appContext.getPageInAppPageNavigationInfo(r),r&&(t.AnswerPanelLauncher.isScenarioTriggered=!0,_MicrosoftMars.Client.Loader.appContext.navigateToPage(r)),f=[i[4],i[3],"Page In App","","","","","","",n.currentTarget.textContent,_MicrosoftMars.Client.Loader.appContext.UserRoleNames],u.SetActivityData(f),u.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete),!1},i.prototype.checkForHighContrastMode=function(){var r,n,i,u;t.$mars("#checkHighContrastDiv").css("background-image")==="none"?(r=!1,n=this.bubbleModel.getBubbleId(),n&&(t.$mars("#"+t.BubbleUtilityConstants.learningPathOverlayId).hasClass("mars_highcontrast")||t.$mars("#"+t.BubbleUtilityConstants.learningPathOverlayId).addClass("mars_highcontrast"),t.$mars("#"+t.BubbleUtilityConstants.learningPathOverlayId).hasClass("lpath-overlay-initial-highcontrast")||t.$mars("#"+t.BubbleUtilityConstants.learningPathOverlayId).addClass("lpath-overlay-initial-highcontrast"),t.$mars("#"+n).css("border-width","thin"),t.$mars("#"+n).css("border-style","solid"),t.$mars('.mars-section-contents-prev input[type="button"]').length>0&&t.$mars('.mars-section-contents-prev input[type="button"]').addClass("mars_highcontrast"),t.$mars("body").css("background-color")==="rgb(255, 255, 255)"&&(r=!0),i=t.$mars('#xbutton input[type="image"]'),i&&i.length>0&&(u=r?_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.closeIcon:_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.closeIconInHighContrast,i.attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/"+u)))):t.$mars("#"+t.BubbleUtilityConstants.learningPathOverlayId).hasClass("mars_highcontrast")&&t.$mars("#"+t.BubbleUtilityConstants.learningPathOverlayId).removeClass("mars_highcontrast")},i.prototype.applyTextOverflowLimit=function(){var n=_MicrosoftMars.Client.Loader.$mars(".lpath-preview-bubble-title").find(".crm-lpath-title"),t=n.text().length;t>30&&n.addClass("lpath-bubble-title-ellipsis")},i.prototype.stripScriptsHelper=function(n){for(var r=n,t=r.getElementsByTagName("script"),i=t.length,u;i--;)u=t[i],t[i].parentNode.removeChild(t[i]),_MicrosoftMars.Client.Loader.appContext.insertCustomScript(u.innerHTML);return r},i.prototype.setAutoResize=function(n){var l=this.bubbleModel.getJquerySelectorMap(),h=this,r=_MicrosoftMars.Client.Loader.marsLocale.moreLinkTextName,e=_MicrosoftMars.Client.Loader.marsLocale.lessLinkTextName,a=l.bubbleId,i=a.find(".mars-section-text"),s,u,f,c;if(i.length&&(this.bubbleModel.isRTL()&&i.attr("dir","rtl"),s=i.text(),u=i.find("div.crm-mars-title").html(),s.length>t.InfoBubbleConstants.minCharCount&&s.length<=t.InfoBubbleConstants.maxCharCount)){var v=u.substr(0,t.InfoBubbleConstants.minCharCount).lastIndexOf(" "),y=u.substr(0,v),o=y+"<span>...";i.html(o+'<\/span>&nbsp&nbsp<span class="mars-morelink" tabindex="1" title="'+r+'">'+r+"<\/span>");i.attr("title",_MicrosoftMars.Client.Utility.Util.resolveTitle(o));i.attr("tabindex","1");f=i.find(".mars-morelink");c=t.$mars("#stepBubbleContainer");c.off("click keydown","span[class=mars-morelink]").on("click keydown","span[class=mars-morelink]",function(s){if(s.type==="click"||s.keyCode===13)return f=i.find(".mars-morelink"),f.attr("title")===e?(f.html(r),i.html(o+'<\/span>&nbsp&nbsp<span tabindex="1" class="mars-morelink" title="'+r+'">'+r+"<\/span>"),i.attr("title",_MicrosoftMars.Client.Utility.Util.resolveTitle(o))):(f.html(e),i.html(u+'<\/span>&nbsp&nbsp<span tabindex="1" class="mars-morelink" style="float:right;" title="'+e+'">'+e+"<\/span>"),i.attr("title",_MicrosoftMars.Client.Utility.Util.resolveTitle(u))),t.BubbleUtility.setBubblePostion(h.getBubbleModel(),n),t.ScenarioManager.setBubbleVisible(!1),t.ScenarioManager.isTriggeredFromMore=!0,h.show(),!1})}},i}();t.Bubble=i})(i=t.Controls||(t.Controls={}))})(i=t.Runtime||(t.Runtime={}))})(i=t.Client||(t.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.maxZIndex=window._MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex(),n.overlayClickAttached=!1,n.GuidedTask="StepThrough",n.sideBar="sidebar",n.quadrant1="quadrant1",n.quadrant2="quadrant2",n.quadrant3="quadrant3",n.quadrant4="quadrant4",n.quadrant12="quadrant11",n.quadrant13="quadrant13",n.quadrant24="quadrant24",n.quadrant34="quadrant34",n.xButtonName="xbutton",n.arrowName="arrow",n.transparentArrowName="transparentArrow",n.overlayName="overlay",n.paddingLength=0,n.left="left",n.right="right",n.top="top",n.bottom="bottom",n.arrowSize=12,n.arrowWidth=24,n.arrowHeight=24,n.bubbleBorderSize=0,n.arrowThickness=2,n.onoverlay=1,n.insidebubble=2,n.insideelement=3,n.bubbleWidth=300,n.bubbleDesignerToolbarWidth=50,n.clickHybridType="click",n.inputHybridType="input",n.customHybridType="custom",n.TITLE="title",n.LANDING="landing",n.DELAY="delay",n.CLICK="click",n.INVOKED="invoked",n.FOCUS="focus",n.HOVER="hover",n.NEXT="next",n.PREVIOUS="previous",n.OK="ok",n.CANCEL="cancel",n.FINISH="finish",n.CLOSE="close",n.launchAction="launch",n.learnMoreAction="learnMore",n.nextAction="next",n.prevAction="prev",n.closeAction="close",n.bubbleContainerId="stepBubbleContainer",n.videoPopoutButtonId="videoPopoutButton",n.mobileClientType="Mobile",n.infoDivId="infoDiv",n.infoIconImageId="InfoIcon",n.bubblePositionAuto="Auto",n.bubblePositionTopLeft="TopLeft",n.bubblePositionTopRight="TopRight",n.bubblePositionBottomLeft="BottomLeft",n.bubblePositionBottomRight="BottomRight",n.bubblePositionLeftTop="LeftTop",n.bubblePositionLeftBottom="LeftBottom",n.bubblePositionRightTop="RightTop",n.bubblePositionRightBottom="RightBottom",n.learningPathOverlayId="lpathRuntimeOverlay",n.overlay_css={position:"absolute",top:"0px",bottom:"0px",left:"0px",right:"0px",height:"100%",width:"100%","z-index":n.maxZIndex},n.bubbleCSS={"z-index":n.maxZIndex+3},n.arrow_left_right_common_css={"z-index":n.maxZIndex+2},n.arrow_top_bottom_common_css={"z-index":n.maxZIndex+2},n}();n.BubbleUtilityConstants=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.controlType="InfoBubble",n.xButtonName="xbutton",n.minCharCount=220,n.maxCharCount=420,n.scrollHeight=140,n.bubblewidth=270,n.circlewidth=5,n.circlespacewidth=4,n.layout="layout",n}();n.InfoBubbleConstants=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){"use strict";var i=function(i){function r(n,t){i.call(this,n);this.userInputTimeDelay=3e3;this.isPreviousElementCRMElementFlag=!1;this.totalSteps=t;this.userInput=!1;this.userActionCompleted=!1}return __extends(r,i),r.replaceNextPrevIcon=function(n,t){var u=window._MicrosoftMars.Client.Utility.Util.getThemeName(),i=_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.greenPreviousImage,r=_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.greenNextImage;u==="BlueTheme.css"&&(i=_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.bluePreviousImage,r=_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.blueNextImage);t.attr("src",i);n.attr("src",r)},r.prototype.inject=function(n,u,f,e){var s,h;f===void 0&&(f=t.BubbleUtilityConstants.bubblePositionAuto);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:inject START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"isDesigner: "+u);try{s=!1;i.prototype.inject.call(this,u,e);var o=i.prototype.getBubbleModel.call(this),a=o.isStepActive(),v=o.getAppContext();o.getPlacementPosition()!==t.BubbleUtilityConstants.bubblePositionAuto&&(f=o.getPlacementPosition());_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"placementPosition: "+f);this.addCircles();this.addTitleToBubble();var o=i.prototype.getBubbleModel.call(this),c=o.getBubbleId(),y=_MicrosoftMars.Client.Loader.$mars("#"+c+" .mars-stepbubble-previousicon"),p=_MicrosoftMars.Client.Loader.$mars("#"+c+" .mars-stepbubble-nexticon");r.replaceNextPrevIcon(p,y);this.removePreviousOrNextButton(u);t.BubbleUtility.setBubblePostion(o,u,f);(u===undefined||u===!1)&&(this.notifyEventScenarioManager(n),this.parseButtonLinks(o.getButtonsModel()),t.ScenarioUtil.lpathRuntimeOverlayClickAttached===!1&&(this.clickhandling(),t.ScenarioUtil.lpathRuntimeOverlayClickAttached=!0),a&&(h=_MicrosoftMars.Client.Loader.appContext.getElement(v.ElementIdentifier),h!=null&&h.element.addClass("marsTargetElement")));s=!0}catch(l){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"error occured in StepBubble:inject");_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchStepException,l.message,null,l);s=!1}finally{return _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:inject END"),s}},r.prototype.cleanup=function(){var r,n,e,u,o;i.prototype.cleanup.call(this);var t=i.prototype.getBubbleModel.call(this),f=t.getEvents(),s=t.isStepActive();if(f)for(r=0;r<f.length;r++)if(n=f[r],s)e=t.getCachedTargetElement(),e!=null&&(u=e.element,u.off(n.Trigger+"#mars"),u.hasClass("marsTargetElement")&&u.removeClass("marsTargetElement"));else{if(n.id==="")continue;o=t.getBubbleId();_MicrosoftMars.Client.Loader.$mars("#"+o+" #"+n.id).off(n.Trigger)}},r.prototype.show=function(n){var s,u,h,f,c;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:show START");var r=i.prototype.getBubbleModel.call(this),o=r.isStepActive(),e=this,l=window._MicrosoftMars.Client.Utility;if(n===undefined||n===!1?(i.prototype.show.call(this),setTimeout(function(){_MicrosoftMars.Client.Loader.appContext.checkForPageLoad(function(){e.keyboardHandling(o)})},1e3)):i.prototype.show.call(this,n),s=_MicrosoftMars.Client.Loader.appContext,_MicrosoftMars.Client.Loader.appContext.clientType!==t.BubbleUtilityConstants.mobileClientType||_MicrosoftMars.Client.Loader.appContext.isISHPage())_MicrosoftMars.Client.Loader.$mars(window).off("resize.marsnamespace").on("resize.marsnamespace",function(){setTimeout(function(){_MicrosoftMars.Client.Loader.appContext.checkForPageLoad(function(){e.handleWindowResize(e,r)})},1e3)});(typeof n=="undefined"||n===!1)&&this.AddCssWatch(this,r,n);t.AnswerPanelLauncher.isScenarioTriggered=!1;n||(r.getControlType()===window._MicrosoftMars.Client.Telemetry.ActivityName.activestepbubble?u=window._MicrosoftMars.Client.Telemetry.ActivityName.activestepbubble:r.getControlType()===window._MicrosoftMars.Client.Telemetry.ActivityName.passivestepbubble?u=window._MicrosoftMars.Client.Telemetry.ActivityName.passivestepbubble:r.getControlType()===window._MicrosoftMars.Client.Telemetry.ActivityName.infobubble&&(u=window._MicrosoftMars.Client.Telemetry.ActivityName.infobubble),t.stepBubbleActivityEvent=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(u),h=_MicrosoftMars.Client.Loader.appContext.Util.getPublishGroupDetails(r.getPublishGroupId(),"Name"),t.stepBubbleActivityEvent.SetUserActivityInfo(s.userId,r.getBubbleId(),r.getPublishGroupId(),h,r.getAuthoringGroupId(),r.getParentControlId(),r.getAuthorId(),r.getControlName(),r.getParentControlId(),r.getParentControlName()),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:show END"),this.trackVideoRenderedActivity(r),o&&(f=r.getJquerySelectorMap(),c=f.bubbleId.find("#bubbleDetails").text(),_MicrosoftMars.Client.Loader.currentInstance.UpdateMarsAriaLiveContent(c,l.AriaLiveType.assertive),f.bubbleId.attr("aria-describedby",""),f.bubbleId.attr("aria-label","")))},r.prototype.trackVideoRenderedActivity=function(n){var t=_MicrosoftMars.Client.Loader.$mars("#stepBubbleContainer");t.find("div[id='marsVideoDiv']").each(function(){var i=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.video),u=_MicrosoftMars.Client.Loader.appContext.Util.getPublishGroupDetails(n.getPublishGroupId(),"Name"),t,r;i.SetUserActivityInfo(_MicrosoftMars.Client.Loader.appContext.userId,n.getBubbleId().replace(n.getParentControlId(),""),n.getPublishGroupId(),u,n.getAuthoringGroupId(),n.getParentControlId(),n.getAuthorId(),n.getControlName());t="";_MicrosoftMars.Client.Loader.$mars(this).find("[data-name='mars-videoPreview']").length>0?t=_MicrosoftMars.Client.Loader.$mars(this).find("[data-name='mars-videoPreview']").attr("src"):_MicrosoftMars.Client.Loader.$mars(this).find("#mars-fwlinkVideoHolder").length>0&&(t=_MicrosoftMars.Client.Loader.$mars(this).find("#mars-fwlinkVideoHolder").data("videosource"));r=[window._MicrosoftMars.Client.Telemetry.ActivityName.guidedtask,t,_MicrosoftMars.Client.Loader.appContext.CurrentStage,_MicrosoftMars.Client.Loader.appContext.UserRoleNames];i.SetActivityData(r);i.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.rendered)})},r.prototype.parseButtonLinks=function(n){var r,f,u;if(n)for(r=i.prototype.getBubbleModel.call(this),f=0;f<n.length;f++)if(u=n[f],u.Type==="guidedtask"||u.Type==="sidebar")_MicrosoftMars.Client.Loader.$mars("#"+u.Id).on("click",{control:u,stepBubbleModel:r},function(n){var u;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Button links clicked");t.ScenarioManager.getInstance().notify(t.BubbleUtilityConstants.CLOSE);var f=_MicrosoftMars.Client.Loader.appContext,i=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.linkClick),e=_MicrosoftMars.Client.Loader.appContext.Util.getPublishGroupDetails(r.getPublishGroupId(),"Name");i.SetUserActivityInfo(f.UserId,r.getBubbleId(),r.getPublishGroupId(),e,r.getAuthoringGroupId(),r.getParentControlId(),r.getAuthorId(),r.getControlName());u=[r.getControlType(),"","",""];t.ScenarioUtil.launchLinkedControl(n.data.control.Id,n.data.control.EnableNavigation,"",i,u)})},r.prototype.AddCssWatch=function(t,i,r){var u=this,e=i.getWildCardNavigation(),f=i.getTargetElement(!1,r,!0,e);if(f){_MicrosoftMars.Client.Loader.$mars(f.element).off("css-change.marsnamespace").on("css-change.marsnamespace",function(){var e,f,r;if(n.Mars.Client.Runtime.Controls.ScenarioManager.isBubbleVisible()){if(e=n.Mars.Client.Runtime.Controls.ScenarioManager.getInstance().getActiveScenario(),e.getCurrentStepId()!==u.getBubbleModel().getBubbleId())return;if(this.id!==""&&_MicrosoftMars.Client.Loader.$mars("#"+u.escapeselector(this.id)).length===0){t.hide();return}if(f=i.getTargetElement(!1,!1,i.getWildCardNavigation()),!f||!f.element.is(":visible")){t.hide();return}for(r=0;r<this.classList.length;r++)if(_MicrosoftMars.Client.Loader.$mars("."+this.classList[r]).length===0&&this.classList[r]!=="marsTargetElement")return;u.handleResizeAndReposition(t,i)}});_MicrosoftMars.Client.Loader.$mars(f.element).csswatch({props:"top,left",props_functions:{top:"offset().top",left:"offset().left"}})}},r.prototype.escapeselector=function(n){return n.replace(/[#;&,\+\. \*~':"!\}\{\^\$\[\]\(\)=>|\/\\]/g,"\\$&")},r.prototype.handleResizeAndReposition=function(n,i){var r=t.ScenarioManager.getInstance().getActiveScenario();r&&(i.isStepActive()?(n.cleanup(),i.setStepInjected(!1),r.launchStep(i.bubbleId)):(n.hide(),t.BubbleUtility.setBubblePostion(i,!1,i.placementPosition),n.show(),i.placementPosition==t.BubbleUtilityConstants.bubblePositionAuto||t.BubbleUtility.isCompleteBubbleVisible(i)||(n.hide(),t.BubbleUtility.setBubblePostion(i,!1),n.show())))},r.prototype.activeBubbleHandling=function(n,i,r){var e=this,c=n.pageX,l=n.pageY,o=t.BubbleUtilityConstants.onoverlay,f=i.getTargetElement(),u,b,k,y,p,w,h;if(n.type==="keydown"&&(f.elementX&&f.elementY?(c=f.elementX,l=f.elementY):(c=f.element.offset().left,l=f.element.offset().top)),u=f.element,b=i.getElementInputable(),b){k=_MicrosoftMars.Client.Loader.appContext.ClientType;u=k===t.BubbleUtilityConstants.mobileClientType?u.parent().parent():u.parent();e.userInput=!1;e.userActionCompleted=!1;var a=t.ScenarioManager.getInstance(),s=a.getActiveScenarioId(),nt=a.getScenario(s),v=nt.getNextStepId();if(this.userInputTimeDelay=3e3,this.userInputTimer=setInterval(function(){e.executeScriptLaunchInputtableBubble(u,s,v)},this.userInputTimeDelay),y=u.find("input, textarea"),y.length>0){u=y;u.on("input #mars",function(){e.executeScriptInputPropertyChanged(u,s,v,!0)})}else u.on("change #mars",function(){e.executeScriptInputPropertyChanged(u,s,v,!1)});a.notify(t.BubbleUtilityConstants.CLOSE);setTimeout(function(){u.focus()},100)}else{for(t.BubbleUtility.clickedInsideElement(f,c,l)&&(o=t.BubbleUtilityConstants.insideelement),p=i.getEvents(),w=!1,h=0;h<p.length;h++){var d=p[h],tt=d.Trigger,g=d.Action;g===t.BubbleUtilityConstants.NEXT&&(w=!0);o===t.BubbleUtilityConstants.insideelement&&g===t.BubbleUtilityConstants.NEXT&&(t.AnswerPanelLauncher.isScenarioTriggered=!0,e.triggerElementEvent(u),u[0].click(),setTimeout(function(){u.trigger(tt+"#mars")},0))}o!==t.BubbleUtilityConstants.insideelement||w?o===t.BubbleUtilityConstants.onoverlay&&this.attentionGrabber(i,r):(e.triggerElementEvent(u),u[0].click(),t.ScenarioManager.getInstance().notify(t.BubbleUtilityConstants.CLOSE))}},r.prototype.triggerElementEvent=function(n){if(_MicrosoftMars.Client.Loader.appContext.clientType===t.BubbleUtilityConstants.mobileClientType){var i=window.parent.React;i!=null&&i!==undefined&&i.addons.TestUtils.Simulate.shortPress(n[0])}},r.prototype.focusTargetedElement=function(n){var t=!1;if(n.attr("tabindex")===undefined?n.attr("tabindex","-1"):t=!0,n.focus(),!t)n.on("#mars focusout",function(){n.attr("tabindex")==="-1"&&n.removeAttr("tabindex");n.off("#mars focusout")})},r.prototype.keyboardHandling=function(n){var f=this,a=!1,u,r,o,s=f.getBubbleModel(),e,p=s.getJquerySelectorMap(),i=p.bubbleId,c=i.find("#xbutton"),l=c.find("input"),h;if(i.length){h=i.find(".mars-morelink");h.length&&t.ScenarioManager.isTriggeredFromMore?(t.$mars(document.activeElement).focus(),t.ScenarioManager.isTriggeredFromMore=!1):n?s.getTargetElement()&&(e=s.getTargetElement().element,u=e,e&&f.focusTargetedElement(e)):i.find('div[id^="learnMore"]').length!==0?(u=i.find('div[id^="learnMore"]'),u.css("display")==="none"&&(u=i.find("#xbutton").find("input")),u.focus()):(u=i.find(".mars-stepbubble-nexticon"),u.css("display")==="none"&&(u=i.find(".mars-stepbubble-previousicon"),u.css("display")==="none"&&(u=i.find("#xbutton").find("input"))),u.focus());var r=i.find(".mars-stepbubble-nexticon"),v='<div tabindex="0" class= "lpath_EmptyDiv"> <\/div>',y=i.find("#mars_step_contentContainer");if(r.css("display")==="none"&&(r=i.find(".mars-stepbubble-previousicon"),(r.css("display")==="none"||r.is("[disabled=disabled]"))&&(r=y.children().last().find("[tabindex]:last"))),n)if(s.getTargetElement()){i.find("#marsVideoDiv").length===0&&(r=i.children().last().find("[tabindex]:last"));u.off("keydown").on("keydown",function(n){if(n.shiftKey||n.keyCode!==9){if(n.shiftKey&&n.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.TabKey)f.isPreviousElementCRMElementFlag=!0,i.find(".lpath_EmptyDiv").length!=0?_MicrosoftMars.Client.Loader.$mars(".lpath_EmptyDiv").focus():r.focus();else if((n.keyCode===32||n.keyCode===13)&&!a){n.stopPropagation();a=!0;var u=t.ScenarioManager.getInstance().getActiveStepbubbleModel();if(u===null)return;f.activeBubbleHandling(n,u,i)}}else return l.focus(),!1})}else i.find('div[id^="learnMore"]').length!==0?(c=i.find("#xbutton"),r=c.find("input")):i.find("[data-id=passiveStepBubbleContainer]").length!==0&&(r=i.find(".mars-stepbubble-nexticon"),r.css("display")==="none"&&(r=i.find(".mars-stepbubble-previousicon"),(r.css("display")==="none"||r.is("[disabled=disabled]"))&&(r=y.children().last().find("[tabindex]:last"))));else i.find('div[id^="learnMore"]').length!==0&&(r=i.find('div[id^="learnMore"]'));e&&f.focusTargetedElement(e);i.find(".lpath_EmptyDiv").length===0&&(i.find("#marsVideoDiv").length!=0?(i.find(".mars-stepbubble-nexticon").length===0&&i.find(".mars-stepbubble-previousicon").length===0||i.find(".mars-stepbubble-nexticon").css("display")==="none"&&i.find(".mars-stepbubble-previousicon").css("display")==="none")&&i.hasClass("lpath_EmptyDiv")===!1&&i.append(v):i&&(n||r.length==0)&&i.append(v));r.off("keydown").on("keydown",function(u){if(u.keyCode===9&&!u.shiftKey){var o=i.find("#xbutton");return n?e&&f.focusTargetedElement(e):o.find("input").focus(),u.stopPropagation(),u.preventDefault(),!1}if(t.$mars(r).text()===i.find('div[id^="learnMore"]').text()&&(u.keyCode===32||u.keyCode===13))return t.$mars(r).click(),!1;r[0]===h[0]&&u.keyCode===13&&h.trigger("click")});_MicrosoftMars.Client.Loader.$mars(".lpath_EmptyDiv").off("focus").on("focus",function(){var t,r;f.isPreviousElementCRMElementFlag?(t=jQuery.Event("keydown"),t.keyCode=_MicrosoftMars.Client.Utility.KeyCodeEnum.TabKey,t.shiftKey=!0,f.isPreviousElementCRMElementFlag=!1,i.find(".lpath_EmptyDiv").trigger(t)):n?f.focusTargetedElement(e):(r=i.find("#xbutton").find("input"),r.focus())});l.off("keydown").on("keydown",function(t){n?t.keyCode===9&&t.shiftKey&&(e=s.getTargetElement().element,f.focusTargetedElement(e),t.stopPropagation(),t.preventDefault()):t.keyCode===9&&t.shiftKey&&(i.find('div[id^="learnMore"]').length!==0?o=i.find('div[id^="learnMore"]'):(o=i.find(".mars-stepbubble-nexticon"),o.css("display")==="none"&&(o=i.find(".mars-stepbubble-previousicon"),o.css("display")==="none"&&(o=l,i.find(".lpath_EmptyDiv")&&(o=_MicrosoftMars.Client.Loader.$mars(".lpath_EmptyDiv"),f.isPreviousElementCRMElementFlag=!0,o.focus())))),o.focus(),t.stopPropagation(),t.preventDefault())});i.click(function(n){return u.focus(),n.stopPropagation(),n.preventDefault(),!1})}},r.prototype.overlayhandling=function(n){var r,i;try{if(t.ScenarioManager.isPreviousOrNextClicked()){t.ScenarioManager.setPreviousOrNextClicked(!1);return}if(r=this,i=t.ScenarioManager.getInstance().getActiveStepbubbleModel(),i===null)return;var e=n.pageX,o=n.pageY,f=t.BubbleUtilityConstants.onoverlay,s=i.getJquerySelectorMap(),u=s.bubbleId,h=i.isStepActive();h&&!i.getWaitingBubble()?r.activeBubbleHandling(n,i,u):i.getWaitingBubble()&&_MicrosoftMars.Client.Loader.appContext.ClientType==t.BubbleUtilityConstants.mobileClientType?r.waitingBubbleNgaClickHandling(n):t.BubbleUtility.clickedInsideBubble(u,e,o)?f=t.BubbleUtilityConstants.insidebubble:f===t.BubbleUtilityConstants.onoverlay&&this.attentionGrabber(i,u)}catch(c){_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchStepException,c.message)}},r.prototype.clickhandling=function(){var n=this;_MicrosoftMars.Client.Loader.$mars("#"+t.BubbleUtilityConstants.learningPathOverlayId).off("click").on("click",function(t){n.overlayhandling(t)})},r.prototype.executeScriptInputPropertyChanged=function(n,t,i,r){var u=this;clearInterval(u.userInputTimer);r?this.userInputTimer=setInterval(function(){u.executeScriptLaunchInputtableBubble(n,t,i)},this.userInputTimeDelay):u.executeScriptLaunchInputtableBubble(n,t,i)},r.prototype.launchInputtableBubble=function(n,i){var r=t.ScenarioManager.getInstance();r.getScenario(n).setCurrentStep(i);r.launchScenario(n,!0)},r.prototype.executeScriptLaunchInputtableBubble=function(n,t,i){var r=this;clearInterval(r.userInputTimer);n.off("input #mars");n.off("change #mars");this.launchInputtableBubble(t,i)},r.prototype.addCircles=function(){var u,o,r;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:addCircles START");this.totalSteps===0&&(this.totalSteps=t.ScenarioManager.getInstance().getActiveScenario().getTotalSteps());_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Adding "+this.totalSteps+" circles for guided task");var f=i.prototype.getBubbleModel.call(this).getStepIndex(),n="lpath-gt-progress-inactive-circle",e="lpath-gt-progress-active-circle";_MicrosoftMars.Client.Loader.$mars("#checkHighContrastDiv").css("background-image")==="none"&&(n="lpath-gt-progress-inactive-circle",e="lpath-gt-progress-active-circle");_MicrosoftMars.Client.Loader.$mars("#"+i.prototype.getBubbleModel.call(this).getBubbleId()).hasClass("mars-rtl")?(o=this.totalSteps-(f-1),r=_MicrosoftMars.Client.Loader.$mars("#"+i.prototype.getBubbleModel.call(this).getBubbleId()+"circle"+o),u=r.find("."+n)):(r=_MicrosoftMars.Client.Loader.$mars("#"+i.prototype.getBubbleModel.call(this).getBubbleId()+"circle"+f),u=r.find("."+n));u.removeClass(n).addClass(e);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:addCircles END")},r.prototype.addTitleToBubble=function(){var u,f;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:addTitleToBubble START");var e=this,o=e.getBubbleModel(),s=o.getJquerySelectorMap(),n=s.bubbleId,r;this.totalSteps===0&&(this.totalSteps=t.ScenarioManager.getInstance().getActiveScenario().getTotalSteps());n.find(".mars-stepbubble-nexticon").css("display")!=="none"&&(u=i.prototype.getBubbleModel.call(this).getStepIndex()+1,n.find(".mars-stepbubble-nexticon").attr("title",_MicrosoftMars.Client.Loader.marsLocale.BubblePrevNextLabel.replace("{0}",u).replace("{1}",this.totalSteps)));n.find(".mars-stepbubble-previousicon").css("display")!=="none"&&(f=i.prototype.getBubbleModel.call(this).getStepIndex()-1,n.find(".mars-stepbubble-previousicon").attr("title",_MicrosoftMars.Client.Loader.marsLocale.BubblePrevNextLabel.replace("{0}",f).replace("{1}",this.totalSteps)));r=n.find(".crm-lpath-title").attr("title");_MicrosoftMars.Client.Loader.$mars("#"+i.prototype.getBubbleModel.call(this).getBubbleId()).attr("aria-label",r);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:addTitleToBubble END")},r.prototype.handleWindowResize=function(n,i){var r=t.ScenarioManager.getInstance().getActiveScenario();r&&(n.hide(),t.BubbleUtility.setBubblePostion(i,!1,i.placementPosition),n.show(),i.placementPosition===t.BubbleUtilityConstants.bubblePositionAuto||t.BubbleUtility.isCompleteBubbleVisible(i)||(n.hide(),t.BubbleUtility.setBubblePostion(i,!1),n.show()))},r.prototype.notifyEventScenarioManager=function(n){var y,c,a;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:notifyEventScenarioManager START");try{var h=this,u=i.prototype.getBubbleModel.call(this),o=u.getBubbleId(),b=u.getJquerySelectorMap();b.xButtonId.off("click keyup").on("click keyup",function(n){var i;if(n.type==="click"||n.keyCode===13){t.ScenarioManager.setPreviousOrNextClicked(!0);t.ScenarioManager.getInstance().notify(t.BubbleUtilityConstants.closeAction.toLowerCase());n.stopPropagation();t.ScenarioManager.setPreviousOrNextClicked(!1);var u=_MicrosoftMars.Client.Loader.appContext,f=u.getPageType(),r=_MicrosoftMars.Client.Loader.appContext.Util.getHelpIcon();r&&(i=r.parents("[tabIndex=0]"),i&&i.length>0&&i[0].focus());t.stepBubbleActivityEvent&&(t.stepBubbleActivityEvent.SetActivityData(["","",f,window._MicrosoftMars.Client.Telemetry.UserClicks.x]),t.stepBubbleActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.close))}});if(y=u.getWaitingBubble(),c=u.getEvents(),c==null)return;var k=u.isStepActive(),l=u.isHybrid(),s=u.getTargetElement(n).element;for(a=0;a<c.length;a++){var v=c[a],e=v.Id,r=v.Trigger,f=v.Action,p=v.ChainedTo;if(f.toLowerCase()!==t.BubbleUtilityConstants.closeAction.toLowerCase()||e!=t.BubbleUtilityConstants.xButtonName){if(y&&f===t.BubbleUtilityConstants.CLOSE){s.off(r).on(r,function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"next triggered for waiting bubble");t.ScenarioManager.getInstance().notify(t.BubbleUtilityConstants.CLOSE)});continue}if(y&&f===t.BubbleUtilityConstants.NEXT){s.off(r).on(r,function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"next triggered for waiting bubble");t.ScenarioManager.getInstance().notify(t.BubbleUtilityConstants.NEXT)});continue}if(k&&f===t.BubbleUtilityConstants.NEXT){s.off(r).on(r+"#mars",function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"next triggered for active bubble");t.ScenarioManager.getInstance().notify(t.BubbleUtilityConstants.NEXT)});if(!l)continue}if(e!==""){if(f.toLowerCase()===t.BubbleUtilityConstants.learnMoreAction.toLowerCase()){_MicrosoftMars.Client.Loader.$mars("#"+o+" #"+e).off(r).on(r,{chainedTo:p},function(n){h.triggerLearnMoreAction(n)});_MicrosoftMars.Client.Loader.$mars("#"+o+" #"+e).off("keydown").on("keydown",{chainedTo:p},function(n){n.keyCode==13&&h.triggerLearnMoreAction(n)});continue}if(r.toLowerCase()===t.BubbleUtilityConstants.CLICK.toLowerCase()&&f.toLowerCase()===t.BubbleUtilityConstants.nextAction.toLowerCase()&&_MicrosoftMars.Client.Loader.appContext.clientType===t.BubbleUtilityConstants.mobileClientType){_MicrosoftMars.Client.Loader.$mars("#"+o+" #"+e).off(r).on(r,{action:f,isHybrid:l,element:s,objStepBubbleModel:u},function(n){h.triggerCallback(n)});continue}_MicrosoftMars.Client.Loader.$mars("#"+o+" #"+e).off(r).on(r,{action:f,isHybrid:l,element:s,objStepBubbleModel:u},function(n){h.triggerCallback(n)});if(e==="btnNext"&&l&&r.toLowerCase()===t.BubbleUtilityConstants.CLICK.toLowerCase()&&f.toLowerCase()===t.BubbleUtilityConstants.nextAction.toLowerCase()){_MicrosoftMars.Client.Loader.$mars("#"+o+" #"+e).off(r).on(r,function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"close Triggered for hybrid bubble last step");t.ScenarioManager.getInstance().notify(t.BubbleUtilityConstants.closeAction.toLowerCase())});continue}}}}}catch(w){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error occured in notifyEventScenarioManager. Launching Error Guided Task");_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchStepException,w.message,null,w)}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:notifyEventScenarioManager END")},r.prototype.triggerLearnMoreAction=function(n){var i,u,f,r;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"learnmore triggered for info bubble");i=t.ScenarioManager.getInstance().getActiveScenario();u=t.ScenarioManager.getInstance().getActiveScenarioId();t.ScenarioManager.getInstance().notify(t.BubbleUtilityConstants.closeAction.toLowerCase());f=_MicrosoftMars.Client.Loader.appContext.Util.getPublishGroupDetails(i.getPublishGroupId(),"Name");r=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.linkClick);r.SetUserActivityInfo(_MicrosoftMars.Client.Loader.appContext.userId,u,i.getPublishGroupId(),f,i.getAuthoringGroupId(),i.getParentScenarioId(),i.getAuthorId(),i.getControlName());n.data.chainedTo&&(n.preventDefault(),n.stopPropagation(),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"chainedTo: "+n.data.chainedTo),t.ScenarioUtil.notifyEventAnswerpanel(n.data.chainedTo,r))},r.prototype.triggerCallback=function(n){var i,r,u;t.ScenarioManager.setPreviousOrNextClicked(!0);n.data.isHybrid&&(i=n.data.objStepBubbleModel.getTargetElement().element,i&&i!=null&&i.length!==0&&(r=_MicrosoftMars.Client.Loader.appContext.util.getNearestFocusableElement(i[0]),r&&(t.AnswerPanelLauncher.isScenarioTriggered=!0,_MicrosoftMars.Client.Loader.appContext.clientType===t.BubbleUtilityConstants.mobileClientType&&(u=window.parent.React,u!=null&&u!==undefined&&u.addons.TestUtils.Simulate.shortPress(r)),r.click())));setTimeout(function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"notifying ScenarioManager with "+n.data.action);t.ScenarioManager.getInstance().notify(n.data.action)},0);n.stopPropagation();t.ScenarioManager.setPreviousOrNextClicked(!1)},r.prototype.removePreviousOrNextButton=function(n){var o,r,e;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:removePreviousOrNextButton START");var u=i.prototype.getBubbleModel.call(this),h=u.getEvents(),c=!1,s=!0,l=!0,a=!0,f=u.getBubbleId();for(o=0;o<h.length;o++)r=h[o],r.Action===t.BubbleUtilityConstants.PREVIOUS?(_MicrosoftMars.Client.Loader.$mars("#"+f+" .mars-stepbubble-previousicon").attr("id",r.Id),l=!1):r.Action===t.BubbleUtilityConstants.NEXT?(_MicrosoftMars.Client.Loader.$mars("#"+f+" .mars-stepbubble-nexticon").attr("id",r.Id),s=this.totalSteps===u.getStepIndex()?!0:!1):r.Action===t.BubbleUtilityConstants.learnMoreAction.toLowerCase()&&(a=!1);u.getStepIndex()===1&&(c=!0);u.isHybrid()&&(s=!1);e=_MicrosoftMars.Client.Loader.$mars("#"+f+" .mars-stepbubble-previousicon");c?e.css("display","none"):l&&(e.attr("src",_MicrosoftMars.Client.Loader.serverUrl+"images/bubble_back-icon_disabled_24x24.png"),e.attr("disabled","disabled"),e.css("cursor","default"));s&&_MicrosoftMars.Client.Loader.$mars("#"+f+" .mars-stepbubble-nexticon").css("display","none");!n&&a&&_MicrosoftMars.Client.Loader.$mars("#"+f+".mars-stepbubble-link").css("display","none");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"StepBubble:removePreviousOrNextButton END")},r.prototype.nudge=function(n,t){t.prop("class").indexOf("up")!==-1?this.nudgeEffect(n,t,"nudgeTop"):t.prop("class").indexOf("right")!==-1?this.nudgeEffect(n,t,"nudgeRight"):t.prop("class").indexOf("left")!==-1?this.nudgeEffect(n,t,"nudgeLeft"):t.prop("class").indexOf("bottom")!==-1&&this.nudgeEffect(n,t,"nudgeBottom")},r.prototype.nudgeEffect=function(n,t,i){n.css("animation-name",i);t.css("animation-name",i);setTimeout(function(){n.css("animation-name","nudge");t.css("animation-name","nudge")},500)},r.prototype.attentionGrabber=function(n,t){if(n.getEnableNudge()){var i=n.getJquerySelectorMap(),r=i.transparentArrowId;this.nudge(t,r)}},r.prototype.waitingBubbleNgaClickHandling=function(n){var u=n.pageX,e=n.pageY,o=window.parent.document,t=o.elementsFromPoint(u,e),r,i,f;if(t=_MicrosoftMars.Client.Loader.$mars(t).not("body, html, #PersistentScriptsIFrame, .customizationContainer"),t.length>0){for(r=0,i=[];r<t.length;)f=u-_MicrosoftMars.Client.Loader.$mars(t[r]).offset().left,i.push({element:t[r],distance:f}),r++;i=_(i).sortBy(function(n){return n.distance});this.triggerElementEvent(_MicrosoftMars.Client.Loader.$mars(i[0].element));i[0].element.click()}},r}(t.Bubble);t.StepBubble=i})(i=t.Controls||(t.Controls={}))})(i=t.Runtime||(t.Runtime={}))})(i=t.Client||(t.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(n,t){var i,r;for(this.scenarioId=null,this.currentStepId=null,this.firstStepId=null,this.lastStepId=null,this.totalSteps=0,this.completed=!1,this.stepIds=null,this.injected=!1,this.parentPageNavigationInfo=null,this.steps={},this.stepBubbleModels={},this.parentScenarioId="00000000-0000-0000-0000-000000000000",this.originalStepIdMapping={},this.scenarioId=n,i=0;i<t.length;i++)this.originalStepIdMapping[n+t[i]]=t[i],t[i]=n+t[i];for(this.stepIds=t,this.totalSteps=t.length,this.totalSteps>0&&(this.firstStepId=t[0],this.lastStepId=t[t.length-1]),i=0;i<this.totalSteps;i++)r=t[i],this.addStep(r,i);this.setCurrentStep(this.firstStepId)}return t.prototype.getOriginalStepId=function(n){return this.originalStepIdMapping[n]},t.prototype.setPublishGroupId=function(n){this.publishGroupId=n},t.prototype.getPublishGroupId=function(){return this.publishGroupId},t.prototype.setAuthoringGroupId=function(n){this.authoringGroupId=n},t.prototype.getAuthoringGroupId=function(){return this.authoringGroupId},t.prototype.setAuthorId=function(n){this.authorId=n},t.prototype.getLocale=function(){return this.locale},t.prototype.setLocale=function(n){this.locale=n},t.prototype.setVersion=function(n){this.version=n},t.prototype.GetVersion=function(){return this.version},t.prototype.setControlName=function(n){this.controlName=n},t.prototype.getControlName=function(){return this.controlName},t.prototype.setPrereqGT=function(n){this.isPrereqGT=n},t.prototype.getPrereqGT=function(){return this.isPrereqGT},t.prototype.setPrereqGTFunctionName=function(n){this.prereqGTFunctionName=n},t.prototype.getPrereqGTFunctionName=function(){return this.prereqGTFunctionName},t.prototype.getAuthorId=function(){return this.authorId},t.prototype.setParentScenarioId=function(n){this.parentScenarioId=n},t.prototype.getParentScenarioId=function(){return this.parentScenarioId},t.prototype.setScenarioType=function(t){t===n.ControlTypes.StepThrough?this.scenarioType=window._MicrosoftMars.Client.Telemetry.ActivityName.guidedtask:t===n.ControlTypes.ActiveStep?this.scenarioType=window._MicrosoftMars.Client.Telemetry.ActivityName.activestepbubble:t===n.ControlTypes.PassiveStep?this.scenarioType=window._MicrosoftMars.Client.Telemetry.ActivityName.passivestepbubble:t===n.ControlTypes.InfoBubble?this.scenarioType=window._MicrosoftMars.Client.Telemetry.ActivityName.infobubble:t===n.ControlTypes.AnswerPanel&&(this.scenarioType=window._MicrosoftMars.Client.Telemetry.ActivityName.answerpanel)},t.prototype.getScenarioType=function(){return this.scenarioType},t.prototype.setCurrentStep=function(n){this.currentStepId=n},t.prototype.isScenarioActiveOrHybrid=function(){var n,t;for(n in this.stepBubbleModels)if(this.stepBubbleModels.hasOwnProperty(n)&&(t=this.stepBubbleModels[n],t.isStepActive()||t.isHybrid()))return!0;return!1},t.prototype.isVideoStep=function(){var n=!1,t=_MicrosoftMars.Client.Loader.$mars("input#videoPopoutButton");return t&&(n=!0),n},t.prototype.getFirstStepId=function(){return this.firstStepId},t.prototype.getTotalSteps=function(){return this.totalSteps},t.prototype.getCurrentStepId=function(){return this.currentStepId},t.prototype.isInjected=function(){return this.injected},t.prototype.setScenarioInjected=function(n){this.injected=n},t.prototype.addStep=function(t,i){var r,u;if(t==null)return _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error: parameter not passed"),null;r=new n.StepBubbleModel(t);r.setStepIndex(i+1);this.stepBubbleModels[t]=r;u=new n.StepBubble(r,0);this.steps[t]=u},t.prototype.getStep=function(n){if(n==null)return _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error: parameter not passed"),null;var t=this.steps[n];return t==null?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error: No step found for stepId: "+n),null):t},t.prototype.getStepBubbleModel=function(n){if(n==null)return _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error: parameter not passed"),null;var t=this.stepBubbleModels[n];return t==null&&_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error: No StepBubbleModel found for stepId: "+n),t},t.prototype.launchStep=function(t,i,r,u){var s,f,l,a,e,v;if(i===void 0&&(i=0),r===void 0&&(r=!1),u===void 0&&(u=!1),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:launchStep START"),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"stepId:"+t+", count:"+i+", isErrorScenario:"+r),t==null){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error: stepId not passed");return}n.ScenarioManager.lpathClickCountForMarsPerfTest=n.ScenarioManager.getNextPerfCounter();s="PERF_M_LAUNCH_GUIDEDTASK_BUBBLE_"+n.ScenarioManager.lpathClickCountForMarsPerfTest+"_START";_MicrosoftMars.Client.Loader.PerfMarker.MarsCaptureModulePerfTime(s);var h=this.getStep(t),o=this.getStepBubbleModel(t),c=!0;if(o.isStepInjected())_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Step already injected");else{if(f=this.checkForElementOnPage(o,i,r),_MicrosoftMars.Client.Utility.Util.isOngoingAutomation()&&(f=f&&!_MicrosoftMars.Client.Loader.appContext.Util.isPageLoading),!f){if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Element not present on page"),r){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Hiding lpathRuntimeOverlay");_MicrosoftMars.Client.Loader.appContext.util.hideOverlay();l=window.Microsoft.Mars.Client.Runtime.Controls;a=l.ScenarioManager.getInstance();a.activeScenarioId=null;return}this.isConditionsForErrorMet(i)?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"count exceeded 3, launching error scenario"),e=new Error(_MicrosoftMars.Client.Loader.marsLocale.TargetElementNotVisibleOnPage),e.message="targetelementmissing",_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchStepException,e.message,null,e)):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Trying to launch Step"),v=this,setTimeout(function(){v.launchStep(t,i+1)},1e3));return}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Injecting Step");c=h.inject(r)}c?(o.setStepInjected(!0),_MicrosoftMars.Client.Loader.appContext.setAriaHiddenForElementsExceptMars(!0),n.$mars("#"+n.BubbleUtilityConstants.learningPathOverlayId).attr("aria-hidden",!1),h.show(u),this.setCurrentStep(t),setTimeout(function(){n.$mars("body").trigger("stepLaunched",{StepId:t})},2e3),_MicrosoftMars.Client.Loader.PerfMarker.MarsCaptureModulePerfTime("PERF_M_LAUNCH_GUIDEDTASK_BUBBLE_"+n.ScenarioManager.lpathClickCountForMarsPerfTest+"_END")):_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.WARNING,"Cannot show step as inject failed");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:launchStep END")},t.prototype.closeStep=function(t,i){if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:closeStep START"),t==null)return console.log("Error: parameter not passed"),null;var r=this.getStep(t),u=this.getStepBubbleModel(t);_MicrosoftMars.Client.Loader.appContext.setAriaHiddenForElementsExceptMars(!1);n.$mars("#"+n.BubbleUtilityConstants.learningPathOverlayId).attr("aria-hidden",!0);this.isLastStep(t)||i?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Inside else"),r.hide()):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Inside If"),r.hide(!0));this.isScenarioActiveOrHybrid()&&this.setCurrentStep(this.firstStepId);(u.isStepActive()||u.isStepExceptionBubble()||this.isVideoStep())&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Cleaning up the step"),r.cleanup(),u.setStepInjected(!1));_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:closeStep END")},t.prototype.navigate=function(n,t){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:navigate START");try{if(n==null||t==null)return _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Parameter not passed"),null;var f=this.getStepBubbleModel(n),r=f.getStepIndex()-1,i=null;t==="next"?i=this.stepIds[r+1]:t==="previous"&&(i=this.stepIds[r-1]);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"navigateTo:"+i);this.launchStep(i)}catch(u){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"exception occured in navigate");_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchStepException,u.message,null,u)}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:navigate END")},t.prototype.getNextStepId=function(){var n=this.stepIds.indexOf(this.currentStepId);return this.stepIds[n+1]},t.prototype.getPrevStepId=function(){var n=this.stepIds.indexOf(this.currentStepId);return this.stepIds[n-1]},t.prototype.cleanup=function(t){var i,f,e,o,r,u,s;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:cleanup START");for(i in this.steps)this.steps.hasOwnProperty(i)&&(f=this.getStep(i),f.cleanup(),delete this.steps[i]);n.guidedTaskActivity&&n.guidedTaskActivity.controlId===this.scenarioId&&(e=this.getCurrentStepId(),o=this.getStepBubbleModel(e),t==="targetelementmissing"?r="":(u=o.getCachedTargetElement(),r=u!=null?u.id:""),s=_MicrosoftMars.Client.Loader.appContext.getPageType(),n.guidedTaskActivity.SetActivityData(["","",s,r,this.getUITrigger(),this.GetVersion(),this.getCurrentStepId()]),this.isCompleted()?n.guidedTaskActivity.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete):n.guidedTaskActivity.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.incomplete),n.guidedTaskActivity=null);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:cleanup END")},t.prototype.isLastStep=function(n){return n===this.lastStepId?!0:!1},t.prototype.toJSONString=function(){var t="[",u=!1,i,f,r,n;for(i in this.stepBubbleModels)this.stepBubbleModels.hasOwnProperty(i)&&(f=this.getStepBubbleModel(i),u?t+=",":u=!0,t+=f.toJSONString(this.scenarioId));for(t+="]",r=[],n=0;n<this.stepIds.length;n++)r[n]=this.getOriginalStepId(this.stepIds[n]);return'{"id":"'+this.scenarioId+'","class":"Scenario","currentStepId":"'+this.currentStepId+'","stepIds":'+JSON.stringify(r)+',"children":'+t+"}"},t.prototype.setUITrigger=function(n){this.uiTrigger=n},t.prototype.getUITrigger=function(){return this.uiTrigger},t.prototype.setParentPageNavigationInfo=function(n){this.parentPageNavigationInfo=n},t.prototype.getParentPageNavigationInfo=function(){return this.parentPageNavigationInfo},t.prototype.setCompleted=function(){if(n.guidedTaskActivity&&n.guidedTaskActivity.controlId===this.scenarioId){var r=this.getCurrentStepId(),u=this.getStepBubbleModel(r),f=_MicrosoftMars.Client.Loader.appContext.getPageType(),t="",i=u.getCachedTargetElement();i!=null&&(t=i.id);n.guidedTaskActivity.SetActivityData(["","",f,t,this.getUITrigger(),this.GetVersion(),this.getCurrentStepId()]);n.guidedTaskActivity.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete);n.guidedTaskActivity=null}this.completed=!0},t.prototype.isCompleted=function(){return this.completed},t.prototype.isExceptionScenario=function(){return this.scenarioId===_MicrosoftMars.Client.Loader.marsExceptionHandler.getExceptionScenarioId()?!0:!1},t.prototype.checkForElementOnPage=function(n,t,i){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:checkForElementOnPage START");var r=n.getTargetElement(i,!1,!1);return r==null?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:checkForElementOnPage END1 return false"),!1):r.elementX<=0&&t<2?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:checkForElementOnPage END2 return false"),!1):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario:checkForElementOnPage END return true"),!0)},t.prototype.isConditionsForErrorMet=function(n){return _MicrosoftMars.Client.Utility.Util.isOngoingAutomation()?n>5&&!_MicrosoftMars.Client.Loader.appContext.Util.isPageLoading:n>3},t.controlType="GuidedTask",t}();n.Scenario=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(){}return t.parseUserProgress=function(n){var i;if(n!==null&&n!==undefined){var r=0,u=0,f=0;for(i=0;i<n.length;i++)r+=n[i].IgnoredCount,u+=n[i].CompleteCount,f+=n[i].IncompleteCount;t.ignoredCount=r;t.completedCount=u;t.incompleteCount=f;t.checkLifeCycleStageChange()}},t.initLifeCycleStage=function(n){for(var u=JSON.parse(localStorage.allConfigurationKey),r=_MicrosoftMars.Client.Loader.appContext.Util.getConfigurationData("AuthoringDetails"),i=0;i<r.length;i++)t.checkForLifeCycleStageCondiotnsForLifeCycleStage(u,r[i].AuthoringGroupDetail,n,0)},t.updateTrackingCount=function(i){i===n.UserProgress.COMPLETE?(t.completedCount++,t.incompleteCount--):i===n.UserProgress.INCOMPLETE?t.incompleteCount++:i===n.UserProgress.IGNORED&&t.incompleteCount++;t.checkLifeCycleStageChange()},t.checkForLifeCycleStageCondiotnsForLifeCycleStage=function(n,i,r,u){var o=i.ConfigurationLifeCycleStages,f,e,s,h;if(u===0&&(t.totalLifeCycleStages=0,t.processedStages=0),u===o.length-1&&(t.processedAllConfigs=!0),u===o.length){r();return}f=o[u];e=f.ConfigurationLifeCycleStageConditions;t.totalLifeCycleStages+=e.length;e.length===0?(_MicrosoftMars.Client.Loader.appContext.Util.setAuthoringGroupLifeCycleStageMap(i.AuthoringId,f),_MicrosoftMars.Client.Loader.appContext.CurrentStage=f.Name,f.NextLifecycleStageId&&(s=t.GetFilteredLifeCycleStage(i,f.NextLifecycleStageId),s&&(_MicrosoftMars.Client.Loader.appContext.NextLifeCycleStageConditions=s,r()))):(h=0,t.checkLifeCycleStageChange(i,f,function(f){t.processedStages+=f;_MicrosoftMars.Client.Loader.appContext.Util.getAuthoringGroupLifeCycleStageMap(i.Id)&&t.processedAllConfigs?t.processedStages>=t.totalLifeCycleStages&&r():(h+=f,_MicrosoftMars.Client.Loader.appContext.Util.getAuthoringGroupLifeCycleStageMap(i.Id)!==""&&h===e.length&&t.checkForLifeCycleStageCondiotnsForLifeCycleStage(n,i,r,u+1))}))},t.checkLifeCycleStageChange=function(n,i,r){var o,h,f,l,u,e,a,v,s,c;for(n===void 0&&(n=null),i===void 0&&(i=null),r===void 0&&(r=null),i&&(o=i.ConfigurationLifeCycleStageConditions),o||(o=_MicrosoftMars.Client.Loader.appContext.NextLifeCycleStageConditions),h=0,f=0,l=0;l<o.length;l++)u=o[l],t.lifeCycleStageConditionCompletionMap[u.Id]===!1||t.lifeCycleStageConditionCompletionMap[u.Id]===undefined?u.IsAdvanced===!0?(e=u.Parameters,e&&e.length!==0?(a=/\s*,\s*/,v=u.Parameters.replace(/\"/g,""),e=v.split(a),e.push(u.Operator)):e=[],s=_MicrosoftMars.Client.Loader.appContext.Util.executeAppMethod(u.Name,JSON.stringify(e)),typeof s.then=="function"?function(i){s.done(function(u){i.Name==="_MicrosoftMars.Client.Utility.AppUtilityLifecycleStage.checkDateCondition"?u===1&&(t.lifeCycleStageConditionCompletionMap[i.Id]=!0,f++):t.isConditionSatisfied(i.Operator,i.Value,u)&&(t.lifeCycleStageConditionCompletionMap[i.Id]=!0,f++);t.UpdateLifecycle(f,o,n);r&&r(1)})}(u):(u.Name==="_MicrosoftMars.Client.Loader.appContext.version"?e[0]&&t.performVersionCompare(u.Operator,e[0],s)&&(t.lifeCycleStageConditionCompletionMap[u.Id]=!0,f++):u.Name==="_MicrosoftMars.Client.Utility.AppUtilityLifecycleStage.checkDateCondition"?s===1&&(t.lifeCycleStageConditionCompletionMap[u.Id]=!0,f++):t.isConditionSatisfied(u.Operator,u.Value,s)&&(t.lifeCycleStageConditionCompletionMap[u.Id]=!0,f++),h++)):(u.Name==="Completed"?c=t.completedCount:u.Name==="Ignored"?c=t.ignoredCount:u.Name==="Incomplete"?c=t.incompleteCount:u.Name==="LoginCount"&&(c=_MicrosoftMars.Client.Loader.appContext.LoginCount),t.isConditionSatisfied(u.Operator,u.Value,c)?(t.lifeCycleStageConditionCompletionMap[u.Id]=!0,f++):t.lifeCycleStageConditionCompletionMap[u.Id]=!1,h++):(h++,f++);t.UpdateLifecycle(f,o,n);r&&r(h)},t.isConditionSatisfied=function(n,t,i){return _MicrosoftMars.Client.Utility.DynamicContextUtil.isConditionSatisfied(t,i,n,_MicrosoftMars.Client.Utility.DynamicContextValueType.Number)},t.performVersionCompare=function(n,i,r){for(var e=r.split("."),f=i.split("."),u=0;t.isConditionSatisfied(3,f[u],e[u])&&u<f.length-1;)u++;return t.isConditionSatisfied(n,f[u],e[u])?!0:!1},t.UpdateLifecycle=function(n,i,r){if(n===i.length&&i.length>0){var f=r.ConfigurationLifeCycleStages,u=f.filter(function(n){return n.Id===i[0].LifeCycleId})[0];_MicrosoftMars.Client.Loader.appContext.Util.setAuthoringGroupLifeCycleStageMap(r.AuthoringId,u);_MicrosoftMars.Client.Loader.appContext.CurrentStage=u.Name;u.NextLifecycleStageId?_MicrosoftMars.Client.Loader.appContext.NextLifeCycleStageConditions=t.GetFilteredLifeCycleStage(r,u.NextLifecycleStageId):u.NextLifecycleStageId=[]}},t.GetFilteredLifeCycleStage=function(n,t){var r=n.ConfigurationLifeCycleStages,i=r.filter(function(n){return n.Id===t});return i.constructor===Array?i.length>0?i[0].ConfigurationLifeCycleStageConditions:[]:i.ConfigurationLifeCycleStageConditions},t.lifeCycleStageConditionCompletionMap={},t.ignoredCount=0,t.completedCount=0,t.incompleteCount=0,t.totalLifeCycleStages=0,t.processedStages=0,t.processedAllConfigs=!1,t}();n.LifeCycleStageManager=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){"use strict";var i=function(){function i(){}return i.getWithinSessionThreshold=function(n){return n===t.Scenario.controlType||n===t.InfoBubbleConstants.controlType?_MicrosoftMars.Client.Loader.guidedTaskWithinSession:0},i.getAcrossSessionThreshold=function(n){return n===t.Scenario.controlType||n===t.InfoBubbleConstants.controlType?1:0},i.saveControlState=function(r,u,f,e){var o,s;n.Mars.Client.Runtime.Controls.LifeCycleStageManager.updateTrackingCount(f);i.NOTSTARTEDSCENARIOS.has(r)&&(i.NOTSTARTEDSCENARIOS.remove(r),t.NotificationBadge.GetInstance().updateNotificationBadge());o=i.getRequestJSON();o.ControlId=r;o.ChildControlId=u;o.TrackingStatus=f;s=JSON.stringify(o);i.addToLocalStorage(s);i.incrementLaunchCountWithinSession(r,e)},i.removeDuplicatesAndMergeInfo=function(n){for(var t,f,r,u={},e=0;e<n.length;e++)t=n[e],f=t.UserId+t.Product+t.ProductVersion+t.ControlId+t.ClientType+t.FormFactor,u[f]?(r=u[f],t.TrackingStatus===i.INCOMPLETE?r.IncompleteCount+=1:t.TrackingStatus===i.COMPLETE?r.CompleteCount+=1:t.TrackingStatus===i.IGNORED&&(r.IgnoredCount+=1),r.TrackingStatus=t.TrackingStatus,r.ChildControlId=t.ChildControlId):(t.IgnoredCount=0,t.CompleteCount=0,t.IncompleteCount=0,t.TrackingStatus===i.INCOMPLETE?t.IncompleteCount=1:t.TrackingStatus===i.COMPLETE?t.CompleteCount=1:t.TrackingStatus===i.IGNORED&&(t.IgnoredCount=1),u[f]=t);return u},i.incrementLaunchCountWithinSession=function(n,t){var f=_MicrosoftMars.Client.Loader.appContext,e=f.userId,u=e+n+"count",r=localStorage.getItem(u),i;i=r===null||r==="null"?0:parseInt(r);i++;localStorage.setItem(u,i.toString());t&&t(i,n)},i.addToLocalStorage=function(n){var t=JSON.parse(localStorage.getItem("userProgressArray"))||[];t[t.length]=JSON.parse(n);localStorage.setItem("userProgressArray",JSON.stringify(t))},i.getRequestJSON=function(){var n=_MicrosoftMars.Client.Loader.appContext,t=n.UserId,i=n.getAppName(),r=n.AppVersion,u=n.ClientType,f=n.getFormFactor();return JSON.parse('{"UserId":"'+t+'","Product":"'+i+'","ProductVersion":"'+r+'","ClientType":"'+u+'","FormFactor":"'+f+'"}')},i.INCOMPLETE="1",i.COMPLETE="2",i.IGNORED="3",i.NOTSTARTED="4",i.OBJECTS_LIMIT=100,i.INTERVAL=36e5,i.NOTSTARTEDSCENARIOS=new _MicrosoftMars.Client.Utility.CustomSet,i.ANSWERPANELNOTSTARTED=!1,i}();t.UserProgress=i})(i=t.Controls||(t.Controls={}))})(i=t.Runtime||(t.Runtime={}))})(i=t.Client||(t.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){"use strict";var i=function(){function i(){}return i.parseScenarioJSON=function(n){var f,e,h,o,r,s,c,a,u;if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:parseScenarioJSON START"),f=n.ControlId,_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"scenarioId: "+f),e=n.Steps,h=[],e){for(u=0;u<e.length;u++){var l=e[u],v=typeof l.MetadataJson=="string"?JSON.parse(l.MetadataJson):l.MetadataJson,y=v.Index-1;h[y]=e[u].ControlId}if(h){if(o=t.ScenarioManager.getInstance(),o.hasScenario(f))_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Scenario already exists. Skipping parsing");else for(o.addScenario(f,h),r=o.getScenario(f),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Parsing at scenario level START"),n.MetadataJson=typeof n.MetadataJson=="string"?JSON.parse(n.MetadataJson):n.MetadataJson,s=n.MetadataJson,r.setPrereqGT(s.IsPrereqGT),r.setPrereqGTFunctionName(s.PrereqGTFunctionName),n.Events=typeof n.Events=="string"?JSON.parse(n.Events):n.Events,c=n.Events,c===null||c.length===0?r.setUITrigger(t.BubbleUtilityConstants.INVOKED):(a=c[0],r.setUITrigger(a.Trigger)),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"UITrigger: "+r.getUITrigger()),s.ParentControlIds&&r.setParentScenarioId(s.ParentControlIds[0]),r.setScenarioType(n.ControlType),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"scenarioType: "+n.ControlType),r.setAuthorId(n.AuthorId),r.setPublishGroupId(n.PublishGroupId),r.setAuthoringGroupId(n.AuthoringId),r.setVersion(n.Version),r.setLocale(n.Lcid),r.setControlName(n.ControlName),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Parsing at scenario level END"),u=0;u<e.length;u++)i.parseStepJSON(e[u],n);o.callbackForUserProgressQuery(f)}}else _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.WARNING,"No children exists for scenario"+f);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:parseScenarioJSON END")},i.parseStepJSON=function(n,r){var u,f,a,y,s,p,l,w;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:parseStepJSON START");var b=t.ScenarioManager.getInstance(),h=r.ControlId,e=b.getScenario(h),c=h+n.ControlId;if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"scenarioId: "+h+" ,stepId: "+n.ControlId),e!=null)if(u=e.getStepBubbleModel(c),u.isInitialized())_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.WARNING,"stepBubbleModel already initialized.");else{u.setStepActive(n.ControlType);u.setEvents(typeof n.Events=="string"?JSON.parse(n.Events):n.Events);u.setTemplate(n.LanguageControlVersionContents[0].HtmlView);u.setCustomAttributes(n.CustomAttributes);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:parseStepJSON LEVEL1");u.setControlType(n.ControlType);u.setAuthorId(n.AuthorId);u.setPublishGroupId(r.PublishGroupId);u.setAuthoringGroupId(r.AuthoringId);u.setControlName(n.ControlName);u.setLocale(n.Lcid);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:parseStepJSON LEVEL2");f=typeof n.MetadataJson=="string"?JSON.parse(n.MetadataJson):n.MetadataJson;u.setParentControlId(r.ControlId);u.setParentControlName(r.ControlName);a=i.getControlPageNavigationInfo(n);u.setAppContext({ElementIdentifier:f.ElementIdentifier,PageNavigationInfo:a});u.setHybrid(f.IsHybridBubble?f.IsHybridBubble:n.ControlType==t.ControlTypes.HybridStep);u.setElementInputable(f.IsElementInputable);u.setElementInputType(f.ElementInputType);u.setPointerless(!f.ShowBubbleElementPointer);u.setPlacementPosition(f.PlacementPosition);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:parseStepJSON LEVEL3");u.setHybridType(f.HybridType);u.setHybridCustomToken(f.HybridCustomToken);u.setWaitingBubble(f.IsWaitingBubble?f.IsWaitingBubble:n.ControlType==t.ControlTypes.WaitingStep);u.setWaitingBubbleFunctionName(f.WaitingBubbleFunctionName);u.setEnableNudge(f.EnableNudge);f.Content!==undefined&&f.Content!==null&&u.setButtonsModel(f.Content.ListOfLinks);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:parseStepJSON LEVEL4");var k=e.getTotalSteps(),v=new t.StepBubbleView(c,k),o=[];_MicrosoftMars.Client.Utility.FFFUtility.isFeatureEnabled("Tokens")&&(t.$mars.merge(o,n.CustomAttributes),r&&t.$mars.merge(o,r.CustomAttributes),y=_MicrosoftMars.Client.Loader.appContext.Util.getConfigurationData(_MicrosoftMars.Client.Loader.appContext.Util.CustomAttributeSetting));_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:parseStepJSON LEVEL5");s=null;n.LanguageControlVersionContents&&n.LanguageControlVersionContents.length>0&&(s=n.LanguageControlVersionContents[0].HtmlView);s!=null?(p=Handlebars.compile(s),n.HtmlView=p({Locale:_MicrosoftMars.Client.Loader.marsLocale,serverUrl:_MicrosoftMars.Client.Loader.serverUrl,Imagepath:_MicrosoftMars.Client.Loader.marsImageMapping,controlCustomAttributes:o,globalCustomAttributes:y,Value:n}),l=!1,n.ControlType===_MicrosoftMars.Client.Utility.ControlTypes.InfoBubble&&(l=!0),v.setHtmlContent(t.CustomAttributeUtility.replaceCustomAttributes(n.HtmlView,o),l),w=e.getStep(c),w.setView(v),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:parseStepJSON LEVEL6"),u.setInitialized(!0)):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.WARNING,"ScenarioUtil:parseStepJSON failed due to no HtmlView"),u.setInitialized(!1))}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:parseStepJSON END")},i.loadScenarios=function(n){var r,u,f;if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:loadScenarios START"),t.UserProgress.NOTSTARTEDSCENARIOS.clear(),n!=null)for(r=0;r<n.length;r++)u=n[r],f=u.UserProgress,(f==null||f.TrackingStatus===t.UserProgress.NOTSTARTED)&&t.UserProgress.NOTSTARTEDSCENARIOS.add(u.ControlId),i.parseScenarioJSON(u);t.NotificationBadge.GetInstance().updateNotificationBadge();_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:loadScenarios END")},i.setAppContextForScenarios=function(n,i){var h,e,f,o,s,r,u,c;for(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:setAppContextForScenarios START"),h=t.ScenarioManager.getInstance(),e=0;e<i.length;e++)if((f=i[e],f!=null)&&f.ControlType===t.ControlTypes.Section){if(o=f.ChildControls,o==null)return;for(s=0;s<o.length;s++)r=o[s],r.ControlType===t.ControlTypes.StepThrough&&(u=h.getScenario(r.ControlId),u&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"setting appContext for scenario"+r.ControlId),u.setParentPageNavigationInfo(n.PageNavigationInfo),u.setParentScenarioId(f.ParentControlId[0]),u.setScenarioType(r.ControlType),u.setAuthorId(r.AuthorId),u.setPublishGroupId(r.PublishGroupId),u.setAuthoringGroupId(r.AuthoringId),u.setLocale(r.Lcid),u.setVersion(r.Version),c=JSON.parse(r.Events)[0].Trigger,u.setUITrigger(c),u.setControlName(r.ControlName)))}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:setAppContextForScenarios END")},i.notifyEventAnswerpanel=function(n,i){var r,u;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:notifyEventAnswerPanel START");_MicrosoftMars.Client.Loader.ServiceProxy.webApiBaseUrl=_MicrosoftMars.Client.Loader.webApiBaseUrl;r=window.Microsoft.Mars.Client.ContextResolution.ContextResolutionManager.getInstance();_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"firing controlById for "+n);u=r.controlById(n);u.done(function(n){var u,r,f;n.Result==null?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"LearnMore Of InfoBubble is attached to Nonpublished Sidebar, showing the ErrorSideBar"),u=_MicrosoftMars.Client.Loader.$mars.grep(_MicrosoftMars.Client.Loader.defaultExceptionControlList,function(n){return n.ControlType===1}),u&&u.length>0&&(_MicrosoftMars.AnswerPanel.getInstance().hide(),i&&i.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.incomplete),t.AnswerPanelLauncher.loadAnswerPanel(u[0]),t.AnswerPanelLauncher.isScenarioTriggered=!1,_MicrosoftMars.AnswerPanel.getInstance().togglePanel())):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"LearnMore is attached to Published Sidebar"),r=n.Result,i&&(f=["Guided Task","","Sidebar",r.ControlId,r.ControlName,r.Version,r.AuthoringId,r.PublishGroupId,r.AuthorId,"",_MicrosoftMars.Client.Loader.appContext.UserRoleNames],i.SetActivityData(f),i.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete)),t.AnswerPanelLauncher.loadAnswerPanel(r),_MicrosoftMars.AnswerPanel.getInstance().togglePanel())});_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:notifyEventAnswerPanel END")},i.launchLinkedControl=function(r,u,f,e,o,s){var l,h,c,a,v;i.lpathClickCountForMarsPerfTest=i.getNextPerfCounter();l="PERF_M_LAUNCH_PANEL_LINK_"+i.lpathClickCountForMarsPerfTest+"_START";_MicrosoftMars.Client.Loader.PerfMarker.MarsCaptureModulePerfTime(l);h=window.Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:launchLinkedControl START");c=!0;(u==null||u===undefined)&&(u=!0);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"controlId: "+r+" toNavigate: "+u);_MicrosoftMars.Client.Loader.ServiceProxy.webApiBaseUrl=_MicrosoftMars.Client.Loader.webApiBaseUrl;n.Mars.Client.Runtime.Controls.AnswerPanelLauncher.isScenarioTriggered=!0;a=window.Microsoft.Mars.Client.ContextResolution.ContextResolutionManager.getInstance();f||(f="AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA");v=a.controlById(r,f);h.isLaunchedControl=!0;v.done(function(r){var f,a,y,v,p,w,l;if(window.marsLoader.invalidateConfigCacheIfRequired(r),f=r.Result,f==null)_MicrosoftMars.Client.Loader.defaultExceptionControlList&&_MicrosoftMars.Client.Loader.defaultExceptionControlList.length>0&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Showing the error sidebar"),a=_MicrosoftMars.Client.Loader.$mars.grep(_MicrosoftMars.Client.Loader.defaultExceptionControlList,function(n){return n.ControlType===1}),a&&a.length>0&&(_MicrosoftMars.AnswerPanel.getInstance().hide(null,null,null,c),t.AnswerPanelLauncher.loadAnswerPanel(a[0]),t.AnswerPanelLauncher.isScenarioTriggered=!1,_MicrosoftMars.AnswerPanel.getInstance().togglePanel()));else{y=f.ControlType;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"launching the control of controlType"+y);f.ControlType===t.ControlTypes.StepThrough?(p=t.ScenarioManager.getInstance(),i.parseScenarioJSON(f),w=h.GTParentPanel,_MicrosoftMars.AnswerPanel.getInstance().hide(),h.GTParentPanel=w,u=!1,v=function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"inside the callback");h.GTParentPanel=h.CurrentPagePanel;p.launchScenario(f.ControlId);typeof o=="undefined"&&(o=[]);o.push("GuidedTask",f.ControlId,f.ControlName,f.Version,f.AuthoringId,f.PublishGroupId,f.AuthorId,"",_MicrosoftMars.Client.Loader.appContext.UserRoleNames,s);e.SetActivityData(o);e.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete)}):f.ControlType===t.ControlTypes.AnswerPanel&&(l=JSON.parse(i.getControlPageNavigationInfo(f)),l.wildcard&&l.wildcard.length>0&&(u=!1),u&&(n.Mars.Client.Runtime.Controls.AnswerPanelLauncher.isScenarioTriggered=!1,_MicrosoftMars.AnswerPanel.getInstance().hide(null,null,null,c)),v=function(){var n="PERF_M_LAUNCH_PANEL_LINK_NAVIGATE"+i.lpathClickCountForMarsPerfTest+"_END";if(_MicrosoftMars.Client.Loader.PerfMarker.MarsCaptureModulePerfTime(n),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"inside the callback"),o.push("Sidebar",f.ControlId,f.ControlName,f.Version,f.AuthoringId,f.PublishGroupId,f.AuthorId,"",_MicrosoftMars.Client.Loader.appContext.UserRoleNames,s),e.SetActivityData(o),e.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete),u){var t=_MicrosoftMars.Client.Loader.appContext.getPageNavigationInfo(),r=JSON.parse(i.getControlPageNavigationInfo(f)),h=!_MicrosoftMars.Client.Loader.appContext.compareNavInfo(t,r);i.launchAnswerPanel(f,h)}else _MicrosoftMars.AnswerPanel.getInstance().hide(),i.launchAnswerPanel(f)});var b=_MicrosoftMars.Client.Loader.appContext.getPageNavigationInfo(),l=JSON.parse(i.getControlPageNavigationInfo(f)),k="PERF_M_LAUNCH_PANEL_LINK_NAVIGATE"+i.lpathClickCountForMarsPerfTest+"_START";_MicrosoftMars.Client.Loader.PerfMarker.MarsCaptureModulePerfTime(k);u&&!_MicrosoftMars.Client.Loader.appContext.compareNavInfo(b,l)?(l.callback=v,t.AnswerPanelLauncher.isScenarioTriggered=!0,_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"navigating to different page"),_MicrosoftMars.Client.Loader.appContext.navigateToPage(l)):v()}});_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:launchLinkedControl END")},i.getControlPageNavigationInfo=function(n){var f="",r,t,i,u;if(n&&n.Contexts&&n.Contexts.length>0){for(r=0;r<n.Contexts.length;r++)if(t=n.Contexts[r].ContextGroup.ContextGroupElements,t&&t.length>0)for(i=0;i<t.length;i++)if(t[i].ContextTypeMetaDataId=="8"&&(u=t[i].ContextValues,u&&u.length>0)){f=u[0].Value;break}}else f=n.MetadataJson.PageNavigationInfo;return f},i.marsLinkClick=function(n,i){var r=n.target,e,u,f,l;n.target!==n.currentTarget&&(r=n.currentTarget);e=!1;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"MarsLink Click START");var a=_MicrosoftMars.Client.Loader.appContext,v=_MicrosoftMars.AnswerPanelModel.telemetry.Guid.newGuid(),o=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.linkClick);if(o.SetUserActivityInfo(a.UserId,i[1],i[6],i[7],i[5],v,i[0],i[2]),n.type==="click"||n.keyCode===13){if(u=r.getAttribute("href")?r.getAttribute("href"):r.getAttribute("data-href"),r.getAttribute("data-openinnew")!=null&&(f=r.getAttribute("data-openinnew").toLowerCase()),!_MicrosoftMars.Client.Loader.MarsLoader.isUCIShim()&&_MicrosoftMars.Client.Loader.appContext.clientType!=="Mobile"||_MicrosoftMars.Client.Loader.appContext.isISHPage()||_MicrosoftMars.Client.Loader.appContext.Util.isWindowsOs())if(f==="tab")window.open(u,"_blank");else if(f==="window")window.open(u,"Popup","location=1, status=1, scrollbars=1, resizable=1, directories=1, toolbar=1, titlebar=1, width=800, height=800");else if(f==="inline"){var s=r.getAttribute("data-dialogheight"),h=r.getAttribute("data-dialogwidth"),c=r.getAttribute("data-callback");_MicrosoftMars.Client.Loader.appContext.setAriaHiddenForElementsExceptMars(!1);_MicrosoftMars.Client.Loader.appContext.openDialog(u,s,h,c);t.$mars("#InlineDialog_Background").css("z-index",_MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex()+19);t.$mars("#InlineDialog").css("z-index",_MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex()+20)}else u?window.open(u,r.getAttribute("target")):e=!0;else if(u==null&&(u=r.getAttribute("data-href")!=null?r.getAttribute("data-href"):r.getAttribute("title")),f==="inline"&&u){var s=r.getAttribute("data-dialogheight"),h=r.getAttribute("data-dialogwidth"),c=r.getAttribute("data-callback");_MicrosoftMars.Client.Loader.appContext.openDialog(u,s,h,c);window.parent.document.getElementById("InlineDialog_Background").style.zIndex=_MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex()+19;window.parent.document.getElementById("InlineDialog").style.zIndex=_MicrosoftMars.Client.Loader.appContext.Util.getMaxZIndex()+20}else u?_MicrosoftMars.Client.Loader.appContext.openExternalUrl(u):e=!0;l=[i[4],i[3],"External Link","","","","","","",u,_MicrosoftMars.Client.Loader.appContext.UserRoleNames];o.SetActivityData(l);o.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete);e||(n.preventDefault(),n.stopPropagation())}return _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"MarsLink Click END"),!1},i.checkForScenariosComplete=function(){var i=localStorage.getItem("userProgressArray"),t=JSON.parse(i);t&&t.length!=0&&t.forEach(function(t){t.TrackingStatus==n.Mars.Client.Runtime.Controls.UserProgress.COMPLETE&&n.Mars.Client.Runtime.Controls.ContentManager.getInstance().setScenarioCompleted(t.ControlId,!1)})},i.launchAnswerPanel=function(n,r){r===void 0&&(r=!1);var u="PERF_M_LAUNCH_PANEL_LINK_"+i.lpathClickCountForMarsPerfTest+"_END";_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:launchAnswerPanel START");t.AnswerPanelLauncher.isScenarioTriggered=!0;setTimeout(function(){r?_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchAnswerPanelException,_MicrosoftMars.Client.Loader.marsLocale.unableToLoadAnswerPanel):t.AnswerPanelLauncher.loadAnswerPanel(n);_MicrosoftMars.AnswerPanel.getInstance().show(0);setTimeout(function(){t.$mars("body").trigger("answerPanelLaunched",{ControlModel:n})},2e3);_MicrosoftMars.Client.Loader.PerfMarker.MarsCaptureModulePerfTime(u)},_MicrosoftMars.AnswerPanelConstants.animationSpeed+100);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioUtil:launchAnswerPanel END")},i.getNextPerfCounter=function(){return i.lpathClickCountForMarsPerfTest>=10&&(i.lpathClickCountForMarsPerfTest=0),i.lpathClickCountForMarsPerfTest+=1,i.lpathClickCountForMarsPerfTest},i.lpathRuntimeOverlayClickAttached=!1,i.lpathClickCountForMarsPerfTest=0,i}();t.ScenarioUtil=i})(i=t.Controls||(t.Controls={}))})(i=t.Runtime||(t.Runtime={}))})(i=t.Client||(t.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){"use strict";var i=function(){function i(){this.scenarios={};this.activeScenarioId=null;i._instance?console.log("Singleton instance already exists for ScenarioManager. Access it via ScenarioManager.getInstance()"):i._instance=this}return i.getInstance=function(){return i._instance==null&&(i._instance=new i),i._instance},i.isBubbleVisible=function(){return i.bubbleVisible},i.setBubbleVisible=function(n){i.bubbleVisible=n;n?_MicrosoftMars.Client.Loader.$mars("#lpathRuntimeOverlay").bind("keydown ",i.shortcutKeysClickHandler):_MicrosoftMars.Client.Loader.$mars("#lpathRuntimeOverlay").unbind("keydown ",i.shortcutKeysClickHandler)},i.isPreviousOrNextClicked=function(){return i.previousOrNextClicked},i.setPreviousOrNextClicked=function(n){i.previousOrNextClicked=n},i.getNextPerfCounter=function(){return i.lpathClickCountForMarsPerfTest>=10&&(i.lpathClickCountForMarsPerfTest=0),i.lpathClickCountForMarsPerfTest+=1,i.lpathClickCountForMarsPerfTest},i.prototype.addScenario=function(n,i){var r=new t.Scenario(n,i);this.scenarios[n]=r},i.prototype.hasScenario=function(n){return this.scenarios[n]==null?!1:!0},i.prototype.getScenario=function(n){return this.scenarios[n]},i.prototype.removeScenario=function(n){if(this.hasScenario(n)){var t=this.getScenario(n);t.cleanup();delete this.scenarios[n];this.activeScenarioId==n&&(this.activeScenarioId=null)}else console.log("Error: Scenario Already removed : "+n)},i.prototype.launchScenario=function(n,r,u,f){var o,c,l,s,v;r===void 0&&(r=!1);u===void 0&&(u=!1);f===void 0&&(f=!1);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:launchScenario START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"scenarioId: "+n+" skipNavigation: "+r+" isErrorScenario:"+u);o=this;try{if(_MicrosoftMars.Client.Loader.ServiceProxy.webApiBaseUrl=_MicrosoftMars.Client.Loader.webApiBaseUrl,this.hasScenario(n)){i.lpathClickCountForMarsPerfTest=0;var e=this.getScenario(n),a=e.getCurrentStepId(),p=e.getStepBubbleModel(a),h=p.getAppContext();if(h!=null&&h.PageNavigationInfo!=null&&h.PageNavigationInfo!==""&&(c=JSON.parse(h.PageNavigationInfo),c.wildcard&&c.wildcard.length>0&&_MicrosoftMars.Client.Utility.FFFUtility.isFeatureEnabled(_MicrosoftMars.Client.Utility.FFFUtility.WildcardingFeatureName)&&(r=!0,!this.isValidWildCardControl(c))))throw new Error("Cannot launch wildcarded GT/sidebar from a different page type");l=function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"launchScenario: callback START");o.activeScenarioId!=null&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Active scenario with scenarioId "+o.activeScenarioId+" found."),o.notify(t.BubbleUtilityConstants.CLOSE));o.activeScenarioId=n;e.launchStep(a,0,u,f);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"launchScenario: callback END")};r?l():this.checkForPageNavigation(t.BubbleUtilityConstants.launchAction,e,l);f||(s="",t.Scenario.controlType===window._MicrosoftMars.Client.Telemetry.ActivityName.guidedtask?s=window._MicrosoftMars.Client.Telemetry.ActivityName.guidedtask:t.Scenario.controlType===window._MicrosoftMars.Client.Telemetry.ActivityName.activestepbubble?s=window._MicrosoftMars.Client.Telemetry.ActivityName.activestepbubble:t.Scenario.controlType===window._MicrosoftMars.Client.Telemetry.ActivityName.passivestepbubble?s=window._MicrosoftMars.Client.Telemetry.ActivityName.passivestepbubble:t.Scenario.controlType===window._MicrosoftMars.Client.Telemetry.ActivityName.answerpanel&&(s=window._MicrosoftMars.Client.Telemetry.ActivityName.answerpanel),t.guidedTaskActivity=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.guidedtask),v=_MicrosoftMars.Client.Loader.appContext.Util.getPublishGroupDetails(e.getPublishGroupId(),"Name"),t.guidedTaskActivity.SetUserActivityInfo(_MicrosoftMars.Client.Loader.appContext.userId,n,e.getPublishGroupId(),v,e.getAuthoringGroupId(),e.getParentScenarioId(),e.getAuthorId(),e.getControlName()))}else _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.WARNING,"No scenario exists for Scenario: "+n)}catch(y){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error occurs in ScenarioManager:launchScenario. Executing error bubble.");_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchStepException,y.message,null,y)}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:launchScenario END")},i.prototype.callbackForUserProgressQuery=function(n){var s,o;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:callbackForUserProgressQuery START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"scenarioId: "+n);var u=i.getInstance(),e=u.getScenario(n),a=e.isScenarioActiveOrHybrid(),r={TrackingStatus:"",IgnoredCount:0,CompleteCount:0,IncompleteCount:0,ChildControlId:null},h=localStorage.getItem("userProgressArray");if(h!=null&&(s=JSON.parse(h),s.length!==0)){var c=t.UserProgress.removeDuplicatesAndMergeInfo(s),f=_MicrosoftMars.Client.Loader.appContext,v=f.UserId,y=f.getAppName(),p=f.AppVersion,w=f.ClientType,b=f.getFormFactor(),l=v+y+p+n+w+b;c[l]&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"User Progress Data Found. Updating it."),r=c[l])}o=r.ChildControlId;n===u.getActiveScenarioId()||o==null||a||(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Changing current step id to "+o),e.setCurrentStep(n+o));r.TrackingStatus===t.UserProgress.COMPLETE&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Changing status of guided task as complete"),t.ContentManager.getInstance().setScenarioCompleted(n,!1),n!==u.getActiveScenarioId()&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"setting current step to first step"),e.setCurrentStep(e.getFirstStepId())));var k=r.IgnoredCount||0,d=r.CompleteCount||0,g=r.IncompleteCount||0,nt=u.getMaximumCount(k,d,g),tt=t.UserProgress.getAcrossSessionThreshold(t.Scenario.controlType);nt<tt&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Threshold not reached. Adding triggered launch"),u.addOrRemoveTriggeredLaunch(n,!0));_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:callbackForUserProgressQuery END")},i.prototype.callbackForRemovingTriggeredLaunch=function(n,r){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:callbackForRemovingTriggeredLaunch START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"count: "+n+" scenarioId: "+r);var u=i.getInstance();n>=t.UserProgress.getWithinSessionThreshold(t.Scenario.controlType)&&u.addOrRemoveTriggeredLaunch(r,!1);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:callbackForRemovingTriggeredLaunch END")},i.prototype.notify=function(n){var u,h,c,o,l;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:notify START");try{if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"ScenarioManager notified with action:"+n),u=this,h=_MicrosoftMars.Client.Loader.appContext.ClientType,h===t.BubbleUtilityConstants.mobileClientType&&sessionStorage.setItem("scenarioNotifyAction",n),this.activeScenarioId!=null&&this.hasScenario(this.activeScenarioId)){var i=this.getScenario(this.activeScenarioId),r=i.getCurrentStepId(),f=i.getOriginalStepId(r),e=i.getStepBubbleModel(r);if(r===i.getFirstStepId()&&n.toLowerCase()===t.BubbleUtilityConstants.NEXT.toLowerCase()&&!e.getWaitingBubble()){if(c=i.getNextStepId(),o=i.getStepBubbleModel(c),o==null){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Next step bubble is null");return}if(!o.isInitialized()){setTimeout(function(){u.validateStepBubbleModelForNextStep(0)},1e3);return}}l=function(){var c,l,a,v,s,h,o;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"callback execution START");c=t.ContentManager.getInstance();n.toLowerCase()===t.BubbleUtilityConstants.NEXT.toLowerCase()||n.toLowerCase()===t.BubbleUtilityConstants.PREVIOUS.toLowerCase()?(l=_MicrosoftMars.Client.Loader.appContext,o=l.getPageType(),t.infobubbleActivityEvent!=null&&t.infobubbleActivityEvent.controlId!=null&&t.infobubbleActivityEvent.controlId===r&&(n.toLowerCase()==="next"?t.infobubbleActivityEvent.SetActivityData(["","",o,window._MicrosoftMars.Client.Telemetry.UserClicks.next]):n.toLowerCase()==="previous"&&t.infobubbleActivityEvent.SetActivityData(["","",o,window._MicrosoftMars.Client.Telemetry.UserClicks.previous]),t.infobubbleActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete),t.infobubbleActivityEvent=null),t.stepBubbleActivityEvent!=null&&t.stepBubbleActivityEvent.controlId!=null&&t.stepBubbleActivityEvent.controlId===r&&(n.toLowerCase()==="next"?t.stepBubbleActivityEvent.SetActivityData(["","",o,window._MicrosoftMars.Client.Telemetry.UserClicks.next]):n.toLowerCase()==="previous"&&t.stepBubbleActivityEvent.SetActivityData(["","",o,window._MicrosoftMars.Client.Telemetry.UserClicks.previous]),t.stepBubbleActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete),t.stepBubbleActivityEvent=null),i.isLastStep(r)&&(_MicrosoftMars.Client.Loader.appContext.util.getGTPreviewState()||c.setScenarioCompleted(u.activeScenarioId,!1)),a=function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"calling navigate For Scenario");var t=i.getStepBubbleModel(r);t.getWaitingBubble()?u.checkForElementOnPage(t)||(i.closeStep(r,!1),i.isLastStep(r)||i.navigate(r,n)):i.navigate(r,n)},_MicrosoftMars.Client.Loader.appContext.clientType===t.BubbleUtilityConstants.mobileClientType&&(v=_MicrosoftMars.Client.Loader.appContext.isQuickCreateFormOpen(),_MicrosoftMars.Client.Loader.appContext.util.setQuickCreateFormOpen(v)),l.checkForPageLoad(a)):(n===t.BubbleUtilityConstants.CLOSE||n===t.BubbleUtilityConstants.CANCEL||n===t.BubbleUtilityConstants.OK||n===t.BubbleUtilityConstants.FINISH)&&(i.isLastStep(r)?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"This is the last step"),_MicrosoftMars.Client.Loader.appContext.util.getGTPreviewState()||(c.setScenarioCompleted(u.activeScenarioId,!0),c.handleValidateAndCollapseAccordion(u.activeScenarioId),t.UserProgress.saveControlState(u.activeScenarioId,f,t.UserProgress.COMPLETE,u.callbackForRemovingTriggeredLaunch)),i.setCurrentStep(i.getFirstStepId()),i.setCompleted(),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Scenario is completed"),t.infobubbleActivityEvent!=null&&t.infobubbleActivityEvent.controlId!=null&&t.infobubbleActivityEvent.controlId===r&&(t.infobubbleActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete),t.infobubbleActivityEvent=null),t.stepBubbleActivityEvent!=null&&t.stepBubbleActivityEvent.controlId!=null&&t.stepBubbleActivityEvent.controlId===r&&(t.stepBubbleActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete),t.stepBubbleActivityEvent=null),t.guidedTaskActivity&&t.guidedTaskActivity.controlId===u.activeScenarioId&&(s="",h=e.getCachedTargetElement(),h!=null&&(s=h.id),o=_MicrosoftMars.Client.Loader.appContext.getPageType(),t.guidedTaskActivity.SetActivityData(["","",o,s,i.getUITrigger(),i.GetVersion(),f]),t.guidedTaskActivity.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete),t.guidedTaskActivity=null)):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Scenario Ignored"),_MicrosoftMars.Client.Loader.appContext.util.getGTPreviewState()||t.UserProgress.saveControlState(u.activeScenarioId,f,t.UserProgress.IGNORED,u.callbackForRemovingTriggeredLaunch),t.infobubbleActivityEvent!=null&&t.infobubbleActivityEvent.id!=null&&t.infobubbleActivityEvent.id===r&&(t.infobubbleActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.close),t.infobubbleActivityEvent=null),t.stepBubbleActivityEvent!=null&&t.stepBubbleActivityEvent.id!=null&&t.stepBubbleActivityEvent.id===r&&(t.stepBubbleActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.close),t.stepBubbleActivityEvent=null),s="",h=e.getCachedTargetElement(),h!=null&&(s=h.id),o=_MicrosoftMars.Client.Loader.appContext.getPageType(),t.guidedTaskActivity&&t.guidedTaskActivity.controlId===u.activeScenarioId&&(t.guidedTaskActivity.SetActivityData(["","",o,s,i.getUITrigger(),i.GetVersion(),f]),t.guidedTaskActivity.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.close),t.guidedTaskActivity=null)),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"Setting active scenario id as null"),u.activeScenarioId=null);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"callback execution END")};this.checkForPageNavigation(n,i,l)}else _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.WARNING,"notify called without any active Scenario")}catch(s){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error occured in notify method");_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchStepException,s?s.message:"",null,s)}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:notify END")},i.prototype.getActiveScenarioId=function(){return this.activeScenarioId},i.prototype.getActiveScenario=function(){return this.activeScenarioId==null?null:this.getScenario(this.activeScenarioId)},i.prototype.getActiveStepbubbleModel=function(){if(this.activeScenarioId===null)return null;var n=this.getScenario(this.activeScenarioId);return n.getStepBubbleModel(n.getCurrentStepId())},i.prototype.setKeyShortcuts=function(n){var r=i.getInstance().getActiveStepbubbleModel(),c,o,l,s,f,u,e,h,v,a;if(r!==null&&(n.keyCode===_MicrosoftMars.Client.Utility.KeyCodeEnum.EscapeKey&&(this.notify(t.BubbleUtilityConstants.CLOSE),c=_MicrosoftMars.Client.Loader.appContext.Util.getHelpIcon(),c&&(o=c.parents("[tabIndex=0]"),o&&o.length>0&&o[0].focus())),n.type==="touchend"&&(i.tapped?(clearTimeout(i.tapped),i.tapped=null,this.notify(t.BubbleUtilityConstants.CLOSE)):i.tapped=setTimeout(function(){i.tapped=null},500),n.preventDefault()),!r.isStepActive()))for(l=r.getEvents(),s=0;s<l.length;s++)f=l[s],u=f.Action,u===t.BubbleUtilityConstants.NEXT&&n.altKey&&n.shiftKey&&n.keyCode===38||u===t.BubbleUtilityConstants.PREVIOUS&&n.altKey&&n.shiftKey&&n.keyCode===40||(u===t.BubbleUtilityConstants.CLOSE||u===t.BubbleUtilityConstants.CANCEL)&&n.keyCode===27||(u===t.BubbleUtilityConstants.OK||u===t.BubbleUtilityConstants.FINISH)&&n.keyCode===13?(r.isHybrid()&&u===t.BubbleUtilityConstants.NEXT&&(e=r.getTargetElement().element,_MicrosoftMars.Client.Loader.appContext.clientType===t.BubbleUtilityConstants.mobileClientType&&e[0].hasAttribute("data-reactid")&&(h=window.parent.React,h!=null&&h!==undefined&&h.addons.TestUtils.Simulate.shortPress(e[0])),e!=null&&e[0].click()),this.notify(u)):u===t.BubbleUtilityConstants.learnMoreAction.toLowerCase()&&n.altKey&&n.keyCode===39&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"learnmore triggered for info bubble"),this.notify(t.BubbleUtilityConstants.closeAction.toLowerCase()),v=_MicrosoftMars.Client.Loader.appContext.Util.getPublishGroupDetails(r.getPublishGroupId(),"Name"),a=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.linkClick),a.SetUserActivityInfo(_MicrosoftMars.Client.Loader.appContext.userId,r.getParentControlId(),r.getPublishGroupId(),v,r.getAuthoringGroupId(),"00000000-0000-0000-0000-000000000000",r.getAuthorId(),r.getParentControlName()),f.ChainedTo&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"chainedTo: "+f.ChainedTo),t.ScenarioUtil.notifyEventAnswerpanel(f.ChainedTo,a)))},i.prototype.computeWildcardedPageKeys=function(n){var t=_MicrosoftMars.Client.Loader.appContext,i=n[t.ClientType],r=n.QSMap,u=n.wildcard,f=t.getPageNavigationObject(i,r,u);return t.getWildcardedPageKeys(f)},i.prototype.isValidWildCardControl=function(n){var t=_MicrosoftMars.Client.Loader.appContext.getPageNavigationInfo(),i=this.computeWildcardedPageKeys(n),r=this.computeWildcardedPageKeys(t);return i.filter(function(n){return r.indexOf(n)!==-1}).length>0},i.prototype.validateStepBubbleModelForNextStep=function(n){var u;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:validateStepBubbleModelForNextStep START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"count: "+n);var i=this.getScenario(this.activeScenarioId),f=i.getNextStepId(),r=i.getStepBubbleModel(f);if(r&&r.isInitialized())_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"step bubble validation successful. Calling next method"),this.notify(t.BubbleUtilityConstants.NEXT);else{if(n>15){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"step bubble validation failed. Launching Error bubble");_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchStepException,_MicrosoftMars.Client.Loader.marsLocale.exceptionMessage);return}u=this;setTimeout(function(){u.validateStepBubbleModelForNextStep(n+1)},1e3)}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:validateStepBubbleModelForNextStep END")},i.prototype.addOrRemoveTriggeredLaunch=function(r,u,f){var o,c,s,v,y,l,e,a,h;if(f===void 0&&(f=0),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:addOrRemoveTriggeredLaunch START"),this.hasScenario(r)){if(o=this.getScenario(r),c=o.getFirstStepId(),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"first Step Id:"+c),s=o.getStepBubbleModel(c),v=s.getTargetElement(!1,!1,!1),!v){if(f>3){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Target Element not visible on page for first Step of scenario");return}y=this;setTimeout(function(){y.addOrRemoveTriggeredLaunch(r,u,f+1)},1e3);return}if(l=_MicrosoftMars.Client.Loader.appContext.ClientType,_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"clientType:"+l),e=o.getUITrigger(),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"uiTrigger:"+e),e===t.BubbleUtilityConstants.LANDING||e===t.BubbleUtilityConstants.DELAY)u!==!0||n.Mars.Client.Runtime.Controls.AnswerPanelLauncher.isLandingTrigger||(o.setCurrentStep(o.getFirstStepId()),a=0,e===t.BubbleUtilityConstants.DELAY&&(a=parseInt(_MicrosoftMars.Client.Loader.userExperienceAdvancedOptionsAttributes.Delay)),i.idleSecondsCounter=0,_MicrosoftMars.Client.Loader.$mars("#lpathRuntimeOverlay").bind("mousemove keypress scroll",function(){i.idleSecondsCounter=0}),this.launchScenarioOnPageLoad(r,a),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Scenario launching on page load for scenarioId - "+r));else if(e===t.BubbleUtilityConstants.HOVER||e===t.BubbleUtilityConstants.FOCUS||e===t.BubbleUtilityConstants.CLICK){if(h=s.getTargetElement()?s.getTargetElement().element:null,h===null||h===undefined)return;if(e===t.BubbleUtilityConstants.HOVER&&(e="mouseenter"),u===!0)if(o.setCurrentStep(o.getFirstStepId()),l!==t.BubbleUtilityConstants.mobileClientType||_MicrosoftMars.Client.Loader.appContext.isISHPage())h.on(e+" #mars",function(){var n=i.getInstance(),u=n.getActiveScenario();t.AnswerPanelLauncher.isScenarioTriggered&&u||(n.launchScenario(r),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"For launching scenario parsing scenarioId - "+r))});else s.setTargetElementForMOCA(t.BubbleUtilityConstants.infoIconImageId),this.attachClickEventToInfoIconForMOCA(s,r,t.BubbleUtilityConstants.infoIconImageId)}}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:addOrRemoveTriggeredLaunch END")},i.prototype.launchScenarioOnPageLoad=function(n,t){var r,u,f;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:launchScenarioOnPageLoad START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"scenarioId: "+n+"delay:"+t);r=_MicrosoftMars.Client.Loader.appContext.isPageLoaded();r&&i.idleSecondsCounter>=t?this.activeScenarioId==null?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"launching scenario on Page Load"),u=i.getInstance(),u.launchScenario(n)):_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"can't launch page load scenario, as "+this.activeScenarioId+" scenario is active"):(f=this,setTimeout(function(){i.idleSecondsCounter=i.idleSecondsCounter+1e3;f.launchScenarioOnPageLoad(n,t)},1e3));_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:launchScenarioOnPageLoad END")},i.prototype.attachClickEventToInfoIconForMOCA=function(n,t,r){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:attachClickEventToInfoIconForMoca START");var u=n.getTargetElementForMOCA(r);u.off("click #mars").on("click #mars",function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"click event on Info Icon triggered. Launching "+t);var n=i.getInstance();n.launchScenario(t)});_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:attachClickEventToInfoIconForMoca END")},i.prototype.detachClickEventToInfoIconForMOCA=function(n,t){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:detachClickEventToInfoIconForMoca START");var i=n.getTargetElementForMOCA(t);i.off("click #mars");n.removeInfoIconDiv();_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:detachClickEventToInfoIconForMoca END")},i.prototype.getMaximumCount=function(n,t,i){return n>=t&&n>=i?n:t>=i?t:i},i.prototype.checkForPageNavigation=function(n,i,r){var l,u,v,a,h,c,y,o,p;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:checkForPageNavigation START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"action: "+n);l=_MicrosoftMars.Client.Loader.appContext;u=i.getCurrentStepId();_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"currentStepId: "+u);var e=i.getStepBubbleModel(u),s=e.getAppContext(),f=null;if(s!=null&&s.PageNavigationInfo!=null&&s.PageNavigationInfo!==""&&(f=JSON.parse(s.PageNavigationInfo)),n.toLowerCase()===t.BubbleUtilityConstants.launchAction.toLowerCase()){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Inside launch Action");f==null||_MicrosoftMars.Client.Loader.appContext.compareNavInfo(f)||f.wildcard?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"No need to navigate. invoke the callback."),r()):(f.callback=r,t.AnswerPanelLauncher.isScenarioTriggered=!0,_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"navigation triggered"),_MicrosoftMars.Client.Loader.appContext.navigateToPage(f));_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:checkForPageNavigation END");return}if((e.isStepActive()||e.isHybrid())&&!e.getWaitingBubble()&&n.toLowerCase()===t.BubbleUtilityConstants.NEXT.toLowerCase()){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Its an active/hybrid step, Checking for page load");i.closeStep(u,!1);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"current step closed");_MicrosoftMars.Client.Loader.appContext.clientType===t.BubbleUtilityConstants.mobileClientType&&(v=_MicrosoftMars.Client.Loader.appContext.isQuickCreateFormOpen(),_MicrosoftMars.Client.Loader.appContext.util.setQuickCreateFormOpen(v));l.checkForPageLoad(r);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:checkForPageNavigation END");return}if(a=l.getPageType(),n.toLowerCase()===t.BubbleUtilityConstants.NEXT.toLowerCase()?(h=window._MicrosoftMars.Client.Telemetry.UserClicks.next,c=i.getStepBubbleModel(i.getNextStepId())):n.toLowerCase()===t.BubbleUtilityConstants.PREVIOUS.toLowerCase()&&(h=window._MicrosoftMars.Client.Telemetry.UserClicks.previous,c=i.getStepBubbleModel(i.getPrevStepId())),c&&(y=c.getAppContext(),t.infobubbleActivityEvent!=null&&t.infobubbleActivityEvent.controlId!=null&&t.infobubbleActivityEvent.controlId===u&&t.infobubbleActivityEvent.SetActivityData(["","",a,h]),t.stepBubbleActivityEvent!=null&&t.stepBubbleActivityEvent.controlId!=null&&t.stepBubbleActivityEvent.controlId===u&&t.stepBubbleActivityEvent.SetActivityData(["","",a,h]),o=JSON.parse(y.PageNavigationInfo),o.callback=r,_MicrosoftMars.Client.Loader.$mars.isEmptyObject(o.wildcard)&&(p=_MicrosoftMars.Client.Loader.appContext.compareNavInfo(_MicrosoftMars.Client.Loader.appContext.getPageNavigationInfo(),o),!p))){i.closeStep(u,!1);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"current step closed");t.AnswerPanelLauncher.isScenarioTriggered=!0;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"navigation triggered");_MicrosoftMars.Client.Loader.appContext.navigateToPage(o);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:checkForPageNavigation END");return}n.toLowerCase()===t.BubbleUtilityConstants.CLOSE.toLowerCase()?(i.closeStep(u,!0),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"current step closed")):e.getWaitingBubble()||(i.closeStep(u,!1),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"current step closed"));r();_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:checkForPageNavigation END");return},i.prototype.checkForElementOnPage=function(n){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:checkForElementOnPage START");var t=n.getTargetElement(!1,!1,!1);return t==null||t.elementX<=0?(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:checkForElementOnPage END1 return false"),!1):(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:checkForElementOnPage END return true"),!0)},i.idleSecondsCounter=0,i.lpathClickCountForMarsPerfTest=0,i.tapped=0,i._instance=null,i.shortcutKeysClickHandler=function(n){return i.getInstance().setKeyShortcuts(n)},i}();t.ScenarioManager=i;_MicrosoftMars.Client.Loader.$mars("#lpathRuntimeOverlay").ready(function(){_MicrosoftMars.Client.Loader.$mars(window).bind("beforeunload",function(){var r=i.getInstance(),u=r.getActiveScenarioId(),f;if(u!=null){var n=r.getActiveScenario(),e=n.getCurrentStepId(),o=n.getOriginalStepId(e),s=_MicrosoftMars.Client.Loader.appContext,f=s.getPageType();_MicrosoftMars.Client.Loader.appContext.util.getGTPreviewState()||t.UserProgress.saveControlState(u,o,t.UserProgress.INCOMPLETE,r.callbackForRemovingTriggeredLaunch);t.stepBubbleActivityEvent!=null&&t.stepBubbleActivityEvent.controlId!=null&&t.stepBubbleActivityEvent.controlId===e&&(t.stepBubbleActivityEvent.SetActivityData(["","",f,window._MicrosoftMars.Client.Telemetry.UserClicks.ignored]),t.stepBubbleActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.incomplete),t.stepBubbleActivityEvent=null);t.guidedTaskActivity!=null&&t.guidedTaskActivity.controlId!=null&&t.guidedTaskActivity.controlId===u&&(f=_MicrosoftMars.Client.Loader.appContext.getPageType(),t.guidedTaskActivity.SetActivityData(["","",f,window._MicrosoftMars.Client.Telemetry.UserClicks.ignored,n.getUITrigger(),n.GetVersion(),o]),t.guidedTaskActivity.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.incomplete),t.guidedTaskActivity=null)}return});_MicrosoftMars.Client.Loader.$mars(window).bind("popstate",function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:popstate START");var r=null,n=null;i!==undefined&&(n=i.getInstance(),r=n.getActiveScenario());r&&!t.AnswerPanelLauncher.isScenarioTriggered&&n.notify(t.BubbleUtilityConstants.CLOSE);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ScenarioManager:popstate END")})})})(i=t.Controls||(t.Controls={}))})(i=t.Runtime||(t.Runtime={}))})(i=t.Client||(t.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){"use strict";var t=function(){function t(){}return t.panelId="answerPanel",t.pages=1,t.width=n.AnswerPanelConstants.defaultWidth,t.isRTL=window._MicrosoftMars.Client.Loader.appContext.isRTL(),t.parentActivityId="00000000-0000-0000-0000-000000000000",t.telemetry=window._MicrosoftMars.Client.Telemetry,t}(),i;n.AnswerPanelModel=t;i=function(){function i(){var f=this,r,u;if(this.currentPage=1,this.fullPages=[],this.mobileClient="Mobile",this.noResultsInSearchFlag=!1,i._instance)throw new Error("Error: Instantiation failed: Use AnswerPanel.createInstance instead of new.");i._instance=this;this.answerPanelElement=n.Client.Loader.$mars().add('<div class="lpath-runner" id="'+t.panelId+'"><\/div>');this.answerPanelElement.addClass(n.AnswerPanelConstants.iframeCSS);this.answerPanelElement.attr("role","dialog");n.Client.Loader.appContext.isISHPage()?this.answerPanelElement.addClass("lpath-ish-ap-height"):n.Client.Loader.appContext.clientType==="Mobile"&&this.answerPanelElement.addClass("lpath-moca-ap-height");this.answerPanelElement.click(function(n){n.stopPropagation()});this.pagebodyContent=window._MicrosoftMars.Client.Loader.appContext.util.getOrCreateOverlay();this.feedbackOverlay=n.$mars(window._MicrosoftMars.Client.Loader.appContext.util.getOrCreateFeedbackOverlay());this.pagebodyContent.appendChild(this.answerPanelElement[0]);this.isISHPage=n.Client.Loader.appContext.isISHPage();this.notificationBadge=Microsoft.Mars.Client.Runtime.Controls.NotificationBadge.GetInstance();r=this;u=function(){r&&(n.propertyHomeTabContainer&&n.propertyHomeTabContainer.is(":visible")&&n.propertyHomeTabContainer.hide(),r.hide())};this.closeButtonElement=this.answerPanelElement.find("#closeButton");this.closeButtonElement.click(u);this.shortcutKeysClickHandler=function(n){f.setShortcutKeys(n,r)};t.isRTL&&(this.answerPanelElement.css("box-shadow",n.AnswerPanelConstants.leftBorderShadow),this.answerPanelElement.css("border-right",n.AnswerPanelConstants.leftBorder),this.answerPanelElement.addClass("lpath-rtl"))}return Object.defineProperty(i.prototype,"isAnswerPanelVisible",{get:function(){return this._isAnswerPanelVisible},set:function(t){this._isAnswerPanelVisible=t;t?n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).bind("keydown",this.shortcutKeysClickHandler):n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).unbind("keydown",this.shortcutKeysClickHandler)},enumerable:!0,configurable:!0}),i.getInstance=function(){return i._instance==null&&(i._instance=new i),i._instance},i.handleBuyNowChatCallMeLink=function(t){var r=n.Client.Loader.$mars(t),u;if(r){u=r.data("name");switch(u){case"mars-footerbutton-livechat":i.trackActivity("liveChat","chat");break;case"mars-footerbutton-callme":i.trackActivity("callMe","call");break;case"mars-footerbutton-buynow":i.trackActivity("buyNow","buy")}}},i.replaceCallMeLiveChatIcons=function(t,i,r){var u=t.find('img[data-name="mars-LiveChat"]'),f=t.find('img[data-name="mars-CallMe"]'),e;u.attr("src",n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath[i]);f.attr("src",n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath[r]);u.addClass("lpath-svg");u.addClass("lpath-svg-fill");f.addClass("lpath-svg");f.addClass("lpath-svg-fill");e=[u,f];e.forEach(function(t){var i,r;try{i=n.$mars("<span/>");i.attr("data-name",t.attr("data-name"));i.attr("alt",t.attr("alt"));r=t.clone();i.append(r);t.replaceWith(i)}catch(u){console.log("Failed to replace image with svg src : "+t.attr("src")+" exception : "+u)}});window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg")},i.attachEventsToSidebar=function(){var i=this,u=Microsoft.Mars.Client.Runtime.Controls.ScenarioUtil,f=n.Client.Loader.$mars(".mars-preview-section").find(".mars-toggleImage"),e=n.Client.Loader.$mars(".mars_webPage"),o=n.Client.Loader.$mars("#answerPanel").find("#closeButton"),s=n.Client.Loader.$mars(".mars_pageInApp"),h=n.Client.Loader.appContext.Util.getPublishGroupDetails(t.publishGroupId,"Name"),r=[t.authorId,t.controlId,t.controlName,t.version,"Sidebar",t.authoringGroupId,t.publishGroupId,h];e.off("click keydown").on("click keydown",{value:r},function(n){u.marsLinkClick(n,n.data.value)});var c=n.Client.Loader.$mars('div[id^="mars-fwlinkVideoHolder"]'),l=n.Client.Loader.$mars(".mars-legacyhelptemplate"),a=n.Client.Loader.$mars(".lpathlegacyhelptemplate"),v=n.Client.Loader.$mars(".lpath-sidebar-section").find(".lpath-toggleImage").parent(),y=n.Client.Loader.$mars(".mars-section-text a, .lpath-section-text a");f.add(v).off("click keypress keydown").on("click keypress keydown",function(n){i.onToggleClick(n)});o.off("click keyup").on("click keyup",function(t){(t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!0))&&i.closeAnswerPanel()});n.Client.Loader.$mars("#lPathSearchSectionContainer").on("keydown",function(t){t.which===n.Client.Utility.KeyCodeEnum.SpaceKey&&t.preventDefault()});s.off("click").on("click",{value:r},function(n){i.pageInAppClickHandler(n,n.data.value)});c.each(function(){i.executeFwLink(n.Client.Loader.$mars(this))});l.add(a).off("click keydown").on("click keydown",{value:r},function(t){(t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!1))&&i.legacyhelphandler(t,t.data.value)});y.each(function(){n.Client.Loader.$mars(this).off("click keydown").on("click keydown",{value:r},function(n){u.marsLinkClick(n,n.data.value)})})},i.removeLiveChat=function(n){var t=n.find('[data-name="mars-liveChatLink"]'),i=n.find('[data-name="mars-LiveChat"]');i.remove();t.remove()},i.setAnswerPanelHeader=function(r,u,f,e,o,s){var a,h,w,v,y,c,b,k,p,l;(s===void 0&&(s=!1),a=170,i.answerPanelContainer=n.Client.Loader.$mars("#"+r),i.sidebarHeaderElement=i.answerPanelContainer.find("#lPathHeader"),i.sidebarHeaderElement)&&((h=i.sidebarHeaderElement.text(),h.length<=0)||(i.lineHeight=Math.floor(parseInt(i.sidebarHeaderElement.css("line-height").replace("px",""))),i.lineHeight<=0)||(w=this.getLineCount(),v=Math.ceil(h.length/i.noOfCharsTotruncate),w>i.maxAllowedLines&&(h.length>a?i.addEllipses(a,v):i.addEllipses(h.length-i.noOfCharsTotruncate,v),h=i.sidebarHeaderElement.text(),i.sidebarHeaderElement.text(h.substring(0,h.length-4)+"...")),s||(u=t.IsSideBarHeaderDisabled,f=t.IsSideBarTitleDisabled,e=t.IsSideBarFooterDisabled),y=i.answerPanelContainer.find(".lpath-sidebar-section-container"),c=0,f?"":c+=i.answerPanelContainer.find("#lPathHeaderSidebarContainer").outerHeight(),u?"":c+=i.answerPanelContainer.find(".lpath-search-subcontainer").outerHeight(),(o==null||o==undefined)&&(o=t.IsFooterSectionAvailable),b=o?"#lPathFooterSectionHolder":"#footer",e?"":c+=i.answerPanelContainer.find(b).outerHeight(),n.Client.InAppSupport.Util.isInAppSupportFeatureEnabled(s)&&n.$mars("#lPathPreviewSidebarHolder").length==0&&n.InAppSupportConfiguration.getInstance()!=null&&n.InAppSupportConfiguration.getInstance().Configuration!=null&&(n.Client.InAppSupport.Util.isIASLaunchThroughSmileyEnabled()?(k=n.Client.Loader.$mars("#"+n.InAppSupportConstants.contactSupportId),p=i.answerPanelContainer.find("#feedbackFrown"),k.length===0&&(p.after(p,n.InAppSupportConfiguration.getInstance().getTemplateHtml("InAppFeedBackOptions")),n.$mars(".feedbackOptions").addClass("support-feedback-Content"))):(l=n.Client.Loader.$mars("#CreateSupportContent"),l.length<=0&&(y.after(n.InAppSupportConfiguration.getInstance().getTemplateHtml("CreateSupportTicket")),l=n.Client.Loader.$mars("#CreateSupportContent")),l.length>0&&(c=c+l.outerHeight())),n.Client.InAppSupport.Util.addEventHandlerForCreateSupportButton()),y.css("height","calc(100% - ("+c+"px)"),i.answerPanelContainer.find(".lpath-videoSectionMaxWidth").each(function(){(n.Client.Loader.$mars(this).prev().length<0||!n.Client.Loader.$mars(this).prev().hasClass("lpath-ap-section-header"))&&(n.Client.Loader.$mars(this).hasClass("lpath-section-without-title")||n.Client.Loader.$mars(this).addClass("lpath-section-without-title"))})))},i.trackActivity=function(i,r){var f=t.telemetry.Guid.newGuid(),u=new t.telemetry.UserActivityEvent(t.telemetry.ActivityName[i]),e=n.Client.Loader.appContext.Util.getPublishGroupDetails(t.publishGroupId,"Name");u.SetUserActivityInfo(n.Client.Loader.appContext.userId,f,t.publishGroupId,e,t.authoringGroupId,t.controlId,t.authorId,i);u.FinishActivity(t.telemetry.EndAction[r])},i.onToggleClick=function(t){var r,o,h,l,i,s,a;if(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:onToggleClick START"),t=t||window.event,t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!0))i=t.target||t.srcElement,i&&i.tagName.toLowerCase()==="div"&&(i=i.firstElementChild),i&&(r=i.parentElement,i.parentElement.tagName.toLowerCase()==="contentblock"&&(r=r.parentElement),r&&(o=n.Client.Loader.$mars(i).hasClass("lpath-toggleImage")?r.parentElement.nextElementSibling:r.nextElementSibling,o&&(n.Client.Loader.$mars(o).slideToggle(10,function(){n.Client.Loader.appContext.Util.handleAnswerPanelScroll()}),h=o.nextElementSibling,h&&n.Client.Loader.$mars(h).slideToggle(10,function(){n.Client.Loader.appContext.Util.handleAnswerPanelScroll()}))),i.src.indexOf("expand")==-1?(i.src=n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.expandedIcon,i.alt=n.Client.Loader.marsLocale.expanded,i.title=n.Client.Loader.marsLocale.sectionExpandedToolTip,n.Client.Loader.$mars(i).parent().attr("aria-expanded","true")):(i.src=n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.collapsedIcon,i.alt=n.Client.Loader.marsLocale.collapsed,i.title=n.Client.Loader.marsLocale.sectionCollapsedToolTip,n.Client.Loader.$mars(i).parent().attr("aria-expanded","false"))),t.preventDefault(),t.stopPropagation();else if(t.keyCode===n.Client.Utility.KeyCodeEnum.DownArrowKey){if(i=t.target||t.srcElement,i){var u=n.Client.Loader.$mars(i).closest("sectionreference")[0],f=u.nextElementSibling,c=u.parentElement.childElementCount;if(f)while(c-1)if(s=n.Client.Loader.$mars(f).find("div.lpath-section-header-collapse").length!=0,s){n.Client.Loader.$mars(f).find(":visible :tabbable").first().focus();break}else f=f.nextElementSibling;else l=u.parentElement,n.Client.Loader.$mars(l).find(".lpath-section-header-collapse").first().focus()}t.preventDefault();t.stopPropagation()}else if(t.keyCode===n.Client.Utility.KeyCodeEnum.UpArrowKey){if(i=t.target||t.srcElement,i){var u=n.Client.Loader.$mars(i).closest("sectionreference")[0],e=u.previousElementSibling,c=u.parentElement.childElementCount;if(e)while(c-1)if(s=n.Client.Loader.$mars(e).find("div.lpath-section-header-collapse").length!=0,s){n.Client.Loader.$mars(e).find(":visible :tabbable").first().focus();break}else e=e.previousElementSibling;else a=u.parentElement,n.Client.Loader.$mars(a).find(".lpath-section-header-collapse").last().focus()}t.preventDefault();t.stopPropagation()}window._MicrosoftMars.AnswerPanel.getInstance().handleHighContrastModeForExpandAndCollapseIcons();n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:onToggleClick END")},i.closeAnswerPanel=function(){var t,i;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:closeAnswerPanel START");t=n.Client.Loader.$mars("#mars_sidebar_answerpanel_templateholder");t.length>0?(n.Client.Loader.$mars("#answerPanel").css("display","none"),n.Client.Loader.appContext.util.hideOverlay(),n.Client.Loader.$mars("#mars_sidebar_answerpanel_templateholder").css("display","none")):(i=window._MicrosoftMars.AnswerPanel.getInstance(),i.hide());n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:closeAnswerPanel END")},i.enlargeImage=function(t,i,r){var u,e,f,o;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:enlargeImage START");(t.type==="click"||t.keyCode===13)&&(u=n.Client.Loader.$mars,r&&(e=u("#enlargeImageDialog"),e.html('<img class="mars-image-center" src="'+i+'"/>'),e.dialog({resizable:!0,draggable:!1,modal:!0,height:270,width:480,close:function(){u(this).dialog("close")}}),u(".ui-dialog-titlebar").removeClass("ui-widget-header"),f=u(".ui-icon-closethick"),f.removeClass("ui-icon"),f.text(""),f.addClass("mars-closepopup"),f.removeClass("ui-icon-closethick"),u(".ui-dialog-mars").addClass("mars-front-dialog"),o=u(".ui-button-text"),o.text(""),o.removeClass("ui-button-text"),u(".ui-state-default").removeClass("ui-state-default")));n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:enlargeImage END")},i.pageInAppClickHandler=function(t,i){var f=t.target,e,u,r,o,s;return t.target!==t.currentTarget&&(f=t.currentTarget),e=n.Client.Loader.appContext,u=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.linkClick),u.SetUserActivityInfo(e.UserId,i[1],i[6],i[7],i[5],n.AnswerPanelModel.telemetry.Guid.newGuid(),i[0],e.locale,i[2]),r=n.Client.Loader.$mars(f).data("pagenavigationinfo"),r=n.Client.Loader.appContext.getPageInAppPageNavigationInfo(r),r&&(Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher.isScenarioTriggered=!0,o=f,r.callback=function(){o.focus()},n.Client.Loader.appContext.navigateToPage(r)),s=[i[4],i[3],"Page In App","","","","","","",t.currentTarget.textContent,n.Client.Loader.appContext.UserRoleNames],u.SetActivityData(s),u.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete),!1},i.legacyhelphandler=function(t,i){var f=n.Client.Loader.appContext,r=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.linkClick),u;return r.SetUserActivityInfo(f.UserId,i[1],i[6],i[7],i[5],n.AnswerPanelModel.telemetry.Guid.newGuid(),i[0],i[2]),n.Client.Loader.appContext.loadStaticHelp(),u=[i[4],i[3],"Legacy help","","","","","","","",n.Client.Loader.appContext.UserRoleNames],r.SetActivityData(u),r.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete),!1},i.popOutVideo=function(t,i){if(t=t||window.event,t.type==="click"||t.keyCode===13){var o=t.target||t.srcElement,u=n.Client.Loader.$mars(o),f=u.prev().html(),e=n.Client.Loader.$mars('<div class="mars_dialog_videoOverlay"  id="videoHolderDiv" />'),r=n.Client.Loader.$mars('<div class="mars-dialog-video"  id="videoContainer" />');r.html(f);n.Client.Loader.$mars("#videoHolderDiv")&&(n.Client.Loader.$mars("#videoHolderDiv").remove(),n.Client.Loader.$mars("#videoContainer").remove());n.Client.Loader.$mars("body").append(e);n.Client.Loader.$mars("body").append(r);e.show();r.show();r.append('<input id="closeVideo" class="lpath-ap-close mars-video-close" type="image" src="\\{{skip-helper}}{{getServerUrl}}images/\\{{skip-helper}}{{getImage "closeIcon"}}" tabindex="0" title="{{Locale.close}}" alt="{{Locale.close}}"/>');u.prev().html("");n.Client.Loader.$mars("[data-id="+i+"iframe]").focus();n.Client.Loader.$mars("#closeVideo").on("click keyup",function(t){(t.type==="click"||t.keyCode===13)&&(u.prev().html(f),n.Client.Loader.$mars("#videoHolderDiv").remove(),n.Client.Loader.$mars("#videoContainer").remove())})}},i.executeFwLink=function(t){n.Client.Loader.appContext.Util.executeFwLink(t)},i.getLineCount=function(){var n=i.answerPanelContainer.find("#lPathHeader").outerHeight();return n/i.lineHeight},i.addEllipses=function(n,t){var u=i.sidebarHeaderElement.text(),r;for(i.sidebarHeaderElement.text(u.substring(0,n)),r=i.getLineCount();r>i.maxAllowedLines&&t>0;)t--,i.addEllipses(n-i.noOfCharsTotruncate,t)},i.prototype.initialize=function(n,i){n&&(t.pages=n);this.setWidth(t.pages,!1,i)},i.prototype.setShortcutKeys=function(t,i){t.keyCode===27?i.answerPanelElement&&i.answerPanelElement.find("#closeButton").click():t.altKey&&t.ctrlKey&&t.keyCode===72||(t.altKey&&t.ctrlKey&&(t.keyCode===83||t.keyCode===115)?n.Client.Loader.$mars("#lPathSearchSidebarContainer #txtSearch")?n.Client.Loader.$mars("#lPathSearchSidebarContainer #txtSearch").focus():n.Client.Loader.$mars("#marsSearchApContainer input[type=text]").focus():t.altKey&&t.ctrlKey&&(t.keyCode===103||t.keyCode===55)?n.Client.Loader.$mars("#feedbackSmile").trigger("click"):t.altKey&&t.ctrlKey&&(t.keyCode===104||t.keyCode===56)?n.Client.Loader.$mars("#feedbackFrown").trigger("click"):t.ctrlKey&&t.altKey&&(t.keyCode===76||t.keyCode===108)?n.Client.Loader.$mars("#lpath-propertyTab_lib-builderControl").trigger("click"):t.shiftKey&&t.altKey&&(t.keyCode===83||t.keyCode===115)?n.Client.Loader.$mars("#lpath_propertyTab_edit_builderControl").trigger("click"):t.ctrlKey&&t.keyCode===117&&this.handleQuickNavigation())},i.prototype.handleQuickNavigation=function(){var t=n.$mars.find(".lpath-quicknavigation:visible"),u=n.$mars(document.activeElement),r=t.indexOf(u[0]),i=0;r===t.length-1?i:i=r+1;t[i].focus()},i.prototype.hotSpotSlide=function(n){n.preventDefault();n.stopPropagation();this.togglePanel()},i.prototype.popOut=function(){var e=n.Client.Loader.appContext.getPageType(),o=["","",e,window._MicrosoftMars.Client.Telemetry.UserClicks.popOut,t.activationEvent,t.version],r,u,f,i;n.answerPanelActivityEvent.SetActivityData(o);this.hide();r=n.Client.Loader.$mars("#"+t.panelId).clone();n.Client.Loader.$mars(r).find("#closeButton").remove().end();n.Client.Loader.$mars(r).find("#marsSearchApContainer").remove().end();n.Client.Loader.$mars(r).find("#footer").remove().end();u=window.open("","_blank","toolbar=no,location=no,menubar=no,scrollbars=yes,width="+r.width());u.document.write(n.Client.Loader.$mars(r).html());f=u.document.getElementsByTagName("head")[0];i=u.document.createElement("link");i.id="MarsStyle";i.rel="stylesheet";i.type="text/css";i.href=n.Client.Loader.serverUrl+"MARSStyle.css";i.media="all";f.appendChild(i);u.document.close()},i.prototype.setControlId=function(n){t.controlId=n},i.prototype.getControlId=function(){return t.controlId},i.prototype.setPublishGroupId=function(n){t.publishGroupId=n},i.prototype.getPublishGroupId=function(){return t.publishGroupId},i.prototype.setAuthoringGroupId=function(n){t.authoringGroupId=n},i.prototype.getAuthoringGroupId=function(){return t.authoringGroupId},i.prototype.setVersion=function(n){t.version=n},i.prototype.setActivation=function(n){t.activationEvent=n},i.prototype.setAuthorId=function(n){t.authorId=n},i.prototype.setControlName=function(n){t.controlName=n},i.prototype.setLocale=function(n){t.locale=n},i.prototype.setIsSideBarHeaderDisabled=function(n){t.IsSideBarHeaderDisabled=n},i.prototype.setIsSideBarTitleDisabled=function(n){t.IsSideBarTitleDisabled=n},i.prototype.setIsSideBarFooterDisabled=function(n){t.IsSideBarFooterDisabled=n},i.prototype.setIsFooterSectionAvailable=function(n){t.IsFooterSectionAvailable=n},i.prototype.setIsLastSectionPinnedtoFooter=function(n){t.IsLastSectionPinnedtoFooter=n},i.prototype.setIsSideBarNextPrevDisabled=function(n){t.IsSideBarNextPrevDisabled=n},i.prototype.setContent=function(r){var h,c,e,f,l,u,o;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:setContent START");try{r=r.replace(/\/\/ <!\[CDATA\[/g,"").replace(/\/\/ \]\]>/g,"");this.answerPanelElement.marsSetInnerHTML(this.answerPanelElement[0],r);var a=this,v=function(){a.popOut()},s=n.Client.Loader.appContext.ClientType;if(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Answer panel launched for client type: "+s),this.searchBox=this.answerPanelElement.find("#txtSearch"),s===this.mobileClient&&this.searchBox.removeClass("mars-float-right"),this.answerpanelContent=this.answerPanelElement.find("#contentAreasContainer"),this.answerpanelContent.height(n.AnswerPanelConstants.answerPanelDefaultHeight),this.answerpanelContent.after(n.AnswerPanelConstants.answerpanelPagination),this.pagination(n.AnswerPanelConstants.answerPanelDefaultHeight,"",this.answerpanelContent),this.footerElement=this.answerPanelElement.find("#footer"),this.footerElement.addClass("paddingthree"),this.footerElement.marsAppend(this.footerElement,n.AnswerPanelConstants.feedbackSearchContent),this.feedbackOverlay.find("#feedbackBox").length==0&&this.feedbackOverlay.marsAppend(this.feedbackOverlay,n.AnswerPanelConstants.feedbackBoxContent),this.searchbarElement=n.Client.Loader.$mars("#searchbar"),h=n.Client.Loader.$mars("#"+n.AnswerPanelConstants.feedbackOverlayDivId),this.feedBack(this.answerPanelElement,h),this.handleHomeIconEvents(this.answerPanelElement),c=n.Client.Utility.FFFUtility.isFeatureEnabled(n.Client.Utility.FFFUtility.LiveChatFeatureName),e=n.Client.Utility.FFFUtility.isFeatureEnabled(n.Client.Utility.FFFUtility.LiveChatv2FeatureName),n.Client.Loader.appContext.CurrentStage.toLowerCase()===n.AnswerPanelConstants.CurrentStage&&(e?this.attachTestDriveChatScriptsV2():this.attachTestDriveChatScripts()),i.attachEventsToSidebar(),n.Client.Utility.Util.validateWhiteListLCID())if(c)if(f=n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).find('[data-name="mars-liveChatLink"]'),i.replaceCallMeLiveChatIcons(n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId),"sidebarFooterChat","sidebarFooterCallMe"),e){this.attachTestDriveChatScriptsV2();l=this;f.off("click").on("click",function(){l.hide();var t=n.$mars(".LPMcontainer div");t.trigger("click")})}else if(this.attachTestDriveChatScripts(),n.Client.Loader.appContext.isISHPage()||n.Client.Loader.appContext.ClientType!=="Mobile")f.on("click keyup",function(t){(t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!0))&&window.lpMTagConfig.dynButton0.onlineAction()});else f.off("click").on("click",function(){var t=window.lpMTagConfig.dynButton0.getActionURL("Available");n.Client.Loader.appContext.openExternalUrl(t)});else i.removeLiveChat(n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId));u="calc( 0px ";t.IsSideBarHeaderDisabled&&(n.Client.Loader.$mars("#answerPanel").find(".lpath-ap-search-container").length>0?(u=u+" + "+n.Client.Loader.$mars("#answerPanel").find(".lpath-ap-search-container").css("height"),n.Client.Loader.$mars("#answerPanel").find(".lpath-ap-search-container").css("display","none")):n.Client.Loader.$mars("#answerPanel").find(".lpath-search-subcontainer").length>0&&(u=u+" + "+n.Client.Loader.$mars("#answerPanel").find(".lpath-search-subcontainer").css("height"),n.Client.Loader.$mars("#answerPanel").find(".lpath-search-subcontainer").css("display","none")));t.IsSideBarTitleDisabled&&(n.Client.Loader.$mars("#answerPanel").find(".mars-ap-title").length>0?(u=u+" + "+n.Client.Loader.$mars("#answerPanel").find(".mars-ap-title").css("height"),n.Client.Loader.$mars("#answerPanel").find(".mars-ap-title").css("display","none")):n.Client.Loader.$mars("#answerPanel").find(".lpath-header-sidebar-container").length>0&&(u=u+" + "+n.Client.Loader.$mars("#answerPanel").find(".lpath-header-sidebar-container").css("height"),n.Client.Loader.$mars("#answerPanel").find(".lpath-header-sidebar-container").css("display","none")));t.IsSideBarFooterDisabled&&(n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).find("#lPathFooterSectionHolder").length>0?(u=u+" + "+n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).find("#lPathFooterSectionHolder").css("height"),n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).find("#lPathFooterSectionHolder").css("display","none")):n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).find("#footer").length>0&&(u=u+" + "+n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).find("#footer").css("height"),n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).find("#footer").css("display","none")));u!="calc( 0px "&&n.Client.Loader.$mars("#lPathSidebarContainer").find("#lPathSidebarSectionContainer").length>0&&(o=n.Client.Loader.$mars("#lPathSidebarContainer").find("#lPathSidebarSectionContainer").css("height"),o&&(u=u+" + "+o),n.Client.Loader.$mars("#lPathSidebarContainer").find("#lPathSidebarSectionContainer").attr("style","height:"+u+");"))}catch(y){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error exception occurs in AnswerPanel:setContent")}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:setContent END")},i.prototype.trackVideoRenderedActivity=function(){var i=n.Client.Loader.$mars("#lPathSidebarContainer");i.find("div[id='marsVideoDiv']").each(function(){var r=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.video),f=n.Client.Loader.appContext.Util.getPublishGroupDetails(t.publishGroupId,"Name"),i,u;r.SetUserActivityInfo(n.Client.Loader.appContext.userId,t.controlId,t.publishGroupId,f,t.authoringGroupId,t.parentActivityId,t.authorId,t.controlName);i="";n.Client.Loader.$mars(this).find("[data-name='mars-videoPreview']").length>0?i=n.Client.Loader.$mars(this).find("[data-name='mars-videoPreview']").attr("src"):n.Client.Loader.$mars(this).find("#mars-fwlinkVideoHolder").length>0&&(i=n.Client.Loader.$mars(this).find("#mars-fwlinkVideoHolder").data("videosource"));u=[window._MicrosoftMars.Client.Telemetry.ActivityName.answerpanel,i,n.Client.Loader.appContext.CurrentStage,n.Client.Loader.appContext.UserRoleNames];r.SetActivityData(u);r.FinishActivity(t.telemetry.EndAction.rendered)})},i.prototype.handleHighContrastModeForExpandAndCollapseIcons=function(){var t,i;n.$mars("#marsIFrame").css("background-image")==="none"&&(t=!1,n.$mars("body").css("background-color")==="rgb(255, 255, 255)"&&(t=!0),i=n.Client.Loader.$mars("#answerPanel").find(".lpath-toggleImage"),i.each(function(){var i=this,r,u;i.src.indexOf("expand")!=-1?(r=t?n.Client.Loader.marsImageMapping.ImagePath.expandedIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.expandedIconInHCB,i.src=n.Client.Loader.serverUrl+"images/"+r):(u=t?n.Client.Loader.marsImageMapping.ImagePath.collapsedIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.collapsedIconInHCB,i.src=n.Client.Loader.serverUrl+"images/"+u)}))},i.prototype.handleHighContrastModeForFooterIcons=function(t,i,r){var s=r?n.Client.Loader.marsImageMapping.ImagePath.sidebarContextHomeIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.sidebarContextHomeIconInHCB,u,f,e,o;t.find("#"+n.AnswerPanelConstants.sidebarHomeIconId).attr("src",n.Client.Loader.serverUrl+"images/"+s);u=r?n.Client.Loader.marsImageMapping.ImagePath.sidebarSmileyIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.sidebarSmileyIconInHCB;t.find("#"+n.AnswerPanelConstants.feedbackButtonId).attr("src",n.Client.Loader.serverUrl+"images/"+u);f=r?n.Client.Loader.marsImageMapping.ImagePath.smileyIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.smileyIconInHCB;t.find("#"+n.AnswerPanelConstants.feedbackSmileDivId).find("img").attr("src",n.Client.Loader.serverUrl+"images/"+f);e=r?n.Client.Loader.marsImageMapping.ImagePath.frownyIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.frownyIconInHCB;t.find("#"+n.AnswerPanelConstants.feedbackFrownDivId).find("img").attr("src",n.Client.Loader.serverUrl+"images/"+e);o=r?n.Client.Loader.marsImageMapping.ImagePath.closeIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.closeIconInHighContrast;i.find("#closeFeedbackBox").attr("src",n.Client.Loader.serverUrl+"images/"+o)},i.prototype.checkForHighContrastMode=function(t){var u,r,f,e,i;return(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:checkForHighContrastMode START"),u=n.Client.Loader.$mars("#answerPanel").find("#closeButton"),n.$mars("#marsIFrame").css("background-image")==="none")?(r=!1,n.$mars(".lpath-preview-answerPanel-holder").addClass("mars_highcontrast"),n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).hasClass("lpath-highcontrast")||n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).addClass("lpath-highcontrast"),n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).hasClass("lpath-overlay-initial-highcontrast")||n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).addClass("lpath-overlay-initial-highcontrast"),n.$mars("body").css("background-color")==="rgb(255, 255, 255)"&&(r=!0,n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).hasClass("lpath_highcontrast_white")||n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).addClass("lpath_highcontrast_white")),u&&(f=r?n.Client.Loader.marsImageMapping.ImagePath.closeIconInHCW:n.Client.Loader.marsImageMapping.ImagePath.closeIconInHighContrast,u.attr("src",n.Client.Loader.serverUrl+"images/"+f)),e=n.Client.Loader.$mars("#"+n.AnswerPanelConstants.feedbackOverlayDivId),this.handleHighContrastModeForFooterIcons(this.answerPanelElement,e,r),window._MicrosoftMars.AnswerPanel.getInstance().handleHighContrastModeForExpandAndCollapseIcons(),i=n.Client.Loader.appContext.Util.getHelpIcon(),this.isISHPage?i.find("#helpHighContrast").length===0&&(i=i.append("<img id='helpHighContrast' />"),i.find("#helpHighContrast").css("visibility","visible"),i.find("#helpHighContrast").css({position:"absolute",top:"0px",left:"0px"})):(window._MicrosoftMars.Client.Loader.appContext.isRTL()&&i.addClass("lpath-rtl-helpIconInHighContrast"),i.addClass("lpath-helpIcon"),i.parent().parent().addClass("lpath-helpIconInHighContrast")),t?this.isISHPage?i.find("#helpHighContrast").attr("src",n.Client.Loader.serverUrl+this.notificationBadge.helpIconStates[Microsoft.Mars.Client.Runtime.HelpIconStates.HiContrastOnState]):(i.attr("src",n.Client.Loader.serverUrl+this.notificationBadge.helpIconStates[Microsoft.Mars.Client.Runtime.HelpIconStates.HiContrastOnState]),n.Client.Loader.appContext.isArabicEnv()&&i.addClass("lpath-helpIconForArabic")):this.isISHPage?i.find("#helpHighContrast").attr("src",n.Client.Loader.serverUrl+this.notificationBadge.helpIconStates[Microsoft.Mars.Client.Runtime.HelpIconStates.HiContrastOffState]):(i.attr("src",n.Client.Loader.serverUrl+this.notificationBadge.helpIconStates[Microsoft.Mars.Client.Runtime.HelpIconStates.HiContrastOffState]),n.Client.Loader.appContext.isArabicEnv()&&i.addClass("lpath-helpIconForArabic")),!0):(n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).hasClass("mars_highcontrast")&&n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).RemoveClass("mars_highcontrast"),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:checkForHighContrastMode END"),!1)},i.prototype.attachTestDriveChatScripts=function(){var t=window.lpTag,r="DYNAMICS_CRM-LEADGEN",f=new n.Client.Loader.SearchAnswerPanelApi,i=f.getMarket(),u="lpChatButton",e="chat-"+r+"-"+i.toUpperCase()+"-"+u+"_"+i.replace("-","").toLowerCase();t!==undefined&&t.taglets&&t.taglets.lp_ajax.newPage([{scope:"page",name:"unit",value:r},{scope:"session",name:"language",value:i},{scope:"session",name:"campaign",value:"crmtestdrive"}],{name:e,pid:u})},i.prototype.attachTestDriveChatScriptsV2=function(){window.lpTag&&window.lpTag.sdes&&window.lpTag.sdes.push({type:"lead",lead:{topic:"Trial"}})},i.prototype.handleHomeIconEvents=function(t,i){var r=function(){var t=n.AnswerPanel.getInstance();t.hide(null,null,null,!0);setTimeout(function(){n.Client.Loader.contextHomeSidebar&&n.Client.Loader.contextHomeSidebar.length>0&&(Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher.loadAnswerPanel(n.Client.Loader.contextHomeSidebar[0]),t.show(0))},n.AnswerPanelConstants.animationSpeed+100)};this.homeElement=t.find("#home-icon");this.homeElement.off("click keydown").on("click keydown",function(t){(t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!0))&&(i&&i(),r())})},i.prototype.feedBack=function(i,r){var s,l;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:feedBack START");try{var u=this,f=i.is("#"+n.InAppSupportConstants.supportSidebarPanelId)?n.InAppSupportConstants.supportPrefix:"",o=i.find("#"+f+"feedback"),h=r.find("#feedbackDescription"),e=r.find("#feedbackBox"),a=r.find("#feedbackHeader"),y=i.find("#"+f+"smileHeaderText"),p=i.find("#"+f+"frownHeaderText"),w=i.find("#"+f+"smilePlaceholderText"),b=i.find("#"+f+"frownPlaceholderText"),v=r.find("#feedbackSend"),c="";u.feedbackButtonElement=i.find("#"+f+"feedbackBtn");s=function(n){if(n){var t=c==="frown"?"last":"first";o.show("fast",function(){i.find(".mars-feedback-options:"+t).first().focus()})}else o.hide("fast",function(){u.feedbackButtonElement.focus();u.feedbackOverlay.hide();u.pagebodyContent.setAttribute("aria-hidden","false")})};i.off("click").on("click",function(n){if(i.find(n.target).first().closest("#"+f+"feedbackBtn").length!==0||i.find(n.target).first().closest("#"+f+"feedback").length!==0)return!1;o.hide()});u.feedbackButtonElement.off("click keyup").on("click keyup",function(t){(t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!0))&&(c="",s(!0))});l=function(t,f,c){var y=r.find(".mars-feedback-privacy").first(),p=r.find("#closeFeedbackBox"),l;o.hide();h.val("");a.text(t);a.attr("title",t);h.attr("placeholder",f);h.attr("aria-label",f);u.feedbackOverlay.show();u.pagebodyContent.setAttribute("aria-hidden","true");e.css("width",i.outerWidth());e.fadeIn("slow",function(){h.focus()});v.attr("value",c);l=n.$mars(".mars-feedback-footer #chatlinkText");l.off("click").on("click",function(){return window.lpMTagConfig.dynButton0.onlineAction(),!1});n.Client.Loader.appContext.CurrentStage.toLowerCase()!==n.AnswerPanelConstants.CurrentStage?l.css("visibility","hidden"):l.css("visibility","visible");y.off("click keydown").on("click keydown",function(t){if(t.type==="click"||t.keyCode===13)if(n.Client.Loader.appContext.clientType!=="Mobile"||n.Client.Loader.appContext.isISHPage())window.open(n.AnswerPanelConstants.feedbackprivacyUrl+"&ClcId="+n.Client.Loader.appContext.getOrgLcid().toString(16),"_blank");else n.Client.Loader.appContext.openExternalUrl(n.AnswerPanelConstants.feedbackprivacyUrl+"&ClcId="+n.Client.Loader.appContext.getOrgLcid().toString(16),{openInNewWindow:!0});if(t.keyCode===9)return t.shiftKey?v.focus():p.focus(),!1});p.off("click keydown").on("click keydown",function(n){if(n.type==="click"||n.keyCode===13)e.fadeOut("slow",function(){s(!1)}),y.off("click keydown");else if(n.keyCode===9&&n.shiftKey)return y.focus(),!1})};u.feedbackSmileyElement=i.find("#"+f+"feedbackSmile");u.feedbackFrownElement=i.find("#"+f+"feedbackFrown");u.contactSupportElement=i.find("#contactSupport");u.openSupportPortalElement=i.find("#openSupportPortal");u.feedbackSmileyElement.off("click keydown").on("click keydown",function(t){if(t.type==="click"||t.keyCode===13)l(y.text(),w.text(),n.Client.Loader.marsLocale.sendFeedbackText),c="smiley";else if((t.keyCode!==n.Client.Utility.KeyCodeEnum.TabKey||t.shiftKey)&&t.keyCode!==n.Client.Utility.KeyCodeEnum.DownArrowKey){if(t.keyCode===n.Client.Utility.KeyCodeEnum.TabKey&&t.shiftKey||t.keyCode===n.Client.Utility.KeyCodeEnum.UpArrowKey)return u.openSupportPortalElement&&u.openSupportPortalElement.length>0?u.openSupportPortalElement.focus():u.feedbackFrownElement.focus(),!1;if(t.keyCode===27)return s(!1),!1}else return u.feedbackFrownElement.focus(),!1});u.feedbackFrownElement.off("click keydown").on("click keydown",function(t){if(t.type==="click"||t.keyCode===13)l(p.text(),b.text(),n.Client.Loader.marsLocale.sendFeedbackText),c="frown";else if((t.keyCode!==n.Client.Utility.KeyCodeEnum.TabKey||t.shiftKey)&&t.keyCode!==n.Client.Utility.KeyCodeEnum.DownArrowKey){if(t.keyCode===n.Client.Utility.KeyCodeEnum.TabKey&&t.shiftKey||t.keyCode===n.Client.Utility.KeyCodeEnum.UpArrowKey)return u.feedbackSmileyElement.focus(),!1;if(t.keyCode===27)return s(!1),!1}else return u.contactSupportElement&&u.contactSupportElement.length>0?u.contactSupportElement.focus():u.feedbackSmileyElement.focus(),!1});u.contactSupportElement.off("click keydown").on("click keydown",function(t){if(t.type==="click"||t.keyCode===13){var i=Microsoft.Mars.Client.Runtime.InAppSupport.SupportSidebar.getInstance();i.openSupportSidebar()}else{if(t.keyCode===n.Client.Utility.KeyCodeEnum.TabKey&&t.shiftKey||t.keyCode===n.Client.Utility.KeyCodeEnum.UpArrowKey)return u.feedbackFrownElement.focus(),!1;if((t.keyCode!==n.Client.Utility.KeyCodeEnum.TabKey||t.shiftKey)&&t.keyCode!==n.Client.Utility.KeyCodeEnum.DownArrowKey){if(t.keyCode===27)return s(!1),!1}else return u.openSupportPortalElement.focus(),!1}});u.openSupportPortalElement.off("click keydown").on("click keydown",function(t){var r,i,f;if(t.type==="click"||t.keyCode===n.Client.Utility.KeyCodeEnum.EnterKey||t.keyCode===n.Client.Utility.KeyCodeEnum.SpaceKey)return r=n.InAppSupportConfiguration.getInstance().getPortalUrl(),n.Client.InAppSupport.Util.openLinkInNewTab(r),i=Microsoft.Mars.Client.Runtime.InAppSupport.SupportSidebar.getInstance(),f=[i.formFactorName,i.pageUrl,i.pageType,"",(new Date).toString(),(new Date).toString(),i.orgId,i.crmVersion,i.clientType,i.userRole,"",""],i.logInAppSupportTelemetry("inAppSupportPortalLinkOpen",f,"complete"),!1;if(t.keyCode===n.Client.Utility.KeyCodeEnum.TabKey&&t.shiftKey||t.keyCode===n.Client.Utility.KeyCodeEnum.UpArrowKey)return u.contactSupportElement.focus(),!1;if((t.keyCode!==n.Client.Utility.KeyCodeEnum.TabKey||t.shiftKey)&&t.keyCode!==n.Client.Utility.KeyCodeEnum.DownArrowKey){if(t.keyCode===27)return s(!1),!1}else return u.feedbackSmileyElement.focus(),!1});t.isRTL&&(o&&o.length>0&&(o.prop("style").removeProperty("right"),o.css("left","0")),e&&e.length>0&&(e.css("right","auto"),e.css("left","0")),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"RTL applied for Answer panel"));h.attr("maxlength",n.AnswerPanelConstants.feedbackCharacterLimit);r.find("#feedbackSend").off("click keydown").on("click keydown",function(t){if(t.type==="click"||t.keyCode===13)u.sendFeedback(i,r,c);else if(t.keyCode===9)return t.shiftKey?(h.focus(),!1):(r.find(".mars-feedback-privacy").first().focus(),!1);n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Feedback has been sent.")});e.off("keydown").on("keydown",function(n){if(n.keyCode===27)return e.fadeOut("slow",function(){s(!1)}),!1})}catch(k){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error exception occurs in AnswerPanel:feedBack")}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:feedBack END")},i.prototype.pagination=function(t,i,r){var u=this,f;this.hiddenContent=n.Client.Loader.$mars().add("<div id='hiddendiv' style='visibility:hidden'>"+i+"<div>");this.pagebodyContent.appendChild(this.hiddenContent[0]);this.hiddenContent.width(n.AnswerPanelConstants.defaultWidth);f=this.hiddenContent;f&&(this.previousButton=n.Client.Loader.$mars("#prev"),this.nextButton=n.Client.Loader.$mars("#next"),this.initializePagination(f,t,r),this.previousButton.click(function(){u.showPage(u.currentPage)}),this.nextButton.click(function(){u.showPage(u.currentPage+2)}))},i.prototype.initializePagination=function(t,i,r){var u=[],f=0,e=this;t.children().each(function(n,t){f+t.clientHeight>=i&&(e.fullPages.push(u),u=[],f=0);f+=t.clientHeight;u.push(t)});f>0&&this.fullPages.push(u);n.Client.Loader.$mars(this.fullPages).wrap("<div><\/div>");r.append(t.children());r.children().css(n.AnswerPanelConstants.contentPageCSS);r.children().hide();this.paginatePages=r.children();this.hiddenContent.remove();this.showPage(this.currentPage,!0)},i.prototype.showPage=function(t,i){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:showPage START");var r=t-1;this.paginatePages[r]&&(i||n.Client.Loader.$mars(this.paginatePages[this.currentPage]).fadeOut(0),this.currentPage=r,n.Client.Loader.$mars(this.paginatePages[this.currentPage]).fadeIn(n.AnswerPanelConstants.animationSpeed));this.fullPages.length<=0?(this.prevnextDiv=n.Client.Loader.$mars("#prevnext"),this.prevnextDiv.hide()):(this.currentPage<=0?this.previousButton.prop("disabled",!0):this.previousButton.prop("disabled",!1),this.currentPage>=this.fullPages.length-1?this.nextButton.prop("disabled",!0):this.nextButton.prop("disabled",!1));n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:showPage END")},i.prototype.expandAnswerPanel=function(){switch(t.pages){case 1:t.pages=n.AnswerPanelConstants.twoXPageSize;this.setWidth(n.AnswerPanelConstants.twoXPageSize,!0);break;case 2:t.pages=n.AnswerPanelConstants.threeXPageSize;this.setWidth(n.AnswerPanelConstants.threeXPageSize,!0)}},i.prototype.collapseAnswerPanel=function(){switch(t.pages){case 3:t.pages=n.AnswerPanelConstants.twoXPageSize;this.setWidth(n.AnswerPanelConstants.twoXPageSize,!0);break;case 2:t.pages=n.AnswerPanelConstants.oneXPageSize;this.setWidth(n.AnswerPanelConstants.oneXPageSize,!0)}},i.prototype.setWidth=function(i,r,u){if(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:setWidth START"),i<1||i%1!=0){console.log("Error:AnswerPanel.setWidth Accepts an integer");return}this.isAnswerPanelVisible=!1;t.width=u?i*n.AnswerPanelConstants.defaultBlankWidth:i*n.AnswerPanelConstants.defaultWidth;t.displacement=t.width+n.AnswerPanelConstants.shadowWidth;r&&(t.displacement=0);t.isRTL?(this.answerPanelElement.css({width:t.width+"px",left:"-"+t.displacement+"px"}),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"AnswerPanel launch for RTL")):(this.answerPanelElement.css({width:t.width+"px",right:"-"+t.displacement+"px"}),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"AnswerPanel launch for NON-RTL"));n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:setWidth END")},i.prototype.removeAnswerPanelOverlayClickHandler=function(){n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).off("click #mars")},i.prototype.addAnswerPanelOverlayClickHandler=function(){var t=this,i=function(){t&&(n.propertyHomeTabContainer&&n.propertyHomeTabContainer.is(":visible")&&n.propertyHomeTabContainer.hide(),t.hide())};n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).off("click #mars").on("click #mars",i)},i.prototype.show=function(){var u=this,f,r,i,e,o,s,h,c,l,a;(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:show START"),Microsoft.Mars.Client.Runtime.Controls.ScenarioManager.isBubbleVisible())||(this.isAnswerPanelVisible=!0,f=t.isRTL?{left:0}:{right:0},n.Client.Loader.appContext.util.showOverlay(),n.Client.Loader.appContext.util.showCustomizationContainer(),this.answerPanelElement.css(f),n.Client.Loader.appContext.setAriaHiddenForElementsExceptMars(!0),n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).attr("aria-hidden",!1),this.answerPanelElement.css("visibility","visible"),n.AnswerPanel.setAnswerPanelHeader("lPathSidebarContainer"),n.Client.Loader.appContext.Util.handleAnswerPanelScroll(),n.Client.Loader.$mars(".mars-preview-section-texttitle img").each(function(){var t=n.Client.Loader.$mars(this);(t.attr("title")===undefined||t.attr("title")==="")&&t.attr("alt")!==undefined&&t.attr("alt")!==""&&t.attr("title",t.attr("alt"))}),this.changeHelpIconStateOnSidebarToggle("white",n.Client.Loader.marsImageMapping.ImagePath.marshelpIconSidebarLoadCompleteRTL,n.Client.Loader.marsImageMapping.ImagePath.marshelpIconSidebarLoadComplete),r=n.Client.Loader.$mars("#feedback"),i=n.Client.Loader.$mars("#feedbackBox"),i.length==0&&this.feedbackOverlay.marsAppend(this.feedbackOverlay,n.AnswerPanelConstants.feedbackBoxContent),e=n.Client.Loader.$mars("#"+n.AnswerPanelConstants.feedbackOverlayDivId),this.feedBack(this.answerPanelElement,e),this.handleHomeIconEvents(this.answerPanelElement),i&&i.is(":visible")&&r&&r.is(":visible")&&(i.show(),r.show()),o=this,this.addAnswerPanelOverlayClickHandler(),s=n.Client.Loader.appContext,h=n.Client.Loader.appContext.getPageType(),n.answerPanelActivityEvent=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.answerpanel),c=n.Client.Loader.appContext.Util.getPublishGroupDetails(t.publishGroupId,"Name"),n.answerPanelActivityEvent.SetUserActivityInfo(s.userId,t.controlId,t.publishGroupId,c,t.authoringGroupId,t.parentActivityId,t.authorId,t.controlName),l=["","",h,null,t.activationEvent,t.version],n.answerPanelActivityEvent.SetActivityData(l),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:show END"),a=n.Client.Loader.currentInstance,n.Client.Loader.$mars.when(a.isDesignerEnabledForEnvironment()).done(function(t){t?n.Client.Loader.designerScriptsDownloaded&&setTimeout(function(){o.attachPropertytab()},1200):u.searchBox&&u.searchBox.focus()}),this.keyBoardHandling(),n.Client.Loader.$mars("#marsSearchImage").find("svg").attr("focusable","false"),Microsoft.Mars.Client.Runtime.Controls.ScenarioUtil.checkForScenariosComplete(),this.replaceExistingGTIcon(),window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg"))},i.prototype.hideAnswerPanelContainer=function(){var i=this,n;this.isAnswerPanelVisible=!1;n=t.isRTL?{left:"-"+t.displacement+"px"}:{right:"-"+t.displacement+"px"};this.answerPanelElement.off("click");i.answerPanelElement.css(n)},i.prototype.hide=function(i,r,u,f){var e,h,c,l,a,s,o,v;if(r===void 0&&(r=!1),u===void 0&&(u=undefined),f===void 0&&(f=!1),n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:hide START"),e=window.Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher,h=n.Client.Loader.appContext.getPageType(),i&&i.srcElement&&i.srcElement.getAttribute&&i.srcElement.getAttribute("id")==="closeButton"&&(c=["","",h,window._MicrosoftMars.Client.Telemetry.UserClicks.x,t.activationEvent,t.version],n.answerPanelActivityEvent.SetActivityData(c)),e.GTParentPanel=null,this.isAnswerPanelVisible){n.Client.Loader.$mars("#feedbackBox")&&n.Client.Loader.$mars("#feedbackBox").is(":visible")&&n.Client.Loader.$mars("#feedback")&&n.Client.Loader.$mars("#feedback").is(":visible")&&(n.Client.Loader.$mars("#feedbackBox").hide(),n.Client.Loader.$mars("#feedback").hide());l=u!=undefined&&!u;a=!r||l;a&&(n.Client.Loader.appContext.setAriaHiddenForElementsExceptMars(!1),n.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).attr("aria-hidden",!0),this.answerPanelElement.css("visibility","hidden"),this.resetVideoSources());Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher.isScenarioTriggered||r||(f?n.$mars("#sidebarEmptyDiv").focus():(s=n.Client.Loader.appContext.Util.getHelpIcon(),s&&(o=s.parents("[tabIndex=0]"),o&&o.length>0&&o[0].focus())));this.hideAnswerPanelContainer();n.Client.Loader.$mars("#mars-launcher-options")&&n.Client.Loader.$mars("#mars-launcher-options").css("display","none");n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId)&&n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).off("click #mars");v=Microsoft.Mars.Client.Runtime.Controls.ScenarioUtil;v.lpathRuntimeOverlayClickAttached=!1;n.Client.Loader.appContext.util.hideOverlay();Microsoft.Mars.Client.Runtime.Controls.UserProgress.ANSWERPANELNOTSTARTED=!0;try{window.playerObj.pauseVideo()}catch(y){}this.changeHelpIconStateOnSidebarToggle("transparent",n.Client.Loader.marsImageMapping.ImagePath.marshelpIconLoadingCompletedRTL,n.Client.Loader.marsImageMapping.ImagePath.marshelpIconLoadingCompleted);r||n.Client.Loader.appContext.util.hideCustomizationContainer();n.answerPanelActivityEvent&&(n.answerPanelActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete),n.answerPanelActivityEvent=null);e.isLaunchedControl?(e.isLaunchedControl=!1,e.loadAnswerPanel(e.CurrentPagePanel)):Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher.isScenarioTriggered=!1;n.propertyHomeTabContainer&&n.propertyHomeTabContainer.hide();this.feedbackOverlay.html("");n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:hide END")}},i.prototype.togglePanel=function(){this.isAnswerPanelVisible?this.hide():this.show(0)},i.prototype.changeHelpIconStateOnSidebarToggle=function(i,r,u){var o,f,s,h,e,c;this.checkForHighContrastMode(!0)&&n.Client.Loader.MarsLoader.isUCIShim()||(o=this,s=n.Client.Loader.appContext.Util.getHelpIcon(),s.length>0&&(h=s.parent(),e=h.find(".navTabHelpImageWeb"),f=n.Client.Loader.appContext.Util.getHelpIconParent(),c=n.Client.Utility.AppContextFactory.isUCIClient(),f&&e&&(f.css({"background-color":i}),c?f&&f.parent().length>0&&f.parent().css({"background-color":i}):this.isAnswerPanelVisible||f.hover(function(){o.isAnswerPanelVisible||n.$mars(this).css({"background-color":"rgba(255,255,255,0.4)"})},function(){o.isAnswerPanelVisible||n.$mars(this).css({"background-color":i})}),t.isRTL&&!n.Client.Loader.appContext.isHebrewEnv()?e.attr("src",n.Client.Loader.serverUrl+"images/"+r):e.attr("src",n.Client.Loader.serverUrl+"images/"+u))))},i.prototype.sendFeedback=function(i,r,u){var s=n.Client.Loader.appContext.getPageType(),h=window._MicrosoftMars.Client.Telemetry.Guid.newGuid(),f=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.feedback),c=n.Client.Loader.appContext.Util.getPublishGroupDetails(t.publishGroupId,"Name"),o,e;f.SetUserActivityInfo(n.Client.Loader.appContext.userId,h,t.publishGroupId,c,t.authoringGroupId,t.controlId,t.authorId,u);o=[u,r.find("#feedbackDescription").val(),s];f.SetActivityData(o);f.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete);e=i.is("#"+n.InAppSupportConstants.supportSidebarPanelId)?n.InAppSupportConstants.supportPrefix:"";r.find("#feedbackBox").fadeOut("slow",function(){i.find("#"+e+"feedback").hide("fast",function(){i.find("#"+e+"feedbackBtn").focus()})});this.feedbackOverlay.hide();n.Client.Loader.currentInstance.UpdateMarsAriaLiveContent(n.Client.Loader.marsLocale.feedbackSubmitted,n.Client.Utility.AriaLiveType.assertive)},i.prototype.searchHandler=function(i,r,u){n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:searchHandler START");this.domHtml=document.createElement("div");n.Client.Loader.$mars(this.domHtml).marsSetInnerHTML(this.domHtml,n.SearchUtil.getSearchHtml(i,t.isRTL));this.setContent(this.domHtml.innerHTML.toString());n.searchActivityEvent=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.search);var f=n.Client.Loader.appContext.Util.getPublishGroupDetails(t.publishGroupId,"Name");n.searchActivityEvent.SetUserActivityInfo(n.Client.Loader.appContext.userId,"",t.publishGroupId,f,t.authoringGroupId,t.controlId,t.authorId,"search");n.SearchUtil.search(i,u);this.searchBox=this.answerPanelElement.find("#txtSearch");this.searchBox.val(r);window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("input.lpath-svg");n.Client.Loader.$mars("#marsSearchImage").find("svg").attr("focusable","false");this.keyBoardHandling();window._MicrosoftMars.AnswerPanel.getInstance().checkForHighContrastMode();n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:searchHandler END")},i.prototype.injectSearchElement=function(i,r,u){var y,v,f,e,l,o,c,k,s;n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:injectSearchElement START");var w=n.SearchUtil.getIndexForSearchSource(i),h=n.Client.Loader.$mars("#lpath_searchContentContainer_"+w),a=h.find("#lpath_searchContent");if(w!==n.SearchUtil.UNDEFINED){if(r.length===0){if(y=h.find(".mars-search-no-results"),y&&y.length>0)return;a.empty();v=document.createElement("div");v.style.display="block";v.innerHTML='<label class="lpath-search-content-div lpath-search-no-results">'+n.Client.Loader.marsLocale.noResults+"<\/label>";h.append(v);i===n.SearchUtil.MARS&&(this.noResultsInSearchFlag=!0);return}if(i===n.SearchUtil.MARS){for(a.empty(),l=!1,o=0;o<r.length;o++){o===n.SearchUtil.MAX_SEARCH_RESULTS&&(l=!0);f=r[o];s=document.createElement("div");s.style.display="block";l&&(s.className="seeMoreFlag",s.style.display="none");s.innerHTML=f.ControlType==="StepThrough"?'<div role="link" tabindex="0" id="mars-results-'+o+'" class="lpath-search-content-div lpath-search-content-title mars-search-content-results lpath-search-content" aria-label="'+n.Client.Loader.marsLocale.headerGuidedTaskText+" "+(f.Title!=null&&f.Title!==""?n.Client.Utility.Util.resolveTitle(f.Title):f.ControlName)+'" title="'+(f.Title!=null&&f.Title!==""?n.Client.Utility.Util.resolveTitle(f.Title):f.ControlName)+'" ><img class ="mars-guidedtask-icon lpath-svg lpath-svg-search-content" src="'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.searchGuidedTaskIcon+'" /><div class="lpath-ellipsis mars-search-content-label">'+(f.Title!=null&&f.Title!==""?n.Client.Utility.Util.resolveTitle(f.Title):f.ControlName)+"<\/div><\/div>":'<div role="link" tabindex="0" id="mars-results-'+o+'" class="lpath-search-content-div lpath-search-content-title lpath-ellipsis lpath-search-content" aria-label="'+n.Client.Loader.marsLocale.headerAnswerPanelText+" "+(f.Title!=null&&f.Title!==""?n.Client.Utility.Util.resolveTitle(f.Title):f.ControlName)+'" title="'+(f.Title!=null&&f.Title!==""?n.Client.Utility.Util.resolveTitle(f.Title):f.ControlName)+'" >'+(f.Title!=null&&f.Title!==""?n.Client.Utility.Util.resolveTitle(f.Title):f.ControlName)+"<\/div>";n.Client.Loader.$mars(a).marsAppend(a,s.outerHTML);this.noResultsInSearchFlag=!1;h.find("#mars-results-"+o).on("click keyup",{result:f},function(t){var i,f;if((t.type==="click"||t.keyCode===13)&&(i=Microsoft.Mars.Client.Runtime.Controls.ScenarioUtil,t.data!=null&&t.data.result!=null)){var e=n.Client.Loader.appContext,o=window._MicrosoftMars.Client.Telemetry.Guid.newGuid(),r=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.linkClick);r.SetUserActivityInfo(e.UserId,"","","","",o,"","");f=["Search",""];i.launchLinkedControl(t.data.result.Id,!0,t.data.result.AuthoringId,r,f,u)}})}if(l){e=document.createElement("div");t.isRTL?e.style.textAlign="left":(e.style.display="block",e.style.textAlign="right");e.className="lpath-search-content-seemore-container";e.innerHTML='<a role="button" tabindex="0" class="lpath-search-content-seemore lpath-search-content-title">'+n.Client.Loader.marsLocale.more+"<\/a>";h.append(e);c=h.find(".lpath-search-content-seemore");c.on("click keyup",function(t){(t.type==="click"||t.keyCode===13)&&(n.Client.Loader.$mars(".seeMoreFlag").css("display","block"),c.parent().parent().find(".seeMoreFlag :tabbable").first().focus(),c.css("display","none"))})}window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg");a.find("svg").attr("focusable",!1)}else{for(l=!1,o=0;o<r.length;o++){if(o===n.SearchUtil.MAX_SEARCH_RESULTS){if(l=!0,n.Client.Loader.appContext.clientType==="Web"){var b=h.find("#lpath_searchContent"),e=document.createElement("div"),p=document.createElement("div");e.style.display="block";l&&(p.className="seeMoreFlag",p.style.display="none");t.isRTL?e.style.textAlign="left":(e.style.display="block",e.style.textAlign="right");e.className="lpath-search-content-seemore-container";e.innerHTML='<a role="button" tabindex="0" class="lpath-search-content-seemore lpath-search-content-title">'+n.Client.Loader.marsLocale.more+"<\/a>";h.append(e);b.append(p);c=h.find(".lpath-search-content-seemore");k=this;c.on("click keyup",function(t){var u,f,e;if(t.type==="click"||t.keyCode===13){for(n.Client.Loader.$mars(".seeMoreFlag").css("display","block"),c.css("display","none"),u="",f=0;f<r.length;f++)u+='<div style="display: block;">',u+=n.SearchUtil.parseResultToHtml(r[f],i),u+="<\/div>";e=b.find(".seeMoreFlag");e.append(u);c.parent().parent().find(".seeMoreFlag :tabbable").first().focus();k.attachEventToAnchorTags();event.stopPropagation()}})}break}s=document.createElement("div");s.style.display="block";s.innerHTML=n.SearchUtil.parseResultToHtml(r[o],i);a.append(s)}this.attachSearchResultClickEvent(i,u)}n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:injectSearchElement END")}},i.prototype.attachSearchResultClickEvent=function(i,r){var u=n.SearchUtil.getIndexForSearchSource(i),f="#lpath_searchContentContainer_"+u,e={sectionClicked:n.SearchUtil.getTitleForSearchSource(i)};n.Client.Loader.$mars(f).on("click",".lpath-search-content-div a",e,function(i){var u=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.search),e=n.Client.Loader.appContext.Util.getPublishGroupDetails(t.publishGroupId,"Name"),f;u.SetUserActivityInfo(n.Client.Loader.appContext.userId,"",t.publishGroupId,e,t.authoringGroupId,t.controlId,t.authorId,"search");f=["","",n.Client.Loader.appContext.getPageType(),r,i.data.sectionClicked,i.currentTarget.href];u.SetActivityData(f);u.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.clicked)});this.attachEventToAnchorTags()},i.prototype.attachEventToAnchorTags=function(){n.Client.Loader.$mars(".lpath-search-content-header").off("click keydown").on("click keydown",function(t){var r,i;if(t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!1))return r=t.target,t.target!==t.currentTarget&&(r=t.currentTarget),i=r.getAttribute("href")!=null?r.getAttribute("href"):r.getAttribute("data-href"),i.indexOf("http")!=0&&(i="https:"+i),!n.Client.Loader.MarsLoader.isUCIShim()&&n.Client.Loader.appContext.clientType!=="Mobile"||n.Client.Loader.appContext.isISHPage()||n.Client.Loader.appContext.Util.isWindowsOs()?window.open(i,"_blank"):n.Client.Loader.appContext.openExternalUrl(i),t.preventDefault(),t.stopPropagation(),!1})},i.prototype.attachPropertytab=function(){if(this.isAnswerPanelVisible){var i=this,r=n.Client.Loader.currentInstance;n.Client.Loader.$mars.when(r.isDesignerEnabledForEnvironment()).done(function(u){var f,e;if(u){n.propertyHomeTabContainer==null&&n.Client.Loader.$mars('[name="lpath_propertytabHome_container"]').length==0&&(f='<div name="lpath_propertytabHome_container" class="lpath-runner lpath-propertyHomeTab" id="lPathPropertyHomeTab" tabindex="-1" role="region" aria-label="'+n.Client.Loader.marsLocale._10analyzeLPathAuthoring+'"><div name="lpath_propertyTab_containers" class="lpath_propertyTab_container" ><button name = "lpath_propertyTab_editControl" id="lpath_propertyTab_edit_builderControl" class="lpath-propertyTab_edit-builderControl lpath-propertyHomeTab_edit" aria-label="'+n.Client.Loader.marsLocale.editSidebar+'" aria-describedby = "lpath_propertyTab_edit_hiddenDiv" title = "'+n.Client.Loader.marsLocale.editSidebar+n.Client.Loader.marsLocale.EditCreateShortcut+'" ><img class ="lpath-svg lpath-svg-edit-template" src = "'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.runtimeSidebarEditHome+'" /><\/button><div id="lpath_propertyTab_edit_hiddenDiv" class="lpath-display-dynpropnone">'+n.Client.Loader.marsLocale.editSidebarVerbalString+' <\/div><\/div><div name ="lpath_propertyTab_containers" class="lpath_propertyTab_container" ><button name = "mars_propertyTab_libControl" id="lpath-propertyTab_lib-builderControl" class="lpath-propertyTab_lib-builderControl lpath-propertyHomeTab_lib" aria-label="'+n.Client.Loader.marsLocale.contentLibrary+'" aria-describedby = "lpath_propertyTab_lib_hiddenDiv" title = "'+n.Client.Loader.marsLocale.launchContentLibraryCaption+n.Client.Loader.marsLocale.contentLibraryShortcut+'" > <img class ="lpath-svg lpath-svg-content-library" src = "'+n.Client.Loader.serverUrl+"images/"+n.Client.Loader.marsImageMapping.ImagePath.runtimeSidebarLibrary+'" /><\/button><div id="lpath_propertyTab_lib_hiddenDiv" class="lpath-display-dynpropnone">'+n.Client.Loader.marsLocale.contentLibraryVerbalString+"<\/div><\/div><\/div>",n.Client.Loader.$mars("#"+n.AnswerPanelConstants.learningPathOverlayId).append(f),window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg"),n.propertyHomeTabContainer=n.Client.Loader.$mars('div[name="lpath_propertytabHome_container"]'));n.Client.Loader.$mars("#answerPanel").find(".mars-preview-answerPanel-holder").is(":visible")||JSON.parse(localStorage.allConfigurationKey).ProductOrgDetail.AuthoringId==t.authoringGroupId?n.Client.Loader.$mars("div > #lpath_propertyTab_edit_builderControl").parent().show():n.Client.Loader.$mars("div > #lpath_propertyTab_edit_builderControl").parent().hide();n.Client.Loader.$mars("#lpath_propertyTab_edit_builderControl").attr("title",Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher.answerPanelResult?n.Client.Loader.marsLocale.editSidebar+n.Client.Loader.marsLocale.EditCreateShortcut:n.Client.Loader.marsLocale.createSidebar+n.Client.Loader.marsLocale.EditCreateShortcut);n.Client.Loader.$mars("#lpath_propertyTab_edit_builderControl").attr("aria-label",Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher.answerPanelResult?n.Client.Loader.marsLocale.editSidebar:n.Client.Loader.marsLocale.createSidebar);Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher.answerPanelResult||n.Client.Loader.$mars("#lpath_propertyTab_edit_hiddenDiv").text("");window._MicrosoftMars.AnswerPanel.getInstance().checkForHighContrastMode();n.Client.Loader.$mars("#lpath_propertyTab_edit_builderControl").off("click").on("click",function(){return r.launchDesignerEditControl(),!1});n.Client.Loader.$mars("#lpath-propertyTab_lib-builderControl").off("click").click(function(){r.launchDesigner()});n.Client.Loader.$mars("#lPathPropertyHomeTab").find("#lpath_propertyTab_edit_builderControl").off("keydown").on("keydown",function(t){if(t.keyCode===9&&t.shiftKey)return n.Client.Loader.$mars("#answerPanel").find(".mars-preview-answerPanel-holder").is(":visible")?n.Client.Loader.$mars("#lPathPropertyHomeTab").find("#lpath-propertyTab_lib-builderControl").focus():i.lastFocusableElement.focus(),!1});n.Client.Loader.$mars("#lPathPropertyHomeTab").find("#lpath-propertyTab_lib-builderControl").off("keydown").on("keydown",function(t){if(t.keyCode===9&&!t.shiftKey)return n.Client.Loader.$mars("#answerPanel").find(".mars-preview-answerPanel-holder").is(":visible")?n.Client.Loader.$mars("#lPathPropertyHomeTab").find("#lpath_propertyTab_edit_builderControl").focus():i.firstFocusableElement.focus(),!1});e=n.Client.Loader.$mars("#answerPanel");i.setPropertyTabPosition(e);Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher.answerPanelResult?i.searchBox&&i.searchBox.focus():n.Client.Loader.$mars("#lpath_propertyTab_edit_builderControl").focus()}t.isRTL&&n.Client.Loader.$mars("#lPathPropertyHomeTab").addClass("lpath-rtl")})}},i.prototype.setPropertyTabPosition=function(t){var i=0,r=0;i=t.width()+1;i>1?(n.propertyHomeTabContainer.css("display","block"),r=t.offset().top+30,n.propertyHomeTabContainer.css({top:"0px"}),n.Client.Loader.appContext.isRTL()?n.propertyHomeTabContainer.css({top:r,left:i}):n.propertyHomeTabContainer.css({top:r,right:i})):n.propertyHomeTabContainer.css("display","none")},i.prototype.onSearchToggleClick=function(t){var e,f,r,h,c,l,a,o,v,i,u,s,y;if(n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:onSearchToggleClick START"),t=t||window.event,t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!0)){if(i=t.target||t.srcElement,i&&i.tagName.toLowerCase()==="div"&&(i=i.firstElementChild),i){if(e=window._MicrosoftMars.Client.Loader.serverUrl,f=i.parentElement,i.parentElement.tagName.toLowerCase()==="contentblock"&&(f=f.parentElement),f)for(r=f.nextElementSibling;r;)(i.src.indexOf("collapsed")!==-1&&r.style.display==="none"||i.src.indexOf("collapsed")===-1&&r.style.display==="block")&&n.Client.Loader.$mars(r).slideToggle(10),r=r.nextElementSibling;i.src.indexOf("collapsed")!==-1?(i.src=e+"images/"+n.Client.Loader.marsImageMapping.ImagePath.expandedIcon,h=n.Client.Loader.marsLocale.expanded,c=n.Client.Loader.marsLocale.sectionExpandedToolTip,i.alt=h,i.title=c,n.Client.Loader.$mars(i).parent().attr("aria-expanded","true")):(i.src=e+"images/"+n.Client.Loader.marsImageMapping.ImagePath.collapsedIcon,l=n.Client.Loader.marsLocale.collapsed,a=n.Client.Loader.marsLocale.sectionCollapsedToolTip,i.alt=l,i.title=a,n.Client.Loader.$mars(i).parent().attr("aria-expanded","false"))}t.stopPropagation()}else t.keyCode===n.Client.Utility.KeyCodeEnum.DownArrowKey?(i=t.target||t.srcElement,i&&(u=i.parentElement,o=u.nextElementSibling,o?n.Client.Loader.$mars(o).find(":tabbable").first().focus():(v=u.parentElement.firstElementChild,n.Client.Loader.$mars(v).find(":tabbable:first").focus()))):t.keyCode===n.Client.Utility.KeyCodeEnum.UpArrowKey&&(i=t.target||t.srcElement,i&&(u=i.parentElement,s=u.previousElementSibling,s?n.Client.Loader.$mars(s).find(":tabbable").first().focus():(y=u.parentElement.lastElementChild,n.Client.Loader.$mars(y).find(":tabbable:first").focus())));window._MicrosoftMars.AnswerPanel.getInstance().handleHighContrastModeForExpandAndCollapseIcons();n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanel:onSearchToggleClick END")},i.prototype.keyBoardHandling=function(){var i,r,u,f,e;t.IsSideBarHeaderDisabled?(this.firstFocusableElement=this.answerPanelElement.find(".lpath-default-sidebar :visible :tabbable:first"),this.firstFocusableElement.focus()):this.firstFocusableElement=this.answerPanelElement.find("#txtSearch");this.lastFocusableElement=this.answerPanelElement.find("#footer").find(":visible").length>0?this.answerPanelElement.find("#feedbackBtn"):this.answerPanelElement.find(":visible :tabbable:last");i=this;this.answerPanelElement.on("click",function(n){n.type==="click"&&(i.firstFocusableElement.focus(),n.stopPropagation())});this.searchBox=this.answerPanelElement.find("#txtSearch");r=function(){var t=n.Client.Loader.marsEncodeDecode.MarsHtmlEncode(n.Client.Loader.marsEncodeDecode.MarsHtmlDecode(n.Client.Loader.$mars.trim(i.searchBox.val())));n.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Search query text: "+t);t.length>0&&i.searchHandler(t,i.searchBox.val(),i.postSearchCallback)};n.Client.Loader.$mars("#answerPanel").find("#marsSearchImage").on("click keydown",function(t){(t.type==="click"||n.Client.Loader.appContext.Util.isEnterPressed(t,!0))&&(r(),n.Client.Loader.$mars("#marsSearchImage").focus())});if(n.Client.Loader.$mars("#answerPanel").find("#closeButton").keydown(function(t){if(t.keyCode===9&&t.shiftKey)return n.Client.Loader.$mars("#marsSearchImage").focus(),!1}),n.Client.Loader.$mars("#answerPanel").find("#txtSearch").keydown(function(t){return t.keyCode===9&&t.shiftKey?(n.Client.Loader.$mars("#feedbackBtn").focus(),!1):t.keyCode===13?(r(),n.Client.Loader.$mars(".lpath-preview-answerPanel-holder").find("txtSearch").focus(),!1):void 0}),u=this.answerPanelElement.find(".lpath-search-template"),u&&u.length>0&&(f=u.find("img[class~=lpath-toggleImage]").parent(),f)){e=function(n){i.onSearchToggleClick(n)};f.on("click keyup",e)}this.firstFocusableElement.on("keydown",function(u){return u.keyCode===9&&u.shiftKey?(n.Client.Loader.$mars("#lPathPropertyHomeTab")?n.Client.Loader.$mars("#lPathPropertyHomeTab").find("#lpath-propertyTab_lib-builderControl").focus():i.lastFocusableElement.focus(),!1):u.keyCode===13&&!t.IsSideBarHeaderDisabled?(r(),n.Client.Loader.$mars("#txtSearch").focus(),!1):void 0});this.lastFocusableElement.on("keydown",function(t){if(t.keyCode===9&&!t.shiftKey)return n.Client.Loader.$mars("#lPathPropertyHomeTab")?n.Client.Loader.$mars("#lPathPropertyHomeTab").find(":visible :tabbable:first").focus():i.firstFocusableElement.focus(),!1})},i.prototype.postSearchCallback=function(){n.AnswerPanel.getInstance().noResultsInSearchFlag&&n.Client.Loader.currentInstance.UpdateMarsAriaLiveContent(n.Client.Loader.marsLocale.noResults,n.Client.Utility.AriaLiveType.assertive)},i.prototype.replaceExistingGTIcon=function(){var t=n.Client.Loader.$mars(".lpath-gt-link-container img.lpath-gt-link-img");n.Client.Loader.$mars(t).each(function(){var t=n.Client.Loader.$mars(this),u=t.attr("class"),f=t.attr("src"),e=t.attr("title"),i=n.Client.Loader.$mars("<span/>",{title:e}),r=n.Client.Loader.$mars("<img/>",{"class":u,src:f,focusable:"false"});r.addClass("lpath-svg");i.append(r);t.replaceWith(i)})},i.prototype.resetVideoSources=function(){var t=n.Client.Loader.$mars("#lPathSidebarContainer");t.find("div[id='marsVideoDiv']").each(function(){var i="",t;n.Client.Loader.$mars(this).find("[data-name='mars-videoPreview']").length>0?(t=n.$mars(this).find("[data-name='mars-videoPreview']"),i=t.attr("src"),t.attr("src",""),t.attr("src",i)):n.Client.Loader.$mars(this).find("#mars-fwlinkVideoHolder").length>0&&(t=n.$mars(this).find("#mars-fwlinkVideoHolder"),i=t.data("videosource"),t.data("videosource",""),t.data("videosource",i))})},i._instance=null,i.noOfCharsTotruncate=10,i.maxAllowedLines=4,i}();n.AnswerPanel=i;n.$mars(window).bind("beforeunload",function(){if(n.answerPanelActivityEvent!=null&&n.answerPanelActivityEvent.controlId!=null){var i=n.Client.Loader.appContext.getPageType(),r=["","",i,window._MicrosoftMars.Client.Telemetry.UserClicks.ignored,t.activationEvent,t.version];n.answerPanelActivityEvent.SetActivityData(r);n.answerPanelActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.incomplete);n.answerPanelActivityEvent=null}})}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(n){this.id=n}return t.prototype.setParent=function(n){this.parent=n},t.prototype.SetIsSequenced=function(){this.isSequenced=!0},t.prototype.DisableScenario=function(){this.isCompleted()||this.$element.addClass("mars-a-disabled")},t.prototype.EnableScenario=function(){this.$element.removeClass("mars-a-disabled")},t.prototype.isCompleted=function(){return this.completed},t.prototype.parseJSON=function(t){n.ScenarioUtil.parseScenarioJSON(t)},t.prototype.handleScenarioCompletion=function(n){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentScenario:handleScenarioCompletion START");this.completed||(this.completed=!0,this.injectCompletionIcon(n),this.EnableScenario(),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Scenario has been completed"));this.parent.updateAccordion(this.isSequenced);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentScenario:handleScenarioCompletion END")},t.prototype.handleScenarioCollapse=function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentScenario:validateAndCollapseAccordion START");var n=this.parent;n&&n.validateAndCollapseAccordion();_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentScenario:validateAndCollapseAccordion END")},t.prototype.injectCompletionIcon=function(t){var u,i,r,f;this.$element=n.$mars("#"+t+".lpath-gt-link-Text");u=this.$element.text();i=_MicrosoftMars.Client.Loader.marsLocale.CompletedStatus;i=i.replace("{0}",u);r=_MicrosoftMars.Client.Loader.$mars("<span/>",{"aria-label":i});f=_MicrosoftMars.Client.Loader.$mars("<img/>",{"class":"lpath-svg mars-guidedtask-completionicon",src:n.ContentManager.completedIconPath});r.append(f);this.$element.append(r.prop("outerHTML"));this.$element.attr("aria-label",i);this.$element.find("label").attr("aria-hidden","true");window._MicrosoftMars.Client.Utility.Util.replaceSVGImageWithInline("img.lpath-svg")},t}();n.ContentScenario=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";(function(n){n[n.AnswerPanel=1]="AnswerPanel";n[n.StepThrough=2]="StepThrough";n[n.ActiveStep=3]="ActiveStep";n[n.InfoBubble=4]="InfoBubble";n[n.Section=5]="Section";n[n.PassiveStep=6]="PassiveStep";n[n.HybridStep=7]="HybridStep";n[n.WaitingStep=8]="WaitingStep"})(n.ControlTypes||(n.ControlTypes={}));var t=n.ControlTypes})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(n){this.id=n;this.contents=[];this.completedScenarioIndex=-1}return t.prototype.setParent=function(n){this.parent=n},t.prototype.parseJSON=function(n){this.parseChildControls(n);this.parseListOfLinks(n)},t.prototype.parseChildControls=function(t){var f,o,e,s,i,r,u;if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentAccordion:parseChildControls START"),f=document.createElement("div"),_MicrosoftMars.Client.Loader.$mars(f).marsSetInnerHTML(f,t.HtmlView),o=f.firstChild,e=_MicrosoftMars.Client.Loader.$mars(".mars-section-contents-prev",o),s=e.length>0?e[0].getAttribute("data-showsequencedguidedtask"):!1,i=t.Links,i!=null)for(r=0;r<i.length;r++)i[r].LinkType&&i[r].ControlReference&&(u=n.ContentManager.getInstance().createContent(i[r].LinkType,i[r].ControlReference.ControlId),u&&(u.setParent(this),u.parseJSON(i[r]),this.contents.push(u)));_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentAccordion:parseChildControls END")},t.prototype.disableGTLink=function(n){for(var i,t=0;t<n.length;t++)i=document.getElementById(n[t]),i&&(i.className+=i.className?" mars-a-disabled":"mars-a-disabled")},t.prototype.parseListOfLinks=function(t){var u,e,r,i,f;if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentAccordion:parseListOfLinks START"),u=JSON.parse(t.MetadataJson).Content.Links,u)for(e=t.ControlType==5?"Sidebar":"GuidedTask",r=0;r<u.length;r++)if(i=u[r],i.LinkType===_MicrosoftMars.Client.Utility.LinkType.Sidebar||i.LinkType===_MicrosoftMars.Client.Utility.LinkType.GuidedTask)if(i.ControlReference){f=[e,_MicrosoftMars.AnswerPanelModel.version];_MicrosoftMars.Client.Loader.$mars('[id="'+i.ControlReference.ControlId+'"]').off("click keyup").on("click keyup",{control:i,AuthoringId:t.AuthoringId,activityData:f},function(t){if(t.type=="click"||t.keyCode==13){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"For Navigation control id is: "+t.data.control.Id+", EnableNavigation is: "+t.data.control.EnableNavigation);var r=_MicrosoftMars.Client.Loader.appContext,i=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.linkClick),u=_MicrosoftMars.Client.Loader.appContext.Util.getPublishGroupDetails(_MicrosoftMars.AnswerPanelModel.publishGroupId,"Name");i.SetUserActivityInfo(r.UserId,_MicrosoftMars.AnswerPanelModel.controlId,_MicrosoftMars.AnswerPanelModel.publishGroupId,u,_MicrosoftMars.AnswerPanelModel.authoringGroupId,_MicrosoftMars.AnswerPanelModel.parentActivityId,_MicrosoftMars.AnswerPanelModel.authorId,_MicrosoftMars.AnswerPanelModel.controlName);n.ScenarioUtil.launchLinkedControl(t.data.control.ControlReference.ControlId,t.data.control.EnableNavigation,t.data.AuthoringId,i,f)}})}else _MicrosoftMars.Client.Loader.$mars("div[data-sectionid='"+t.ControlId+"_"+r+"']").on("click keyup",{control:i},function(n){(n.type=="click"||n.keyCode==13)&&_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchAnswerPanelException,_MicrosoftMars.Client.Loader.marsLocale.unableToLoadAnswerPanel)});else if(i.LinkHolder==="btnLink")_MicrosoftMars.Client.Loader.$mars("#"+t.ControlId).find("[data-name=mars-footerbutton-buynow]").on("click keyup",{control:i},function(n){if(n.type==="click"||_MicrosoftMars.Client.Loader.appContext.Util.isEnterPressed(n,!0)){var t=n.target;t.tagName.toLowerCase()==="span"&&(t=t.parentElement);_MicrosoftMars.AnswerPanel.handleBuyNowChatCallMeLink(t)}});else if(i.LinkHolder==="callMeImg")_MicrosoftMars.Client.Loader.$mars("#"+t.ControlId).find("[data-name=mars-footerbutton-callme]").on("click keyup",{control:i},function(n){(n.type==="click"||_MicrosoftMars.Client.Loader.appContext.Util.isEnterPressed(n,!0))&&_MicrosoftMars.AnswerPanel.handleBuyNowChatCallMeLink(n.target)});else if(i.LinkHolder==="liveChatImg"&&_MicrosoftMars.Client.Utility.FFFUtility.isFeatureEnabled(_MicrosoftMars.Client.Utility.FFFUtility.LiveChatFeatureName))_MicrosoftMars.Client.Loader.$mars("#"+t.ControlId).find("[data-name=mars-liveChatLink]").on("click keyup",{control:i},function(n){(n.type==="click"||_MicrosoftMars.Client.Loader.appContext.Util.isEnterPressed(n,!0))&&_MicrosoftMars.AnswerPanel.handleBuyNowChatCallMeLink(n.target)});_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentAccordion:parseListOfLinks END")},t.prototype.validateAndCollapseAccordion=function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentAccordion:validateAndCollapseAccordion START");this.isAccordionComplete()&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Scenario successfully completed scenarioId: "+this.id),_MicrosoftMars.Client.Loader.$mars("#"+this.id).find(".mars-toggleImage").trigger("click"));_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentAccordion:validateAndCollapseAccordion END")},t.prototype.isAccordionComplete=function(){var n,t;if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentAccordion:isAccordionComplete START"),n=!1,!this||!this.contents)return _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"ContentAccordion:isAccordionComplete variable does not have any content."),n;for(t=0;t<this.contents.length;t++){if(!this.contents[t].isCompleted()){n=!1;break}n=!0}return _MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentAccordion:isAccordionComplete END"),n},t.prototype.updateAccordion=function(n){n&&(this.completedScenarioIndex++,this.EnableNextGT())},t.prototype.EnableNextGT=function(){if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentAccordion:EnableNextGT START"),this.completedScenarioIndex<this.contents.length-1){var n=this.contents[this.completedScenarioIndex+1];n.EnableScenario()}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentAccordion:EnableNextGT END")},t.prototype.DisableGT=function(){var n=this.contents[this.completedScenarioIndex];n.DisableScenario()},t}();n.ContentAccordion=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(){if(this.scenarios={},t._instance)throw new Error("Singleton instance already exists for Content Manager. Access it via ContentManager.getInstance()");t._instance=this}return t.getInstance=function(){return t._instance==null&&(t._instance=new t),t._instance},t.prototype.createContent=function(t,i){var r;if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentManager:createContent START"),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Content type: "+t+", Id of content: "+i),t===n.ControlTypes.Section)return new n.ContentAccordion(i);if(t===_MicrosoftMars.Client.Utility.LinkType.GuidedTask)return r=new n.ContentScenario(i),this.scenarios[i]=r,r;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentManager:createContent END")},t.prototype.parseJSON=function(n){var u,i,t,f,r;for(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentManager:parseJSON START"),u=[],i=0;i<n.length;i++)(t=n[i],t!=null)&&(f="",t.ParentControlId&&(f=t.ParentControlId[i]),r=this.createContent(t.ControlType,t.ControlId),r.parseJSON(t),u.push(r));_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentManager:parseJSON END")},t.prototype.setScenarioCompleted=function(n,t){var i,r;t===void 0&&(t=!1);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentManager:setScenarioCompleted START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"For scenario id: "+n);this.scenarios.hasOwnProperty(n)?(t&&(i=window.Microsoft.Mars.Client.Runtime.Controls.AnswerPanelLauncher,i.loadAnswerPanel(i.GTParentPanel),window._MicrosoftMars.AnswerPanel.getInstance().show(0)),r=this.scenarios[n],r.handleScenarioCompletion(n)):console.log("No such scenario exists");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentManager:setScenarioCompleted END")},t.prototype.handleValidateAndCollapseAccordion=function(n){if(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentManager:handleValidateAndCollapseAccordion START params: scenarioId : "+n),this.scenarios.hasOwnProperty(n)){var t=this.scenarios[n];t&&t.handleScenarioCollapse()}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"ContentManager:handleValidateAndCollapseAccordion END")},t.completedIconPath=_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.completionIndicator,t._instance=null,t}();n.ContentManager=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(){}return t.loadAnswerPanel=function(n){var i;if(n){i=_MicrosoftMars.AnswerPanel.getInstance();n.Pages=JSON.parse(n.MetadataJson).Template&&JSON.parse(n.MetadataJson).Template==_MicrosoftMars.AnswerPanelConstants.sidebar2xTemplate?2:1;i.initialize(n.Pages);t.loadPanel(n);t.addQuickNavigationClass();var u=window._MicrosoftMars.Client.Telemetry.Guid.newGuid(),r=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.launchmars),f=_MicrosoftMars.Client.Loader.appContext.Util.getPublishGroupDetails(n.PublishGroupId,"Name");r.SetUserActivityInfo(_MicrosoftMars.Client.Loader.appContext.userId,u,n.PublishGroupId,f,n.AuthoringId,"00000000-0000-0000-0000-000000000000",n.AuthorId,n.ControlName);r.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.complete)}},t.loadPanel=function(t){var e,s,f,r,h,c,i,u,o,l;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanelLauncher:loadPanel START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Answer Panel is launched of name :- "+t.ControlName+", Control ID :- "+t.ControlId);try{if(t){if(e=[],_MicrosoftMars.Client.Utility.FFFUtility.isFeatureEnabled("Tokens")&&(e=t.CustomAttributes),s=_MicrosoftMars.Client.Loader.appContext.Util.getConfigurationData(_MicrosoftMars.Client.Loader.appContext.Util.CustomAttributeSetting),t.Sections)for(f=0;f<t.Sections.length;f++)t.Sections[f]!=null&&t.Sections[f].CustomAttributes&&t.Sections[f].CustomAttributes.length>0&&n.$mars.merge(e,t.Sections[f].CustomAttributes);r="";r=r+t.LanguageControlVersionContents[0].HtmlView;h=Handlebars.compile(r);r=h({Locale:_MicrosoftMars.Client.Loader.marsLocale,serverUrl:_MicrosoftMars.Client.Loader.serverUrl,Imagepath:_MicrosoftMars.Client.Loader.marsImageMapping,controlCustomAttributes:e,globalCustomAttributes:s});_MicrosoftMars.Client.Loader.appContext.Util.iswindows8Shim()&&(_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanelLauncher:loadPanel for mobileClientType START"),r=this.stripScriptsHelper(r),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanelLauncher:loadPanel for mobileClientType END"));c=n.CustomAttributeUtility.replaceCustomAttributes(r,e);i=_MicrosoftMars.AnswerPanel.getInstance();try{u=JSON.parse(t.MetadataJson)}catch(a){u=t.MetadataJson}i.setIsSideBarHeaderDisabled(u.IsSideBarHeaderDisabled);i.setIsSideBarTitleDisabled(u.IsSideBarTitleDisabled);i.setIsSideBarFooterDisabled(u.IsSideBarFooterDisabled);i.setIsLastSectionPinnedtoFooter(u.IsLastSectionPinnedtoFooter);i.setIsFooterSectionAvailable(u.IsFooterSectionAvailable);i.setIsSideBarNextPrevDisabled(u.IsSideBarNextPrevDisabled);i.setControlId(t.ControlId);i.setPublishGroupId(t.PublishGroupId);i.setAuthoringGroupId(t.AuthoringId);i.setAuthorId(t.AuthorId);i.setVersion(t.Version);i.setControlName(t.ControlName);o=JSON.parse(t.Events)[0].Trigger;_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"AnswerPanel activation event/trigger is "+o);i.setActivation(o);i.setLocale(t.Lcid);i.setContent(c);_MicrosoftMars.Client.Loader.$mars("#answerPanel").attr("aria-labelledby","lPathHeaderH1");i.trackVideoRenderedActivity();t!=null&&t.Sections!=null&&(l=n.ContentManager.getInstance(),l.parseJSON(t.Sections),n.ScenarioUtil.setAppContextForScenarios(t.AppContext,t.Sections),_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"App context for scenario called from ScenarioUtil"))}}catch(v){_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(window._MicrosoftMars.Client.Utility.launchAnswerPanelException,_MicrosoftMars.Client.Loader.marsLocale.unableToLoadAnswerPanel);_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.ERROR,"Error exception occurs in AnswerPanelLauncher:loadPanel")}_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanelLauncher:loadPanel END")},t.addQuickNavigationClass=function(){var i=n.$mars.find(".lpath-toggleImage"),t;n.$mars(i[0]).hasClass("lpath-quicknavigation")||n.$mars(i[0]).addClass("lpath-quicknavigation");t=n.$mars.find("#home-icon");n.$mars(t).hasClass("lpath-quicknavigation")||n.$mars(t).addClass("lpath-quicknavigation")},t.getContextTypeMetadata=function(n,t){var e=[],o=n.Contexts,u,i,r,f;if(o)for(u=0;u<o.length;u++)if(i=n.Contexts[u].ContextGroup.ContextGroupElements,i)for(r=0;r<i.length;r++)if(i[r].ContextTypeMetaDataId==t)for(f=0;f<i[r].ContextValues.length;f++)e.push(i[r].ContextValues[f].Value);return e},t.loadEmptyPanel=function(){_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.DEBUG,"AnswerPanelLauncher:loadEmptyPanel START");_MicrosoftMars.Client.Loader.logger.log(window._MicrosoftMars.Client.Telemetry.Logger.INFO,"Empty Answer Panel is launched");var n=_MicrosoftMars.AnswerPanel.getInstance();n.initialize(1,!0);n.setContent('<div class="mars-preview-answerPanel-holder"><\/div>');n.setControlId(null)},t.stripScriptsHelper=function(t){var u=document.createElement("div"),i,r,f;for(n.$mars(u).marsSetInnerHTML(u,t),i=u.getElementsByTagName("script"),r=i.length;r--;)f=i[r],i[r].parentNode.removeChild(i[r]),_MicrosoftMars.Client.Loader.appContext.insertCustomScript(f.innerHTML);return u.innerHTML},t}();n.AnswerPanelLauncher=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.morethanfive="5+",n.divIntersection=15,n.notifycircle={height:"15px","border-radius":"100px",font:"9px Segoe UI bold",color:"#fff",background:"#00FF00",width:"15px","line-height":"15px",position:"absolute","text-align":"center"},n.mars_ISHHelpIcon_OnState={"background-color":"#ffffff","background-image":"url('"+_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.ISHhelpIconOnState+"')","background-position":"center","background-repeat":"no-repeat"},n.mars_ISHHelpIcon_OffState={"background-image":"url('"+_MicrosoftMars.Client.Loader.serverUrl+"images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.ISHhelpIconOffState+"')","background-color":"transparent","background-position":"center","background-repeat":"no-repeat"},n}();n.NotificationBadgeConstants=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.template1="<div id='content1'><div id='content1-title'>content1<\/div><div id='content1-content'><div id='3f32e83a-e961-4c17-8126-e108f415f0e5'>Scenario1<\/div><div id='scenario2'>Scenario2<\/div><\/div><\/div><div id='content2'><div id='content2-title'>content2<\/div><div id='content2-content'><div id='scenario3'>Scenario3<\/div><div id='scenario4'>Scenario4<\/div><\/div><\/div>",n.contentAreaJSON=JSON.parse('[{"ControlId":"content1","ControlType":5,"titleId":"content1-title","contentId":"content1-content","ChildControls":[{"ControlId":"3f32e83a-e961-4c17-8126-e108f415f0e5","ControlType":2,"ChildControlIds":["f6b45237-4f2f-4788-b1e2-24a12c566589","step13","step14","step15"],"ChildControls":[{"ControlId":"f6b45237-4f2f-4788-b1e2-24a12c566589","ControlType":6,"ParentControlId":["3f32e83a-e961-4c17-8126-e108f415f0e5"],"Events":[{"Id":"button3","Trigger":"click","Action":"previous"},{"Id":"button4","Trigger":"click","Action":"next"}],"AppContext":{"ElementIdentifier":">SPAN #TabSFA","PageHierarchy":"abc","PageNavigationInfo":"{\\"navigationFlag\\": true,\\"samewindow\\": true,\\"uri\\": \\"/TEST/workplace/home_dashboards.aspx?sitemappath=SFA%7cMyWork%7cnav_dashboards\\"}"},"HtmlView":"<div id=\'f6b45237-4f2f-4788-b1e2-24a12c566589\'><div id=\'title\'> Step1 <\/div> <div id=\'text\'>Click here to view the list of entities. <\/div><button id=\'button3\' title=\'Previous\'> Back <\/button> <button id=\'button4\' title=\'next\'> Next <\/button><\/div>"}]},{"id":"scenario2","ControlType":2,"completed":true}]},{"ControlId":"content2","ControlType":5,"titleId":"content2-title","contentId":"content2-content","ChildControls":[{"ControlId":"scenario3","ControlType":2,"completed":true},{"ControlId":"scenario4","ControlType":2,"completed":true}]}]'),n}();n.DemoObjects=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.getRequestJSON=function(){return JSON.parse('{"UserId":"393A3012-CAD0-4806-9F74-943126CC3865","Product":"CrmOnPrem","ProductVersion":"1.0.0.1","ClientType":"MoCA","FormFactor":"Desktop"}')},n.getResponseJSON=function(){return JSON.parse('{ "Succeeded": true,"Result": {"UserId": "393a3012-cad0-4806-9f74-943126cc3865","Product": "CrmOnPrem","ProductVersion": "1.0.0.1","ControlId": "3f32e83a-e961-4c17-8126-e108f415f0e5","ClientType": "Moca","FormFactor": "Desktop","TrackingStatus": "NotStarted","ChildControlId": "f6b45237-4f2f-4788-b1e2-24a12c566589","IgnoredCount": 0}}')},n.scenario1Init=JSON.parse('{"ControlId":"3f32e83a-e961-4c17-8126-e108f415f0e5","ControlType":2,"ChildControlIds":["f6b45237-4f2f-4788-b1e2-24a12c566589","step13","step14","step15"],"ChildControls":[{"ControlId":"f6b45237-4f2f-4788-b1e2-24a12c566589","ParentControlId":["3f32e83a-e961-4c17-8126-e108f415f0e5"],"Events":[{"Trigger":"click","Action":"next"}],"AppContext":{"ElementIdentifier":">SPAN #TabSFA","PageHierarchy":"abc","PageNavigationInfo":"{\\"navigationFlag\\": true,\\"samewindow\\": true,\\"uri\\": \\"/TEST/workplace/home_dashboards.aspx?sitemappath=SFA%7cMyWork%7cnav_dashboards\\"}"},"HtmlView":"<div id=\'f6b45237-4f2f-4788-b1e2-24a12c566589\'><div id=\'title\'> Step1 <\/div> <div id=\'text\'>Click here to view the list of entities. <\/div><button id=\'button3\' title=\'Previous\'> Back <\/button> <button id=\'button4\' title=\'next\'> Next <\/button><\/div>"}]}'),n.scenario1Step2=JSON.parse('{"ControlId":"step12","ParentControlId":["3f32e83a-e961-4c17-8126-e108f415f0e5"],"events":[{"id":"button3","trigger":"click","action":"previous"},{"id":"button4","trigger":"click","action":"next"}],"elementId":"nav_activities .nav-iconContainer","AppContext":{"pagePath":{"pageHierarchy":"abc","pageNavigationInfo":{"navigationFlag":true,"samewindow":true,"uri":"/TEST/workplace/home_dashboards.aspx?sitemappath=SFA%7cMyWork%7cnav_dashboards"}}},"isActive":false,"HtmlView":{"content":"<div id=\'step12\'><div id=\'title\'> Step2 <\/div> <div id=\'text\'> {{customParameter \'Attributes.Select\'}} on next to open the Activities Page <\/div> <button id=\'button3\' title=\'Previous\'> Back <\/button> <button id=\'button4\' title=\'next\'> Next <\/button> <\/div>"},"Attributes":[{"API":"AppInfo.client","APIValue":"Web","Key":"Select","Value":"Click"}]}'),n.scenario1Step3=JSON.parse('{"ControlId":"step13","ParentControlId":["3f32e83a-e961-4c17-8126-e108f415f0e5"],"ControlType":6,"Events":[{"Id":"button5","Trigger":"click","Action":"previous"},{"Id":"button6","Trigger":"click","Action":"next"}],"AppContext":{"ElementIdentifier":">LI #activitypointer|NoRelationship|HomePageGrid|Mscrm.HomepageGrid.activitypointer.NewTask","PageHierarchy":"abc1","PageNavigationInfo":"{\\"navigationFlag\\": true,\\"samewindow\\": true,\\"uri\\": \\"/TEST/_root/homepage.aspx?etc=4200&sitemappath=SFA%7cMyWork%7cnav_activities\\"}"},"HtmlView":"<div id=\'step13\'><div id=\'title\'> Step3 <\/div> <div id=\'text\'>  Click on the Task button to create a new task <\/div> <button id=\'button5\' title=\'Previous\'> Back <\/button> <button id=\'button6\' title=\'next\'> Next <\/button><\/div>"}'),n.scenario1Step4=JSON.parse('{"ControlId":"step14","ParentControlId":["3f32e83a-e961-4c17-8126-e108f415f0e5"],"ControlType":6,"Events":[{"Id":"button7","Trigger":"click","Action":"close"}],"AppContext":{"ElementIdentifier":">LI #activitypointer|NoRelationship|HomePageGrid|Mscrm.HomepageGrid.activitypointer.NewServiceActivity","PageHierarchy":"abc","PageNavigationInfo":"{\\"navigationFlag\\": true,\\"samewindow\\": true,\\"uri\\": \\"/TEST/_root/homepage.aspx?etc=4200&sitemappath=SFA%7cMyWork%7cnav_activities\\"}"},"HtmlView":"<div id=\'step14\'><div id=\'title\'> Step4 <\/div> <div id=\'text\'>Click here to create a new service activity. <\/div> <button id=\'button7\' title=\'Close\'> Previous <\/button>"}'),n.scenario1Step5=JSON.parse('{"ControlId": "step15","ParentControlId":["3f32e83a-e961-4c17-8126-e108f415f0e5"], "events": [{ "id": "button9", "trigger": "click", "action": "close" }], "elementId": "moreCommands", "AppContext":{"pagePath":{"pageHierarchy":"abc","pageNavigationInfo":{"navigationFlag":true,"sameWindow":true,"uri":"/TEST/_root/homepage.aspx?etc=4200&sitemappath=SFA%7cMyWork%7cnav_activities"}}}, "isActive": false, "HtmlView": { "content": "<div id=\'step15\'><div id=\'title\'> Step5 <\/div> <div id=\'text\'>Click here to see more actions for activities. <\/div> <button id=\'button9\' title=\'Close\'> Close <\/button><\/div>" }}'),n.infoBubble=JSON.parse('[{"ControlId":"info1","Events":[{"Id":"more1","ChainedTo":"ans1","Trigger":"click","Action":"learnmore"},{"Id":null,"ChainedTo":"null","Trigger":"click","Action":"Launch"}],"HtmlView":"<html><body><div id=\'info1\'><div id=\'title\'> Get started with Microsoft Dynamics CRM Dashboard<\/div> <div id=\'text\'> You can click here to start exploring navigation across various modules and entities of Dynamics CRM. <\/div> <div id=\'more1\'style= \'color:#0000FF;float:right; text-decoration: underline;\' >See more details. <\/div><\/div><\/body><\/html>","AppContext":{"ElementIdentifier":">SPAN #Tabnav_dashboards-main","PageHierarchy":"abc","PageNavigationInfo":"{\\"navigationFlag\\": true,\\"samewindow\\": true,\\"uri\\": \\"/TEST/workplace/home_dashboards.aspx?sitemappath=SFA%7cMyWork%7cnav_dashboards\\"}"}}]'),n}();n.MockObject=t})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t,i;(function(n){n[n.Unknown=0]="Unknown";n[n.Desktop=1]="Desktop";n[n.Tablet=2]="Tablet";n[n.Phone=3]="Phone"})(n.FormFactorEnum||(n.FormFactorEnum={}));t=n.FormFactorEnum,function(n){n[n.OnState=0]="OnState";n[n.OffState=1]="OffState";n[n.HiContrastOnState=2]="HiContrastOnState";n[n.HiContrastOffState=3]="HiContrastOffState"}(n.HelpIconStates||(n.HelpIconStates={}));i=n.HelpIconStates})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(t){"use strict";var i=function(){function t(){this.utility=_MicrosoftMars.Client.Loader.appContext.Util;this.attributeToApiMap={};this.setMapping("AppInfo.UserInfo.UserId",_MicrosoftMars.Client.Loader.appContext.UserId);this.setMapping("AppInfo.UserInfo.UserName",_MicrosoftMars.Client.Loader.appContext.UserName);this.setMapping("AppInfo.UserInfo.UserLcid",_MicrosoftMars.Client.Loader.appContext.Locale);this.setMapping("AppInfo.Client",_MicrosoftMars.Client.Loader.appContext.ClientType);this.setMapping("AppInfo.OrgInfo.OrgName",_MicrosoftMars.Client.Loader.appContext.getOrgName());this.setMapping("AppInfo.OrgInfo.OrgLCID",_MicrosoftMars.Client.Loader.appContext.getOrgLcid());this.setMapping("AppInfo.OrgInfo.ClientUrl",_MicrosoftMars.Client.Loader.appContext.getClientUrl())}return t.GetInstance=function(){return t._instance==null&&(t._instance=new t),t._instance},t.prototype.setMapping=function(n,t){this.attributeToApiMap[n]=t},t.prototype.getMapping=function(i,r,u){var b=_MicrosoftMars.Client.Loader.appContext.Locale,p=_MicrosoftMars.Client.Loader.appContext.Util,w=this,f,a,e,h,c,l,v,y,o,s;if(this.matchingExpressionValue="",this.attributeToApiMap[i])return this.attributeToApiMap[i];if(f=i.split("."),f.length===2&&f[0]==="Entity")return this.utility.getEntityDisplayValue(i);if(f.length===2&&f[0]==="Command")return this.utility.getCommandDisplayValue(i);if(f.length===2&&f[0]==="Client")return f[1]==="ClientUrl"?_MicrosoftMars.Client.Loader.appContext.getClientUrl():f[1]==="ClientState"?_MicrosoftMars.Client.Loader.appContext.getClientState():f[1]==="ClientName"?_MicrosoftMars.Client.Loader.appContext.getClientName():"";if(f[0]==="Attributes"){for(a=f.slice(1).join("."),e=JSON.parse("[]"),r!==undefined&&(e=r.filter(function(n){return n.SubKey===a})),e.length===0&&u&&(e=u.filter(function(n){return n.SubKey===a})),h=0,c=0;c<e.length;c++)e[c].Lcid===b&&(h=c);if(e.length>0)return(l=[],e[h].Expression===""||e[h].Expression==null)?e[h].SubValue:(e[h].Expression==="AppInfo.client"?(v=_MicrosoftMars.Client.Loader.appContext.ClientType,l=e.filter(function(n){return n.TokenType===t.multivaluedDynamicToken&&w.filterMultivaluedTokens(n.SubValue,v.toLowerCase().trim())?n:n.ExpressionValue===v})):e[0].Expression==="AppInfo.DeviceInfo.formfactor"&&(y=n.FormFactorEnum[_MicrosoftMars.Client.Loader.appContext.getFormFactor()].toString(),l=e.filter(function(n){return n.TokenType===t.multivaluedDynamicToken&&w.filterMultivaluedTokens(n.SubValue,y.toLowerCase().trim())?n:n.ExpressionValue===y})),l[0]?this.matchingExpressionValue&&this.matchingExpressionValue.trim()!==""?this.matchingExpressionValue:l[0].SubValue:"")}else return f.length===2?(o=null,s=[],f[0]==="Control"?(s.push(f[1]),o="Xrm.Page.ui.controls.get(arg1]).getName()"):f[0]==="Tabs"&&(s.push(f[1]),o="Xrm.Page.ui.tabs.get(arg1).getName()"),f[0]==="Navigation"?(s.push(f[1]),o="Xrm.Page.ui.navigation.items.get(arg1).getId()"):f[0]==="FormSelector"&&(o="Xrm.Page.ui.formSelector.getCurrentItem().getId();"),p.executeAppMethod(o,s).toString()):(o=null,s=[],f[0]==="Control"&&f[2]==="label"?(s.push(f[1]),o="Xrm.Page.ui.controls.get(arg1).getLabel()"):f[0]==="Tabs"&&f[2]==="label"?(s.push(f[1]),o="Xrm.Page.ui.tabs.get(arg1).getLabel()"):f[0]==="Navigation"&&f[2]==="label"?(s.push(f[1]),o="Xrm.Page.ui.navigation.items.get(arg1).getLabel()"):f[0]==="FormSelector"&&f[2]==="label"&&(o="Xrm.Page.ui.formSelector.getCurrentItem().getLabel()"),p.executeAppMethod(o,s).toString())},t.prototype.filterMultivaluedTokens=function(n,i){for(var f,e=!1,u=n.split(","),r=0;r<u.length;r++)if(u[r].split(":")[0].toLowerCase().trim()===i&&(f=u[r].split(":")[1],f!==undefined&&f!=="undefined")){e=!0;this.matchingExpressionValue=f;break}if(!e){for(r=0;r<u.length;r++)if(u[r].split(":")[0].toLowerCase().trim()===t.defaultFilterCondition.toLowerCase()&&(f=u[r].split(":")[1],f!==undefined&&f!=="undefined")){e=!0;this.matchingExpressionValue=u[r].split(":")[1];break}e||(this.matchingExpressionValue="")}return e},t._instance=null,t.multivaluedDynamicToken="multivaluedDynamic",t.defaultFilterCondition="default",t}();t.CustomAttribute=i})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";Handlebars.registerHelper("customParameter",function(t){var i=n.CustomAttribute.GetInstance();return i.getMapping(t.toString(),this.controlCustomAttributes,this.globalCustomAttributes)});Handlebars.registerHelper("json",function(n){return JSON.stringify(n)});Handlebars.registerHelper("getImage",function(n){return _MicrosoftMars.Client.Loader.marsImageMapping.ImagePath[n]});Handlebars.registerHelper("getServerUrl",function(){return _MicrosoftMars.Client.Loader.serverUrl});Handlebars.registerHelper("getLocale",function(n){return _MicrosoftMars.Client.Loader.marsLocale[n]});Handlebars.registerHelper("validateLCID",function(n){return _MicrosoftMars.Client.Utility.Util.validateWhiteListLCID()?n.fn(this):n.inverse(this)});Handlebars.registerHelper("isFooterAvailable",function(n,t){for(var i=0;i<n.length;i++)if(n[i]&&n[i].MetadataJson.Template==="renderer_footersectiontemplate")return t.inverse(this);return t.fn(this)});Handlebars.registerHelper("orgID",function(){return _MicrosoftMars.Client.Loader.appContext.getOrgId()});Handlebars.registerHelper("siteWideUrl",function(){return window.parent.location.hostname.replace(/[^.]*/,"port")});Handlebars.registerHelper("orgName",function(){return _MicrosoftMars.Client.Loader.appContext.getOrgName()});Handlebars.registerHelper("appModuleUniqueName",function(){return _MicrosoftMars.Client.Loader.appContext.getCurrentAppModule()});Handlebars.registerHelper("tenantID",function(){return _MicrosoftMars.Client.Loader.appContext.TenantId})})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";n.$mars=_MicrosoftMars.Client.Loader.$mars;var t=function(){function t(){if(this.defaultInjectSize=10,t._instance)throw new Error("Singleton instance exists for InfoBubbleManager. Access via InfoBubbleManager.getInstance()");t._instance=this;this.elementIdToBubbleMap={};this.infoBubbleMap={};this.bubbleModel={};this.bubble={};this.view={};this.tooltipMap={};this.activeBubbleId=null}return t.getInstance=function(){return t._instance==null&&(t._instance=new t),t._instance},t.prototype.setDefaultInjectSize=function(n){this.defaultInjectSize=n},t.prototype.parseJson=function(t){var e,u,r;for(this.addJsonData(t),e=this.defaultInjectSize>this.totalInfoBubble?this.totalInfoBubble:this.defaultInjectSize,u=Object.keys(this.infoBubbleMap),r=0;r<e;r++){var i=u[r],f=this.infoBubbleMap[i],h=f.AppContext,c=_MicrosoftMars.Client.Loader.appContext.getElement(h.ElementIdentifier),o=c.element,s=o.attr(n.BubbleUtilityConstants.TITLE);s?(this.tooltipMap[f.ControlId]=s,o.removeAttr(n.BubbleUtilityConstants.TITLE)):this.tooltipMap[f.ControlId]=null;this.addInfoBubble(u,r);var l=this.infoBubbleMap[i].Events,a=l.filter(function(t){return t.Action.toLowerCase()===n.BubbleUtilityConstants.launchAction.toLowerCase()}),v=_MicrosoftMars.Client.Loader.appContext.ClientType;v===n.BubbleUtilityConstants.mobileClientType?(this.bubbleModel[i].setTargetElementForMOCA(i),this.attachClickEventToInfoIconForMOCA(this.bubbleModel[i],this.bubble[i],i)):this.executeScriptElementId(this.bubbleModel[i],this.bubble[i],a[0].Trigger,i);n.BubbleUtilityConstants.overlayClickAttached===!1&&(this.attachlpathRuntimeOverlayClickHandler(),n.BubbleUtilityConstants.overlayClickAttached=!0)}if(this.totalInfoBubble>this.defaultInjectSize)while(r<this.totalInfoBubble)this.addInfoBubbleOnDemand(u,r),r++},t.prototype.lpathRuntimeOverlayClickHandler=function(t){var i=this,o,s,u,c,l;if(i.totalInfoBubble!==0){var r=n.BubbleUtilityConstants.onoverlay,f=t.pageX,e=t.pageY;if(i.activeBubbleId===null)for(o=i.totalInfoBubble,s=Object.keys(i.infoBubbleMap),u=0;u<o;u++){var a=s[u],v=i.infoBubbleMap[a],y=v.AppContext,h=_MicrosoftMars.Client.Loader.appContext.getElement(y.ElementIdentifier),p=h.element;if(n.BubbleUtility.clickedInsideElement(h,f,e)&&(r=n.BubbleUtilityConstants.insideelement),r===n.BubbleUtilityConstants.insideelement){p.trigger("click");break}}else c=i.bubbleModel[i.activeBubbleId].getJquerySelectorMap(),l=c.bubbleId,n.BubbleUtility.clickedInsideBubble(l,f,e)&&(r=n.BubbleUtilityConstants.insidebubble),r===n.BubbleUtilityConstants.onoverlay&&(i.bubble[i.activeBubbleId].hide(),i.captureUserProgress(i.activeBubbleId,n.UserProgress.IGNORED),i.activeBubbleId=null)}},t.prototype.cleanupBubbles=function(){for(var i,t=Object.keys(this.bubble),n=0;n<t.length;n++)i=t[n],this.cleanupBubble(i)},t.prototype.cleanupBubble=function(t){var u=this.bubble[t],e,r;u&&u.cleanup(this.bubbleModel[t]);this.bubble[t]&&delete this.bubble[t];this.bubbleModel[t]&&delete this.bubbleModel[t];this.view[t]&&delete this.view[t];var i=this.infoBubbleMap[t],o=i.AppContext,s=_MicrosoftMars.Client.Loader.appContext.getElement(o.ElementIdentifier),h=s.element,f=this.tooltipMap[t];f&&h.attr(n.BubbleUtilityConstants.TITLE,f);e=i.Events;r=e.filter(function(t){return t.Action.toLowerCase()===n.BubbleUtilityConstants.launchAction.toLowerCase()});r[0].Trigger===n.BubbleUtilityConstants.HOVER?n.$mars("#"+i.ControlId).off("mouseenter#mars"):n.$mars("#"+i.ControlId).off(r[0].Trigger+"#mars")},t.prototype.setKeyShortcuts=function(t){var i=this,u,r;if(i.activeBubbleId!==null)if(u=i.infoBubbleMap[i.activeBubbleId].learnmore.length,t.keyCode===27&&i.activeBubbleId)i.bubble[i.activeBubbleId].hide(),i.captureUserProgress(i.activeBubbleId,n.UserProgress.IGNORED),i.activeBubbleId=null;else if(t.altKey&&t.ctrlKey&&t.keyCode===73&&i.activeBubbleId)for(r=0;r<u;r++)i.bubble[i.activeBubbleId].hide(),i.captureUserProgress(i.activeBubbleId,n.UserProgress.COMPLETE),i.activeBubbleId=null},t.prototype.addInfoBubble=function(t,i){var h=t[i],r=this.infoBubbleMap[h],f=new n.BubbleModel(r.ControlId),o=new n.View(r.ControlId),u=new n.Bubble(f),c,s,e;for(u.setView(o),this.elementIdToBubbleMap[r.ControlId]=u,this.bubble[r.ControlId]=u,this.bubbleModel[r.ControlId]=f,this.view[r.ControlId]=o,f.setAppContext(r.AppContext),f.setCustomAttributes(r.CustomAttributes),o.setHtmlContent(n.CustomAttributeUtility.replaceCustomAttributes(r.HtmlView,r.CustomAttributes)),u.inject(),this.executeScriptxButton(f,u),c=this.infoBubbleMap[h].Events,s=c.filter(function(t){return t.Action.toLowerCase()===n.BubbleUtilityConstants.learnMoreAction.toLowerCase()}),e=0;e<s.length;e++)this.notifyEventAnswerpanel(u,s[e])},t.prototype.getDefaultInjectSize=function(){return this.defaultInjectSize},t.prototype.addJsonData=function(n){var t,i,r;for(this.totalInfoBubble=n.length,t=0;t<n.length;t++)i=n[t],r=i.ControlId,this.infoBubbleMap[r]=i},t.prototype.addInfoBubbleOnDemand=function(t,i){var r=this,f=t[i],u=r.infoBubbleMap[f],s=u.Events,h=s.filter(function(t){return t.Action.toLowerCase()===n.BubbleUtilityConstants.launchAction.toLowerCase()}),c=u.AppContext,l=_MicrosoftMars.Client.Loader.appContext.getElement(c.ElementIdentifier),e=l.element,o=e.attr(n.BubbleUtilityConstants.TITLE);o?(this.tooltipMap[u.ControlId]=o,e.removeAttr(n.BubbleUtilityConstants.TITLE)):this.tooltipMap[u.ControlId]=null;e.on(h[0].Trigger+"#mars",function(){var n=r.elementIdToBubbleMap[u.ControlId];n?(r.activeBubbleId=f,n.show()):(r.addInfoBubble(t,i),r.setPositionAndShowBubble(r.bubbleModel[t[i]],r.bubble[t[i]],f))})},t.prototype.attachlpathRuntimeOverlayClickHandler=function(){var t=this;_MicrosoftMars.Client.Loader.$mars("#"+n.BubbleUtilityConstants.learningPathOverlayId).on("click",function(n){t.lpathRuntimeOverlayClickHandler(n)})},t.prototype.executeScriptxButton=function(t,i){var r=this,u=t.getJquerySelectorMap();u.xButtonId.on("click",function(){i.hide();r.captureUserProgress(r.activeBubbleId,n.UserProgress.IGNORED);r.activeBubbleId=null})},t.prototype.executeScriptElementId=function(t,i,r,u){var f=this,e=t.getTargetElement().element;if(r===n.BubbleUtilityConstants.HOVER)e.on("mouseenter#mars",function(){f.setPositionAndShowBubble(t,i,u)});else e.on(r+"#mars",function(){f.setPositionAndShowBubble(t,i,u)})},t.prototype.attachClickEventToInfoIconForMOCA=function(n,t,i){var r=this,u=n.getTargetElementForMOCA(i);u.on("click#mars",function(){r.setPositionAndShowBubble(n,t,i)})},t.prototype.detachClickEventToInfoIconForMOCA=function(n,t){var i=n.getTargetElementForMOCA(t);i.off("click#mars");n.removeInfoIconDiv()},t.prototype.setPositionAndShowBubble=function(t,i,r){var u=this,e;n.BubbleUtility.setBubblePostion(t,!1);i.show();u.activeBubbleId=r;n.infobubbleActivityEvent=new window._MicrosoftMars.Client.Telemetry.UserActivityEvent(window._MicrosoftMars.Client.Telemetry.ActivityName.infobubble);var f=this.infoBubbleMap[r].AppContext,o=_MicrosoftMars.Client.Loader.appContext.getPageType(),s=_MicrosoftMars.Client.Loader.appContext.getElement(f.ElementIdentifier),h=_MicrosoftMars.Client.Loader.appContext.Util.getPublishGroupDetails(t.getPublishGroupId(),"Name");n.infobubbleActivityEvent.SetUserActivityInfo(f.UserId(),r,t.getPublishGroupId(),h,t.getAuthoringGroupId(),t.getParentControlId(),"","",t.getParentControlId(),t.getParentControlName());e=["","",o,s.id];n.infobubbleActivityEvent.SetActivityData(e);n.$mars(window).bind("beforeunload",function(){u.activeBubbleId!=null&&n.infobubbleActivityEvent.FinishActivity(window._MicrosoftMars.Client.Telemetry.EndAction.incomplete)})},t.prototype.notifyEventAnswerpanel=function(t,i){var r=this;n.$mars("#"+i.Id).on(i.Trigger,function(){var u;t.hide();r.captureUserProgress(r.activeBubbleId,n.UserProgress.COMPLETE);r.activeBubbleId=null;u=JSON.parse('{"ControlIds":["'+i.answerPanelId+'"],"LcId":"'+_MicrosoftMars.Client.Loader.appContext.Locale+'","Environment":"'+_MicrosoftMars.Client.Loader.appContext.ProductEnvironmentType+'"}');_MicrosoftMars.Client.Loader.ServiceProxy.webApiBaseUrl=_MicrosoftMars.Client.Loader.webApiBaseUrl;var f=new _MicrosoftMars.Client.Loader.RuntimeControlApi,e=f.post(u,"ControlById");e.done(function(t){n.AnswerPanelLauncher.loadAnswerPanel(t.Result)})})},t.prototype.captureUserProgress=function(t,i){var r,u;t!=null&&(r=this,_MicrosoftMars.Client.Loader.appContext.util.getGTPreviewState()||(u=function(t,i){t>=n.UserProgress.getWithinSessionThreshold(n.InfoBubbleConstants.controlType)&&r.cleanupBubble(i)},n.UserProgress.saveControlState(t,null,i,u)),n.infobubbleActivityEvent.FinishActivity(i))},t._instance=null,t}();n.InfoBubbleManager=t;n.$mars(document).ready(function(){n.$mars(document).bind("keydown",function(n){t.getInstance().setKeyShortcuts(n)})})})(t=n.Controls||(n.Controls={}))})(t=n.Runtime||(n.Runtime={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){"use strict";var i=function(){function i(){if(this.marshelpIconOnState="mars-helpIcon-onstate",this.marshelpIconOffState="mars-helpIcon-offstate",this.marshelpIconHiContrastOnState="images/MARS-icon_ON_no-badge_hi-contrast_50x50.png",this.marshelpIconHiContrastOffState="images/MARS-icon_OFF_no-badge_hi-contrast_50x50.png",this.marsISHHelpIconOnState=n.Mars.Client.Runtime.Controls.NotificationBadgeConstants.mars_ISHHelpIcon_OnState,this.marsISHHelpIconOffState=n.Mars.Client.Runtime.Controls.NotificationBadgeConstants.mars_ISHHelpIcon_OffState,this.marsISHHelpIconHiContrastOnState="images/MARS-icon_ON_hi-contrast_ISH_50x41.png",this.marsISHHelpIconHiContrastOffState="images/MARS-icon_OFF_hi-contrast_ISH_50x41.png",this.marsHelpIconOnStateHebrew="mars-helpIconInHebrew-onstate",this.marsHelpIconOffStateHebrew="mars-helpIconInHebrew-offstate",this.marsHelpIconOnStateHiContrastHebrew="images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.helpIconONHiContrastInHebrew,this.marsHelpIconOffStateHiContrastHebrew="images/"+_MicrosoftMars.Client.Loader.marsImageMapping.ImagePath.helpIconOFFHiContrastInHebrew,this.helpIconStates=[],this.circleDiv=null,i._instance)throw new Error("Singleton instance exists for NotificationBadge. Access via NotificationBadge.getInstance()");i._instance=this;this.isISHPage=_MicrosoftMars.Client.Loader.appContext.isISHPage();this.isHebrew=_MicrosoftMars.Client.Loader.appContext.isHebrewEnv();this.isArabic=_MicrosoftMars.Client.Loader.appContext.isArabicEnv();this.isISHPage?(this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.OnState]=this.marsISHHelpIconOnState,this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.OffState]=this.marsISHHelpIconOffState,this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.HiContrastOnState]=this.marsISHHelpIconHiContrastOnState,this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.HiContrastOffState]=this.marsISHHelpIconHiContrastOffState):this.isHebrew?(this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.OnState]=this.marsHelpIconOnStateHebrew,this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.OffState]=this.marsHelpIconOffStateHebrew,this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.HiContrastOnState]=this.marsHelpIconOnStateHiContrastHebrew,this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.HiContrastOffState]=this.marsHelpIconOffStateHiContrastHebrew):(this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.OnState]=this.marshelpIconOnState,this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.OffState]=this.marshelpIconOffState,this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.HiContrastOnState]=this.marshelpIconHiContrastOnState,this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.HiContrastOffState]=this.marshelpIconHiContrastOffState)}return i.GetInstance=function(){return i._instance==null&&(i._instance=new i),i._instance},i.prototype.notificationManager=function(n){n>5&&(n=t.NotificationBadgeConstants.morethanfive);this.circleDiv.children().first().remove();this.circleDiv.append(n);n!==0?this.circleDiv.css("display","block"):this.circleDiv.css("display","none")},i.prototype.applyHelpCSS=function(){},i.prototype.applyISHhelpCSS=function(){},i.prototype.updateNotificationBadge=function(){},i.prototype.checkForHighContrastMode=function(i){if(!t.$mars("#checkHighContrastDiv").css("background-image")){var r=_MicrosoftMars.Client.Loader.appContext.Util.getHelpIcon();return this.isISHPage?r.find("#helpHighContrast").length===0&&(r=r.append("<img id='helpHighContrast' />"),r.find("#helpHighContrast").css("visibility","visible"),r.find("#helpHighContrast").css({position:"absolute",top:"0px",left:"0px"})):(window._MicrosoftMars.Client.Loader.appContext.isRTL()&&r.addClass("mars-rtl-helpIconInHighContrast"),r.addClass("mars-helpIcon"),r.parent().parent().addClass("mars-helpIconInHighContrast")),i?this.isISHPage?r.find("#helpHighContrast").attr("src",_MicrosoftMars.Client.Loader.serverUrl+this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.HiContrastOnState]):(r.attr("src",_MicrosoftMars.Client.Loader.serverUrl+this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.HiContrastOnState]),this.isArabic&&r.addClass("mars-helpIconForArabic")):this.isISHPage?r.find("#helpHighContrast").attr("src",_MicrosoftMars.Client.Loader.serverUrl+this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.HiContrastOffState]):(r.attr("src",_MicrosoftMars.Client.Loader.serverUrl+this.helpIconStates[n.Mars.Client.Runtime.HelpIconStates.HiContrastOffState]),this.isArabic&&r.addClass("mars-helpIconForArabic")),!0}return!1},i._instance=null,i}();t.NotificationBadge=i})(i=t.Controls||(t.Controls={}))})(i=t.Runtime||(t.Runtime={}))})(i=t.Client||(t.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={}));