var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},_MicrosoftMars;(function(n){var t;(function(t){var i;(function(i){"use strict";var r=function(){function t(){}return t.getInitOrgProvisioningRequest=function(){return{ProductOrgId:i.appContext.getOrgId(),TenantId:i.appContext.TenantId,BaseLcid:i.appContext.getOrgLcid(),OrgName:i.appContext.getOrgName(),Url:i.appContext.getClientUrl()}},t.getOrgProvisioningRequest=function(){return i.appContext.getOrganizationUserRoles(),{ProductOrgId:i.appContext.getOrgId(),TenantId:i.appContext.TenantId,BaseLcid:i.appContext.getOrgLcid(),OrgName:i.appContext.getOrgName(),Url:i.appContext.getClientUrl(),UserRoles:window._MicrosoftMars.Client.Utility.AppContext.organizationUserRoles}},t.prototype.getControlAPI=function(n){return i.trafficManagerBaseUrl!=null&&i.trafficManagerBaseUrl!==undefined&&i.trafficManagerBaseUrl!=""?i.trafficManagerBaseUrl+n:i.webApiBaseUrl+n},t.prototype.get=function(t,i){var r=this;return jQuery.when(n.Client.Loader.Crossdomain.getInstance().getauthtoken()).then(function(n){var u=r.getProxyHeader(n);return jQuery.ajax(t,{cache:!1,beforeSend:function(t){r.setRequestHeader(t,n,u.RequestId,!i)},headers:u})})},t.prototype.getSync=function(t,i,r){var u=this;return jQuery.when(n.Client.Loader.Crossdomain.getInstance().getauthtoken()).then(function(n){var e,f=u.getProxyHeader(n);return r!=null?(r.append("Control",i),e=jQuery.ajax(t,{type:"GET",dataType:"json",data:r,contentType:!1,processData:!1,async:!1,beforeSend:function(t){u.setRequestHeader(t,n,f.RequestId)},headers:f})):e=jQuery.ajax(t,{type:"GET",dataType:"json",data:JSON.stringify(i),contentType:"application/json;charset=utf-8",async:!1,beforeSend:function(t){u.setRequestHeader(t,n,f.RequestId)},headers:f}),e})},t.prototype.postSync=function(t,i){var r=this;return jQuery.when(n.Client.Loader.Crossdomain.getInstance().getauthtoken()).then(function(n){var u=r.getProxyHeader(n);return jQuery.ajax(t,{type:"POST",dataType:"json",data:JSON.stringify(i),contentType:"application/json;charset=utf-8",async:!1,beforeSend:function(t){r.setRequestHeader(t,n,u.RequestId)},headers:u})})},t.prototype.post=function(t,r,u,f,e){var s,c,a;f===void 0&&(f=!0);n.Client.Loader.appContext.Util.isPageLoading=!0;s=n.Client.Loader.appContext.Util.getApiRequest();s.Request=r;r=JSON.stringify(s);var l=s.marsRequestContext.RequestId,v=window._MicrosoftMars.Client.Utility.Util.newGuid(),h=n.Client.Loader.Crossdomain.getInstance(),o=n.Client.Loader.$mars.Deferred();return i.allowUnAuthorize?(c=h.postutil(l,t,r,u,f,e,""),c.done(function(t){n.Client.Loader.appContext.Util.isPageLoading=!1;var i;i=t;i==undefined?o.reject(t):o.resolve(t)}),c.fail(function(t){n.Client.Loader.appContext.Util.isPageLoading=!1;o.reject(t)})):a=window.setInterval(function(){var i=h.isAuthenticated(v);i.done(function(i){var c=i,s;c!=!1&&(window.clearInterval(a),s=h.postutil(l,t,r,u,f,e,""),s.done(function(t){n.Client.Loader.appContext.Util.isPageLoading=!1;var i;i=t;i==undefined?o.reject(t):o.resolve(t)}),s.fail(function(t){n.Client.Loader.appContext.Util.isPageLoading=!1;o.reject(t)}))})},200),o},t.prototype.put=function(t,i){var r=this;return jQuery.when(n.Client.Loader.Crossdomain.getInstance().getauthtoken()).then(function(n){var u=r.getProxyHeader(n);return jQuery.ajax(t,{type:"PUT",dataType:"json",data:JSON.stringify(i),contentType:"application/json;charset=utf-8",beforeSend:function(t){r.setRequestHeader(t,n,u.RequestId)},headers:u})})},t.prototype.getSearchUtil=function(n){return jQuery.ajax({url:n})},t.prototype.setRequestHeader=function(n,i,r,u){u===void 0&&(u=!0);i&&n.setRequestHeader("Authorization",t.BEARER+i);u&&n.setRequestHeader("RequestId",r)},t.prototype.getProxyHeader=function(n){var r=window._MicrosoftMars.Client.Utility.Util.newGuid(),i={};return i["RequestId"]=r,n&&(i.Authorization=t.BEARER+n),i},t.BEARER="Bearer ",t}(),u,f,e,o,s,h,c,l,a,v,y,p,w,b;i.ServiceProxy=r;u=function(n){function t(){n.apply(this,arguments);this.FFFWebApiUrl=n.prototype.getControlAPI.call(this,"Client/FCB")}return __extends(t,n),t.prototype.post=function(t,i){return n.prototype.post.call(this,this.FFFWebApiUrl+"/"+i,t)},t.prototype.getAllEnabledFeatures=function(t){return n.prototype.post.call(this,this.FFFWebApiUrl+"/Features",t)},t.prototype.getFeatureByName=function(t){return n.prototype.post.call(this,i.webApiBaseUrl+"FeatureById",t)},t}(r);i.FeatureAPI=u;f=function(t){function r(){t.apply(this,arguments);this.controlWebApiUrl=i.webApiBaseUrl+"Designer/Controls"}return __extends(r,t),r.prototype.get=function(n){return n!=null?t.prototype.get.call(this,this.controlWebApiUrl+"/"+n):t.prototype.get.call(this,this.controlWebApiUrl)},r.prototype.post=function(n,i,r){return i!=null?t.prototype.post.call(this,this.controlWebApiUrl+"/"+i,n,r):t.prototype.post.call(this,this.controlWebApiUrl,n)},r.prototype.put=function(n){return t.prototype.put.call(this,this.controlWebApiUrl,n)},r.prototype.getRelatedStates=function(t){return jQuery.when(n.Client.Loader.Crossdomain.getInstance().getauthtoken()).then(function(){return jQuery.ajax({url:this.controlWebApiUrl+"/GetRelatedStates/"+t,type:"GET",dataType:"json",data:t,contentType:"application/json;charset=utf-8"})})},r.prototype.GetCompiledHTML=function(t){return jQuery.when(n.Client.Loader.Crossdomain.getInstance().getauthtoken()).then(function(){return jQuery.ajax({url:this.controlWebApiUrl+"/GetCompiledHTML",type:"POST",dataType:"json",data:JSON.stringify(t),contentType:"application/json;charset=utf-8"})})},r.prototype.getControlTemplates=function(n){return t.prototype.post.call(this,i.webApiBaseUrl+"Designer/Controls/GetControlTemplates",n,"",!1,"")},r.prototype.searchSync=function(n,i){return i!=null?t.prototype.post.call(this,this.controlWebApiUrl+"/"+i+n,"","",!1,"search"):t.prototype.post.call(this,this.controlWebApiUrl+n,"","",!1)},r.prototype.getConfiguration=function(n){return t.prototype.get.call(this,i.webApiBaseUrl+"Configuration?configurationType="+n)},r.prototype.getCustomAttributesByLocale=function(n){return t.prototype.get.call(this,i.webApiBaseUrl+"Configuration/GetCustomAttributesByLocale?lcid="+n)},r.prototype.postConfiguration=function(n){return t.prototype.post.call(this,i.webApiBaseUrl+"Configuration/",n)},r.prototype.exportXMLHttpRequest=function(t,r,u){var s=this.controlWebApiUrl+"/"+t,e=n.Client.Loader.appContext.Util.getApiRequest(),l,a;e.Request=u;var h=JSON.stringify(e),c=e.marsRequestContext.RequestId,v=window._MicrosoftMars.Client.Utility.Util.newGuid(),o=n.Client.Loader.Crossdomain.getInstance(),f=n.Client.Loader.$mars.Deferred();return i.allowUnAuthorize?(l=o.postutil(c,s,h,"",!0,"export",r),l.done(function(n){var t;t=n;t==undefined?f.reject():f.resolve(n)})):a=window.setInterval(function(){var n=o.isAuthenticated(v);n.done(function(n){var i=n,t;i!=!1&&(window.clearInterval(a),t=o.postutil(c,s,h,"",!0,"export",r),t.done(function(n){var t;t=n;t==undefined?f.reject():f.resolve(n)}))})},200),f},r}(r);i.DesignerControlApi=f;e=function(n){function t(){n.apply(this,arguments);this.analyticsWebApiUrl=n.prototype.getControlAPI.call(this,"Analytics")}return __extends(t,n),t.prototype.getAllReportNames=function(){return n.prototype.post.call(this,this.analyticsWebApiUrl+"/GetAllReportNames")},t.prototype.getReportDetails=function(t){return n.prototype.post.call(this,this.analyticsWebApiUrl+"/GetReportDetails",t)},t.prototype.logUserActivity=function(t){return n.prototype.post.call(this,this.analyticsWebApiUrl+"/LogUserActivity",t)},t}(r);i.AnalyticsAPI=e;o=function(r){function u(){r.apply(this,arguments);this.controlWebApiUrl=r.prototype.getControlAPI.call(this,"Runtime/Controls")}return __extends(u,r),u.prototype.get=function(n){return n!=null?r.prototype.get.call(this,this.controlWebApiUrl+"/"+n):r.prototype.get.call(this,this.controlWebApiUrl)},u.prototype.post=function(n,t){return r.prototype.post.call(this,this.controlWebApiUrl+"/"+t,n)},u.prototype.searchMarsAnswerPanel=function(n,t){return(new u).post(n,t)},u.prototype.getPayloadForControlById=function(i,r){var e,u,f;return e=t.Loader.appContext.getClientUrl(),u=this.getSubscribedPublishGroupIds(),f={ControlId:i,PGs:u,AuthoringId:r,Lcid:n.Client.Loader.appContext.Locale},f},u.prototype.getSubscribedPublishGroupIds=function(){for(var i,u=[],r=n.Client.Loader.appContext.Util.getConfigurationData(n.Client.Loader.appContext.Util.AuthoringDetails),t=0;t<r.length;t++)for(i=0;i<r[t].SubscribedPGDetails.length;i++)u.push(r[t].SubscribedPGDetails[i].PgId);return u},u.prototype.getUserRoleName=function(t){var i,r;if(t&&localStorage.getItem("allConfigurationKey")&&(i=n.Client.Loader.appContext.Util.getConfigurationData(n.Client.Loader.appContext.Util.UserRoleSetting),i))for(typeof i=="string"&&(i=JSON.parse(i)),r=0;r<i.length;r++)if(i[r].Value&&i[r].Value.toLowerCase()==t.toLowerCase())return i[r].Name;return""},u.prototype.fireControlById=function(n,t){var i=this.getPayloadForControlById(n,t);return this.post(i,"ControlById")},u.prototype.postData=function(n,t){return r.prototype.post.call(this,i.webApiBaseUrl+n,t)},u}(r);i.RuntimeControlApi=o;s=function(n){function t(){n.apply(this,arguments);this.controlWebApiUrl=i.webApiBaseUrl+"Designer/PublishLog"}return __extends(t,n),t.prototype.get=function(t){return n.prototype.get.call(this,this.controlWebApiUrl+"/"+t)},t.prototype.post=function(t){return n.prototype.post.call(this,this.controlWebApiUrl+"/Search",t)},t}(r);i.PublishLogApi=s;h=function(n){function t(){n.apply(this,arguments);this.configurationWebApiUrl=n.prototype.getControlAPI.call(this,"Configuration")}return __extends(t,n),t.prototype.get=function(t){return t!=null?n.prototype.get.call(this,this.configurationWebApiUrl+"?key="+t):n.prototype.get.call(this,this.configurationWebApiUrl)},t.prototype.post=function(t,i){return n.prototype.post.call(this,this.configurationWebApiUrl+"/"+i,t)},t.prototype.getTenantInstances=function(){return n.prototype.post.call(this,this.configurationWebApiUrl+"/GetTenantInstances",null,null,!1)},t.prototype.getAllConfigurations=function(){return n.prototype.post.call(this,this.configurationWebApiUrl+"/GetAllConfigurations")},t.prototype.getInitializeOrgProvisioning=function(t){return n.prototype.post.call(this,this.configurationWebApiUrl+"/InitializeOrgProvisioning",t)},t.prototype.getFinalizeOrgProvisioning=function(t){return n.prototype.post.call(this,this.configurationWebApiUrl+"/FinalizeOrgProvisioning",t)},t}(r);i.ConfigurationAPI=h;c=function(n){function t(){n.apply(this,arguments);this.inappWebApiUrl=n.prototype.getControlAPI.call(this,"InAppSupport")}return __extends(t,n),t.prototype.getInAppSupportConfiguration=function(){return n.prototype.post.call(this,this.inappWebApiUrl+"/GetInAppSupportConfiguration")},t.prototype.post=function(t,i,r){return n.prototype.post.call(this,this.inappWebApiUrl+"/"+i,t,r)},t}(r);i.InAppSupportConfigurationAPI=c;l=function(n){function t(){n.apply(this,arguments);this.controlWebApiUrl=i.webApiBaseUrl+"Utility"}return __extends(t,n),t.prototype.post=function(t,i){return n.prototype.post.call(this,this.controlWebApiUrl+"/"+i,t)},t.prototype.getResolveUrl=function(n){var u=window._MicrosoftMars.Client.Utility.Util.newGuid(),t={},i,r;return t.RequestId=u,i=this.controlWebApiUrl+"/UrlResolve?urlToResolve="+n,r=jQuery.ajax(i,{cache:!0,beforeSend:function(n){n.setRequestHeader("RequestId",t.RequestId)},headers:t}),r},t}(r);i.UtilityAPI=l;a=function(n){function t(){n.apply(this,arguments);this.controlWebApiUrl=i.webApiBaseUrl+"MarsValidator"}return __extends(t,n),t.prototype.get=function(t){return t!=null?n.prototype.get.call(this,this.controlWebApiUrl+"?ScenarioId="+t):n.prototype.get.call(this,this.controlWebApiUrl+"/GetAll")},t.prototype.post=function(t,i){return n.prototype.post.call(this,this.controlWebApiUrl+"/"+i,t)},t}(r);i.MarsValidatorApi=a;v=function(n){function t(){n.apply(this,arguments);this.controlWebApiUrl=i.webApiBaseUrl+"MARSReports/Report"}return __extends(t,n),t.prototype.get=function(t){return t!=null?n.prototype.get.call(this,this.controlWebApiUrl+"?"+t):n.prototype.get.call(this,this.controlWebApiUrl)},t}(r);i.MarsReportApi=v;y=function(t){function i(){t.apply(this,arguments);this.webApiUrl="https://ussearchprod.trafficmanager.net/services/api/search";this.markets={"1069":"eu-ES","1026":"bg-BG","1027":"ca-ES","3076":"zh-HK","2052":"zh-CN","1028":"zh-TW","1050":"hr-HR","1029":"cs-CZ","1030":"da-DK","1043":"nl-NL","1033":"en-US","1061":"et-EE","1035":"fi-FI","1036":"fr-FR","1110":"gl-ES","1031":"de-DE","1032":"el-GR","1037":"he-IL","1081":"hi-IN","1038":"hu-HU","1057":"id-ID","1040":"it-IT","1041":"ja-JP","1087":"kk-KZ","1042":"ko-KR","1062":"lv-LV","1063":"lt-LT","1044":"nb-NO","1045":"pl-PL","1046":"pt-BR","2070":"pt-PT","1048":"ro-RO","1049":"ru-RU","2074":"sr-Latn-RS","1051":"sk-SK","1060":"sl-SL","1034":"es-ES","1053":"sv-SE","1054":"th-TH","1055":"tr-TR","1058":"uk-UA","1025":"ar-SA","1066":"vi-VN","1086":"ms-MY","3082":"es-ES","3098":"sr-Cyrl-CS","9242":"sr-Latn-RS","10266":"sr-Cyrl-RS"}}return __extends(i,t),i.prototype.getMarket=function(){var t=this.markets[n.Client.Loader.appContext.locale.toString()];return t?t:"en-US"},i.prototype.getEndUserResults=function(n){return this.getSearchResults("SPDynamicsCRM",n,"ctg:crm-customer-center")},i.prototype.getAdminAndCustomizerResults=function(n){return this.getSearchResults("BingTechNetDynamics",n,"prd:crm")},i.prototype.getVideoResults=function(n){return this.getSearchResults("DynamicsVideo",n)},i.prototype.getClientId=function(){return"0FA2A310-A20A-4F57-B013-7C319F18C71E"},i.prototype.getSearchResults=function(n,i,r){var u=this.webApiUrl+"?clientid="+this.getClientId()+"&markets="+this.getMarket()+"&source="+n;return(i==null||i=="")&&(i="*"),u+="&query="+i,r!=null&&r!==""&&(u+="&filter="+r),t.prototype.getSearchUtil.call(this,u)},i}(r);i.SearchAnswerPanelApi=y;p=function(){function t(t,i,r,u,f,e,o,s,h){this.skip=i*(t-1);this.top=i;this.orderby=u;this.SortOrder=f;this.AuthoringId=r;this.search=e;this.Filters=o;this.GroupBy=s;this.PublishGroupId=h;this.Lcid=n.Client.Loader.defaultLanguageLcid}return t.prototype.toQueryString=function(){return this.query="",this.skip&&this.skip>0&&(this.query+="PageNumber="+this.skip+"&"),this.top&&this.top>0&&(this.query+="PageSize="+this.top+"&"),this.orderby&&this.orderby.length>0&&(this.query+="SortName="+this.orderby+"&"),this.SortOrder&&this.SortOrder.length>0&&(this.query+="SortOrder="+this.SortOrder+"&"),this.search&&this.search.length>0&&(this.query+="SearchKeyWord="+this.search+"&"),this.Filters&&this.Filters.length>0&&(this.query+="Filters="+this.Filters[0].toQueryString()+"&"),this.GroupBy&&this.GroupBy.length>0&&(this.query+="GroupBy="+this.GroupBy+"&"),this.query.replace(/\&$/,"")},t}();i.SearchCriteria=p;w=function(){function n(n,t,i){this.LogicalOperator=n;this.Name=t;this.Details=i}return n.prototype.toQueryString=function(){return this.query="",this.LogicalOperator&&this.LogicalOperator.length>0&&(this.query+="LogicalOperator="+this.LogicalOperator+"&"),this.Name&&this.Name.length>0&&(this.query+="Name="+this.Name+"&"),this.Details&&this.Details.length>0&&(this.query+="Details="+this.Details[0].toQueryString()+"&"),this.query.replace(/\&$/,"")},n}();i.Filters=w;b=function(){function n(n,t){this.Condition=n;this.Value=t}return n.prototype.toQueryString=function(){return this.query="",this.Condition&&this.Condition>0&&(this.query+="Condition="+this.Condition+"&"),this.Value&&this.Value.length>0&&(this.query+="Value="+this.Value+"&"),this.query.replace(/\&$/,"")},n}();i.Details=b})(i=t.Loader||(t.Loader={}))})(t=n.Client||(n.Client={}))})(_MicrosoftMars||(_MicrosoftMars={}));