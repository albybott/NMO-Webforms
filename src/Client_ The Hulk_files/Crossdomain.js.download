var _MicrosoftMars;(function(n){var t;(function(t){var i;(function(t){"use strict";var i=function(){function i(){i._instance?console.log("Singleton instance already exists for Crossdomain. Access it via Crossdomain.getInstance()"):(i._instance=this,this.requestMap={},this.registerListener())}return i.getInstance=function(){return i._instance==null&&(i._instance=new i),i._instance},i.prototype.postutil=function(r,u,f,e,o,s,h){var c=jQuery.Deferred();this.requestMap[r]=c;var l=i.POSTUTIL,a=e,v={url:u,value:f,fileData:a,allowUnAuthorize:t.allowUnAuthorize,aadClientId:n.Client.Loader.aadClientId,aadTenantDomain:n.Client.Loader.aadTenantDomain,isAsync:o,callType:s,exportedFileName:h};return this.makePostMessageCall(r,l,v),c},i.prototype.isAuthenticated=function(r){var e=i.ISAUTHENTICATED,u=jQuery.Deferred(),f;return this.requestMap[r]=u,t.allowUnAuthorize?this.requestMap[r].resolve(""):(f={UserId:n.Client.Loader.appContext.UserId,OrgId:n.Client.Loader.appContext.getOrgId(),clientUrl:t.appContext.getClientUrl()},this.makePostMessageCall(r,e,f)),u},i.prototype.getauthtoken=function(r){var u=window._MicrosoftMars.Client.Utility.Util.newGuid(),f=jQuery.Deferred();if(this.requestMap[u]=f,t.allowUnAuthorize)this.requestMap[u].resolve("");else{var e=i.GETAUTHTOKEN,o=r!==undefined||r!=null?r:"",s={params:o,aadClientId:n.Client.Loader.aadClientId,aadTenantDomain:n.Client.Loader.aadTenantDomain};this.makePostMessageCall(u,e,s)}return f},i.prototype.registerListener=function(){function t(t){var e=t.origin||t.originalEvent.origin,o=n.Client.Loader.integrationsApiUrl;if(e!==o.substring(0,o.indexOf("MARS")-1)){console.log("Response from Invalid domain: "+e);return}if(t.data.requestType==i.GETAUTHTOKEN){var s=t.data.responseData,u=t.data.requestId,f=i.getInstance();f.requestMap[u].resolve(s);delete f.requestMap[u]}else if(t.data.requestType==i.POSTUTIL){var r=t.data.responseData,u=t.data.requestId,f=i.getInstance();r.status==0&&r.statusText=="error"||r.responseJSON&&!r.responseJSON.Succeeded?f.requestMap[u].reject(r):f.requestMap[u].resolve(r);delete f.requestMap[u]}else if(t.data.requestType==i.ISAUTHENTICATED){var r=t.data.responseData,u=t.data.requestId,f=i.getInstance();f.requestMap[u]!=undefined&&(r.status==0&&r.statusText=="error"?f.requestMap[u].reject(r):f.requestMap[u].resolve(r),delete f.requestMap[u])}else console.log("Response Invalid for requestType: "+t.data.requestType)}window.addEventListener("message",t)},i.prototype.makePostMessageCall=function(t,i,r){var e=document.getElementById("marsIFrame"),o=e.contentWindow,s=n.Client.Loader.integrationsApiUrl,h="web",u,f;window.parent.Microsoft&&window.parent.Microsoft.Crm&&(u=window.parent.Microsoft.Crm.Client.Core.Framework.UserAgent,u&&u.getInstance().get_PALEnabled()&&(h="moca"));f={requestId:t,requestType:i,requestData:r};o.postMessage(f,s)},i._instance=null,i.GETAUTHTOKEN="GETAUTHTOKEN",i.POSTUTIL="POSTUTIL",i.ISAUTHENTICATED="ISAUTHENTICATED",i}();t.Crossdomain=i})(i=t.Loader||(t.Loader={}))})(t=n.Client||(n.Client={}))})(_MicrosoftMars||(_MicrosoftMars={}));