var Microsoft;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";(function(n){n[n.LOWER=-1]="LOWER";n[n.EQUAL=0]="EQUAL";n[n.HIGHER=1]="HIGHER"})(n.PRECEDENCE||(n.PRECEDENCE={}));var t=n.PRECEDENCE})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))})(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){if(n._instance)throw new Error("Singleton instance already exists. Access it via AppModuleFilter.getInstance()");else n._instance=this}return n.getInstance=function(){return n._instance==null&&(n._instance=new n),n._instance},n.prototype.filter=function(n,t){var i,u,r;if(n.length>0)for(i=0;i<n.length;i++)u=n[i],r=_MicrosoftMars.Client.Loader.appContext.getCurrentAppModule(),(u.AppUniqueName==r||u.IsDefault&&(!r||r==""))&&t();else t()},n._instance=null,n}();n.AppModuleFilter=t})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(){if(this._controlUserRoles=[],this._appContextUserRoles=[],t._instance)throw new Error("Singleton instance already exists. Access it via FilterByUserRolePrecedence.getInstance()");else t._instance=this}return t.getInstance=function(){return t._instance==null&&(t._instance=new t),t._instance},t.prototype.setUserRolesLists=function(n,t){this._controlUserRoles=n;this._appContextUserRoles=t},t.prototype.filter=function(t,i){this.setUserRolePrecedence(i);var r=this.compare(t[0].UserRolePrecedence,i.UserRolePrecedence);return r==n.PRECEDENCE.HIGHER&&(t[t.length-1]=t[0],t[0]=i),r},t.prototype.setUserRolePrecedence=function(n){var t=[],r=this._appContextUserRoles,u=this._controlUserRoles,i;t=u.filter(function(n){return r.indexOf(n)>-1});i=this.getAuthoringGroup(n.AuthoringId).ConfigurationUserRoles;n.UserRolePrecedence=this.getLeastUserRolePrecedence(i,t)},t.prototype.getAuthoringGroup=function(n){for(var r=null,i=_MicrosoftMars.Client.Loader.appContext.Util.getConfigurationData("AuthoringDetails"),t=0;t<i.length;t++)if(n==i[t].AuthoringGroupDetail.AuthoringId){r=i[t].AuthoringGroupDetail;break}return r},t.prototype.compare=function(t,i){return t>i?n.PRECEDENCE.HIGHER:t<i?n.PRECEDENCE.LOWER:n.PRECEDENCE.EQUAL},t.prototype.getLeastUserRolePrecedence=function(n,t){for(var r,u=Number.MAX_VALUE,i=0;i<n.length;i++)for(r=0;r<t.length;r++)t[r]==n[i].Value&&u>n[i].Precedence&&(u=n[i].Precedence);return u},t._instance=null,t}();n.FilterByUserRolePrecedence=t})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(){if(t._instance)throw new Error("Singleton instance already exists. Access it via FilterByPublishGroupPrecedence.getInstance()");else t._instance=this}return t.getInstance=function(){return t._instance==null&&(t._instance=new t),t._instance},t.prototype.filter=function(t,i){var r=this.compare(t[0],i);return r==n.PRECEDENCE.HIGHER&&(t[t.length-1]=t[0],t[0]=i),r},t.prototype.compare=function(t,i){var r=t.PublishGroupPrecedence,u=i.PublishGroupPrecedence;return r>u?n.PRECEDENCE.HIGHER:r<u?n.PRECEDENCE.LOWER:n.PRECEDENCE.EQUAL},t._instance=null,t}();n.FilterByPublishGroupPrecedence=t})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){if(n._instance)throw new Error("Singleton instance already exists. Access it via DynamicPropertyFilter.getInstance()");else n._instance=this}return n.getInstance=function(){return n._instance==null&&(n._instance=new n),n._instance},n.prototype.filter=function(n,t){_MicrosoftMars.Client.Utility.DynamicContextUtil.evaluateDynamicProperties(n,t,0)},n._instance=null,n}();n.DynamicPropertyFilter=t})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(){if(t._instance)throw new Error("Singleton instance already exists for ControlStoreInvalidator. Access it via ControlStoreInvalidator.getInstance()");else t._instance=this,this.start(144e5)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.checkStoreValidity=function(n){var t=this.populateSubscribedPublishGroups();this.isDifferent(n,t)&&this.resetCache()},t.prototype.populateSubscribedPublishGroups=function(){var r={},t=_MicrosoftMars.Client.Loader.appContext.Util.getConfigurationData(_MicrosoftMars.Client.Loader.appContext.Util.AuthoringDetails),n,i;if(!t)return r;for(n=0;n<t.length;n++)for(i=0;i<t[n].SubscribedPGDetails.length;i++)r[t[n].SubscribedPGDetails[i].PgId]=t[n].SubscribedPGDetails[i].PgCurrentEtag;return r},t.prototype.start=function(n){setInterval(this.invalidateConfiguration,n)},t.prototype.invalidateConfiguration=function(){sessionStorage.removeItem("INVALIDATE_CONFIG_CACHE_KEY")},t.prototype.resetCache=function(){n.ContextResolutionManager.getInstance().notify(n.ClientResolutionState.Reset)},t.prototype.isDifferent=function(n,t){if(n==t)return!1;if(!n||!t)return!0;if(!n.entries&&!t.entries)return!1;if(!n.entries&&t.entries||n.entries&&!t.entries||n.entries.length!=t.entries.length)return!0;for(var i in n)if(n[i]!=t[i])return!0;return!1},t._instance=null,t}();n.ControlStoreInvalidator=t})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(){if(t._instance)throw new Error("Singleton instance already exists. Access it via FilterByLastUpdatedDate.getInstance()");else t._instance=this}return t.getInstance=function(){return t._instance==null&&(t._instance=new t),t._instance},t.prototype.filter=function(t,i){var r=this.compare(t[0],i);return r==n.PRECEDENCE.HIGHER&&(t[t.length-1]=t[0],t[0]=i),r},t.prototype.compare=function(t,i){var r=t.LastUpdatedDate,u=i.LastUpdatedDate;return r>u?n.PRECEDENCE.LOWER:r<u?n.PRECEDENCE.HIGHER:n.PRECEDENCE.EQUAL},t._instance=null,t}();n.FilterByLastUpdatedDate=t})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var i=function(){function i(){if(this.ISHConstant="Ish",this.appContext=null,this.clientResolutionState=t.Initial,i._instance)throw new Error("Singleton instance already exists for ContextResolutionManager. Access it via ContextResolutionManager.getInstance()");else i._instance=this,this.appContext=_MicrosoftMars.Client.Utility.AppContextFactory.createAppContext()}return i.getInstance=function(){return i._instance==null&&(i._instance=new i),i._instance},i.prototype.fetchControls=function(){var i=jQuery.Deferred(),r=this,u;if(this.decideControlByContextCall()){var f=new window._MicrosoftMars.Client.Utility.ContextEngine,e=window.Microsoft.Mars.Client.Runtime.Controls.ControlTypes,o=_MicrosoftMars.Client.Loader.appContext.isISHPage()?this.ISHConstant:_MicrosoftMars.Client.Loader.appContext.ClientType,s=n.ControlStore.getInstance(),h;_MicrosoftMars.Client.Loader.PerfMarker.MarsCaptureModulePerfTime("PERF_M_ALL_CBC_START");u=f.getControlByContext(e.Any,_MicrosoftMars.Client.Loader.contextAppVersionType,_MicrosoftMars.Client.Loader.appContext.Locale,o,null,null);u.done(function(n){_MicrosoftMars.Client.Loader.PerfMarker.MarsCaptureModulePerfTime("PERF_M_ALL_CBC_END");r.notify(t.ControlByContextCalled);s.storeData(n);r.getCurrentContextData(i,n)});u.fail(function(n){_MicrosoftMars.Client.Loader.marsExceptionHandler.execute(n.status,n.statusText,n.responseJSON);h=null;i.reject()})}else r.getCurrentContextData(i);return i},i.prototype.notify=function(n){this.clientResolutionState=n},i.prototype.controlById=function(t,i){var r=jQuery.Deferred(),f=n.ControlStore.getInstance(),e=f.getControl(t),o,u;return e?r.resolve({Result:e,Succeeded:!0,ErrorCode:0}):(o=new window._MicrosoftMars.Client.Utility.ContextEngine,u=o.getControlById(t,i),u.done(function(n){n.Result&&f.addControl(t,n.Result);r.resolve(n)}),u.fail(function(n){r.reject(n)})),r},i.prototype.getCurrentContextData=function(t,i){i===void 0&&(i=null);var u=n.ControlStore.getInstance(),f=this.appContext.ClientType,r=this.appContext.getPageNavigationInfo(),e=r[f],o=r.QSMap,s=this.appContext.getPageNavigationObject(e,o),h=u.retrievedata(s),c={CBCData:i,filteredControls:h};t.resolve(c)},i.prototype.decideControlByContextCall=function(){var n=!1;return(this.clientResolutionState==t.Initial||this.clientResolutionState==t.Reset)&&(n=!0),n},i._instance=null,i}(),t;n.ContextResolutionManager=i,function(n){n[n.Initial=0]="Initial";n[n.ControlByContextCalled=1]="ControlByContextCalled";n[n.Reset=2]="Reset"}(n.ClientResolutionState||(n.ClientResolutionState={}));t=n.ClientResolutionState})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(){"use strict"})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(){if(this.appContext=null,this.pageNavigationInfo=null,this.userRoleListInfo=null,this.dynamicPropertiesInfo=[],this.appModuleContext=[],t._instance)throw new Error("Singleton instance already exists for ControlStore. Access it via ControlStore.getInstance()");else t._instance=this,this.resetControlStore(),this.appContext=_MicrosoftMars.Client.Utility.AppContextFactory.createAppContext()}return t.getInstance=function(){return t._instance==null&&(t._instance=new t),t._instance},t.prototype.resetControlStore=function(){this.controlIdToControlObject={};this.pageNavigationKeyToPageNavigationInfo={};this.pageNavigationKeyToControlId={};this.wcPageNavigationKeyToControlId={};this.contextHomeSideBar={};this.errorSideBar={};this.errorGuidedTask={};_MicrosoftMars.Client.Loader.contextHomeSidebar=[];_MicrosoftMars.Client.Loader.defaultExceptionControlList=[]},t.prototype.getControl=function(n){return this.controlIdToControlObject[n]},t.prototype.addControl=function(n,t){this.controlIdToControlObject[n]=t},t.prototype.storeData=function(n){var i=n.Result,t,n,r;if(!0&&this.resetControlStore(),i)for(t=0;t<i.length;t++)n=i[t],r={Id:n.PublishGroupId,Precedence:n.Precedence},this.parseControlData(n.AnswerPanels,r),this.parseControlData(n.Stepthroughs,r)},t.prototype.retrievedata=function(n){var r={},v=n.PageKey,e=this.retrieveFromControlMap(this.pageNavigationKeyToControlId,v),i,u,o,f,h,s;if(e){if(i=r.sidebar=e.sidebar,u=r.stepThrough=e.stepThrough,(!i||!u)&&_MicrosoftMars.Client.Utility.FFFUtility.isFeatureEnabled(_MicrosoftMars.Client.Utility.FFFUtility.WildcardingFeatureName))for(o=this.appContext.getWildcardedPageKeys(n),f=0,h=o.length;f<h;f++){var c=this.retrieveFromControlMap(this.wcPageNavigationKeyToControlId,o[f]),l=c.sidebar,a=c.stepThrough;if(!i&&l&&(i=l,r.sidebar=i),!u&&a&&(u=a,r.stepThrough=u),i&&u)return r}i||(s=this.contextHomeSideBar[t.ContextHomeSideBarConstant],s&&s.length>0&&(i=_MicrosoftMars.Client.Loader.contextHomeSidebar[0],r.sidebar=i))}return r},t.prototype.parseControlData=function(i,r){for(var f,s,c=this.appContext.ClientType,l=i.length,o=0;o<l;o++){f=i[o];s=f.ControlId;f.PublishGroupId=r.Id;var a=new Date(f.LastUpdatedDate).getTime(),v=f.AuthoringId,e={ControlId:s,LastUpdatedDate:a,PublishGroupPrecedence:r.Precedence,AuthoringId:v};this.addControl(s,f);this.processControlContext(f);var u=this,y=function(){var n,r,i,l,a,v,y,p,w,b,k,d;if(u.isNavigationEnabled(f)&&(n=u.pageNavigationInfo,n&&(r=n[c],r))){var g=n.QSMap,nt=n.wildcard,o=u.appContext.getPageNavigationObject(r,g,nt),s=o.PageKey,h=o.WildCardPageKey;u.pageNavigationKeyToPageNavigationInfo[s]=n;u.insertControlIntoMap(u.pageNavigationKeyToControlId,s,e);h&&u.insertControlIntoMap(u.wcPageNavigationKeyToControlId,h,e)}i=window.Microsoft.Mars.Client.Runtime.Controls.ControlTypes;f.IsContextHomeSideBar&&f.ControlType==i.AnswerPanel&&(l=t.ContextHomeSideBarConstant,u.insertControlIntoMap(u.contextHomeSideBar,l,e),_MicrosoftMars.Client.Loader.contextHomeSidebar&&(a=u.contextHomeSideBar[t.ContextHomeSideBarConstant],v=u.getControl(a[0].ControlId),_MicrosoftMars.Client.Loader.contextHomeSidebar[0]=v));f.IsErrorControl&&f.ControlType==i.StepThrough&&(y=t.ErrorGuidedTaskConstant,u.insertControlIntoMap(u.errorGuidedTask,y,e),_MicrosoftMars.Client.Loader.defaultExceptionControlList&&(p=u.errorGuidedTask[t.ErrorGuidedTaskConstant],w=u.getControl(p[0].ControlId),_MicrosoftMars.Client.Loader.defaultExceptionControlList[1]=w));f.IsErrorControl&&f.ControlType==i.AnswerPanel&&(b=t.ErrorSideBarConstant,u.insertControlIntoMap(u.errorSideBar,b,e),_MicrosoftMars.Client.Loader.defaultExceptionControlList&&(k=u.errorSideBar[t.ErrorSideBarConstant],d=u.getControl(k[0].ControlId),_MicrosoftMars.Client.Loader.defaultExceptionControlList[0]=d))},h=this;n.TriggerFilter.getInstance().filter(f,function(){n.AppModuleFilter.getInstance().filter(h.appModuleContext,function(){n.DynamicPropertyFilter.getInstance().filter(h.dynamicPropertiesInfo,y)})});this.resetControlContext()}},t.prototype.processControlContext=function(n){for(var i,f,u=n.Contexts[0].ContextGroup.ContextGroupElements,r=0;r<u.length;r++){i=u[r];f=u[r].ContextTypeMetaDataId.toString();switch(f){case t.PageNavigationInfo:this.pageNavigationInfo=this.processPageNavigation(i);break;case t.UserRoleInfo:this.userRoleListInfo=this.processUserRoles(i);break;case t.DynamicContext:this.dynamicPropertiesInfo=this.processDynamicContext(i);break;case t.AppModuleContext:this.appModuleContext=this.processAppModuleContext(i)}}},t.prototype.resetControlContext=function(){this.pageNavigationInfo=null;this.userRoleListInfo=null;this.dynamicPropertiesInfo=[];this.appModuleContext=[]},t.prototype.processPageNavigation=function(n){var t=n.ContextValues,i=null;return t[0].Value&&t[0].Value!=""&&(i=JSON.parse(t[0].Value)),i},t.prototype.processUserRoles=function(n){for(var i=[],r=n.ContextValues,t=0;t<r.length;t++)i.push(r[t].Value);return i},t.prototype.processDynamicContext=function(n){for(var r,u=[],i=n.ContextValues,t=0;t<i.length;t++)i[t].EntityContextValue&&(r=i[t].EntityContextValue,_MicrosoftMars.Client.Utility.DynamicContext.parseValue(r),u.push(r));return u},t.prototype.processAppModuleContext=function(n){var i=[],t,r;if(n.ContextValues)for(t=0;t<n.ContextValues.length;t++)r=JSON.parse(n.ContextValues[t].Value),i.push(r);return i},t.prototype.isNavigationEnabled=function(n){return!(n.IsContextHomeSideBar||n.IsErrorControl)},t.prototype.retrieveFromControlMap=function(n,t){var o=window.Microsoft.Mars.Client.Runtime.Controls.ControlTypes,i={},u,e,f,s,r;if(t&&(u=n[t],e=!1,u))for(f=0;f<u.length;f++)if(s=u[f].ControlId,r=this.controlIdToControlObject[s],r.ControlType==o.AnswerPanel){if(e)continue;i.sidebar=r;e=!0}else r.ControlType==o.StepThrough&&((i.stepThrough==null||i.stepThrough==undefined)&&(i.stepThrough=[]),i.stepThrough[i.stepThrough.length]=r);return i},t.prototype.insertControlIntoMap=function(t,i,r){var e,f,o,u,s;t[i]?(t[i].push(r),f=t[i],o=n.FilterByPublishGroupPrecedence.getInstance(),o.filter(f,r)==n.PRECEDENCE.EQUAL&&(u=n.FilterByUserRolePrecedence.getInstance(),u.setUserRolesLists(this.userRoleListInfo,this.appContext.RoleTemplates),u.filter(f,r)==n.PRECEDENCE.EQUAL&&(s=n.FilterByLastUpdatedDate.getInstance(),s.filter(f,r)))):(u=n.FilterByUserRolePrecedence.getInstance(),u.setUserRolesLists(this.userRoleListInfo,this.appContext.RoleTemplates),u.setUserRolePrecedence(r),e=[],t[i]=e,t[i].push(r))},t.PageNavigationInfo="8",t.UserRoleInfo="3",t.DynamicContext="9",t.AppModuleContext="10",t.ContextHomeSideBarConstant="ContextHomeSideBar",t.ErrorSideBarConstant="ErrorSideBar",t.ErrorGuidedTaskConstant="ErrorGuidedTask",t._instance=null,t}();n.ControlStore=t})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){if(n._instance)throw new Error("Singleton instance already exists. Access it via TriggerFilter.getInstance()");else n._instance=this}return n.getInstance=function(){return n._instance==null&&(n._instance=new n),n._instance},n.prototype.filter=function(n,t){var r=typeof n.Events=="string"?JSON.parse(n.Events):n.Events,i;r&&r[0]&&(i=r[0].Trigger,(n.IsErrorControl||i=="landing"||i=="click"||i=="delay")&&t())},n._instance=null,n}();n.TriggerFilter=t})(t=n.ContextResolution||(n.ContextResolution={}))})(t=n.Client||(n.Client={}))})(t=n.Mars||(n.Mars={}))}(Microsoft||(Microsoft={}));