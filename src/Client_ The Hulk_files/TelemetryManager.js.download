var Queue,__extends,_MicrosoftMars;(function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(n,t){this.parameterName=n;this.value=t}return n.prototype.ParameterName=function(){return this.parameterName},n.prototype.Value=function(){return this.value},n}();n.EventParameter=t})(t=n.Telemetry||(n.Telemetry={}))})(t=n.Client||(n.Client={}))})(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(t){var i;(function(t){"use strict";var i=function(){function t(){if(this.analyticsApi=null,t._instance)throw new Error("Singleton instance already exists for ServiceHandler. Access it via ServiceHandler.getInstance()");else t._instance=this,this.analyticsApi=new n.Client.Loader.AnalyticsAPI}return t.getInstance=function(){return t._instance==null&&(t._instance=new t),t._instance},t.prototype.logUserActivity=function(n){return this.analyticsApi.logUserActivity(n)},t._instance=null,t}();t.ServiceHandler=i})(i=t.Telemetry||(t.Telemetry={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.download=function(){try{var i=new Blob([localStorage.getItem("marslogs")],{type:"text/plain"}),t=document.createElement("a");t.download="marslogs.txt";t.innerHTML="Download File";window.webkitURL!=null?t.href=window.webkitURL.createObjectURL(i):(t.href=window.URL.createObjectURL(i),t.onclick=n.destroyClickedElement,t.style.display="none",document.body.appendChild(t));t.click()}catch(r){console.log("cannot download the log file")}localStorage.setItem("marslogs",JSON.stringify([]))},n.destroyClickedElement=function(n){document.body.removeChild(n.target)},n.prototype.notify=function(t){var i=JSON.parse(localStorage.getItem("marslogs"))||[];i[i.length]=t;localStorage.setItem("marslogs",JSON.stringify(i));i.length>5e3&&n.download()},n}();n.FileLoggingPlatform=t})(t=n.Telemetry||(n.Telemetry={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function n(){}return n.newGuid=function(){for(var i,r="xx-x-4m-ym-xxx",n="",t=0;t<r.length;t++){i=Math.floor(Math.random()*Date.now());switch(r[t]){case"x":n+=i.toString(16).substring(0,4);break;case"m":n+=i.toString(16).substring(0,3);break;case"y":n+=(i&3|8).toString(16);break;default:n+=r[t]}}return n},n}();n.Guid=t})(t=n.Telemetry||(n.Telemetry={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(){"use strict"})(t=n.Telemetry||(n.Telemetry={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(){this.levelMap={};t._instance||(t._instance=this);this.isEnabled=!1;this.levelMap[t.INFO]=!0;this.levelMap[t.DEBUG]=!0;this.levelMap[t.WARNING]=!0;this.levelMap[t.ERROR]=!0;this.loggingPlatform=new n.FileLoggingPlatform}return t.getInstance=function(){return t._instance==null&&(t._instance=new t),t._instance},t.prototype.setEnabled=function(n){this.isEnabled=n},t.prototype.setLevel=function(n,t){this.levelMap[n]=t},t.prototype.setLoggingPlatform=function(n){this.loggingPlatform=n},t.prototype.log=function(n,i){try{if(this.isEnabled&&this.levelMap[n]){var r=(new Date).toString(),u=JSON.parse('{"timestamp":"'+r+'","message":"'+i+'","level":"'+n+'"}');this.loggingPlatform.notify(u)}}catch(f){this.log(t.ERROR,"Error Occured in Logger: log")}},t.INFO="INFO",t.DEBUG="DEBUG",t.WARNING="WARNING",t.ERROR="ERROR",t._instance=null,t}();n.Logger=t})(t=n.Telemetry||(n.Telemetry={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){"use strict";var t=function(){function t(n,t){this.activityId=n;(this.activityId===null||this.activityId==="")&&(this.activityId=this.ActiveSessionId());this.eventName=t;this.eventParameters=[]}return t.prototype.AddEventParameter=function(t,i){this.eventParameters.push(new n.EventParameter(t,i))},t.prototype.ToJson=function(){var t={},i,n;for(t.ActivityId=this.activityId,t.EventName=this.eventName,i={},n=0;n<this.eventParameters.length;n++)i[this.eventParameters[n].ParameterName()]=this.eventParameters[n].Value();return t.EventValues=i,t},t.prototype.ActiveSessionId=function(){return t.activeSessionId},t.prototype.IsActivityIdSet=function(){return t.isActivityIdSet},t.prototype.ActivityId=function(){return this.activityId},t.prototype.EventName=function(){return this.eventName},t.prototype.EventParameters=function(){return this.eventParameters},t.activeSessionId=n.Guid.newGuid(),t}();n.MarsTelemetryEvent=t})(t=n.Telemetry||(n.Telemetry={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={}));Queue=function(){function n(){this._arr=[]}return Object.defineProperty(n.prototype,"canDequeue",{get:function(){return this._arr.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this._arr.length},enumerable:!0,configurable:!0}),n.prototype.enqueue=function(n){this._arr.push(n)},n.prototype.dequeue=function(){return this._arr.shift()},n.prototype.peek=function(){return this._arr.length===0?undefined:this._arr[0]},n.prototype.clear=function(){delete this._arr;this._arr=[]},n}(),function(n){var t;(function(t){var i;(function(t){"use strict";var i=function(){function t(){this.timeoutTimerId=t.DefaultTimerId;t.pendingEvents=new Queue}return t.Instance=function(){return t.instance==null&&(t.instance=new t),t.instance},t.SetReportingInterval=function(){var i=n.Client.Loader.appContext.Util.getConfigurationData("GlobalConfiguration");return i.Configuration.telemetryReportingInterval?i.Configuration.telemetryReportingInterval:t.DefaultReportingInterval},t.prototype.AddTelemetryEvent=function(n){t.pendingEvents.enqueue(n);this.ConfigureReportingTimer(!1)},t.prototype.ReportEvents=function(){var f=t.pendingEvents.count,e,r,i,o,s,h,u;for(e=f<t.MaxEventsPerReport?f:t.MaxEventsPerReport,r=[],i=0;i<e;i++)o=t.pendingEvents.dequeue(),r[i]=o.ToJson();s=n.Client.Telemetry.ServiceHandler.getInstance();h=s.logUserActivity(r);h.fail(function(n){console.error("Sending Learning Path Telemetry data failed -"+n)});u=!0;t.pendingEvents.count>0&&(this.timeoutTimerId=t.DefaultTimerId,u=!1);t.Instance().ConfigureReportingTimer(u)},t.prototype.ConfigureReportingTimer=function(n){n?this.timeoutTimerId=t.DefaultTimerId:this.timeoutTimerId===t.DefaultTimerId&&(this.timeoutTimerId=1,setTimeout(this.ReportEvents,t.ReportingInterval))},t.MaxEventsPerReport=200,t.DefaultReportingInterval=3e5,t.ReportingInterval=t.SetReportingInterval(),t.DefaultTimerId=-1,t}();t.TelemetryReporter=i})(i=t.Telemetry||(t.Telemetry={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t;(function(t){var i;(function(t){"use strict";var u,i,f,e,r;t.UserActivityEventName="MarsUserActivity";u=function(u){function f(n){u.call(this,null,t.UserActivityEventName+n);this.activityName=n}return __extends(f,u),f.prototype.SetUserActivityInfo=function(r,u,f,e,o,s,h,c,l,a){this.AddEventParameter(i.id,t.Guid.newGuid());this.AddEventParameter(i.controlName,c);this.AddEventParameter(i.userId,r);this.AddEventParameter(i.controlId,u);this.AddEventParameter(i.publishGroupId,f);this.AddEventParameter(i.publishGroupName,e);this.AddEventParameter(i.authoringGroupId,o);this.AddEventParameter(i.appModuleUniqueName,n.Client.Loader.appContext.getCurrentAppModule());this.AddEventParameter(i.lifeCycleStage,n.Client.Loader.appContext.currentStage);this.AddEventParameter(i.gtid,l);this.AddEventParameter(i.gtname,a);this.controlId=u;this.AddEventParameter(i.parentActivityId,s);this.AddEventParameter(i.author,h);this.AddEventParameter(i.locale,n.Client.Loader.appContext.locale);this.SetStartTime()},f.prototype.SetActivityData=function(u){var f;this.activityName===r.answerpanel&&(this.AddEventParameter(i.eModule,u[0]),this.AddEventParameter(i.entity,u[1]),this.AddEventParameter(i.pageType,u[2]),this.AddEventParameter(i.elementClicked,u[3]),this.AddEventParameter(i.activationEvent,u[4]),this.AddEventParameter(i.version,u[5]));this.activityName===r.guidedtask&&(this.AddEventParameter(i.eModule,u[0]),this.AddEventParameter(i.entity,u[1]),this.AddEventParameter(i.pageType,u[2]),this.AddEventParameter(i.elementClicked,u[3]),this.AddEventParameter(i.activationEvent,u[4]),this.AddEventParameter(i.version,u[5]),this.AddEventParameter(i.progressId,u[6]));this.activityName===r.activestepbubble&&(this.AddEventParameter(i.eModule,u[0]),this.AddEventParameter(i.entity,u[1]),this.AddEventParameter(i.pageType,u[2]),this.AddEventParameter(i.elementClicked,u[3]));this.activityName===r.passivestepbubble&&(this.AddEventParameter(i.eModule,u[0]),this.AddEventParameter(i.entity,u[1]),this.AddEventParameter(i.pageType,u[2]),this.AddEventParameter(i.elementClicked,u[3]));this.activityName===r.infobubble&&(this.AddEventParameter(i.eModule,u[0]),this.AddEventParameter(i.entity,u[1]),this.AddEventParameter(i.pageType,u[2]),this.AddEventParameter(i.elementClicked,u[3]));this.activityName===r.search&&(this.AddEventParameter(i.eModule,u[0]),this.AddEventParameter(i.entity,u[1]),this.AddEventParameter(i.pageType,u[2]),this.AddEventParameter(i.searchText,u[3]),this.AddEventParameter(i.sectionClicked,u[4]),this.AddEventParameter(i.targetUrl,u[5]));this.activityName===r.feedback&&(this.AddEventParameter(i.mood,u[0]),this.AddEventParameter(i.feedbackText,u[1]),this.AddEventParameter(i.pageType,u[2]));this.activityName===r.video&&(this.AddEventParameter(i.controlType,u[0]),this.AddEventParameter(i.videoUrl,u[1]),this.AddEventParameter(i.stage,u[2]),this.AddEventParameter(i.userRole,u[3]));this.activityName===r.linkClick&&(this.AddEventParameter(i.sourceElement,u[0]),this.AddEventParameter(i.version,u[1]),this.AddEventParameter(i.elementClicked,u[2]),this.AddEventParameter(i.targetControlId,u[3]),this.AddEventParameter(i.targetControlName,u[4]),this.AddEventParameter(i.targetVersion,u[5]),this.AddEventParameter(i.targetAuthoringGroupId,u[6]),this.AddEventParameter(i.targetPublishGroupId,u[7]),this.AddEventParameter(i.targetAuthor,u[8]),this.AddEventParameter(i.targetUrl,u[9]),this.AddEventParameter(i.userRole,u[10]),this.AddEventParameter(i.searchText,u[11]));this.activityName===r.analyze&&this.AddEventParameter(i.elementClicked,u[0]);this.activityName===r.answerpanelAuthoring&&(f=n.Client.Loader.appContext,this.AddEventParameter(t.UserInfoParameters.version,f.AppVersion),this.AddEventParameter(t.UserInfoParameters.paid,f.isPaid?!0:!1),this.AddEventParameter(t.UserInfoParameters.orgSize,Number(f.OrgSize)),this.AddEventParameter(t.UserInfoParameters.orgAge,f.orgAge?Number(f.orgAge):0),this.AddEventParameter(t.UserInfoParameters.client,f.ClientType),this.AddEventParameter(t.UserInfoParameters.clientFormFactor,u[0]),this.AddEventParameter(i.controlEnabledFormFactors,u[1]),this.AddEventParameter(i.baseLocale,u[2]),this.AddEventParameter(i.activationEvent,u[3]),this.AddEventParameter(i.isErrorControl,u[4]),this.AddEventParameter(i.isContextHomeSideBar,u[5]),this.AddEventParameter(i.templateType,u[6]),this.AddEventParameter(i.sectionCount,u[7]),this.AddEventParameter(i.tags,u[8]));this.activityName===r.guidedtaskAuthoring&&(f=n.Client.Loader.appContext,this.AddEventParameter(t.UserInfoParameters.version,f.AppVersion),this.AddEventParameter(t.UserInfoParameters.paid,f.isPaid?!0:!1),this.AddEventParameter(t.UserInfoParameters.orgSize,Number(f.OrgSize)),this.AddEventParameter(t.UserInfoParameters.orgAge,f.orgAge?Number(f.orgAge):0),this.AddEventParameter(t.UserInfoParameters.client,f.ClientType),this.AddEventParameter(t.UserInfoParameters.clientFormFactor,u[0]),this.AddEventParameter(i.controlEnabledFormFactors,u[1]),this.AddEventParameter(i.baseLocale,u[2]),this.AddEventParameter(i.activationEvent,u[3]),this.AddEventParameter(i.isErrorControl,u[4]),this.AddEventParameter(i.stepCount,u[5]),this.AddEventParameter(i.tags,u[6]));this.activityName===r.guidedtaskStepAuthoring&&(f=n.Client.Loader.appContext,this.AddEventParameter(t.UserInfoParameters.version,f.AppVersion),this.AddEventParameter(t.UserInfoParameters.paid,f.isPaid?!0:!1),this.AddEventParameter(t.UserInfoParameters.orgSize,Number(f.OrgSize)),this.AddEventParameter(t.UserInfoParameters.orgAge,f.orgAge?Number(f.orgAge):0),this.AddEventParameter(t.UserInfoParameters.client,f.ClientType),this.AddEventParameter(t.UserInfoParameters.clientFormFactor,u[0]),this.AddEventParameter(i.controlEnabledFormFactors,u[1]),this.AddEventParameter(i.bubblePosition,u[2]),this.AddEventParameter(i.bubbleType,u[3]),this.AddEventParameter(i.bubbleContentType,u[4]),this.AddEventParameter(i.tags,u[5]))},f.prototype.GetActivityId=function(){return this.controlId},f.prototype.FinishActivity=function(n){this.SetEndTime();this.SetEndAction(n);t.TelemetryReporter.Instance().AddTelemetryEvent(this)},f.prototype.SetStartTime=function(){var n=new Date,t=n.toString();this.AddEventParameter(i.startTime,t)},f.prototype.SetEndAction=function(n){this.AddEventParameter(i.endAction,n)},f.prototype.SetEndTime=function(){var n=new Date,t=n.toString();this.AddEventParameter(i.endTime,t)},f}(t.MarsTelemetryEvent);t.UserActivityEvent=u;i=function(){function n(){}return n.id="id",n.controlId="controlid",n.controlName="controlname",n.publishGroupId="publishgroupid",n.publishGroupName="publishgroupname",n.authoringGroupId="authoringgroupid",n.appModuleUniqueName="appmoduleuniquename",n.lifeCycleStage="stage",n.gtname="gtname",n.gtid="gtid",n.userId="userid",n.parentActivityId="parentactivityid",n.endAction="endaction",n.startTime="starttime",n.endTime="endtime",n.author="author",n.locale="locale",n.eModule="module",n.entity="entity",n.pageType="pagetype",n.elementClicked="elementclicked",n.activationEvent="activationevent",n.version="version",n.progressId="progressid",n.searchText="searchtext",n.sectionClicked="sectionclicked",n.feedbackText="feedbacktext",n.mood="mood",n.controlType="controltype",n.videoUrl="videourl",n.stage="stage",n.userRole="userrole",n.sourceElement="sourceelement",n.targetControlName="targetcontrolname",n.targetControlId="targetcontrolid",n.targetPublishGroupId="targetpublishgroupid",n.targetAuthoringGroupId="targetauthoringgroupid",n.targetVersion="targetversion",n.targetAuthor="targetauthor",n.targetUrl="targeturl",n.baseLocale="baselocale",n.isErrorControl="iserrorcontrol",n.isContextHomeSideBar="ishomesidebar",n.templateType="template",n.sectionCount="sectioncount",n.stepCount="stepcount",n.bubblePosition="position",n.bubbleType="bubbletype",n.bubbleContentType="contenttype",n.controlEnabledFormFactors="controlformfactors",n.tags="tags",n}();t.UserActivityParameters=i;f=function(){function n(){}return n.complete="complete",n.incomplete="incomplete",n.close="close",n.error="error",n.buy="buy",n.trial="try",n.demo="demo",n.chat="chat",n.call="call",n.rendered="rendered",n.played="played",n.playingCompleted="playingcompleted",n.loaded="loaded",n.failed="failed",n.searched="searched",n.clicked="clicked",n.created="created",n.checkedin="checkedin",n.published="published",n.edited="edited",n}();t.EndAction=f;e=function(){function n(){}return n.ignored="ignored",n.x="x",n.previous="previous",n.next="next",n.popout="popOut",n}();t.UserClicks=e;r=function(){function n(){}return n.answerpanel="Sidebar",n.guidedtask="GuidedTask",n.infobubble="InfoBubble",n.activestepbubble="ActiveStepBubble",n.passivestepbubble="PassiveStepBubble",n.search="Search",n.feedback="Feedback",n.launchmars="LaunchMars",n.liveChat="LiveChat",n.callMe="CallMe",n.buyNow="BuyNow",n.video="Video",n.linkClick="LinkClick",n.analyze="Analyze",n.answerpanelAuthoring="SidebarAuthoring",n.guidedtaskAuthoring="GuidedTaskAuthoring",n.guidedtaskStepAuthoring="GuidedTaskStepAuthoring",n}();t.ActivityName=r})(i=t.Telemetry||(t.Telemetry={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){"use strict";var i,t;n.UserInfoEventName="MarsUserInfo";i=function(i){function r(){i.call(this,null,n.UserInfoEventName)}return __extends(r,i),r.prototype.SetUserInfo=function(n,i,r,u){this.AddEventParameter(t.userId,n);this.AddEventParameter(t.userRole,i);this.AddEventParameter(t.paid,r.toString());this.AddEventParameter(t.stage,u);this.SetStartTime()},r.prototype.SetEnvInfo=function(n,i,r,u,f,e,o,s){this.AddEventParameter(t.app,n);this.AddEventParameter(t.version,i);this.AddEventParameter(t.appModule,r);this.AddEventParameter(t.clientFormFactor,u);this.AddEventParameter(t.os,f);this.AddEventParameter(t.browser,e);this.AddEventParameter(t.locale,o);this.AddEventParameter(t.client,s)},r.prototype.SetOrgInfo=function(n,i,r,u,f,e,o,s,h,c){this.AddEventParameter(t.org,n);this.AddEventParameter(t.tenant,i);this.AddEventParameter(t.orgType,r);this.AddEventParameter(t.orgSize,u.toString());this.AddEventParameter(t.orgLicenses,f.toString());this.AddEventParameter(t.mnc,e);this.AddEventParameter(t.cloudType,o);this.AddEventParameter(t.orgUrl,s);this.AddEventParameter(t.country,h);this.AddEventParameter(t.market,c)},r.prototype.FinishActivity=function(){n.TelemetryReporter.Instance().AddTelemetryEvent(this);n.MarsTelemetryEvent.isActivityIdSet=!0},r.prototype.SetStartTime=function(){var n=new Date,i=n.toString();this.AddEventParameter(t.startTime,i)},r}(n.MarsTelemetryEvent);n.UserInfoEvent=i;t=function(){function n(){}return n.userId="userid",n.userRole="userrole",n.paid="paid",n.stage="stage",n.startTime="starttime",n.app="app",n.version="version",n.appModule="module",n.clientFormFactor="formfactor",n.os="os",n.browser="browser",n.locale="locale",n.client="client",n.org="organization",n.tenant="tenant",n.orgType="orgtype",n.orgSize="orgsize",n.orgLicenses="orglicenses",n.mnc="mnc",n.cloudType="cloudtype",n.orgUrl="orgurl",n.country="country",n.market="market",n.orgAge="orgage",n}();n.UserInfoParameters=t})(t=n.Telemetry||(n.Telemetry={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={})),function(n){var t;(function(n){var t;(function(n){"use strict";var i,t,r;n.ExceptionEventName="MarsUserException";i=function(i){function r(){i.call(this,null,n.ExceptionEventName)}return __extends(r,i),r.prototype.SetExceptionData=function(n,i,r,u,f,e,o,s,h,c,l,a){this.AddEventParameter(t.userId,n);this.AddEventParameter(t.activityType,i);this.AddEventParameter(t.clientInfo,r);this.AddEventParameter(t.errorMsg,u);this.AddEventParameter(t.errorType,f);this.AddEventParameter(t.page,e);this.AddEventParameter(t.pageType,o);this.AddEventParameter(t.stackTrace,s);this.AddEventParameter(t.controlName,h);this.AddEventParameter(t.controlId,c);this.AddEventParameter(t.lifeCycleStage,l);this.AddEventParameter(t.locale,a);this.SetStartTime()},r.prototype.FinishActivity=function(){n.TelemetryReporter.Instance().AddTelemetryEvent(this)},r.prototype.SetStartTime=function(){var n=new Date,i=n.toString();this.AddEventParameter(t.startTime,i)},r}(n.MarsTelemetryEvent);n.ExceptionEvent=i;t=function(){function n(){}return n.userId="userid",n.activityType="activitytype",n.clientInfo="clientinfo",n.errorMsg="errormessage",n.errorType="errortype",n.startTime="starttime",n.page="page",n.pageType="pagetype",n.stackTrace="stacktrace",n.controlName="controlname",n.controlId="controlid",n.lifeCycleStage="stage",n.locale="locale",n}();r=function(){function n(){}return n.ErrorType_JS="JS",n.ErrorType_HTML="HTML",n.ErrorType_Context_Mismatch="Context Mismatch",n.ErrorType_Locale="Locale",n.ErrorType_Region="Region",n}();n.ExceptionConstants=r})(t=n.Telemetry||(n.Telemetry={}))})(t=n.Client||(n.Client={}))}(_MicrosoftMars||(_MicrosoftMars={}));